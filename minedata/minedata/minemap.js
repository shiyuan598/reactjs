/*
 * @description: 
 * @Date: 2020-03-02 11:01:55
 * @LastEditTime: 2020-06-05 16:12:52
 */ 
/**
 * 最后修改时间：2020-6-3 15:09:26
 * 软件版本：minemap 3d 3.0.0版 
 */
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(global.minemap = factory());
}(this, (function () { 'use strict';

var shared, worker, minemap;function define(_, chunk) {if (!shared) {shared = chunk;} else if (!worker) {worker = chunk;} else {var workerBundleString = 'var sharedChunk = {}; (' + shared + ')(sharedChunk); (' + worker + ')(sharedChunk);';var sharedChunk = {};shared(sharedChunk);minemap = chunk(sharedChunk);minemap.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: 'text/javascript' }));}}


define(["exports"],function(t){"use strict";function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),r=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,a=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,n={now:i,frame:function(t){var e=r(t);return{cancel:function(){return a(e)}}},getImageData:function(t){var e=self.document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(0,0,t.width,t.height)},resolveURL:function(t){var e=self.document.createElement("a");return e.href=t,e.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},supportsWebp:!1};if(self.document){var o=self.document.createElement("img");o.onload=function(){n.supportsWebp=!0;},o.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";}var s=u;function u(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=i,this.p2y=r;}u.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},u.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},u.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},u.prototype.solveCurveX=function(t,e){var i,r,a,n,o;for(void 0===e&&(e=1e-6),a=t,o=0;o<8;o++){if(n=this.sampleCurveX(a)-t,Math.abs(n)<e)return a;var s=this.sampleCurveDerivativeX(a);if(Math.abs(s)<1e-6)break;a-=n/s;}if(r=1,(a=t)<(i=0))return i;if(a>r)return r;for(;i<r;){if(n=this.sampleCurveX(a),Math.abs(n-t)<e)return a;t>n?i=a:r=a,a=.5*(r-i)+i;}return a},u.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var l=function(t,e,i){this.column=t,this.row=e,this.zoom=i;};l.prototype.clone=function(){return new l(this.column,this.row,this.zoom)},l.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},l.prototype.sub=function(t){return this.clone()._sub(t)},l.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},l.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this};var p=c;function c(t,e,i){this.x=t,this.y=e,this.z=i||0;}function h(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!h(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(!h(t[r],e[r]))return!1;return!0}return t===e}function f(t,e,i,r){var a=new s(t,e,i,r);return function(t){return a.solve(t)}}c.prototype={clone:function(){return new c(this.x,this.y,this.z)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,a=i*this.x+e*this.y;return this.x=r,this.y=a,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),a=e.x+i*(this.x-e.x)-r*(this.y-e.y),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=a,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(t){return t instanceof c?t:Array.isArray(t)?new c(t[0],t[1],t[2]):t};var m=f(.25,.1,.25,1),d=f(0,.7,1,.3);function _(t,e,i){return Math.min(i,Math.max(e,t))}function y(t,e,i){var r=i-e,a=((t-e)%r+r)%r+e;return a===e?i:a}function g(t,e,i){if(!t.length)return i(null,[]);var r=t.length,a=new Array(t.length),n=null;t.forEach(function(t,o){e(t,function(t,e){t&&(n=t),a[o]=e,0==--r&&i(n,a);});});}function v(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var r=0,a=e;r<a.length;r+=1){var n=a[r];for(var o in n)t[o]=n[o];}return t}function x(t,e){for(var i={},r=0;r<e.length;r++){var a=e[r];a in t&&(i[a]=t[a]);}return i}var b=1;function w(){return b++}function A(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e));});}function T(t,e){return-1!==t.indexOf(e,t.length-e.length)}function S(t,e,i){var r={};for(var a in t)r[a]=e.call(i||this,t[a],a,t);return r}function E(t,e,i){var r={};for(var a in t)e.call(i||this,t[a],a,t)&&(r[a]=t[a]);return r}function P(t){return Array.isArray(t)?t.map(P):"object"==typeof t&&t?S(t,P):t}var I={};function R(t){I[t]||("undefined"!=typeof console&&console.warn(t),I[t]=!0);}function M(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function z(t){for(var e=0,i=0,r=t.length,a=r-1,n=void 0,o=void 0;i<r;a=i++)n=t[i],e+=((o=t[a]).x-n.x)*(n.y+o.y);return e}function C(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,i,r,a){var n=r||a;return e[i]=!n||n.toLowerCase(),""}),e["max-age"]){var i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i;}return e}var O={DOMAIN:"//minedata.cn",DATA_DOMAIN:"//datahive.minedata.cn",API_BASE:"/data/",API_URL:"//datahive.minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//datahive.minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//datahive.minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//datahive.minedata.cn/otherdata/",SRC_BASE:"/minemapapi/v3.0.0/",SRC_URL:"//minedata.cn/minemapapi/v3.0.0/",SERVICE_BASE:"/service",SERVICE_URL:"//minedata.cn/service",REQUIRE_ACCESS_TOKEN:!0,APP_KEY:null,ACCESS_TOKEN:null},F="参见minedata.cn帮助页面";function L(t,e,i,r){switch(t.protocol){case"minemap":var a=U(O.SRC_URL);t.protocol=a.protocol,t.authority=a.authority;break;case"minemapdata":var n=U(O.API_URL);t.path=n.path+t.authority+t.path,t.protocol=n.protocol,t.authority=n.authority;break;case"minemapdatad":var o=U(O.DYN_URL);t.path=o.path+t.authority+t.path,t.protocol=o.protocol,t.authority=o.authority;break;case"minemapdatam":var s=U(O.MERGE_URL);t.path=s.path+t.authority+t.path,t.protocol=s.protocol,t.authority=s.authority;break;case"minemapdatao":var u=U(O.OTHER_URL);t.path=u.path+t.authority+t.path,t.protocol=u.protocol,t.authority=u.authority;}if(!O.REQUIRE_ACCESS_TOKEN)return j(t);if(e=e||O.APP_KEY,i=i||O.SOLU,r=r||O.DATA_VERSION,!e&&!O.ACCESS_TOKEN)throw new Error("需要申请appKey. "+F);if(!i)throw new Error("需要申请solution id. "+F);return O.ACCESS_TOKEN&&t.params.push("token="+O.ACCESS_TOKEN),e&&t.params.push("appKey="+e),t.params.push("solu="+i),r&&t.params.push("version="+r),j(t)}function D(t){return 0===t.indexOf("minemap:")||0===t.indexOf("minemapdata:")||0===t.indexOf("minemapdatad:")||0===t.indexOf("minemapdatam:")||0===t.indexOf("minemapdatao:")}var N=function(t,e){if(!D(t))return t;var i=U(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),L(i,e)},k=/(\.(png|jpg)\d*)(?=$)/,B=function(t,e,i){if(!t||!D(t))return t.startsWith("//")?""+window.document.location.protocol+t:t;var r=U(t),a=n.devicePixelRatio>=2||512===i?"@2x":"",o=n.supportsWebp?".webp":"$1";return r.path=r.path.replace(k,""+a+o),function(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(O.ACCESS_TOKEN||""));}(r.params),L(r)};var V=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function U(t){var e=t.match(V);if(!e){var i=t.match(/^\/\/([^/?]+)(\/[^?]+)?\??(.+)?/);if(!i)throw new Error("Unable to parse URL object");return{protocol:"",authority:i[1],path:i[2]||"/",params:i[3]?i[3].split("&"):[]}}return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function j(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol&&t.protocol.length>0?t.protocol+"://"+t.authority+t.path+e:window.document.location.protocol+"//"+t.authority+t.path+e}var q={create:function(t,e,i){var r=self.document.createElement(t);return e&&(r.className=e),i&&i.appendChild(r),r},createNS:function(t,e){return self.document.createElementNS(t,e)}},X=self.document?self.document.documentElement.style:null;function G(t){if(!X)return null;for(var e=0;e<t.length;e++)if(t[e]in X)return t[e];return t[0]}var W,Y=G(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);q.disableDrag=function(){X&&Y&&(W=X[Y],X[Y]="none");},q.enableDrag=function(){X&&Y&&(X[Y]=W);};var H=G(["transform","WebkitTransform"]);q.setTransform=function(t,e){t.style[H]=e;};var Q=!1;try{var Z=Object.defineProperty({},"passive",{get:function(){Q=!0;}});self.addEventListener("test",Z,Z),self.removeEventListener("test",Z,Z);}catch(t){Q=!1;}q.addEventListener=function(t,e,i,r){void 0===r&&(r={}),"passive"in r&&Q?t.addEventListener(e,i,r):t.addEventListener(e,i,r.capture);},q.removeEventListener=function(t,e,i,r){void 0===r&&(r={}),"passive"in r&&Q?t.removeEventListener(e,i,r):t.removeEventListener(e,i,r.capture);};var J=function(t){t.preventDefault(),t.stopPropagation(),self.removeEventListener("click",J,!0);};q.suppressClick=function(){self.addEventListener("click",J,!0),self.setTimeout(function(){self.removeEventListener("click",J,!0);},0);},q.mousePos=function(t,e){var i=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new p(e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop)},q.touchPos=function(t,e){for(var i=t.getBoundingClientRect(),r=[],a="touchend"===e.type?e.changedTouches:e.touches,n=0;n<a.length;n++)r.push(new p(a[n].clientX-i.left-t.clientLeft,a[n].clientY-i.top-t.clientTop));return r},q.mouseButton=function(t){return void 0!==self.InstallTrigger&&2===t.button&&t.ctrlKey&&self.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},q.remove=function(t){t.parentNode&&t.parentNode.removeChild(t);};var K=1e-6,$="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function tt(){var t=new $(4);return $!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function et(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*s,t[1]=a*u+o*s,t[2]=r*-s+n*u,t[3]=a*-s+o*u,t}function it(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=i[0],u=i[1];return t[0]=r*s,t[1]=a*s,t[2]=n*u,t[3]=o*u,t}function rt(){var t=new $(16);return $!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function at(t){var e=new $(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function nt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ot(t,e){if(t===e){var i=e[1],r=e[2],a=e[3],n=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=a,t[13]=o,t[14]=s;}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function st(t,e){var i=e[0],r=e[1],a=e[2],n=e[3],o=e[4],s=e[5],u=e[6],l=e[7],p=e[8],c=e[9],h=e[10],f=e[11],m=e[12],d=e[13],_=e[14],y=e[15],g=i*s-r*o,v=i*u-a*o,x=i*l-n*o,b=r*u-a*s,w=r*l-n*s,A=a*l-n*u,T=p*d-c*m,S=p*_-h*m,E=p*y-f*m,P=c*_-h*d,I=c*y-f*d,R=h*y-f*_,M=g*R-v*I+x*P+b*E-w*S+A*T;return M?(M=1/M,t[0]=(s*R-u*I+l*P)*M,t[1]=(a*I-r*R-n*P)*M,t[2]=(d*A-_*w+y*b)*M,t[3]=(h*w-c*A-f*b)*M,t[4]=(u*E-o*R-l*S)*M,t[5]=(i*R-a*E+n*S)*M,t[6]=(_*x-m*A-y*v)*M,t[7]=(p*A-h*x+f*v)*M,t[8]=(o*I-s*E+l*T)*M,t[9]=(r*E-i*I-n*T)*M,t[10]=(m*w-d*x+y*g)*M,t[11]=(c*x-p*w-f*g)*M,t[12]=(s*S-o*P-u*T)*M,t[13]=(i*P-r*S+a*T)*M,t[14]=(d*v-m*b-_*g)*M,t[15]=(p*b-c*v+h*g)*M,t):null}function ut(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=e[4],u=e[5],l=e[6],p=e[7],c=e[8],h=e[9],f=e[10],m=e[11],d=e[12],_=e[13],y=e[14],g=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*r+x*s+b*c+w*d,t[1]=v*a+x*u+b*h+w*_,t[2]=v*n+x*l+b*f+w*y,t[3]=v*o+x*p+b*m+w*g,v=i[4],x=i[5],b=i[6],w=i[7],t[4]=v*r+x*s+b*c+w*d,t[5]=v*a+x*u+b*h+w*_,t[6]=v*n+x*l+b*f+w*y,t[7]=v*o+x*p+b*m+w*g,v=i[8],x=i[9],b=i[10],w=i[11],t[8]=v*r+x*s+b*c+w*d,t[9]=v*a+x*u+b*h+w*_,t[10]=v*n+x*l+b*f+w*y,t[11]=v*o+x*p+b*m+w*g,v=i[12],x=i[13],b=i[14],w=i[15],t[12]=v*r+x*s+b*c+w*d,t[13]=v*a+x*u+b*h+w*_,t[14]=v*n+x*l+b*f+w*y,t[15]=v*o+x*p+b*m+w*g,t}function lt(t,e,i){var r,a,n,o,s,u,l,p,c,h,f,m,d=i[0],_=i[1],y=i[2];return e===t?(t[12]=e[0]*d+e[4]*_+e[8]*y+e[12],t[13]=e[1]*d+e[5]*_+e[9]*y+e[13],t[14]=e[2]*d+e[6]*_+e[10]*y+e[14],t[15]=e[3]*d+e[7]*_+e[11]*y+e[15]):(r=e[0],a=e[1],n=e[2],o=e[3],s=e[4],u=e[5],l=e[6],p=e[7],c=e[8],h=e[9],f=e[10],m=e[11],t[0]=r,t[1]=a,t[2]=n,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=p,t[8]=c,t[9]=h,t[10]=f,t[11]=m,t[12]=r*d+s*_+c*y+e[12],t[13]=a*d+u*_+h*y+e[13],t[14]=n*d+l*_+f*y+e[14],t[15]=o*d+p*_+m*y+e[15]),t}function pt(t,e,i){var r=i[0],a=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ct(t,e,i){var r=Math.sin(i),a=Math.cos(i),n=e[4],o=e[5],s=e[6],u=e[7],l=e[8],p=e[9],c=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*a+l*r,t[5]=o*a+p*r,t[6]=s*a+c*r,t[7]=u*a+h*r,t[8]=l*a-n*r,t[9]=p*a-o*r,t[10]=c*a-s*r,t[11]=h*a-u*r,t}function ht(t,e,i){var r=Math.sin(i),a=Math.cos(i),n=e[0],o=e[1],s=e[2],u=e[3],l=e[8],p=e[9],c=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*a-l*r,t[1]=o*a-p*r,t[2]=s*a-c*r,t[3]=u*a-h*r,t[8]=n*r+l*a,t[9]=o*r+p*a,t[10]=s*r+c*a,t[11]=u*r+h*a,t}function ft(t,e,i){var r=Math.sin(i),a=Math.cos(i),n=e[0],o=e[1],s=e[2],u=e[3],l=e[4],p=e[5],c=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*a+l*r,t[1]=o*a+p*r,t[2]=s*a+c*r,t[3]=u*a+h*r,t[4]=l*a-n*r,t[5]=p*a-o*r,t[6]=c*a-s*r,t[7]=h*a-u*r,t}function mt(t,e,i,r){var a=e[0],n=e[1],o=e[2],s=e[3],u=a+a,l=n+n,p=o+o,c=a*u,h=a*l,f=a*p,m=n*l,d=n*p,_=o*p,y=s*u,g=s*l,v=s*p,x=r[0],b=r[1],w=r[2];return t[0]=(1-(m+_))*x,t[1]=(h+v)*x,t[2]=(f-g)*x,t[3]=0,t[4]=(h-v)*b,t[5]=(1-(c+_))*b,t[6]=(d+y)*b,t[7]=0,t[8]=(f+g)*w,t[9]=(d-y)*w,t[10]=(1-(c+m))*w,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function dt(t,e){var i=e[0],r=e[1],a=e[2],n=e[3],o=i+i,s=r+r,u=a+a,l=i*o,p=r*o,c=r*s,h=a*o,f=a*s,m=a*u,d=n*o,_=n*s,y=n*u;return t[0]=1-c-m,t[1]=p+y,t[2]=h-_,t[3]=0,t[4]=p-y,t[5]=1-l-m,t[6]=f+d,t[7]=0,t[8]=h+_,t[9]=f-d,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _t(t,e,i,r,a){var n,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(n=1/(r-a),t[10]=(a+r)*n,t[14]=2*a*r*n):(t[10]=-1,t[14]=-2*r),t}function yt(t,e,i,r,a,n,o){var s=1/(e-i),u=1/(r-a),l=1/(n-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*s,t[13]=(a+r)*u,t[14]=(o+n)*l,t[15]=1,t}function gt(t,e,i,r){var a,n,o,s,u,l,p,c,h,f,m=e[0],d=e[1],_=e[2],y=r[0],g=r[1],v=r[2],x=i[0],b=i[1],w=i[2];return Math.abs(m-x)<K&&Math.abs(d-b)<K&&Math.abs(_-w)<K?nt(t):(p=m-x,c=d-b,h=_-w,a=g*(h*=f=1/Math.sqrt(p*p+c*c+h*h))-v*(c*=f),n=v*(p*=f)-y*h,o=y*c-g*p,(f=Math.sqrt(a*a+n*n+o*o))?(a*=f=1/f,n*=f,o*=f):(a=0,n=0,o=0),s=c*o-h*n,u=h*a-p*o,l=p*n-c*a,(f=Math.sqrt(s*s+u*u+l*l))?(s*=f=1/f,u*=f,l*=f):(s=0,u=0,l=0),t[0]=a,t[1]=s,t[2]=p,t[3]=0,t[4]=n,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=h,t[11]=0,t[12]=-(a*m+n*d+o*_),t[13]=-(s*m+u*d+l*_),t[14]=-(p*m+c*d+h*_),t[15]=1,t)}var vt=ut;function xt(){var t=new $(3);return $!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bt(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function wt(t,e,i){var r=new $(3);return r[0]=t,r[1]=e,r[2]=i,r}function At(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Tt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function St(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Et(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Pt(t,e){var i=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.sqrt(i*i+r*r+a*a)}function It(t,e){var i=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return i*i+r*r+a*a}function Rt(t,e){var i=e[0],r=e[1],a=e[2],n=i*i+r*r+a*a;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function Mt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zt(t,e,i){var r=e[0],a=e[1],n=e[2],o=i[0],s=i[1],u=i[2];return t[0]=a*u-n*s,t[1]=n*o-r*u,t[2]=r*s-a*o,t}function Ct(t,e,i,r){var a=e[0],n=e[1],o=e[2];return t[0]=a+r*(i[0]-a),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function Ot(t,e,i){var r=e[0],a=e[1],n=e[2],o=i[3]*r+i[7]*a+i[11]*n+i[15];return o=o||1,t[0]=(i[0]*r+i[4]*a+i[8]*n+i[12])/o,t[1]=(i[1]*r+i[5]*a+i[9]*n+i[13])/o,t[2]=(i[2]*r+i[6]*a+i[10]*n+i[14])/o,t}function Ft(t,e,i){var r=i[0],a=i[1],n=i[2],o=i[3],s=e[0],u=e[1],l=e[2],p=a*l-n*u,c=n*s-r*l,h=r*u-a*s,f=a*h-n*c,m=n*p-r*h,d=r*c-a*p,_=2*o;return p*=_,c*=_,h*=_,f*=2,m*=2,d*=2,t[0]=s+p+f,t[1]=u+c+m,t[2]=l+h+d,t}var Lt,Dt=St,Nt=Pt,kt=bt,Bt=(Lt=xt(),function(t,e,i,r,a,n){var o,s;for(e||(e=3),i||(i=0),s=r?Math.min(r*e+i,t.length):t.length,o=i;o<s;o+=e)Lt[0]=t[o],Lt[1]=t[o+1],Lt[2]=t[o+2],a(Lt,Lt,n),t[o]=Lt[0],t[o+1]=Lt[1],t[o+2]=Lt[2];return t});function Vt(){var t=new $(4);return $!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ut(t,e){var i=e[0],r=e[1],a=e[2],n=e[3],o=i*i+r*r+a*a+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=a*o,t[3]=n*o),t}function jt(t,e,i,r){var a=e[0],n=e[1],o=e[2],s=e[3];return t[0]=a+r*(i[0]-a),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=s+r*(i[3]-s),t}function qt(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*a+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*a+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*a+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*a+i[11]*n+i[15]*o,t}var Xt=function(){var t=Vt();return function(e,i,r,a,n,o){var s,u;for(i||(i=4),r||(r=0),u=a?Math.min(a*i+r,e.length):e.length,s=r;s<u;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],n(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function Gt(){var t=new $(4);return $!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Wt(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>K?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function Yt(t,e,i){i*=.5;var r=e[0],a=e[1],n=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+a*s,t[1]=a*u-r*s,t[2]=n*u+o*s,t[3]=o*u-n*s,t}function Ht(t,e,i,r){var a,n,o,s,u,l=e[0],p=e[1],c=e[2],h=e[3],f=i[0],m=i[1],d=i[2],_=i[3];return(n=l*f+p*m+c*d+h*_)<0&&(n=-n,f=-f,m=-m,d=-d,_=-_),1-n>K?(a=Math.acos(n),o=Math.sin(a),s=Math.sin((1-r)*a)/o,u=Math.sin(r*a)/o):(s=1-r,u=r),t[0]=s*l+u*f,t[1]=s*p+u*m,t[2]=s*c+u*d,t[3]=s*h+u*_,t}var Qt,Zt,Jt,Kt,$t,te,ee,ie=jt,re=Ut,ae=(Qt=xt(),Zt=wt(1,0,0),Jt=wt(0,1,0),function(t,e,i){var r=Mt(e,i);return r<-.999999?(zt(Qt,Zt,e),kt(Qt)<1e-6&&zt(Qt,Jt,e),Rt(Qt,Qt),function(t,e,i){i*=.5;var r=Math.sin(i);t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i);}(t,Qt,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(zt(Qt,e,i),t[0]=Qt[0],t[1]=Qt[1],t[2]=Qt[2],t[3]=1+r,re(t,t))});Kt=Gt(),$t=Gt(),te=new $(9),$!=Float32Array&&(te[1]=0,te[2]=0,te[3]=0,te[5]=0,te[6]=0,te[7]=0),te[0]=1,te[4]=1,te[8]=1,ee=te;function ne(){var t=new $(2);return $!=Float32Array&&(t[0]=0,t[1]=0),t}!function(){var t=ne();}();var oe=new Float64Array(16);oe[0]=1,oe[5]=1,oe[10]=1,oe[15]=1,yt(oe,-1,1,-1,1,0,1),lt(oe,oe,[-1,-1,0]),pt(oe,oe,[2/8192,2/8192,1]);var se=6378.137,ue=3.141592653589793,le={DEFAULT_SPHERE_TRIANGLES:[],SCROLL_ZOOM_SPHERE_CONTROL:4,TILE_GRIDSAMPLES_SPLIT:{SMALL:4,MIDDLE:6,LARGE:9,LARGE_S:20,SMALL_Z_SAMPLES:16,MIDDLE_Z_SAMPLES:8,LARGE_Z_SAMPLES:2,LARGE_S_Z_SAMPLES:1,THE_MIN_SAMPLES:1},TRANSFORM:{PROJECTION_CHANGE_SMALL_ZOOM:5,PROJECTION_CHANGE_MIDDLE_ZOOM:10,PROJECTION_CHANGE_LARGE_ZOOM:15,MAX_LAT:85.05113,MIN_LAT:-85.05113,SPHERE_MAX_PITCH:85,PLAIN_MAX_PITCH:60,SPHERE_DRAG_PAN_MAX_PITCH:45,DEG_TO_RAD:ue/180,RAD_TO_DEG:180/ue,R:se,REAL_R:6378137,R_SCALE:.001,R_ZOOM:1e3,CIR:2*ue*se,COVERING_TILE_ZOOM:6,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,UNIT_Z:[0,0,1],UNIT_Z_REVERSE:[0,0,-1],VIEW_MAX_BOUNDING:{west:-180,south:-85.05113,east:180,north:85.05113},TWO_PI:2*ue,PI_OVER_TWO:ue/2,FP_ZOOM:17,TERRAIN_FIND_ZOOM_MIN:10,TERRAIN_SIMPLIFY_ZOOM_MAX:15,ERR_TERRAIN_ALT:-se,OFFSCREEN_WIDTH:2048,OFFSCREEN_HEIGHT:2048,SHADOW_VIEWPORT_SIZE:[8192,8192],RAY_PICK_MIN_ZOOM:4},SOURCE:{MAX_BOUNDS:[[-180,90],[180,90],[180,-90],[-180,-90]],ERROR_IMG_INDEX:-999,CLOCK_SKEW_RETRY_TIMEOUT:3e4,TRANSPARENT_PNG_URL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",GLOBAL_SOURCE_ID:"sphere-image-globe",SKYBOX_SOURCE_ID:"sphere-image-skybox",PANORAMA_SOURCE_ID:"panorama-special-source",ATMOSPHERE_SOURCE_ID:"sphere-atmosphere",COSMOS_SOURCE_ID:"sphere-cosmos",MAX_GLTF_TILE_COUNT:400,MAX_GLTF_TILE_TO_FIND_PARENT:64},MODEL_TYPE:{OSGB:"osgb",E3DCM:"e3dcm",TDMODEL:"3dmodel"},LAYER:{PANORAMA_LAYER_ID:"panorama-special-layer"},FB_MATRIX:oe,TILE:{EXTENT:8192,DEPTH_MAX_RANGE:1,OFFSCREEN_SIZE:1024,OFFSCREEN_SIZE_WITH_PIXEL_RATIO:1024*(self.devicePixelRatio>1?1.3:1)},FPMODE:{MAP:"MAP",DRAG_ROTATE:"DRAG_ROTATE",NULL:"NULL"},FRAMEBUFFER:{DEPTH_IMAGE_SCALE:1},EFFECTS:{FOG_START_DISTANCE:4,FOG_CALC_LENGTH:20,SHADOW_OFFSET:2.5e-7},CAMERA:{SUNLIGHT_CAMERA_ID:"SUNLIGHT_CAMERA_ID",SKYBOX_CAMERA_ID:"SKYBOX_CAMERA_ID",ATMOSPHERE_BLEND_CAMERA_ID:"ATMOSPHERE_BLEND_CAMERA_ID",DRAW_MODE:{NORMAL:"NORMAL",OFFSCREEN:"OFFSCREEN",OFFSCREEN_VIEWSHED:"OFFSCREEN_VIEWSHED",ONSCREEN_SHADOW:"SHADOW",ONSCREEN_VIEWSHED:"VIEWSHED",ONSCREEN_ALL:"ONSCREEN_ALL"}}};function pe(t,e){if(e&&-1!=e.indexOf("?")){var i=e.split("?")[1],r=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=i.match(r);if(null!=a)return unescape(a[2])}return null}function ce(t){var e=t.responseURL||t.__responseURL,i=t.response,r=i?i.byteLength:0,a=pe("token",e)||"",n=pe("appKey",e)||"",o=n.length>0?n:a;if(o.length>0&&r>8){var s=new Uint8Array(i);if("minedata"===function(t,e,i){for(var r="",a=e;a<i;){var n=t[a],o=null,s=n>239?4:n>223?3:n>191?2:1;if(a+s>i)break;var u=void 0,l=void 0,p=void 0;1===s?n<128&&(o=n):2===s?128==(192&(u=t[a+1]))&&(o=(31&n)<<6|63&u)<=127&&(o=null):3===s?(u=t[a+1],l=t[a+2],128==(192&u)&&128==(192&l)&&((o=(15&n)<<12|(63&u)<<6|63&l)<=2047||o>=55296&&o<=57343)&&(o=null)):4===s&&(u=t[a+1],l=t[a+2],p=t[a+3],128==(192&u)&&128==(192&l)&&128==(192&p)&&((o=(15&n)<<18|(63&u)<<12|(63&l)<<6|63&p)<=65535||o>=1114112)&&(o=null)),null===o?(o=65533,s=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|1023&o),r+=String.fromCharCode(o),a+=s;}return r}(s,r-8,r).toLowerCase())return function(t,e){var i=t.length-8;if(i<=e)for(var r=0;r<i/2;r++){var a=t[r];t[r]=t[i-r-1],t[i-r-1]=a;}else for(var n=parseInt(i/e),o=parseInt(e/2),s=0;s<n;s++)for(var u=s*e,l=(s+1)*e-1,p=u,c=0;p<u+o;p++,c++){var h=p,f=l-c,m=t[h];t[h]=t[f],t[f]=m;}}(s,function(t){for(var e=0,i=t.length,r=0;r<i;r++)e+=t.charCodeAt(r);return parseInt(e/i)}(o)),i.slice(0,r-8)}return i}var he={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(he);var fe=function(t){function e(e,i,r){t.call(this,e),this.status=i,this.url=r,this.name=this.constructor.name,this.message=e;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function me(t){var e=new self.XMLHttpRequest;for(var i in e.open("GET",t.url,!0),t.headers)e.setRequestHeader(i,t.headers[i]);return e.withCredentials="include"===t.credentials,e}var de=function(t,e){var i=me("string"==typeof t?{url:t}:t);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){e(new Error(i.statusText));},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var r;try{r=JSON.parse(i.response);}catch(t){return e(t)}e(null,r);}else e(new fe(i.statusText,i.status,t.url));},i.send(),{cancel:function(){return i.abort()}}},_e=function(t,e){var i=me(t);return i.__responseURL=t.url,i.responseType="arraybuffer",i.onerror=function(){e(new Error(i.statusText));},i.onload=function(){var r=i.response;if(0===r.byteLength&&200===i.status&&e(null,{data:r,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}),i.status>=200&&i.status<300&&i.response){var a=ce(i);e(null,{data:a,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")});}else e(new fe(i.statusText,i.status,t.url));},i.send(),{cancel:function(){return i.abort()}}};var ye=function(t,e){return _e(t,function(t,i){if(t)e(t);else if(i){var r=new self.Image,a=self.URL||self.webkitURL;r.onload=function(){e(null,r),a.revokeObjectURL(r.src);};var n=new self.Blob([new Uint8Array(i.data)],{type:"image/png"});r.cacheControl=i.cacheControl,r.expires=i.expires,r.src=i.data.byteLength?a.createObjectURL(n):le.SOURCE.TRANSPARENT_PNG_URL;}})},ge=function(t,e){var i,r,a=self.document.createElement("video");a.muted=!0,a.onloadstart=function(){e(null,a);};for(var n=0;n<t.length;n++){var o=self.document.createElement("source");i=t[n],r=void 0,(r=self.document.createElement("a")).href=i,(r.protocol!==self.document.location.protocol||r.host!==self.document.location.host)&&(a.crossOrigin="Anonymous"),o.src=t[n],a.appendChild(o);}return{cancel:function(){}}};function ve(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e));}function xe(t,e,i){if(i&&i[t]){var r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1);}}var be=function(t,e){void 0===e&&(e={}),v(this,e),this.type=t;},we=function(t){function e(e,i){void 0===i&&(i={}),t.call(this,"error",v({error:e},i));}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(be),Ae=function(){};Ae.prototype.on=function(t,e){return this._listeners=this._listeners||{},ve(t,e,this._listeners),this},Ae.prototype.off=function(t,e){return xe(t,e,this._listeners),xe(t,e,this._oneTimeListeners),this},Ae.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},ve(t,e,this._oneTimeListeners),this},Ae.prototype.fire=function(t){"string"==typeof t&&(t=new be(t,arguments[1]||{}));var e=t.type;if(this.listens(e)){t.target=this;for(var i=0,r=this._listeners&&this._listeners[e]?this._listeners[e].slice():[];i<r.length;i+=1){r[i].call(this,t);}for(var a=0,n=this._oneTimeListeners&&this._oneTimeListeners[e]?this._oneTimeListeners[e].slice():[];a<n.length;a+=1){var o=n[a];xe(e,o,this._oneTimeListeners),o.call(this,t);}var s=this._eventedParent;s&&(v(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),s.fire(t));}else t instanceof we&&console.error(t.error);return this},Ae.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Ae.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_geojson","source_video","source_image","source_sphere_image","source_3d_model","source_3d_tile","source_panorama"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},tileUsage:{type:"enum",values:{all:{},plain:{},sphere:{}},default:"plain"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},terrainTiles:{type:"array",value:"string"},renderWithTerrain:{type:"boolean"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},tileUsage:{type:"enum",values:{all:{},plain:{},sphere:{}},default:"plain"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},lineMetrics:{type:"boolean",default:!1},tileUsage:{type:"enum",values:{all:{},plain:{},sphere:{}},default:"plain"}},source_sphere_image:{type:{required:!0,type:"enum",values:{"sphere-image":{}}},url:{required:!0,type:"string"},renderInner:{required:!0,type:"boolean"},radius:{required:!0,type:"number"},extractRadius:{required:!1,type:"number"},gridSamples:{required:!1,type:"number"},debug:{type:"boolean"},renderAtmosphere:{type:"boolean"}},source_3d_model:{type:{required:!0,type:"enum",values:{"3d-model":{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},location:{required:!0,type:"array",value:{type:"number"}},scale:{required:!0,type:"array",value:{type:"number"}},pickable:{type:"boolean"},filter:{type:"array",value:"*"},aabbFilter:{type:"array",value:"*"},rotation:{required:!0,type:"array",value:{type:"number"}},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},translation:{required:!0,type:"array",value:{type:"number"}},modelFolder:{required:!0,type:"string"}},source_3d_tile:{type:{required:!0,type:"enum",values:{"3d-tile":{}}},modelFolder:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},location:{required:!0,type:"array",value:{type:"number"}},translation:{required:!0,type:"array",value:{type:"number"}},collectResourceTiming:{required:!0,type:"boolean"},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},pickable:{type:"boolean"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},grid:{type:"number",default:1}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},grid:{type:"number",default:1},wms:{required:!1,type:"boolean"}},source_panorama:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},extrusion:{},raster:{},hillshade:{},tracking:{},"sphere-raster":{},"sphere-fill":{},"sphere-line":{},"sphere-symbol":{},"sphere-circle":{},"sphere-heatmap":{},"sphere-extrusion":{},"sphere-tracking":{},"sphere-sprite":{},sprite:{},symtracking:{},histogram:{},"3d-model":{},"3d-tile":{},"3d-point-cloud":{},background:{},"sphere-background":{},panorama:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"depth-test":{type:"boolean"},location:{type:"array",value:{type:"number"}},rotation:{type:"array",value:{type:"number"}},translation:{type:"array",value:{type:"number"}},scale:{type:"array",value:{type:"number"}},clipGround:{type:"boolean"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sphere-background","layout_tracking","layout_sphere-fill","layout_sphere-line","layout_sphere-symbol","layout_sphere-circle","layout_sphere-heatmap","layout_sphere-raster","layout_sphere-extrusion","layout_sphere-tracking","layout_sphere-sprite","layout_sprite","layout_3d-model","layout_3d-tile","layout_3d-point-cloud","layout_panorama"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_extrusion:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"border-visibility":{type:"enum",default:"none",values:{visible:{},none:{}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"string",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_tracking:{"tracking-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"tracking-miter-limit":{type:"number",default:2,requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-round-limit":{type:"number",default:1.05,requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"tracking-display-mode":{type:"enum",function:"piecewise-constant",values:["loop","reverse","loop-reserve","reverse-reserve"],default:"loop","property-type":"data-constant"}},layout_sprite:{"sprite-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"sprite-miter-limit":{type:"number",default:2,requires:[{"sprite-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-round-limit":{type:"number",default:1.05,requires:[{"sprite-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symtracking:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"string",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"symtracking-time-segment":{type:"number",function:"piecewise-constant",default:20,minimum:1,"property-type":"data-constant"},"symtracking-fps":{type:"number",function:"piecewise-constant",default:1,minimum:1,"property-type":"data-constant"},"compatible-mode":{type:"boolean",function:"piecewise-constant",default:!0,"property-type":"data-constant"}},layout_histogram:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"histogram-color-render":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"histogram-max-height-render":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},layout_panorama:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},like:{},"!like":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},arrin:{},"!arrin":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Heatmap"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sphere-background","paint_tracking","paint_sphere-fill","paint_sphere-line","paint_sphere-symbol","paint_sphere-circle","paint_sphere-raster","paint_sphere-extrusion","paint_sphere-tracking","paint_sphere-sprite","paint_sprite","paint_3d-model","paint_3d-point-cloud","paint_panorama"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"fill-water":{type:"enum",values:{water:{},none:{}},default:"none",transition:!1,"property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_extrusion:{"extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"render-road":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-opacity":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:0,maximum:1,transition:!0,"property-type":"data-driven"},"line-border-color":{type:"color",default:"#ffffff",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"render-road-mark":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"symbol-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:1e4,"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_tracking:{"tracking-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-type":{type:"enum",function:"piecewise-constant",values:["real-time","history"],default:"real-time","property-type":"constant"},"tracking-seg-count":{type:"number",function:"interpolated",default:700,minimum:0,maximum:1e4,transition:!0,"property-type":"constant"},"tracking-seg-group":{type:"number",function:"interpolated",default:20,minimum:1,maximum:600,transition:!0,"property-type":"constant"},"tracking-speed":{type:"number",function:"interpolated",default:1,minimum:1,maximum:500,transition:!0,"property-type":"constant"},"tracking-delay":{type:"number",default:20,minimum:0,maximum:120,transition:!0,"property-type":"constant"},"tracking-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"constant"}},paint_sprite:{"sprite-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"sprite-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["sprite-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-interpolate":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-status":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-instatus":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:100,"property-type":"data-constant"}},paint_symtracking:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symtracking-delay":{type:"number",function:"piecewise-constant",default:10,minimum:0,maximum:120,transition:!0,"property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"symtracking-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:100,"property-type":"data-constant"},"render-road-mark":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_histogram:{"histogram-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"histogram-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["histogram-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"histogram-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["histogram-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-dynamic":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"histogram-heightArr1":{type:"color",default:[0,0,0,0],transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},units:"x-color","property-type":"data-driven"},"histogram-heightArr2":{type:"color",default:[0,0,0,0],transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},units:"x-color","property-type":"data-driven"},"histogram-heightArr3":{type:"color",default:[0,0,0,0],transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},units:"x-color","property-type":"data-driven"},"histogram-time":{type:"number",function:"piecewise-constant",default:1e3,minimum:0,units:"millisecond",transition:!0,"property-type":"data-constant"},"histogram-count":{type:"number",function:"piecewise-constant",default:12,minimum:1,maximum:12,units:"millisecond",transition:!0,"property-type":"data-constant"},"histogram-colors":{type:"array",value:"string",length:5,default:["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],function:"interpolated",transition:!0,"property-type":"data-constant"},"histogram-max-height":{type:"number",function:"piecewise-constant",default:200,minimum:0,units:"meters",transition:!0,"property-type":"data-constant"},"histogram-fluorescent":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_panorama:{"panorama-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"layout_sphere-background":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-sprite":{"sprite-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"sprite-miter-limit":{type:"number",default:2,requires:[{"sprite-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-round-limit":{type:"number",default:1.05,requires:[{"sprite-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-raster":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-fill":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-line":{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"border-visibility":{type:"enum",default:"none",values:{visible:{},none:{}},"property-type":"constant"}},"layout_sphere-symbol":{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"string",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-circle":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-heatmap":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-tracking":{"tracking-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"tracking-miter-limit":{type:"number",default:2,requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-round-limit":{type:"number",default:1.05,requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"tracking-display-mode":{type:"enum",function:"piecewise-constant",values:["loop","reverse","loop-reserve","reverse-reserve"],default:"loop","property-type":"data-constant"}},"layout_3d-model":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_3d-tile":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_3d-point-cloud":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},"paint_sphere-background":{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-raster":{"sphere-raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-fill":{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"}},"paint_sphere-line":{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-opacity":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:0,maximum:1,transition:!0,"property-type":"data-driven"},"line-border-color":{type:"color",default:"#ffffff",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},"paint_sphere-symbol":{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-circle":{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_sphere-heatmap":{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-extrusion":{"extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-top-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"render-road":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},"paint_sphere-tracking":{"tracking-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-type":{type:"enum",function:"piecewise-constant",values:["real-time","history"],default:"real-time","property-type":"constant"},"tracking-seg-count":{type:"number",function:"interpolated",default:700,minimum:0,maximum:1e4,transition:!0,"property-type":"constant"},"tracking-seg-group":{type:"number",function:"interpolated",default:20,minimum:1,maximum:600,transition:!0,"property-type":"constant"},"tracking-speed":{type:"number",function:"interpolated",default:1,minimum:1,maximum:500,transition:!0,"property-type":"constant"},"tracking-delay":{type:"number",default:20,minimum:0,maximum:120,transition:!0,"property-type":"constant"},"tracking-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"constant"}},"paint_sphere-sprite":{"sprite-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"sprite-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["sprite-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"data-constant"},"sprite-interpolate":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-status":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-instatus":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:100,"property-type":"data-constant"}},"paint_3d-model":{"3d-model-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_3d-tile":{"3d-tile-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_3d-point-cloud":{"3d-point-cloud-mode":{type:"enum",values:{color:{},intensity:{},height:{},classification:{}},default:"color","property-type":"constant"},"3d-point-cloud-size":{type:"number",default:1,minimum:0,maximum:100,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"3d-point-cloud-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},Se=function(t,e,i,r){this.message=(t?t+": ":"")+i,r&&(this.identifier=r),null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__);};function Ee(t){var e=t.key,i=t.value;return i?[new Se(e,i,"constants have been deprecated as of v8")]:[]}function Pe(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var r=0,a=e;r<a.length;r+=1){var n=a[r];for(var o in n)t[o]=n[o];}return t}function Ie(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Re(t){return Array.isArray(t)?t.map(Re):Ie(t)}var Me=function(t){function e(e,i){t.call(this,i),this.message=i,this.key=e;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),ze=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var i=0,r=e;i<r.length;i+=1){var a=r[i],n=a[0],o=a[1];this.bindings[n]=o;}};ze.prototype.concat=function(t){return new ze(this,t)},ze.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},ze.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ce={kind:"null"},Oe={kind:"number"},Fe={kind:"string"},Le={kind:"boolean"},De={kind:"color"},Ne={kind:"object"},ke={kind:"value"},Be={kind:"collator"};function Ve(t,e){return{kind:"array",itemType:t,N:e}}function Ue(t){if("array"===t.kind){var e=Ue(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var je=[Ce,Oe,Fe,Le,De,Ne,Ve(ke)];function qe(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&!qe(t.itemType,e.itemType)&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var i=0,r=je;i<r.length;i+=1){if(!qe(r[i],e))return null}}return"Expected "+Ue(t)+" but found "+Ue(e)+" instead."}var Xe=e(function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function a(t){return t<0?0:t>1?1:t}function n(t){return"%"===t[t.length-1]?r(parseFloat(t)/100*255):r(parseInt(t))}function o(t){return"%"===t[t.length-1]?a(parseFloat(t)/100):a(parseFloat(t))}function s(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in i)return i[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=a.indexOf("("),l=a.indexOf(")");if(-1!==u&&l+1===a.length){var p=a.substr(0,u),c=a.substr(u+1,l-(u+1)).split(","),h=1;switch(p){case"rgba":if(4!==c.length)return null;h=o(c.pop());case"rgb":return 3!==c.length?null:[n(c[0]),n(c[1]),n(c[2]),h];case"hsla":if(4!==c.length)return null;h=o(c.pop());case"hsl":if(3!==c.length)return null;var f=(parseFloat(c[0])%360+360)%360/360,m=o(c[1]),d=o(c[2]),_=d<=.5?d*(m+1):d+m-d*m,y=2*d-_;return[r(255*s(y,_,f+1/3)),r(255*s(y,_,f)),r(255*s(y,_,f-1/3)),h];default:return null}}return null};}catch(t){}}),Ge=Xe.parseCSSColor,We=function(t,e,i,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=i,this.a=r;};We.parse=function(t){if(t){if(t instanceof We)return t;if("string"==typeof t){var e=Ge(t);if(e)return new We(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},We.prototype.toString=function(){var t=this.toArray(),e=t[0],i=t[1],r=t[2],a=t[3];return"rgba("+Math.round(e)+","+Math.round(i)+","+Math.round(r)+","+a+")"},We.prototype.toArray=function(){var t=this.r,e=this.g,i=this.b,r=this.a;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*i/r,r]},We.black=new We(0,0,0,1),We.white=new We(1,1,1,1),We.transparent=new We(0,0,0,0);var Ye=function(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"});};Ye.prototype.compare=function(t,e){return this.collator.compare(t,e)},Ye.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var He=function(t,e,i){this.type=Be,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e;};function Qe(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,i,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ze(t){if(null===t)return Ce;if("string"==typeof t)return Fe;if("boolean"==typeof t)return Le;if("number"==typeof t)return Oe;if(t instanceof We)return De;if(t instanceof Ye)return Be;if(Array.isArray(t)){for(var e,i=t.length,r=0,a=t;r<a.length;r+=1){var n=Ze(a[r]);if(e){if(e===n)continue;e=ke;break}e=n;}return Ve(e||ke,i)}return Ne}He.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Le);if(!r)return null;var a=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Le);if(!a)return null;var n=null;return i.locale&&!(n=e.parse(i.locale,1,Fe))?null:new He(r,a,n)},He.prototype.evaluate=function(t){return new Ye(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},He.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale);},He.prototype.possibleOutputs=function(){return[void 0]},He.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Je=function(t,e){this.type=t,this.value=e;};Je.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof We)return!0;if(e instanceof Ye)return!0;if(Array.isArray(e)){for(var i=0,r=e;i<r.length;i+=1)if(!t(r[i]))return!1;return!0}if("object"==typeof e){for(var a in e)if(!t(e[a]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var i=t[1],r=Ze(i),a=e.expectedType;return"array"!==r.kind||0!==r.N||!a||"array"!==a.kind||"number"==typeof a.N&&0!==a.N||(r=a),new Je(r,i)},Je.prototype.evaluate=function(){return this.value},Je.prototype.eachChild=function(){},Je.prototype.possibleOutputs=function(){return[this.value]},Je.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof We?["rgba"].concat(this.value.toArray()):this.value};var Ke=function(t){this.name="ExpressionEvaluationError",this.message=t;};Ke.prototype.toJSON=function(){return this.message};var $e={string:Fe,number:Oe,boolean:Le,object:Ne},ti=function(t,e){this.type=t,this.args=e;};ti.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var i=t[0],r=$e[i],a=[],n=1;n<t.length;n++){var o=e.parse(t[n],n,ke);if(!o)return null;a.push(o);}return new ti(r,a)},ti.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var i=this.args[e].evaluate(t);if(!qe(this.type,Ze(i)))return i;if(e===this.args.length-1)throw new Ke("Expected value to be of type "+Ue(this.type)+", but found "+Ue(Ze(i))+" instead.")}return null},ti.prototype.eachChild=function(t){this.args.forEach(t);},ti.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t;},ti.prototype.serialize=function(){return[this.type.kind].concat(this.args.map(function(t){return t.serialize()}))};var ei={string:Fe,number:Oe,boolean:Le},ii=function(t,e){this.type=t,this.input=e;};ii.parse=function(t,e){if(t.length<2||t.length>4)return e.error("Expected 1, 2, or 3 arguments, but found "+(t.length-1)+" instead.");var i,r;if(t.length>2){var a=t[1];if("string"!=typeof a||!(a in ei))return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=ei[a];}else i=ke;if(t.length>3){if("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2]))return e.error('The length argument to "array" must be a positive integer literal',2);r=t[2];}var n=Ve(i,r),o=e.parse(t[t.length-1],t.length-1,ke);return o?new ii(n,o):null},ii.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(qe(this.type,Ze(e)))throw new Ke("Expected value to be of type "+Ue(this.type)+", but found "+Ue(Ze(e))+" instead.");return e},ii.prototype.eachChild=function(t){t(this.input);},ii.prototype.possibleOutputs=function(){return this.input.possibleOutputs()},ii.prototype.serialize=function(){var t=["array"],e=this.type.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){t.push(e.kind);var i=this.type.N;"number"==typeof i&&t.push(i);}return t.push(this.input.serialize()),t};var ri={"to-number":Oe,"to-color":De},ai=function(t,e){this.type=t,this.args=e;};ai.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var i=t[0],r=ri[i],a=[],n=1;n<t.length;n++){var o=e.parse(t[n],n,ke);if(!o)return null;a.push(o);}return new ai(r,a)},ai.prototype.evaluate=function(t){if("color"===this.type.kind){for(var e,i,r=0,a=this.args;r<a.length;r+=1){if(i=null,"string"==typeof(e=a[r].evaluate(t))){var n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&!(i=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":Qe(e[0],e[1],e[2],e[3])))return new We(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Ke(i||"Could not parse color from value '"+("string"==typeof e?e:JSON.stringify(e))+"'")}for(var o=null,s=0,u=this.args;s<u.length;s+=1){if(null!==(o=u[s].evaluate(t))){var l=Number(o);if(!isNaN(l))return l}}throw new Ke("Could not convert "+JSON.stringify(o)+" to number.")},ai.prototype.eachChild=function(t){this.args.forEach(t);},ai.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t;},ai.prototype.serialize=function(){var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize());}),t};var ni=["Unknown","Point","LineString","Polygon"],oi=function(){this._parseColorCache={};};oi.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},oi.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ni[this.feature.type]:this.feature.type:null},oi.prototype.properties=function(){return this.feature&&this.feature.properties||{}},oi.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=We.parse(t)),e};var si=function(t,e,i,r){this.name=t,this.type=e,this._evaluate=i,this.args=r;};function ui(t){if(t instanceof si){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!ui(t)&&(e=!1);}),e}function li(t){if(t instanceof si&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!li(t)&&(e=!1);}),e}function pi(t,e){if(t instanceof si&&e.indexOf(t.name)>=0)return!1;var i=!0;return t.eachChild(function(t){i&&!pi(t,e)&&(i=!1);}),i}si.prototype.evaluate=function(t){return this._evaluate(t,this.args)},si.prototype.eachChild=function(t){this.args.forEach(t);},si.prototype.possibleOutputs=function(){return[void 0]},si.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},si.parse=function(t,e){var i=t[0],r=si.definitions[i];if(!r)return e.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(r)?r[0]:r.type,n=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=n.filter(function(e){var i=e[0];return!Array.isArray(i)||i.length===t.length-1}),s=[],u=1;u<t.length;u++){var l=t[u],p=void 0;if(1===o.length){var c=o[0][0];p=Array.isArray(c)?c[u-1]:c.type;}var h=e.parse(l,1+s.length,p);if(!h)return null;s.push(h);}for(var f=null,m=0,d=o;m<d.length;m+=1){var _=d[m],y=_[0],g=_[1];if(f=new hi(e.registry,e.path,null,e.scope),Array.isArray(y)&&y.length!==s.length)f.error("Expected "+y.length+" arguments, but found "+s.length+" instead.");else{for(var v=0;v<s.length;v++){var x=Array.isArray(y)?y[v]:y.type,b=s[v];f.concat(v+1).checkSubtype(x,b.type);}if(0===f.errors.length)return new si(i,a,g,s)}}if(1===o.length)e.errors.push.apply(e.errors,f.errors);else{var w=(o.length?o:n).map(function(t){var e,i=t[0];return e=i,Array.isArray(e)?"("+e.map(Ue).join(", ")+")":"("+Ue(e.type)+"...)"}).join(" | "),A=s.map(function(t){return Ue(t.type)}).join(", ");e.error("Expected arguments of type "+w+", but found ("+A+") instead.");}return null},si.register=function(t,e){for(var i in si.definitions=e,e)t[i]=si;};var ci=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e;};ci.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var i=t[1];return e.scope.has(i)?new ci(i,e.scope.get(i)):e.error('Unknown variable "'+i+'". Make sure "'+i+'" has been bound in an enclosing "let" expression before using it.',1)},ci.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ci.prototype.eachChild=function(){},ci.prototype.possibleOutputs=function(){return[void 0]},ci.prototype.serialize=function(){return["var",this.name]};var hi=function(t,e,i,r,a){void 0===e&&(e=[]),void 0===r&&(r=new ze),void 0===a&&(a=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=r,this.errors=a,this.expectedType=i;};function fi(t,e){for(var i,r,a=0,n=t.length-1,o=0;a<=n;){if(i=t[o=Math.floor((a+n)/2)],r=t[o+1],e===i||e>i&&e<r)return o;if(i<e)a=o+1;else{if(!(i>e))throw new Ke("Input is not a number.");n=o-1;}}return Math.max(o-1,0)}hi.prototype.parse=function(t,e,i,r,a){return void 0===a&&(a={}),e?this.concat(e,i,r)._parse(t,a):this._parse(t,a)},hi.prototype._parse=function(t,e){if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found "+typeof i+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var r=this.registry[i];if(r){var a=r.parse(t,this);if(!a)return null;if(this.expectedType){var n=this.expectedType,o=a.type;if("string"!==n.kind&&"number"!==n.kind&&"boolean"!==n.kind&&"object"!==n.kind||"value"!==o.kind)if("array"===n.kind&&"value"===o.kind)e.omitTypeAnnotations||(a=new ii(n,a));else if("color"!==n.kind||"value"!==o.kind&&"string"!==o.kind){if(this.checkSubtype(this.expectedType,a.type))return null}else e.omitTypeAnnotations||(a=new ai(n,[a]));else e.omitTypeAnnotations||(a=new ti(n,[a]));}if(!(a instanceof Je)&&function t(e){if(e instanceof ci)return t(e.boundExpression);if(e instanceof si&&"error"===e.name)return!1;if(e instanceof He)return!1;var i=e instanceof ai||e instanceof ti||e instanceof ii;var r=!0;e.eachChild(function(e){r=i?r&&t(e):r&&e instanceof Je;});if(!r)return!1;return ui(e)&&pi(e,["zoom","heatmap-density","line-progress","is-supported-script"])}(a)){var s=new oi;try{a=new Je(a.type,a.evaluate(s));}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},hi.prototype.concat=function(t,e,i){var r="number"==typeof t?this.path.concat(t):this.path,a=i?this.scope.concat(i):this.scope;return new hi(this.registry,r,e||null,a,this.errors)},hi.prototype.error=function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];var r=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Me(r,t));},hi.prototype.checkSubtype=function(t,e){var i=qe(t,e);return i&&this.error(i),i};var mi=function(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,a=i;r<a.length;r+=1){var n=a[r],o=n[0],s=n[1];this.labels.push(o),this.outputs.push(s);}};function di(t,e,i){return t*(1-i)+e*i}mi.parse=function(t,e){var i=t[1],r=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,1,Oe)))return null;var a=[],n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType),r.unshift(-1/0);for(var o=0;o<r.length;o+=2){var s=r[o],u=r[o+1],l=o+1,p=o+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(a.length&&a[a.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var c=e.parse(u,p,n);if(!c)return null;n=n||c.type,a.push([s,c]);}return new mi(n,i,a)},mi.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);var a=e.length;return r>=e[a-1]?i[a-1].evaluate(t):i[fi(e,r)].evaluate(t)},mi.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1){t(i[e]);}},mi.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t;},mi.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var _i=Object.freeze({number:di,color:function(t,e,i){return new We(di(t.r,e.r,i),di(t.g,e.g,i),di(t.b,e.b,i),di(t.a,e.a,i))},array:function(t,e,i){return t.map(function(t,r){return di(t,e[r],i)})}}),yi=function(t,e,i,r){this.type=t,this.interpolation=e,this.input=i,this.labels=[],this.outputs=[];for(var a=0,n=r;a<n.length;a+=1){var o=n[a],s=o[0],u=o[1];this.labels.push(s),this.outputs.push(u);}};function gi(t,e,i,r){var a=r-i,n=t-i;return 0===a?0:1===e?n/a:(Math.pow(e,n)-1)/(Math.pow(e,a)-1)}yi.interpolationFactor=function(t,e,i,r){var a=0;if("exponential"===t.name)a=gi(e,t.base,i,r);else if("linear"===t.name)a=gi(e,1,i,r);else if("cubic-bezier"===t.name){var n=t.controlPoints;a=new s(n[0],n[1],n[2],n[3]).solve(gi(e,1,i,r));}return a},yi.parse=function(t,e){var i=t[1],r=t[2],a=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var n=i[1];if("number"!=typeof n)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:n};}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var o=i.slice(1);if(4!==o.length||o.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:o};}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,2,Oe)))return null;var s=[],u=null;e.expectedType&&"value"!==e.expectedType.kind&&(u=e.expectedType);for(var l=0;l<a.length;l+=2){var p=a[l],c=a[l+1],h=l+3,f=l+4;if("number"!=typeof p)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(s.length&&s[s.length-1][0]>=p)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',h);var m=e.parse(c,f,u);if(!m)return null;u=u||m.type,s.push([p,m]);}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"==typeof u.N?new yi(u,i,r,s):e.error("Type "+Ue(u)+" is not interpolatable.")},yi.prototype.evaluate=function(t){var e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);var a=e.length;if(r>=e[a-1])return i[a-1].evaluate(t);var n=fi(e,r),o=e[n],s=e[n+1],u=yi.interpolationFactor(this.interpolation,r,o,s),l=i[n].evaluate(t),p=i[n+1].evaluate(t);return _i[this.type.kind.toLowerCase()](l,p,u)},yi.prototype.eachChild=function(t){t(this.input);for(var e=0,i=this.outputs;e<i.length;e+=1){t(i[e]);}},yi.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}));var t;},yi.prototype.serialize=function(){for(var t=["interpolate","linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints),this.input.serialize()],e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t};var vi=function(t,e){this.type=t,this.args=e;};vi.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var i=null,r=e.expectedType;r&&"value"!==r.kind&&(i=r);for(var a=[],n=0,o=t.slice(1);n<o.length;n+=1){var s=o[n],u=e.parse(s,1+a.length,i,void 0,{omitTypeAnnotations:!0});if(!u)return null;i=i||u.type,a.push(u);}var l=r&&a.some(function(t){return qe(r,t.type)});return new vi(l?ke:i,a)},vi.prototype.evaluate=function(t){for(var e=null,i=0,r=this.args;i<r.length;i+=1){if(null!==(e=r[i].evaluate(t)))break}return e},vi.prototype.eachChild=function(t){this.args.forEach(t);},vi.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}));var t;},vi.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize());}),t};var xi=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e;};xi.prototype.evaluate=function(t){return this.result.evaluate(t)},xi.prototype.eachChild=function(t){for(var e=0,i=this.bindings;e<i.length;e+=1){t(i[e][1]);}t(this.result);},xi.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var i=[],r=1;r<t.length-1;r+=2){var a=t[r];if("string"!=typeof a)return e.error("Expected string, but found "+typeof a+" instead.",r);if(/[^a-zA-Z0-9_]/.test(a))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var n=e.parse(t[r+1],r+1);if(!n)return null;i.push([a,n]);}var o=e.parse(t[t.length-1],t.length-1,void 0,i);return o?new xi(i,o):null},xi.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},xi.prototype.serialize=function(){for(var t=["let"],e=0,i=this.bindings;e<i.length;e+=1){var r=i[e],a=r[0],n=r[1];t.push(a,n.serialize());}return t.push(this.result.serialize()),t};var bi=function(t,e,i){this.type=t,this.index=e,this.input=i;};bi.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1,Oe),r=e.parse(t[2],2,Ve(e.expectedType||ke));if(!i||!r)return null;var a=r.type;return new bi(a.itemType,i,r)},bi.prototype.evaluate=function(t){var e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new Ke("Array index out of bounds: "+e+" < 0.");if(e>=i.length)throw new Ke("Array index out of bounds: "+e+" > "+(i.length-1)+".");if(e!==Math.floor(e))throw new Ke("Array index must be an integer, but found "+e+" instead.");return i[e]},bi.prototype.eachChild=function(t){t(this.index),t(this.input);},bi.prototype.possibleOutputs=function(){return[void 0]},bi.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var wi=function(t,e,i,r,a,n){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=a,this.otherwise=n;};wi.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var a={},n=[],o=2;o<t.length-1;o+=2){var s=t[o],u=t[o+1];Array.isArray(s)||(s=[s]);var l=e.concat(o);if(0===s.length)return l.error("Expected at least one branch label.");for(var p=0,c=s;p<c.length;p+=1){var h=c[p];if("number"!=typeof h&&"string"!=typeof h)return l.error("Branch labels must be numbers or strings.");if("number"==typeof h&&Math.abs(h)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof h&&Math.floor(h)!==h)return l.error("Numeric branch labels must be integer values.");if(i){if(l.checkSubtype(i,Ze(h)))return null}else i=Ze(h);if(void 0!==a[String(h)])return l.error("Branch labels must be unique.");a[String(h)]=n.length;}var f=e.parse(u,o,r);if(!f)return null;r=r||f.type,n.push(f);}var m=e.parse(t[1],1,ke);if(!m)return null;var d=e.parse(t[t.length-1],t.length-1,r);return d?"value"!==m.type.kind&&e.concat(1).checkSubtype(i,m.type)?null:new wi(i,r,m,a,n,d):null},wi.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(Ze(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},wi.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise);},wi.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t;},wi.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],i=[],r={},a=0,n=Object.keys(this.cases).sort();a<n.length;a+=1){var o=n[a],s=r[t.cases[o]];void 0===s?(r[t.cases[o]]=i.length,i.push([t.cases[o],[o]])):i[s][1].push(o);}for(var u=function(e){return"number"===t.inputType.kind?Number(e):e},l=0,p=i;l<p.length;l+=1){var c=p[l],h=c[0],f=c[1];1===f.length?e.push(u(f[0])):e.push(f.map(u)),e.push(t.outputs[h].serialize());}return e.push(this.otherwise.serialize()),e};var Ai=function(t,e,i){this.type=t,this.branches=e,this.otherwise=i;};function Ti(t){return"string"===t.kind||"number"===t.kind||"boolean"===t.kind||"null"===t.kind}function Si(t,e){return function(){function i(t,e,i){this.type=Le,this.lhs=t,this.rhs=e,this.collator=i;}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=e.parse(t[1],1,ke);if(!r)return null;var a=e.parse(t[2],2,ke);if(!a)return null;if(!Ti(r.type)&&!Ti(a.type))return e.error("Expected at least one argument to be a string, number, boolean, or null, but found ("+Ue(r.type)+", "+Ue(a.type)+") instead.");if(r.type.kind!==a.type.kind&&"value"!==r.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare "+Ue(r.type)+" and "+Ue(a.type)+".");var n=null;if(4===t.length){if("string"!==r.type.kind&&"string"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(n=e.parse(t[3],3,Be)))return null}return new i(r,a,n)},i.prototype.evaluate=function(t){var i=this.collator?0===this.collator.evaluate(t).compare(this.lhs.evaluate(t),this.rhs.evaluate(t)):this.lhs.evaluate(t)===this.rhs.evaluate(t);return e?!i:i},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator);},i.prototype.possibleOutputs=function(){return[!0,!1]},i.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize());}),e},i}()}Ai.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var r=[],a=1;a<t.length-1;a+=2){var n=e.parse(t[a],a,Le);if(!n)return null;var o=e.parse(t[a+1],a+1,i);if(!o)return null;r.push([n,o]),i=i||o.type;}var s=e.parse(t[t.length-1],t.length-1,i);return s?new Ai(i,r,s):null},Ai.prototype.evaluate=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var r=i[e],a=r[0],n=r[1];if(a.evaluate(t))return n.evaluate(t)}return this.otherwise.evaluate(t)},Ai.prototype.eachChild=function(t){for(var e=0,i=this.branches;e<i.length;e+=1){var r=i[e],a=r[0],n=r[1];t(a),t(n);}t(this.otherwise);},Ai.prototype.possibleOutputs=function(){return(t=[]).concat.apply(t,this.branches.map(function(t){t[0];return t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs());var t;},Ai.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize());}),t};var Ei=Si("==",!1),Pi=Si("!=",!0),Ii=function(t){this.type=Oe,this.input=t;};Ii.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error("Expected argument of type string or array, but found "+Ue(i.type)+" instead."):new Ii(i):null},Ii.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Ke("Expected value to be of type string or array, but found "+Ue(Ze(e))+" instead.")},Ii.prototype.eachChild=function(t){t(this.input);},Ii.prototype.possibleOutputs=function(){return[void 0]},Ii.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize());}),t};var Ri={"==":Ei,"!=":Pi,array:ii,at:bi,boolean:ti,case:Ai,coalesce:vi,collator:He,interpolate:yi,length:Ii,let:xi,literal:Je,match:wi,number:ti,object:ti,step:mi,string:ti,"to-color":ai,"to-number":ai,var:ci};function Mi(t,e){var i=e[0],r=e[1],a=e[2],n=e[3];i=i.evaluate(t),r=r.evaluate(t),a=a.evaluate(t);var o=n?n.evaluate(t):1,s=Qe(i,r,a,o);if(s)throw new Ke(s);return new We(i/255*o,r/255*o,a/255*o,o)}function zi(t,e){return t in e}function Ci(t,e){var i=e[t];return void 0===i?null:i}function Oi(t,e){var i=e[0],r=e[1];return i.evaluate(t)<r.evaluate(t)}function Fi(t,e){var i=e[0],r=e[1];return i.evaluate(t)>r.evaluate(t)}function Li(t,e){var i=e[0],r=e[1];return i.evaluate(t)<=r.evaluate(t)}function Di(t,e){var i=e[0],r=e[1];return i.evaluate(t)>=r.evaluate(t)}function Ni(t){return{type:t}}function ki(t){return{result:"success",value:t}}function Bi(t){return{result:"error",value:t}}function Vi(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Ui(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function ji(t){return!!t.expression&&t.expression.interpolated}si.register(Ri,{error:[{kind:"error"},[Fe],function(t,e){var i=e[0];throw new Ke(i.evaluate(t))}],typeof:[Fe,[ke],function(t,e){return Ue(Ze(e[0].evaluate(t)))}],"to-string":[Fe,[ke],function(t,e){var i=e[0],r=typeof(i=i.evaluate(t));return null===i?"":"string"===r||"number"===r||"boolean"===r?String(i):i instanceof We?i.toString():JSON.stringify(i)}],"to-boolean":[Le,[ke],function(t,e){var i=e[0];return Boolean(i.evaluate(t))}],"to-rgba":[Ve(Oe,4),[De],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[De,[Oe,Oe,Oe],Mi],rgba:[De,[Oe,Oe,Oe,Oe],Mi],has:{type:Le,overloads:[[[Fe],function(t,e){return zi(e[0].evaluate(t),t.properties())}],[[Fe,Ne],function(t,e){var i=e[0],r=e[1];return zi(i.evaluate(t),r.evaluate(t))}]]},get:{type:ke,overloads:[[[Fe],function(t,e){return Ci(e[0].evaluate(t),t.properties())}],[[Fe,Ne],function(t,e){var i=e[0],r=e[1];return Ci(i.evaluate(t),r.evaluate(t))}]]},"feature-state":[ke,[Fe],function(t,e){return Ci(e[0].evaluate(t),t.featureState||{})}],properties:[Ne,[],function(t){return t.properties()}],"geometry-type":[Fe,[],function(t){return t.geometryType()}],id:[ke,[],function(t){return t.id()}],zoom:[Oe,[],function(t){return t.globals.zoom}],"heatmap-density":[Oe,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Oe,[],function(t){return t.globals.lineProgress||0}],"+":[Oe,Ni(Oe),function(t,e){for(var i=0,r=0,a=e;r<a.length;r+=1){i+=a[r].evaluate(t);}return i}],"*":[Oe,Ni(Oe),function(t,e){for(var i=1,r=0,a=e;r<a.length;r+=1){i*=a[r].evaluate(t);}return i}],"-":{type:Oe,overloads:[[[Oe,Oe],function(t,e){var i=e[0],r=e[1];return i.evaluate(t)-r.evaluate(t)}],[[Oe],function(t,e){return-e[0].evaluate(t)}]]},"/":[Oe,[Oe,Oe],function(t,e){var i=e[0],r=e[1];return i.evaluate(t)/r.evaluate(t)}],"%":[Oe,[Oe,Oe],function(t,e){var i=e[0],r=e[1];return i.evaluate(t)%r.evaluate(t)}],ln2:[Oe,[],function(){return Math.LN2}],pi:[Oe,[],function(){return Math.PI}],e:[Oe,[],function(){return Math.E}],"^":[Oe,[Oe,Oe],function(t,e){var i=e[0],r=e[1];return Math.pow(i.evaluate(t),r.evaluate(t))}],sqrt:[Oe,[Oe],function(t,e){var i=e[0];return Math.sqrt(i.evaluate(t))}],log10:[Oe,[Oe],function(t,e){var i=e[0];return Math.log10(i.evaluate(t))}],ln:[Oe,[Oe],function(t,e){var i=e[0];return Math.log(i.evaluate(t))}],log2:[Oe,[Oe],function(t,e){var i=e[0];return Math.log2(i.evaluate(t))}],sin:[Oe,[Oe],function(t,e){var i=e[0];return Math.sin(i.evaluate(t))}],cos:[Oe,[Oe],function(t,e){var i=e[0];return Math.cos(i.evaluate(t))}],tan:[Oe,[Oe],function(t,e){var i=e[0];return Math.tan(i.evaluate(t))}],asin:[Oe,[Oe],function(t,e){var i=e[0];return Math.asin(i.evaluate(t))}],acos:[Oe,[Oe],function(t,e){var i=e[0];return Math.acos(i.evaluate(t))}],atan:[Oe,[Oe],function(t,e){var i=e[0];return Math.atan(i.evaluate(t))}],min:[Oe,Ni(Oe),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[Oe,Ni(Oe),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[Oe,[Oe],function(t,e){var i=e[0];return Math.abs(i.evaluate(t))}],round:[Oe,[Oe],function(t,e){var i=e[0].evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Oe,[Oe],function(t,e){var i=e[0];return Math.floor(i.evaluate(t))}],ceil:[Oe,[Oe],function(t,e){var i=e[0];return Math.ceil(i.evaluate(t))}],"filter-==":[Le,[Fe,ke],function(t,e){var i=e[0],r=e[1];return t.properties()[i.value]===r.value}],"filter-id-==":[Le,[ke],function(t,e){var i=e[0];return t.id()===i.value}],"filter-type-==":[Le,[Fe],function(t,e){var i=e[0];return t.geometryType()===i.value}],"filter-<":[Le,[Fe,ke],function(t,e){var i=e[0],r=e[1],a=t.properties()[i.value],n=r.value;return typeof a==typeof n&&a<n}],"filter-id-<":[Le,[ke],function(t,e){var i=e[0],r=t.id(),a=i.value;return typeof r==typeof a&&r<a}],"filter->":[Le,[Fe,ke],function(t,e){var i=e[0],r=e[1],a=t.properties()[i.value],n=r.value;return typeof a==typeof n&&a>n}],"filter-id->":[Le,[ke],function(t,e){var i=e[0],r=t.id(),a=i.value;return typeof r==typeof a&&r>a}],"filter-<=":[Le,[Fe,ke],function(t,e){var i=e[0],r=e[1],a=t.properties()[i.value],n=r.value;return typeof a==typeof n&&a<=n}],"filter-id-<=":[Le,[ke],function(t,e){var i=e[0],r=t.id(),a=i.value;return typeof r==typeof a&&r<=a}],"filter->=":[Le,[Fe,ke],function(t,e){var i=e[0],r=e[1],a=t.properties()[i.value],n=r.value;return typeof a==typeof n&&a>=n}],"filter-id->=":[Le,[ke],function(t,e){var i=e[0],r=t.id(),a=i.value;return typeof r==typeof a&&r>=a}],"filter-has":[Le,[ke],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Le,[],function(t){return null!==t.id()}],"filter-type-in":[Le,[Ve(Fe)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-type-arrin":[Le,[Ve(Fe)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-arrin":[Le,[Fe,Ve(ke)],function(t,e){var i=e[0],r=e[1];return function(t,e,i,r){for(;i<=r;){if(!t)return!1;var a=null;if("string"==typeof t?a=t.split(","):"number"==typeof t&&(a=[t]),a&&a.indexOf(e[i])>-1)return!0;i+=1;}return!1}(t.properties()[i.value],r.value,0,r.value.length-1)}],"filter-type-like":[Le,[Ve(Fe)],function(t,e){var i=e[0];return t.geometryType().indexOf(i.value)>=0}],"filter-like":[Le,[Fe,Ve(ke)],function(t,e){var i=e[0],r=e[1];return function(t,e){return-1!==t.indexOf(e)}(t.properties()[i.value],r.value)}],"filter-id-in":[Le,[Ve(ke)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Le,[Fe,Ve(ke)],function(t,e){var i=e[0];return e[1].value.indexOf(t.properties()[i.value])>=0}],"filter-in-large":[Le,[Fe,Ve(ke)],function(t,e){var i=e[0],r=e[1];return function(t,e,i,r){for(;i<=r;){var a=i+r>>1;if(e[a]===t)return!0;e[a]>t?r=a-1:i=a+1;}return!1}(t.properties()[i.value],r.value,0,r.value.length-1)}],">":{type:Le,overloads:[[[Oe,Oe],Fi],[[Fe,Fe],Fi],[[Fe,Fe,Be],function(t,e){var i=e[0],r=e[1];return e[2].evaluate(t).compare(i.evaluate(t),r.evaluate(t))>0}]]},"<":{type:Le,overloads:[[[Oe,Oe],Oi],[[Fe,Fe],Oi],[[Fe,Fe,Be],function(t,e){var i=e[0],r=e[1];return e[2].evaluate(t).compare(i.evaluate(t),r.evaluate(t))<0}]]},">=":{type:Le,overloads:[[[Oe,Oe],Di],[[Fe,Fe],Di],[[Fe,Fe,Be],function(t,e){var i=e[0],r=e[1];return e[2].evaluate(t).compare(i.evaluate(t),r.evaluate(t))>=0}]]},"<=":{type:Le,overloads:[[[Oe,Oe],Li],[[Fe,Fe],Li],[[Fe,Fe,Be],function(t,e){var i=e[0],r=e[1];return e[2].evaluate(t).compare(i.evaluate(t),r.evaluate(t))<=0}]]},all:{type:Le,overloads:[[[Le,Le],function(t,e){var i=e[0],r=e[1];return i.evaluate(t)&&r.evaluate(t)}],[Ni(Le),function(t,e){for(var i=0,r=e;i<r.length;i+=1){if(!r[i].evaluate(t))return!1}return!0}]]},any:{type:Le,overloads:[[[Le,Le],function(t,e){var i=e[0],r=e[1];return i.evaluate(t)||r.evaluate(t)}],[Ni(Le),function(t,e){for(var i=0,r=e;i<r.length;i+=1){if(r[i].evaluate(t))return!0}return!1}]]},"!":[Le,[Le],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Le,[Fe],function(t,e){var i=e[0],r=t.globals&&t.globals.isSupportedScript;return!r||r(i.evaluate(t))}],upcase:[Fe,[Fe],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Fe,[Fe],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Fe,Ni(Fe),function(t,e){return e.map(function(e){return e.evaluate(t)}).join("")}],"resolved-locale":[Fe,[Be],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var qi=.95047,Xi=1,Gi=1.08883,Wi=4/29,Yi=6/29,Hi=3*Yi*Yi,Qi=Yi*Yi*Yi,Zi=Math.PI/180,Ji=180/Math.PI;function Ki(t){return t>Qi?Math.pow(t,1/3):t/Hi+Wi}function $i(t){return t>Yi?t*t*t:Hi*(t-Wi)}function tr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function er(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ir(t){var e=er(t.r),i=er(t.g),r=er(t.b),a=Ki((.4124564*e+.3575761*i+.1804375*r)/qi),n=Ki((.2126729*e+.7151522*i+.072175*r)/Xi);return{l:116*n-16,a:500*(a-n),b:200*(n-Ki((.0193339*e+.119192*i+.9503041*r)/Gi)),alpha:t.a}}function rr(t){var e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=Xi*$i(e),i=qi*$i(i),r=Gi*$i(r),new We(tr(3.2404542*i-1.5371385*e-.4985314*r),tr(-.969266*i+1.8760108*e+.041556*r),tr(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}var ar={forward:ir,reverse:rr,interpolate:function(t,e,i){return{l:di(t.l,e.l,i),a:di(t.a,e.a,i),b:di(t.b,e.b,i),alpha:di(t.alpha,e.alpha,i)}}},nr={forward:function(t){var e=ir(t),i=e.l,r=e.a,a=e.b,n=Math.atan2(a,r)*Ji;return{h:n<0?n+360:n,c:Math.sqrt(r*r+a*a),l:i,alpha:t.a}},reverse:function(t){var e=t.h*Zi,i=t.c;return rr({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:function(t,e,i){var r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}(t.h,e.h,i),c:di(t.c,e.c,i),l:di(t.l,e.l,i),alpha:di(t.alpha,e.alpha,i)}}},or=Object.freeze({lab:ar,hcl:nr});function sr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function ur(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function lr(t){return t}function pr(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function cr(t,e,i,r,a){return pr(typeof i===a?r[i]:void 0,t.default,e.default)}function hr(t,e,i){if("number"!==sr(i))return pr(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];var a=dr(t.stops,i);return t.stops[a][1]}function fr(t,e,i){var r=void 0!==t.base?t.base:1;if("number"!==sr(i))return pr(t.default,e.default);var a=t.stops.length;if(1===a)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];var n=dr(t.stops,i),o=function(t,e,i,r){var a=r-i,n=t-i;return 0===a?0:1===e?n/a:(Math.pow(e,n)-1)/(Math.pow(e,a)-1)}(i,r,t.stops[n][0],t.stops[n+1][0]),s=t.stops[n][1],u=t.stops[n+1][1],l=_i[e.type]||lr;if(t.colorSpace&&"rgb"!==t.colorSpace){var p=or[t.colorSpace];l=function(t,e){return p.reverse(p.interpolate(p.forward(t),p.forward(e),o))};}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var i=s.evaluate.apply(void 0,t),r=u.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return l(i,r,o)}}:l(s,u,o)}function mr(t,e,i){return"color"===e.type?"x-color"!==e.units&&(i=We.parse(i)):sr(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),pr(i,t.default,e.default)}function dr(t,e){for(var i,r,a=0,n=t.length-1,o=0;a<=n;){if(i=t[o=Math.floor((a+n)/2)][0],r=t[o+1][0],e===i||e>i&&e<r)return o;i<e?a=o+1:i>e&&(n=o-1);}return Math.max(o-1,0)}var _r=function(t,e){var i;this.expression=t,this._warningHistory={},this._defaultValue="color"===(i=e).type&&ur(i.default)?new We(0,0,0,0):"color"===i.type?We.parse(i.default)||null:void 0===i.default?null:i.default,"enum"===e.type&&(this._enumValues=e.values);};function yr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ri}function gr(t,e){var i=new hi(Ri,[],function(t){var e={color:De,string:Fe,number:Oe,enum:Fe,boolean:Le};if("array"===t.type)return Ve(e[t.value]||ke,t.length);return e[t.type]||null}(e)),r=i.parse(t);return r?ki(new _r(r,e)):Bi(i.errors)}_r.prototype.evaluateWithoutErrorHandling=function(t,e,i){return this._evaluator||(this._evaluator=new oi),this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this.expression.evaluate(this._evaluator)},_r.prototype.evaluate=function(t,e,i){this._evaluator||(this._evaluator=new oi),this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i;try{var r=this.expression.evaluate(this._evaluator);if(null===r||void 0===r)return this._defaultValue;if(this._enumValues&&!(r in this._enumValues))throw new Ke("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(r)+" instead.");return r}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var vr=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!li(e.expression);};vr.prototype.evaluateWithoutErrorHandling=function(t,e,i){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i)},vr.prototype.evaluate=function(t,e,i){return this._styleExpression.evaluate(t,e,i)};var xr=function(t,e,i){this.kind=t,this.zoomStops=i.labels,this._styleExpression=e,this.isStateDependent="camera"!==t&&!li(e.expression),i instanceof yi&&(this._interpolationType=i.interpolation);};function br(t,e){if("error"===(t=gr(t,e)).result)return t;var i=t.value.expression,r=ui(i);if(!r&&!Vi(e))return Bi([new Me("","data expressions not supported")]);var a=pi(i,["zoom"]);if(!a&&!Ui(e))return Bi([new Me("","zoom expressions not supported")]);var n=function t(e){var i=null;if(e instanceof xi)i=t(e.result);else if(e instanceof vi)for(var r=0,a=e.args;r<a.length;r+=1){var n=a[r];if(i=t(n))break}else(e instanceof mi||e instanceof yi)&&e.input instanceof si&&"zoom"===e.input.name&&(i=e);if(i instanceof Me)return i;e.eachChild(function(e){var r=t(e);r instanceof Me?i=r:!i&&r?i=new Me("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&r&&i!==r&&(i=new Me("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));});return i}(i);return n||a?n instanceof Me?Bi([n]):n instanceof yi&&!ji(e)?Bi([new Me("",'"interpolate" expressions cannot be used with this property')]):ki(n?new xr(r?"camera":"composite",t.value,n):new vr(r?"constant":"source",t.value)):Bi([new Me("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}xr.prototype.evaluateWithoutErrorHandling=function(t,e,i){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i)},xr.prototype.evaluate=function(t,e,i){return this._styleExpression.evaluate(t,e,i)},xr.prototype.interpolationFactor=function(t,e,i){return this._interpolationType?yi.interpolationFactor(this._interpolationType,t,e,i):0};var wr=function(t,e){this._parameters=t,this._specification=e,Pe(this,function t(e,i){var r,a,n,o="color"===i.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,l=s||!u,p=e.type||(ji(i)?"exponential":"interval");if(o&&((e=Pe({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],We.parse(t[1])]})),e.default?e.default=We.parse(e.default):e.default=We.parse(i.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!or[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===p)r=fr;else if("interval"===p)r=hr;else if("categorical"===p){r=cr,a=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var f=h[c];a[f[0]]=f[1];}n=typeof e.stops[0][0];}else{if("identity"!==p)throw new Error('Unknown function type "'+p+'"');r=mr;}if(s){for(var m={},d=[],_=0;_<e.stops.length;_++){var y=e.stops[_],g=y[0].zoom;void 0===m[g]&&(m[g]={zoom:g,type:e.type,property:e.property,default:e.default,stops:[]},d.push(g)),m[g].stops.push([y[0].value,y[1]]);}for(var v=[],x=0,b=d;x<b.length;x+=1){var w=b[x];v.push([m[w].zoom,t(m[w],i)]);}return{kind:"composite",interpolationFactor:yi.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:v.map(function(t){return t[0]}),evaluate:function(t,r){var a=t.zoom;return fr({stops:v,base:e.base},i,a).evaluate(a,r)}}}return l?{kind:"camera",interpolationFactor:"exponential"===p?yi.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){var o=t.zoom;return r(e,i,o,a,n)}}:{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?pr(e.default,i.default):r(e,i,s,a,n)}}}(this._parameters,this._specification));};function Ar(t,e){if(ur(t))return new wr(t,e);if(yr(t)){var i=br(t,e);if("error"===i.result)throw new Error(i.value.map(function(t){return t.key+": "+t.message}).join(", "));return i.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=We.parse(t)),{kind:"constant",evaluate:function(){return r}}}function Tr(t){var e=t.key,i=t.value,r=t.valueSpec||{},a=t.objectElementValidators||{},n=t.style,o=t.styleSpec,s=[],u=sr(i);if("object"!==u)return[new Se(e,i,"object expected, "+u+" found")];for(var l in i){var p=l.split(".")[0],c=r[p]||r["*"],h=void 0;if(a[p])h=a[p];else if(r[p])h=Zr;else if(a["*"])h=a["*"];else{if(!r["*"]){s.push(new Se(e,i[l],'unknown property "'+l+'"'));continue}h=Zr;}s=s.concat(h({key:(e?e+".":e)+l,value:i[l],valueSpec:c,style:n,styleSpec:o,object:i,objectKey:l},i));}for(var f in r)a[f]||r[f].required&&void 0===r[f].default&&void 0===i[f]&&s.push(new Se(e,i,'missing required property "'+f+'"'));return s}function Sr(t){var e=t.value,i=t.valueSpec,r=t.style,a=t.styleSpec,n=t.key,o=t.arrayElementValidator||Zr;if("array"!==sr(e))return[new Se(n,e,"array expected, "+sr(e)+" found")];if(i.length&&e.length!==i.length)return[new Se(n,e,"array length "+i.length+" expected, length "+e.length+" found")];if(i["min-length"]&&e.length<i["min-length"])return[new Se(n,e,"array length at least "+i["min-length"]+" expected, length "+e.length+" found")];var s={type:i.value};a.$version<7&&(s.function=i.function),"object"===sr(i.value)&&(s=i.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(o({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:r,styleSpec:a,key:n+"["+l+"]"}));return u}function Er(t){var e=t.key,i=t.value,r=t.valueSpec,a=sr(i);return"number"!==a?[new Se(e,i,"number expected, "+a+" found")]:"minimum"in r&&i<r.minimum?[new Se(e,i,i+" is less than the minimum value "+r.minimum)]:"maximum"in r&&i>r.maximum?[new Se(e,i,i+" is greater than the maximum value "+r.maximum)]:[]}function Pr(t){var e,i,r,a=t.valueSpec,n=Ie(t.value.type),o={},s="categorical"!==n&&void 0===t.value.property,u=!s,l="array"===sr(t.value.stops)&&"array"===sr(t.value.stops[0])&&"object"===sr(t.value.stops[0][0]),p=Tr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new Se(t.key,t.value,'identity function may not have a "stops" property')];var e=[],i=t.value;e=e.concat(Sr({key:t.key,value:i,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:c})),"array"===sr(i)&&0===i.length&&e.push(new Se(t.key,i,"array must have at least one stop"));return e},default:function(t){return Zr({key:t.key,value:t.value,valueSpec:a,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&s&&p.push(new Se(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||p.push(new Se(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!ji(t.valueSpec)&&p.push(new Se(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!Vi(t.valueSpec)?p.push(new Se(t.key,t.value,"property functions not supported")):s&&!Ui(t.valueSpec)&&p.push(new Se(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!l||void 0!==t.value.property||p.push(new Se(t.key,t.value,'"property" property is required')),p;function c(t){var e=[],n=t.value,s=t.key;if("array"!==sr(n))return[new Se(s,n,"array expected, "+sr(n)+" found")];if(2!==n.length)return[new Se(s,n,"array length 2 expected, length "+n.length+" found")];if(l){if("object"!==sr(n[0]))return[new Se(s,n,"object expected, "+sr(n[0])+" found")];if(void 0===n[0].zoom)return[new Se(s,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Se(s,n,"object stop key must have value")];if(r&&r>Ie(n[0].zoom))return[new Se(s,n[0].zoom,"stop zoom values must appear in ascending order")];Ie(n[0].zoom)!==r&&(r=Ie(n[0].zoom),i=void 0,o={}),e=e.concat(Tr({key:s+"[0]",value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Er,value:h}}));}else e=e.concat(h({key:s+"[0]",value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return e.concat(Zr({key:s+"[1]",value:n[1],valueSpec:a,style:t.style,styleSpec:t.styleSpec}))}function h(t,r){var s=sr(t.value),u=Ie(t.value),l=null!==t.value?t.value:r;if(e){if(s!==e)return[new Se(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Se(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){var p="number expected, "+s+" found";return Vi(a)&&void 0===n&&(p+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Se(t.key,l,p)]}return"categorical"!==n||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==n&&"number"===s&&void 0!==i&&u<i?[new Se(t.key,l,"stop domain values must appear in ascending order")]:(i=u,"categorical"===n&&u in o?[new Se(t.key,l,"stop domain values must be unique")]:(o[u]=!0,[])):[new Se(t.key,l,"integer expected, found "+u)]}}function Ir(t){var e=("property"===t.expressionContext?br:gr)(Re(t.value),t.valueSpec);return"error"===e.result?e.value.map(function(e){return new Se(""+t.key+e.key,t.value,e.message)}):"property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==e.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new Se(t.key,t.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:"property"!==t.expressionContext||"layout"!==t.propertyType||li(e.value._styleExpression.expression)?[]:[new Se(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')]}function Rr(t){var e=t.key,i=t.value,r=t.valueSpec,a=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ie(i))&&a.push(new Se(e,i,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(i)+" found")):-1===Object.keys(r.values).indexOf(Ie(i))&&a.push(new Se(e,i,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(i)+" found")),a}function Mr(t){if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":case"!arrin":case"arrin":case"like":case"!like":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,i=t.slice(1);e<i.length;e+=1){var r=i[e];if(!Mr(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}wr.deserialize=function(t){return new wr(t._parameters,t._specification)},wr.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var zr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cr(t){if(!t)return function(){return!0};Mr(t)||(t=Fr(t));var e=gr(t,zr);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,i){return e.value.evaluate(t,i)}}function Or(t,e){return t<e?-1:t>e?1:0}function Fr(t){if(!t)return!0;var e,i=t[0];return t.length<=1?"any"!==i:"=="===i?Lr(t[1],t[2],"=="):"!="===i?Vr(Lr(t[1],t[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Lr(t[1],t[2],i):"any"===i?(e=t.slice(1),["any"].concat(e.map(Fr))):"all"===i?["all"].concat(t.slice(1).map(Fr)):"none"===i?["all"].concat(t.slice(1).map(Fr).map(Vr)):"in"===i?Dr(t[1],t.slice(2)):"!in"===i?Vr(Dr(t[1],t.slice(2))):"has"===i?Br(t[1]):"!has"===i?Vr(Br(t[1])):"arrin"===i?Nr(t[1],t.slice(2)):"!arrin"===i?Vr(Nr(t[1],t.slice(2))):"like"===i?kr(t[1],t.slice(2)):"!like"!==i||Vr(kr(t[1],t.slice(2)))}function Lr(t,e,i){switch(t){case"$type":return["filter-type-"+i,e];case"$id":return["filter-id-"+i,e];default:return["filter-"+i,t,e]}}function Dr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(Or)]]:["filter-in-small",t,["literal",e]]}}function Nr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-arrin",["literal",e]];default:return["filter-arrin",t,["literal",e]]}}function kr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-like",["literal",e]];default:return["filter-like",t,["literal",e]]}}function Br(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Vr(t){return["!",t]}function Ur(t){return Mr(Re(t.value))?Ir(Pe({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var i=e.value;var r=e.key;if("array"!==sr(i))return[new Se(r,i,"array expected, "+sr(i)+" found")];var a=e.styleSpec;var n;var o=[];if(i.length<1)return[new Se(r,i,"filter array must have at least 1 element")];o=o.concat(Rr({key:r+"[0]",value:i[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec}));switch(Ie(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Ie(i[1])&&o.push(new Se(r,i,'"$type" cannot be use with operator "'+i[0]+'"'));case"==":case"!=":3!==i.length&&o.push(new Se(r,i,'filter array for operator "'+i[0]+'" must have 3 elements'));case"in":case"!in":case"arrin":case"!arrin":case"like":case"!like":i.length>=2&&"string"!==(n=sr(i[1]))&&o.push(new Se(r+"[1]",i[1],"string expected, "+n+" found"));for(var s=2;s<i.length;s++)n=sr(i[s]),"$type"===Ie(i[1])?o=o.concat(Rr({key:r+"["+s+"]",value:i[s],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new Se(r+"["+s+"]",i[s],"string, number, or boolean expected, "+n+" found"));break;case"any":case"all":case"none":for(var u=1;u<i.length;u++)o=o.concat(t({key:r+"["+u+"]",value:i[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=sr(i[1]),2!==i.length?o.push(new Se(r,i,'filter array for "'+i[0]+'" operator must have 2 elements')):"string"!==n&&o.push(new Se(r+"[1]",i[1],"string expected, "+n+" found"));}return o}(t)}function jr(t,e){var i=t.key,r=t.style,a=t.styleSpec,n=t.value,o=t.objectKey,s=a[e+"_"+t.layerType];if(!s)return[];var u=o.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Zr({key:i,value:n,valueSpec:a.transition,style:r,styleSpec:a});var l,p=t.valueSpec||s[o];if(!p)return[new Se(i,n,'unknown property "'+o+'"')];if("string"===sr(n)&&Vi(p)&&!p.tokens&&(l=/^{([^}]+)}$/.exec(n)))return[new Se(i,n,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var c=[];return"symbol"===t.layerType&&("text-field"===o&&r&&!r.glyphs&&c.push(new Se(i,n,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&ur(Re(n))&&"identity"===Ie(n.type)&&c.push(new Se(i,n,'"text-font" does not support identity functions'))),c.concat(Zr({key:t.key,value:n,valueSpec:p,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:o}))}function qr(t){return jr(t,"paint")}function Xr(t){return jr(t,"layout")}function Gr(t){var e=[],i=t.value,r=t.key,a=t.style,n=t.styleSpec;i.type||i.ref||e.push(new Se(r,i,'either "type" or "ref" is required'));var o,s=Ie(i.type),u=Ie(i.ref);if(i.id)for(var l=Ie(i.id),p=0;p<t.arrayIndex;p++){var c=a.layers[p];Ie(c.id)===l&&e.push(new Se(r,i.id,'duplicate layer id "'+i.id+'", previously used at line '+c.id.__line__));}if("ref"in i)["type","source","source-layer","filter","layout"].forEach(function(t){t in i&&e.push(new Se(r,i[t],'"'+t+'" is prohibited for ref layers'));}),a.layers.forEach(function(t){Ie(t.id)===u&&(o=t);}),o?o.ref?e.push(new Se(r,i.ref,"ref cannot reference another ref layer")):s=Ie(o.type):e.push(new Se(r,i.ref,'ref layer "'+u+'" not found'));else if("background"!==s&&"sphere-background"!==s)if(i.source){var h=a.sources&&a.sources[i.source],f=h&&Ie(h.type);h?"vector"===f&&"raster"===s?e.push(new Se(r,i.source,'layer "'+i.id+'" requires a raster source')):"raster"===f&&"raster"!==s&&"sphere-raster"!==s?e.push(new Se(r,i.source,'layer "'+i.id+'" requires a vector source')):"vector"!==f||i["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Se(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===f&&h.lineMetrics||e.push(new Se(r,i,'layer "'+i.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Se(r,i,'layer "'+i.id+'" must specify a "source-layer"')):e.push(new Se(r,i.source,'source "'+i.source+'" not found'));}else e.push(new Se(r,i,'missing required property "source"'));return e=e.concat(Tr({key:r,value:i,valueSpec:n.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Zr({key:r+".type",value:i.type,valueSpec:n.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"})},filter:Ur,layout:function(t){return Tr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Xr(Pe({layerType:s},t))}}})},paint:function(t){return Tr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return qr(Pe({layerType:s},t))}}})}}}))}function Wr(t){var e=t.value,i=t.key,r=t.styleSpec,a=t.style;if(!e.type)return[new Se(i,e,'"type" is required')];var n=Ie(e.type),o=[];switch(n){case"vector":case"raster":case"raster-dem":if(o=o.concat(Tr({key:i,value:e,valueSpec:r["source_"+n.replace("-","_")],style:t.style,styleSpec:r})),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&o.push(new Se(i+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return o;case"geojson":return Tr({key:i,value:e,valueSpec:r.source_geojson,style:a,styleSpec:r});case"video":return Tr({key:i,value:e,valueSpec:r.source_video,style:a,styleSpec:r});case"image":return Tr({key:i,value:e,valueSpec:r.source_image,style:a,styleSpec:r});case"canvas":return o.push(new Se(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")),o;default:return Rr({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:r})}}function Yr(t){var e=t.value,i=t.styleSpec,r=i.light,a=t.style,n=[],o=sr(e);if(void 0===e)return n;if("object"!==o)return n=n.concat([new Se("light",e,"object expected, "+o+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);n=u&&r[u[1]]&&r[u[1]].transition?n.concat(Zr({key:s,value:e[s],valueSpec:i.transition,style:a,styleSpec:i})):r[s]?n.concat(Zr({key:s,value:e[s],valueSpec:r[s],style:a,styleSpec:i})):n.concat([new Se(s,e[s],'unknown property "'+s+'"')]);}return n}function Hr(t){var e=t.value,i=t.key,r=sr(e);return"string"!==r?[new Se(i,e,"string expected, "+r+" found")]:[]}var Qr={"*":function(){return[]},array:Sr,boolean:function(t){var e=t.value,i=t.key,r=sr(e);return"boolean"!==r?[new Se(i,e,"boolean expected, "+r+" found")]:[]},number:Er,color:function(t){var e=t.key,i=t.value,r=sr(i);return"string"!==r?[new Se(e,i,"color expected, "+r+" found")]:null===Ge(i)?[new Se(e,i,'color expected, "'+i+'" found')]:[]},constants:Ee,enum:Rr,filter:Ur,function:Pr,layer:Gr,object:Tr,source:Wr,light:Yr,string:Hr};function Zr(t){var e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&ur(Ie(e))?Pr(t):i.expression&&yr(Re(e))?Ir(t):i.type&&Qr[i.type]?Qr[i.type](t):Tr(Pe({},t,{valueSpec:i.type?r[i.type]:i}))}function Jr(t){var e=t.value,i=t.key,r=Hr(t);return r.length?r:(-1===e.indexOf("{fontstack}")&&r.push(new Se(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new Se(i,e,'"glyphs" url must include a "{range}" token')),r)}function Kr(t,e){e=e||Te;var i=[];return i=i.concat(Zr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Jr,"*":function(){return[]}}})),t.constants&&(i=i.concat(Ee({key:"constants",value:t.constants,style:t,styleSpec:e}))),$r(i)}function $r(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function ta(t){return function(){return $r(t.apply(this,arguments))}}Kr.source=ta(Wr),Kr.light=ta(Yr),Kr.layer=ta(Gr),Kr.filter=ta(Ur),Kr.paintProperty=ta(qr),Kr.layoutProperty=ta(Xr);var ea=Kr,ia=Kr.light,ra=Kr.paintProperty,aa=Kr.layoutProperty;function na(t,e){var i=!1;if(e&&e.length)for(var r=0,a=e;r<a.length;r+=1){var n=a[r];t.fire(new we(new Error(n.message))),i=!0;}return i}var oa=ua,sa=3;function ua(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],e=a[1],i=a[2],this.d=e+2*i;for(var n=0;n<this.d*this.d;n++){var o=a[sa+n],s=a[sa+n+1];r.push(o===s?null:a.subarray(o,s));}var u=a[sa+r.length],l=a[sa+r.length+1];this.keys=a.subarray(u,l),this.bboxes=a.subarray(l),this.insert=this._insertReadonly;}else{this.d=e+2*i;for(var p=0;p<this.d*this.d;p++)r.push([]);this.keys=[],this.bboxes=[];}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var c=i/e*t;this.min=-c,this.max=t+c;}ua.prototype.insert=function(t,e,i,r,a){this._forEachCell(e,i,r,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(a);},ua.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ua.prototype._insertCell=function(t,e,i,r,a,n){this.cells[a].push(n);},ua.prototype.query=function(t,e,i,r,a){var n=this.min,o=this.max;if(t<=n&&e<=n&&o<=i&&o<=r&&!a)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,i,r,this._queryCell,s,{},a),s},ua.prototype._queryCell=function(t,e,i,r,a,n,o,s){var u=this.cells[a];if(null!==u)for(var l=this.keys,p=this.bboxes,c=0;c<u.length;c++){var h=u[c];if(void 0===o[h]){var f=4*h;(s?s(p[f+0],p[f+1],p[f+2],p[f+3]):t<=p[f+2]&&e<=p[f+3]&&i>=p[f+0]&&r>=p[f+1])?(o[h]=!0,n.push(l[h])):o[h]=!1;}}},ua.prototype._forEachCell=function(t,e,i,r,a,n,o,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),p=this._convertToCellCoord(i),c=this._convertToCellCoord(r),h=u;h<=p;h++)for(var f=l;f<=c;f++){var m=this.d*f+h;if((!s||s(this._convertFromCellCoord(h),this._convertFromCellCoord(f),this._convertFromCellCoord(h+1),this._convertFromCellCoord(f+1)))&&a.call(this,t,e,i,r,m,n,o,s))return}},ua.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ua.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ua.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=sa+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var n=e,o=0;o<t.length;o++){var s=t[o];a[sa+o]=n,a.set(s,n),n+=s.length;}return a[sa+t.length]=n,a.set(this.keys,n),n+=this.keys.length,a[sa+t.length+1]=n,a.set(this.bboxes,n),n+=this.bboxes.length,a.buffer};var la=self.ImageData,pa={};function ca(t,e,i){void 0===i&&(i={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),pa[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]};}for(var ha in ca("Object",Object),oa.serialize=function(t,e){var i=t.toArrayBuffer();return e&&e.push(i),i},oa.deserialize=function(t){return new oa(t)},ca("Grid",oa),ca("Color",We),ca("Error",Error),ca("StylePropertyFunction",wr),ca("StyleExpression",_r,{omit:["_evaluator"]}),ca("ZoomDependentExpression",xr),ca("ZoomConstantExpression",vr),ca("CompoundExpression",si,{omit:["_evaluate"]}),Ri)Ri[ha]._classRegistryKey||ca("Expression_"+ha,Ri[ha]);function fa(t,e){if(null===t||void 0===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var i=t;return e&&e.push(i.buffer),i}if(t instanceof la)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],a=0,n=t;a<n.length;a+=1){var o=n[a];r.push(fa(o,e));}return r}if("object"==typeof t){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var l={};if(s.serialize)l._serialized=s.serialize(t,e);else{for(var p in t)if(t.hasOwnProperty(p)&&!(pa[u].omit.indexOf(p)>=0)){var c=t[p];l[p]=pa[u].shallow.indexOf(p)>=0?c:fa(c,e);}t instanceof Error&&(l.message=t.message);}return{name:u,properties:l}}throw new Error("can't serialize object of type "+typeof t)}function ma(t){if(null===t||void 0===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof la)return t;if(Array.isArray(t))return t.map(function(t){return ma(t)});if("object"==typeof t){var e=t,i=e.name,r=e.properties;if(!i)throw new Error("can't deserialize object of anonymous class");var a=pa[i].klass;if(!a)throw new Error("can't deserialize unregistered class "+i);if(a.deserialize)return a.deserialize(r._serialized);for(var n=Object.create(a.prototype),o=0,s=Object.keys(r);o<s.length;o+=1){var u=s[o];n[u]=pa[i].shallow.indexOf(u)>=0?r[u]:ma(r[u]);}return n}throw new Error("can't deserialize object of type "+typeof t)}var da=function(){this.first=!0;};da.prototype.update=function(t,e){var i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))};var _a={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function ya(t){for(var e=0,i=t;e<i.length;e+=1){if(va(i[e].charCodeAt(0)))return!0}return!1}function ga(t){return!_a.Arabic(t)&&(!_a["Arabic Supplement"](t)&&(!_a["Arabic Extended-A"](t)&&(!_a["Arabic Presentation Forms-A"](t)&&!_a["Arabic Presentation Forms-B"](t))))}function va(t){return 746===t||747===t||!(t<4352)&&(!!_a["Bopomofo Extended"](t)||(!!_a.Bopomofo(t)||(!(!_a["CJK Compatibility Forms"](t)||t>=65097&&t<=65103)||(!!_a["CJK Compatibility Ideographs"](t)||(!!_a["CJK Compatibility"](t)||(!!_a["CJK Radicals Supplement"](t)||(!!_a["CJK Strokes"](t)||(!(!_a["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||(!!_a["CJK Unified Ideographs Extension A"](t)||(!!_a["CJK Unified Ideographs"](t)||(!!_a["Enclosed CJK Letters and Months"](t)||(!!_a["Hangul Compatibility Jamo"](t)||(!!_a["Hangul Jamo Extended-A"](t)||(!!_a["Hangul Jamo Extended-B"](t)||(!!_a["Hangul Jamo"](t)||(!!_a["Hangul Syllables"](t)||(!!_a.Hiragana(t)||(!!_a["Ideographic Description Characters"](t)||(!!_a.Kanbun(t)||(!!_a["Kangxi Radicals"](t)||(!!_a["Katakana Phonetic Extensions"](t)||(!(!_a.Katakana(t)||12540===t)||(!(!_a["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||(!(!_a["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(!!_a["Unified Canadian Aboriginal Syllabics"](t)||(!!_a["Unified Canadian Aboriginal Syllabics Extended"](t)||(!!_a["Vertical Forms"](t)||(!!_a["Yijing Hexagram Symbols"](t)||(!!_a["Yi Syllables"](t)||!!_a["Yi Radicals"](t))))))))))))))))))))))))))))))}function xa(t){return!(va(t)||function(t){return!!(_a["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||_a["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||_a["Letterlike Symbols"](t)||_a["Number Forms"](t)||_a["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||_a["Control Pictures"](t)&&9251!==t||_a["Optical Character Recognition"](t)||_a["Enclosed Alphanumerics"](t)||_a["Geometric Shapes"](t)||_a["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||_a["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||_a["CJK Symbols and Punctuation"](t)||_a.Katakana(t)||_a["Private Use Area"](t)||_a["CJK Compatibility Forms"](t)||_a["Small Form Variants"](t)||_a["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function ba(t,e){return!(!e&&(t>=1424&&t<=2303||_a["Arabic Presentation Forms-A"](t)||_a["Arabic Presentation Forms-B"](t)))&&!(t>=2304&&t<=3583||t>=3840&&t<=4255||_a.Khmer(t))}var wa,Aa=!1,Ta=null,Sa=!1,Ea=new Ae,Pa={applyArabicShaping:null,processBidirectionalText:null,isLoaded:function(){return Sa||null!=Pa.applyArabicShaping}},Ia=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new da,this.transition={});};Ia.prototype.isSupportedScript=function(t){return function(t,e){for(var i=0,r=t;i<r.length;i+=1)if(!ba(r[i].charCodeAt(0),e))return!1;return!0}(t,Pa.isLoaded())},Ia.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)};var Ra=function(t,e){this.property=t,this.value=e,this.expression=Ar(void 0===e?t.specification.default:e,t.specification);};Ra.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},Ra.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var Ma=function(t){this.property=t,this.value=new Ra(t,void 0);};Ma.prototype.transitioned=function(t,e){return new Ca(this.property,this.value,e,v({},t.transition,this.transition),t.now)},Ma.prototype.untransitioned=function(){return new Ca(this.property,this.value,null,{},0)};var za=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues);};za.prototype.getValue=function(t){return P(this._values[t].value.value)},za.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Ma(this._values[t].property)),this._values[t].value=new Ra(this._values[t].property,null===e?void 0:P(e));},za.prototype.getTransition=function(t){return P(this._values[t].transition)},za.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Ma(this._values[t].property)),this._values[t].transition=P(e)||void 0;},za.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var r=i[e],a=this.getValue(r);void 0!==a&&(t[r]=a);var n=this.getTransition(r);void 0!==n&&(t[r+"-transition"]=n);}return t},za.prototype.transitioned=function(t,e){for(var i=new Oa(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var n=a[r];i._values[n]=this._values[n].transitioned(t,e._values[n]);}return i},za.prototype.untransitioned=function(){for(var t=new Oa(this._properties),e=0,i=Object.keys(this._values);e<i.length;e+=1){var r=i[e];t._values[r]=this._values[r].untransitioned();}return t};var Ca=function(t,e,i,r,a){this.property=t,this.value=e,this.begin=a+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i);};Ca.prototype.possiblyEvaluate=function(t){var e=t.now||0,i=this.value.possiblyEvaluate(t),r=this.prior;if(r){if(e>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(e<this.begin)return r.possiblyEvaluate(t);var a=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(r.possiblyEvaluate(t),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(a))}return i};var Oa=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues);};Oa.prototype.possiblyEvaluate=function(t){for(var e=new Da(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var a=r[i];e._values[a]=this._values[a].possiblyEvaluate(t);}return e},Oa.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var i=e[t];if(this._values[i].prior)return!0}return!1};var Fa=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues);};Fa.prototype.getValue=function(t){return P(this._values[t].value)},Fa.prototype.setValue=function(t,e){this._values[t]=new Ra(this._values[t].property,null===e?void 0:P(e));},Fa.prototype.serialize=function(){for(var t={},e=0,i=Object.keys(this._values);e<i.length;e+=1){var r=i[e],a=this.getValue(r);void 0!==a&&(t[r]=a);}return t},Fa.prototype.possiblyEvaluate=function(t){for(var e=new Da(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var a=r[i];e._values[a]=this._values[a].possiblyEvaluate(t);}return e};var La=function(t,e,i){this.property=t,this.value=e,this.globals=i;};La.prototype.isConstant=function(){return"constant"===this.value.kind},La.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},La.prototype.evaluate=function(t,e){return this.property.evaluate(this.value,this.globals,t,e)};var Da=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues);};Da.prototype.get=function(t){return this._values[t]};var Na=function(t){this.specification=t;};Na.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Na.prototype.interpolate=function(t,e,i){var r=_i[this.specification.type];return r?r(t,e,i):t};var ka=function(t){this.specification=t;};ka.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new La(this,{kind:"constant",value:t.expression.evaluate(e)},e):new La(this,t.expression,e)},ka.prototype.interpolate=function(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new La(this,{kind:"constant",value:void 0},t.globals);var r=_i[this.specification.type];return r?new La(this,{kind:"constant",value:r(t.value.value,e.value.value,i)},t.globals):t},ka.prototype.evaluate=function(t,e,i,r){return"constant"===t.kind?t.value:t.evaluate(e,i,r)};var Ba=function(t){this.specification=t;};Ba.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new Ia(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Ia(Math.floor(e.zoom),e)),t.expression.evaluate(new Ia(Math.floor(e.zoom+1),e)),e)}},Ba.prototype._calculate=function(t,e,i,r){var a=r.zoom,n=a-Math.floor(a),o=r.crossFadingFactor();return a>r.zoomHistory.lastIntegerZoom?{from:t,to:e,fromScale:2,toScale:1,t:n+(1-n)*o}:{from:i,to:e,fromScale:.5,toScale:1,t:1-(1-o)*n}},Ba.prototype.interpolate=function(t){return t};var Va=function(t){this.specification=t;};Va.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},Va.prototype.interpolate=function(){return!1};var Ua=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var i=t[e],r=this.defaultPropertyValues[e]=new Ra(i,void 0),a=this.defaultTransitionablePropertyValues[e]=new Ma(i);this.defaultTransitioningPropertyValues[e]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({});}};ca("DataDrivenProperty",ka),ca("DataConstantProperty",Na),ca("CrossFadedProperty",Ba),ca("ColorRampProperty",Va);var ja=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]));};ja.prototype.setNorthEast=function(t){return this._ne=t instanceof qa?new qa(t.lng,t.lat):qa.convert(t),this},ja.prototype.setSouthWest=function(t){return this._sw=t instanceof qa?new qa(t.lng,t.lat):qa.convert(t),this},ja.prototype.extend=function(t){var e,i,r=this._sw,a=this._ne;if(t instanceof qa)e=t,i=t;else{if(!(t instanceof ja))return Array.isArray(t)?t.every(Array.isArray)?this.extend(ja.convert(t)):this.extend(qa.convert(t)):this;if(e=t._sw,i=t._ne,!e||!i)return this}return r||a?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),a.lng=Math.max(i.lng,a.lng),a.lat=Math.max(i.lat,a.lat)):(this._sw=new qa(e.lng,e.lat),this._ne=new qa(i.lng,i.lat)),this},ja.prototype.getCenter=function(){return new qa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ja.prototype.getSouthWest=function(){return this._sw},ja.prototype.getNorthEast=function(){return this._ne},ja.prototype.getNorthWest=function(){return new qa(this.getWest(),this.getNorth())},ja.prototype.getSouthEast=function(){return new qa(this.getEast(),this.getSouth())},ja.prototype.getWest=function(){return this._sw.lng},ja.prototype.getSouth=function(){return this._sw.lat},ja.prototype.getEast=function(){return this._ne.lng},ja.prototype.getNorth=function(){return this._ne.lat},ja.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ja.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ja.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ja.convert=function(t){return!t||t instanceof ja?t:new ja(t)};var qa=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};qa.prototype.wrap=function(){return new qa(y(this.lng,-180,180),this.lat)},qa.prototype.toArray=function(){return[this.lng,this.lat]},qa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},qa.prototype.toBounds=function(t){var e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new ja(new qa(this.lng-i,this.lat-e),new qa(this.lng+i,this.lat+e))},qa.convert=function(t){if(t instanceof qa)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new qa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new qa(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Xa={LATLON:"LATLON",MERCATOR:"MERCATOR"},Ga={R:le.TRANSFORM.R,CIR:le.TRANSFORM.CIR,project:function(t){return new p(this.lngX(t.lng,this.CIR),this.latY(t.lat,this.CIR))},unproject:function(t){return new qa(this.xLng(t.x,this.CIR),this.yLat(t.y,this.CIR))},projectWithWorldSize:function(t,e){return new p(this.lngX(t.lng,e),this.latY(t.lat,e))},unprojectWithWorldSize:function(t,e){return new qa(this.xLng(t.x,e),this.yLat(t.y,e))},lngX:function(t,e){return(180+t)*e/360},latY:function(t,e){return(90-t)/180*e*.5},xLng:function(t,e){return 360*t/e-180},yLat:function(t,e){return 90-t/(.5*e)*180},tileNumberToLngLat:function(t,e,i){return new qa(this.xLng(t[0]*e,i),this.yLat(t[1]*e,i))},lngLatToTileNumber:function(t,e,i){return[this.lngX(t.lng,i)/e,this.latY(t.lat,i)/e]}},Wa={R:le.TRANSFORM.R,CIR:le.TRANSFORM.CIR,project:function(t){return new p(this.lngX(t.lng,this.CIR),this.latY(t.lat,this.CIR))},unproject:function(t){return new qa(this.xLng(t.x,this.CIR),this.yLat(t.y,this.CIR))},projectWithWorldSize:function(t,e){return new p(this.lngX(t.lng,e),this.latY(t.lat,e))},unprojectWithWorldSize:function(t,e){return new qa(this.xLng(t.x,e),this.yLat(t.y,e))},lngX:function(t,e){return(180+t)*e/360},latY:function(t,e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*e/360},xLng:function(t,e){return 360*t/e-180},yLat:function(t,e){var i=180-360*t/e;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90},tileNumberToLngLat:function(t,e,i){return new qa(this.xLng(t[0]*e,i),this.yLat(t[1]*e,i))},lngLatToTileNumber:function(t,e,i){return[this.lngX(t.lng,i)/e,this.latY(t.lat,i)/e]}};function Ya(t){return t===Xa.LATLON?Ga:Wa}var Ha={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Qa=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8;},Za=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0);};function Ja(t,e){void 0===e&&(e=1);var i=0,r=0;return{members:t.map(function(t){var a,n=(a=t.type,Ha[a].BYTES_PER_ELEMENT),o=i=Ka(i,Math.max(e,n)),s=t.components||1;return r=Math.max(r,n),i+=n*s,{name:t.name,type:t.type,components:s,offset:o}}),size:Ka(i,Math.max(r,e)),alignment:e}}function Ka(t,e){return Math.ceil(t/e)*e}Za.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Za.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Za.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews());},Za.prototype.clear=function(){this.length=0;},Za.prototype.resize=function(t){this.reserve(t),this.length=t;},Za.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e);}},Za.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var $a=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var r=2*i;return this.int16[r+0]=t,this.int16[r+1]=e,i},e.prototype.emplace=function(t,e,i){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t},e}(Za);$a.prototype.bytesPerElement=4,ca("StructArrayLayout2i4",$a);var tn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r){var a=this.length;this.resize(a+1);var n=4*a;return this.int16[n+0]=t,this.int16[n+1]=e,this.int16[n+2]=i,this.int16[n+3]=r,a},e.prototype.emplace=function(t,e,i,r,a){var n=4*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,this.int16[n+3]=a,t},e}(Za);tn.prototype.bytesPerElement=8,ca("StructArrayLayout4i8",tn);var en=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a){var n=this.length;this.resize(n+1);var o=5*n;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=i,this.float32[o+3]=r,this.float32[o+4]=a,n},e.prototype.emplace=function(t,e,i,r,a,n){var o=5*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=a,this.float32[o+4]=n,t},e}(Za);en.prototype.bytesPerElement=20,ca("StructArrayLayout5f20",en);var rn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s){var u=this.length;this.resize(u+1);var l=8*u;return this.float32[l+0]=t,this.float32[l+1]=e,this.float32[l+2]=i,this.float32[l+3]=r,this.float32[l+4]=a,this.float32[l+5]=n,this.float32[l+6]=o,this.float32[l+7]=s,u},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u){var l=8*t;return this.float32[l+0]=e,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=a,this.float32[l+4]=n,this.float32[l+5]=o,this.float32[l+6]=s,this.float32[l+7]=u,t},e}(Za);rn.prototype.bytesPerElement=32,ca("StructArrayLayout8f32",rn);var an=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i){var r=this.length;this.resize(r+1);var a=4*r;return this.int16[a+0]=t,this.int16[a+1]=e,this.int16[a+2]=i,r},e.prototype.emplace=function(t,e,i,r){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,t},e}(Za);an.prototype.bytesPerElement=8,ca("StructArrayLayout3i8",an);var nn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o){var s=this.length;this.resize(s+1);var u=8*s;return this.int16[u+0]=t,this.int16[u+1]=e,this.int16[u+2]=i,this.int16[u+4]=r,this.int16[u+5]=a,this.int16[u+6]=n,this.int16[u+7]=o,s},e.prototype.emplace=function(t,e,i,r,a,n,o,s){var u=8*t;return this.int16[u+0]=e,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+4]=a,this.int16[u+5]=n,this.int16[u+6]=o,this.int16[u+7]=s,t},e}(Za);nn.prototype.bytesPerElement=16,ca("StructArrayLayout3i4i16",nn);var on=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u,l){var p=this.length;this.resize(p+1);var c=8*p,h=16*p;return this.int16[c+0]=t,this.int16[c+1]=e,this.int16[c+2]=i,this.int16[c+3]=r,this.uint8[h+8]=a,this.uint8[h+9]=n,this.uint8[h+10]=o,this.uint8[h+11]=s,this.uint16[c+6]=u,this.uint16[c+7]=l,p},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l,p){var c=8*t,h=16*t;return this.int16[c+0]=e,this.int16[c+1]=i,this.int16[c+2]=r,this.int16[c+3]=a,this.uint8[h+8]=n,this.uint8[h+9]=o,this.uint8[h+10]=s,this.uint8[h+11]=u,this.uint16[c+6]=l,this.uint16[c+7]=p,t},e}(Za);on.prototype.bytesPerElement=16,ca("StructArrayLayout4i4ub2ui16",on);var sn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u){var l=this.length;this.resize(l+1);var p=8*l,c=16*l;return this.int16[p+0]=t,this.int16[p+1]=e,this.int16[p+2]=i,this.int16[p+3]=r,this.uint8[c+8]=a,this.uint8[c+9]=n,this.uint8[c+10]=o,this.uint8[c+11]=s,this.uint16[p+6]=u,l},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l){var p=8*t,c=16*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=a,this.uint8[c+8]=n,this.uint8[c+9]=o,this.uint8[c+10]=s,this.uint8[c+11]=u,this.uint16[p+6]=l,t},e}(Za);sn.prototype.bytesPerElement=16,ca("StructArrayLayout4i4ub1ui16",sn);var un=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u,l,p,c,h){var f=this.length;this.resize(f+1);var m=10*f,d=20*f;return this.int16[m+0]=t,this.int16[m+1]=e,this.int16[m+2]=i,this.int16[m+3]=r,this.uint8[d+8]=a,this.uint8[d+9]=n,this.uint8[d+10]=o,this.uint8[d+11]=s,this.uint8[d+12]=u,this.uint8[d+13]=l,this.uint8[d+14]=p,this.uint16[m+8]=c,this.uint16[m+9]=h,f},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l,p,c,h,f){var m=10*t,d=20*t;return this.int16[m+0]=e,this.int16[m+1]=i,this.int16[m+2]=r,this.int16[m+3]=a,this.uint8[d+8]=n,this.uint8[d+9]=o,this.uint8[d+10]=s,this.uint8[d+11]=u,this.uint8[d+12]=l,this.uint8[d+13]=p,this.uint8[d+14]=c,this.uint16[m+8]=h,this.uint16[m+9]=f,t},e}(Za);un.prototype.bytesPerElement=20,ca("StructArrayLayout4i4ub3ub2ui20",un);var ln=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n){var o=this.length;this.resize(o+1);var s=6*o;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=n,o},e.prototype.emplace=function(t,e,i,r,a,n,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=a,this.int16[s+4]=n,this.int16[s+5]=o,t},e}(Za);ln.prototype.bytesPerElement=12,ca("StructArrayLayout2i4i12",ln);var pn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a){var n=this.length;this.resize(n+1);var o=4*n,s=16*n;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=i,this.int8[s+12]=r,this.int8[s+13]=a,n},e.prototype.emplace=function(t,e,i,r,a,n){var o=4*t,s=16*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.int8[s+12]=a,this.int8[s+13]=n,t},e}(Za);pn.prototype.bytesPerElement=16,ca("StructArrayLayout3f2b16",pn);var cn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u){var l=this.length;this.resize(l+1);var p=9*l;return this.float32[p+0]=t,this.float32[p+1]=e,this.float32[p+2]=i,this.float32[p+3]=r,this.float32[p+4]=a,this.float32[p+5]=n,this.float32[p+6]=o,this.float32[p+7]=s,this.float32[p+8]=u,l},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l){var p=9*t;return this.float32[p+0]=e,this.float32[p+1]=i,this.float32[p+2]=r,this.float32[p+3]=a,this.float32[p+4]=n,this.float32[p+5]=o,this.float32[p+6]=s,this.float32[p+7]=u,this.float32[p+8]=l,t},e}(Za);cn.prototype.bytesPerElement=36,ca("StructArrayLayout3f3f3f36",cn);var hn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u,l,p,c){var h=this.length;this.resize(h+1);var f=6*h,m=24*h;return this.float32[f+0]=t,this.float32[f+1]=e,this.float32[f+2]=i,this.int8[m+12]=r,this.int8[m+13]=a,this.uint8[m+16]=n,this.uint8[m+17]=o,this.uint8[m+18]=s,this.uint8[m+19]=u,this.uint8[m+20]=l,this.uint8[m+21]=p,this.uint8[m+22]=c,h},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l,p,c,h){var f=6*t,m=24*t;return this.float32[f+0]=e,this.float32[f+1]=i,this.float32[f+2]=r,this.int8[m+12]=a,this.int8[m+13]=n,this.uint8[m+16]=o,this.uint8[m+17]=s,this.uint8[m+18]=u,this.uint8[m+19]=l,this.uint8[m+20]=p,this.uint8[m+21]=c,this.uint8[m+22]=h,t},e}(Za);hn.prototype.bytesPerElement=24,ca("StructArrayLayout3f2b4ub3ub24",hn);var fn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u){var l=this.length;this.resize(l+1);var p=5*l,c=20*l;return this.float32[p+0]=t,this.float32[p+1]=e,this.float32[p+2]=i,this.int8[c+12]=r,this.int8[c+13]=a,this.uint8[c+16]=n,this.uint8[c+17]=o,this.uint8[c+18]=s,this.uint8[c+19]=u,l},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l){var p=5*t,c=20*t;return this.float32[p+0]=e,this.float32[p+1]=i,this.float32[p+2]=r,this.int8[c+12]=a,this.int8[c+13]=n,this.uint8[c+16]=o,this.uint8[c+17]=s,this.uint8[c+18]=u,this.uint8[c+19]=l,t},e}(Za);fn.prototype.bytesPerElement=20,ca("StructArrayLayout3f2b4ub20",fn);var mn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i){var r=this.length;this.resize(r+1);var a=3*r;return this.float32[a+0]=t,this.float32[a+1]=e,this.float32[a+2]=i,r},e.prototype.emplace=function(t,e,i,r){var a=3*t;return this.float32[a+0]=e,this.float32[a+1]=i,this.float32[a+2]=r,t},e}(Za);mn.prototype.bytesPerElement=12,ca("StructArrayLayout3f12",mn);var dn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u,l){var p=this.length;this.resize(p+1);var c=6*p,h=24*p,f=12*p;return this.float32[c+0]=t,this.float32[c+1]=e,this.float32[c+2]=i,this.int8[h+12]=r,this.int8[h+13]=a,this.uint8[h+16]=n,this.uint8[h+17]=o,this.uint8[h+18]=s,this.uint8[h+19]=u,this.uint16[f+10]=l,p},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l,p){var c=6*t,h=24*t,f=12*t;return this.float32[c+0]=e,this.float32[c+1]=i,this.float32[c+2]=r,this.int8[h+12]=a,this.int8[h+13]=n,this.uint8[h+16]=o,this.uint8[h+17]=s,this.uint8[h+18]=u,this.uint8[h+19]=l,this.uint16[f+10]=p,t},e}(Za);dn.prototype.bytesPerElement=24,ca("StructArrayLayout3f2b4ub1ui24",dn);var _n=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a){var n=this.length;this.resize(n+1);var o=4*n,s=8*n;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=i,this.int16[s+6]=r,this.int16[s+7]=a,n},e.prototype.emplace=function(t,e,i,r,a,n){var o=4*t,s=8*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.int16[s+6]=a,this.int16[s+7]=n,t},e}(Za);_n.prototype.bytesPerElement=16,ca("StructArrayLayout3f2i16",_n);var yn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u){var l=this.length;this.resize(l+1);var p=9*l;return this.int16[p+0]=t,this.int16[p+1]=e,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=a,this.uint16[p+5]=n,this.uint16[p+6]=o,this.uint16[p+7]=s,this.uint16[p+8]=u,l},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l){var p=9*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=a,this.uint16[p+4]=n,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=u,this.uint16[p+8]=l,t},e}(Za);yn.prototype.bytesPerElement=18,ca("StructArrayLayout4i5ui18",yn);var gn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var i=1*e;return this.uint32[i+0]=t,e},e.prototype.emplace=function(t,e){var i=1*t;return this.uint32[i+0]=e,t},e}(Za);gn.prototype.bytesPerElement=4,ca("StructArrayLayout1ul4",gn);var vn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u,l,p){var c=this.length;this.resize(c+1);var h=12*c,f=6*c;return this.int16[h+0]=t,this.int16[h+1]=e,this.int16[h+2]=i,this.int16[h+3]=r,this.int16[h+4]=a,this.int16[h+5]=n,this.uint32[f+3]=o,this.uint16[h+8]=s,this.uint16[h+9]=u,this.int16[h+10]=l,this.int16[h+11]=p,c},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l,p,c){var h=12*t,f=6*t;return this.int16[h+0]=e,this.int16[h+1]=i,this.int16[h+2]=r,this.int16[h+3]=a,this.int16[h+4]=n,this.int16[h+5]=o,this.uint32[f+3]=s,this.uint16[h+8]=u,this.uint16[h+9]=l,this.int16[h+10]=p,this.int16[h+11]=c,t},e}(Za);vn.prototype.bytesPerElement=24,ca("StructArrayLayout6i1ul2ui2i24",vn);var xn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n){var o=this.length;this.resize(o+1);var s=6*o;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=n,o},e.prototype.emplace=function(t,e,i,r,a,n,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=a,this.int16[s+4]=n,this.int16[s+5]=o,t},e}(Za);xn.prototype.bytesPerElement=12,ca("StructArrayLayout2i2i2i12",xn);var bn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var r=4*i;return this.uint8[r+0]=t,this.uint8[r+1]=e,i},e.prototype.emplace=function(t,e,i){var r=4*t;return this.uint8[r+0]=e,this.uint8[r+1]=i,t},e}(Za);bn.prototype.bytesPerElement=4,ca("StructArrayLayout2ub4",bn);var wn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u,l,p,c,h,f){var m=this.length;this.resize(m+1);var d=20*m,_=10*m,y=40*m;return this.int16[d+0]=t,this.int16[d+1]=e,this.uint16[d+2]=i,this.uint16[d+3]=r,this.uint32[_+2]=a,this.uint32[_+3]=n,this.uint32[_+4]=o,this.uint16[d+10]=s,this.uint16[d+11]=u,this.uint16[d+12]=l,this.float32[_+7]=p,this.float32[_+8]=c,this.uint8[y+36]=h,this.uint8[y+37]=f,m},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l,p,c,h,f,m){var d=20*t,_=10*t,y=40*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.uint16[d+2]=r,this.uint16[d+3]=a,this.uint32[_+2]=n,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[d+10]=u,this.uint16[d+11]=l,this.uint16[d+12]=p,this.float32[_+7]=c,this.float32[_+8]=h,this.uint8[y+36]=f,this.uint8[y+37]=m,t},e}(Za);wn.prototype.bytesPerElement=40,ca("StructArrayLayout2i2ui3ul3ui2f2ub40",wn);var An=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var i=1*e;return this.float32[i+0]=t,e},e.prototype.emplace=function(t,e){var i=1*t;return this.float32[i+0]=e,t},e}(Za);An.prototype.bytesPerElement=4,ca("StructArrayLayout1f4",An);var Tn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i){var r=this.length;this.resize(r+1);var a=3*r;return this.int16[a+0]=t,this.int16[a+1]=e,this.int16[a+2]=i,r},e.prototype.emplace=function(t,e,i,r){var a=3*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,t},e}(Za);Tn.prototype.bytesPerElement=6,ca("StructArrayLayout3i6",Tn);var Sn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u,l){var p=this.length;this.resize(p+1);var c=10*p;return this.int16[c+0]=t,this.int16[c+1]=e,this.int16[c+2]=i,this.int16[c+3]=r,this.uint16[c+4]=a,this.uint16[c+5]=n,this.uint16[c+6]=o,this.uint16[c+7]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,p},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l,p){var c=10*t;return this.int16[c+0]=e,this.int16[c+1]=i,this.int16[c+2]=r,this.int16[c+3]=a,this.uint16[c+4]=n,this.uint16[c+5]=o,this.uint16[c+6]=s,this.uint16[c+7]=u,this.uint16[c+8]=l,this.uint16[c+9]=p,t},e}(Za);Sn.prototype.bytesPerElement=20,ca("StructArrayLayout4i6ui20",Sn);var En=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o,s,u){var l=this.length;this.resize(l+1);var p=6*l,c=12*l;return this.float32[p+0]=t,this.float32[p+1]=e,this.float32[p+2]=i,this.int16[c+6]=r,this.int16[c+7]=a,this.uint16[c+8]=n,this.uint16[c+9]=o,this.uint16[c+10]=s,this.uint16[c+11]=u,l},e.prototype.emplace=function(t,e,i,r,a,n,o,s,u,l){var p=6*t,c=12*t;return this.float32[p+0]=e,this.float32[p+1]=i,this.float32[p+2]=r,this.int16[c+6]=a,this.int16[c+7]=n,this.uint16[c+8]=o,this.uint16[c+9]=s,this.uint16[c+10]=u,this.uint16[c+11]=l,t},e}(Za);En.prototype.bytesPerElement=24,ca("StructArrayLayout3f2i4ui24",En);var Pn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r,a,n,o){var s=this.length;this.resize(s+1);var u=5*s,l=10*s;return this.float32[u+0]=t,this.float32[u+1]=e,this.float32[u+2]=i,this.int16[l+6]=r,this.int16[l+7]=a,this.int16[l+8]=n,this.int16[l+9]=o,s},e.prototype.emplace=function(t,e,i,r,a,n,o,s){var u=5*t,l=10*t;return this.float32[u+0]=e,this.float32[u+1]=i,this.float32[u+2]=r,this.int16[l+6]=a,this.int16[l+7]=n,this.int16[l+8]=o,this.int16[l+9]=s,t},e}(Za);Pn.prototype.bytesPerElement=20,ca("StructArrayLayout3f2i2i20",Pn);var In=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i){var r=this.length;this.resize(r+1);var a=2*r,n=4*r;return this.uint32[a+0]=t,this.uint16[n+2]=e,this.uint16[n+3]=i,r},e.prototype.emplace=function(t,e,i,r){var a=2*t,n=4*t;return this.uint32[a+0]=e,this.uint16[n+2]=i,this.uint16[n+3]=r,t},e}(Za);In.prototype.bytesPerElement=8,ca("StructArrayLayout1ul2ui8",In);var Rn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i){var r=this.length;this.resize(r+1);var a=3*r;return this.uint16[a+0]=t,this.uint16[a+1]=e,this.uint16[a+2]=i,r},e.prototype.emplace=function(t,e,i,r){var a=3*t;return this.uint16[a+0]=e,this.uint16[a+1]=i,this.uint16[a+2]=r,t},e}(Za);Rn.prototype.bytesPerElement=6,ca("StructArrayLayout3ui6",Rn);var Mn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var r=2*i;return this.uint16[r+0]=t,this.uint16[r+1]=e,i},e.prototype.emplace=function(t,e,i){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t},e}(Za);Mn.prototype.bytesPerElement=4,ca("StructArrayLayout2ui4",Mn);var zn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var i=this.length;this.resize(i+1);var r=2*i;return this.float32[r+0]=t,this.float32[r+1]=e,i},e.prototype.emplace=function(t,e,i){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t},e}(Za);zn.prototype.bytesPerElement=8,ca("StructArrayLayout2f8",zn);var Cn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,i,r){var a=this.length;this.resize(a+1);var n=4*a;return this.float32[n+0]=t,this.float32[n+1]=e,this.float32[n+2]=i,this.float32[n+3]=r,a},e.prototype.emplace=function(t,e,i,r,a){var n=4*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,this.float32[n+3]=a,t},e}(Za);Cn.prototype.bytesPerElement=16,ca("StructArrayLayout4f16",Cn);var On=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return i.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t;},i.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t;},i.x1.get=function(){return this._structArray.int16[this._pos2+2]},i.x1.set=function(t){this._structArray.int16[this._pos2+2]=t;},i.y1.get=function(){return this._structArray.int16[this._pos2+3]},i.y1.set=function(t){this._structArray.int16[this._pos2+3]=t;},i.x2.get=function(){return this._structArray.int16[this._pos2+4]},i.x2.set=function(t){this._structArray.int16[this._pos2+4]=t;},i.y2.get=function(){return this._structArray.int16[this._pos2+5]},i.y2.set=function(t){this._structArray.int16[this._pos2+5]=t;},i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t;},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t;},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t;},i.radius.get=function(){return this._structArray.int16[this._pos2+10]},i.radius.set=function(t){this._structArray.int16[this._pos2+10]=t;},i.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},i.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t;},i.anchorPoint.get=function(){return new p(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,i),e}(Qa);On.prototype.size=24;var Fn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new On(this,t)},e}(vn);ca("CollisionBoxArray",Fn);var Ln=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t;},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t;},i.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t;},i.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},i.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t;},i.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},i.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t;},i.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t;},i.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},i.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t;},i.segment.get=function(){return this._structArray.uint16[this._pos2+10]},i.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t;},i.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},i.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t;},i.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},i.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t;},i.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},i.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t;},i.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},i.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t;},i.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},i.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t;},i.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},i.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t;},Object.defineProperties(e.prototype,i),e}(Qa);Ln.prototype.size=40;var Dn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Ln(this,t)},e}(wn);ca("PlacedSymbolArray",Dn);var Nn=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={offsetX:{configurable:!0}};return i.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},i.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t;},Object.defineProperties(e.prototype,i),e}(Qa);Nn.prototype.size=4;var kn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new Nn(this,t)},e}(An);ca("GlyphOffsetArray",kn);var Bn=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return i.x.get=function(){return this._structArray.int16[this._pos2+0]},i.x.set=function(t){this._structArray.int16[this._pos2+0]=t;},i.y.get=function(){return this._structArray.int16[this._pos2+1]},i.y.set=function(t){this._structArray.int16[this._pos2+1]=t;},i.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},i.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t;},Object.defineProperties(e.prototype,i),e}(Qa);Bn.prototype.size=6;var Vn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new Bn(this,t)},e}(Tn);ca("SymbolLineVertexArray",Vn);var Un=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t;},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t;},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t;},Object.defineProperties(e.prototype,i),e}(Qa);Un.prototype.size=8;var jn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Un(this,t)},e}(In);function qn(t,e,i,r,a){var n={arr:[]},o=Ya(r),s=Math.pow(2,e),u=s;r===Xa.LATLON&&(u=s/2);for(var l=0;l<u;l++)for(var p=0;p<=s;p++)Xn(n.arr,o,s,u,p,l,i,e,t,a),Xn(n.arr,o,s,u,p,l+1,i,e,t,a);return n}function Xn(t,e,i,r,a,n,o,s,u,l){var p=[];Gn(p,e.tileNumberToLngLat([a,n],o,o*Math.pow(2,s)).toArray(),u),l.emplaceBack.apply(l,p.concat([a/i],[n/r]));}function Gn(t,e,i){var r=e[0]*le.TRANSFORM.DEG_TO_RAD,a=e[1]*le.TRANSFORM.DEG_TO_RAD,n=i*Math.cos(a);return t[0]=n*Math.cos(r),t[1]=i*Math.sin(a),t[2]=n*Math.sin(r),t}function Wn(t,e){var i=e[0],r=e[2],a=e[1],n=Math.sqrt(i*i+r*r+a*a);return t[0]=Math.atan2(r,i)*le.TRANSFORM.RAD_TO_DEG,t[1]=Math.asin(a/n)*le.TRANSFORM.RAD_TO_DEG,t[2]=n,t}function Yn(t,e,i,r,a,n,o){var s=Math.pow(2,n),u=r+t/8192,l=a+e/8192,p=Ya(o),c=[];return Gn(c,[p.xLng(u,s),p.yLat(l,s)],le.TRANSFORM.R+le.TRANSFORM.R_SCALE*i),c}function Hn(t,e,i,r){var a=i,n=t,o=e,s=Ya(r);return[s.xLng(n,a),s.yLat(o,a)]}function Qn(t,e,i,r){var a=[];return Gn(a,Hn(t,e,Math.pow(2,i),r),le.TRANSFORM.R),{out1:a,matrix:lt([],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a)}}function Zn(t,e,i){var r=e.translation||[0,0,0],a=[];return Gn(a,e.location,le.TRANSFORM.R),lt(i,i,a),ht(i,i,(90-e.location[0])*le.TRANSFORM.DEG_TO_RAD),ct(i,i,((t?0:90)-e.location[1])*le.TRANSFORM.DEG_TO_RAD),ft(i,i,180*le.TRANSFORM.DEG_TO_RAD),pt(i,i,[le.TRANSFORM.R_SCALE,-le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE]),lt(i,i,t?[r[0],r[2],r[1]]:r)}function Jn(t,e,i){var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return lt(r,r,e),i&&pt(r,r,[1.1,1.1,1.1]),r}function Kn(t){return t.slice()}function $n(t,e,i){var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return Ot([],Gn([],t,t[2]?le.TRANSFORM.REAL_R+t[2]:le.TRANSFORM.REAL_R),r=function(t,e,i){pt(e,e,[1,-1,1]),ft(e,e,-180*le.TRANSFORM.DEG_TO_RAD),ct(e,e,((i?0:-90)+t[1])*le.TRANSFORM.DEG_TO_RAD),ht(e,e,(t[0]-90)*le.TRANSFORM.DEG_TO_RAD);var r=[];return Gn(r,t,t[2]?le.TRANSFORM.REAL_R+t[2]:le.TRANSFORM.REAL_R),lt(e,e,[-r[0],-r[1],-r[2]]),e}(e,r,i))}function to(t,e){var i=Wn([],Ot([],e,function(t,e,i){var r=i||[0,0,0],a=[];return t[2]=t[2]||0,Gn(a,t,le.TRANSFORM.REAL_R+t[2]),lt(e,e,[a[0],a[1],a[2]]),ht(e,e,-(t[0]-90)*le.TRANSFORM.DEG_TO_RAD),ct(e,e,(90-t[1])*le.TRANSFORM.DEG_TO_RAD),ft(e,e,180*le.TRANSFORM.DEG_TO_RAD),pt(e,e,[1,-1,1]),lt(e,e,r)}(t,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])));return i[2]=i[2]-le.TRANSFORM.REAL_R,i}function eo(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}ca("FeatureIndexArray",jn);var io=8192;function ro(t){return 2*Math.PI*6378137*Math.cos(t*Math.PI/180)}function ao(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}var no=function(t,e,i){void 0===i&&(i=0),this.x=+t,this.y=+e,this.z=+i;};no.fromLngLat=function(t,e){void 0===e&&(e=0);var i,r=qa.convert(t);return new no((180+r.lng)/360,(i=r.lat,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360),function(t,e){return t/ro(e)}(e,r.lat))},no.prototype.toLngLat=function(){return new qa(360*this.x-180,ao(this.y))},no.prototype.toAltitude=function(){return t=this.z,e=this.y,t*ro(ao(e));var t,e;};var oo=function(t,e,i){this.z=t,this.x=e,this.y=i,this.key=lo(0,t,e,i);};oo.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},oo.prototype.url=function(t,e){var i=function(t,e,i){var r=eo(256*t,256*(e=Math.pow(2,i)-e-1),i),a=eo(256*(t+1),256*(e+1),i);return r[0]+","+r[1]+","+a[0]+","+a[1]}(this.x,this.y,this.z),r=function(t,e,i){for(var r,a="",n=t;n>0;n--)a+=(e&(r=1<<n-1)?1:0)+(i&r?2:0);return a}(this.z,this.x,this.y),a="tms"===e?Math.pow(2,this.z)-this.y-1:this.y;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a)).replace("{m}",String(Math.floor(this.x/16))).replace("{n}",String(Math.floor(a/16))).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)},oo.prototype.getTilePoint=function(t){return new p((t.x-this.x)*io,(t.y-this.y)*io)};var so=function(t,e){this.wrap=t,this.canonical=e,this.key=lo(t,e.z,e.x,e.y);},uo=function(t,e,i,r,a){this.overscaledZ=t,this.wrap=e,this.canonical=new oo(i,+r,+a),this.key=lo(e,t,r,a);};function lo(t,e,i,r){return t+"_"+e+"_"+i+"_"+r}function po(t,e,i,r){void 0===r&&(r=!0);var a=1<<t,n={};function o(e,o,s){var u,l,p;if(s>=0&&s<=a)for(u=e;u<o;u++)0!==(l=Math.floor(u/a))&&!0!==r||(p=new uo(i,l,t,(u%a+a)%a,s),n[p.key]=p);}return fo(e[0],e[1],e[2],0,a,o),fo(e[2],e[3],e[0],0,a,o),Object.keys(n).map(function(t){return n[t]})}function co(t,e){if(t.row>e.row){var i=t;t=e,e=i;}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function ho(t,e,i,r,a){var n=Math.max(i,Math.floor(e.y0)),o=Math.min(r,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s;}for(var u=t.dx/t.dy,l=e.dx/e.dy,p=t.dx>0,c=e.dx<0,h=n;h<o;h++){var f=u*Math.max(0,Math.min(t.dy,h+p-t.y0))+t.x0,m=l*Math.max(0,Math.min(e.dy,h+c-e.y0))+e.x0;a(Math.floor(m),Math.ceil(f),h);}}function fo(t,e,i,r,a,n){var o,s=co(t,e),u=co(e,i),l=co(i,t);s.dy>u.dy&&(o=s,s=u,u=o),s.dy>l.dy&&(o=s,s=l,l=o),u.dy>l.dy&&(o=u,u=l,l=o),s.dy&&ho(l,s,r,a,n),u.dy&&ho(l,u,r,a,n);}uo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},uo.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new uo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new uo(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},uo.prototype.isChildOf=function(t){var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},uo.prototype.children=function(t){if(this.overscaledZ>=t)return[new uo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new uo(e,this.wrap,e,i,r),new uo(e,this.wrap,e,i+1,r),new uo(e,this.wrap,e,i,r+1),new uo(e,this.wrap,e,i+1,r+1)]},uo.prototype.isLessThan=function(t){return"string"!=typeof t&&(this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y)))},uo.prototype.wrapped=function(){return new uo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},uo.prototype.unwrapTo=function(t){return new uo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},uo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},uo.prototype.toUnwrapped=function(){return new so(this.wrap,this.canonical)},uo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},uo.prototype.toCoordinate=function(){return new l(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)},uo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new no(t.x-this.wrap,t.y))},ca("CanonicalTileID",oo),ca("OverscaledTileID",uo,{omit:["posMatrix"]});var mo=function(t,e,i){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new qa(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={};},_o={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},x:{configurable:!0},y:{configurable:!0},point:{configurable:!0}};mo.prototype.clone=function(){var t=new mo(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},_o.minZoom.get=function(){return this._minZoom},_o.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t));},_o.maxZoom.get=function(){return this._maxZoom},_o.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t));},_o.renderWorldCopies.get=function(){return this._renderWorldCopies},_o.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t;},_o.worldSize.get=function(){return this.tileSize*this.scale},_o.centerPoint.get=function(){return this.size._div(2)},_o.size.get=function(){return new p(this.width,this.height)},_o.bearing.get=function(){return-this.angle/Math.PI*180},_o.bearing.set=function(t){var e=-y(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=tt(),et(this.rotationMatrix,this.rotationMatrix,this.angle));},_o.pitch.get=function(){return this._pitch/Math.PI*180},_o.pitch.set=function(t){var e=_(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices());},_o.fov.get=function(){return this._fov/Math.PI*180},_o.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices());},_o.zoom.get=function(){return this._zoom},_o.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices());},_o.center.get=function(){return this._center},_o.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices());},mo.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},mo.prototype.getVisibleUnwrappedCoordinates=function(t){var e=this.pointCoordinate(new p(0,0),0),i=this.pointCoordinate(new p(this.width,0),0),r=Math.floor(e.column),a=Math.floor(i.column),n=[new so(0,t)];if(this._renderWorldCopies)for(var o=r;o<=a;o++)0!==o&&n.push(new so(o,t));return n},mo.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),i=e;if(void 0!==t.minzoom&&e<t.minzoom)return[];void 0!==t.maxzoom&&e>t.maxzoom&&(e=t.maxzoom);var r=this.pointCoordinate(this.centerPoint,e),a=new p(r.column-.5,r.row-.5);return po(e,[this.pointCoordinate(new p(0,0),e),this.pointCoordinate(new p(this.width,0),e),this.pointCoordinate(new p(this.width,this.height),e),this.pointCoordinate(new p(0,this.height),e)],t.reparseOverscaled?i:e,this._renderWorldCopies).sort(function(t,e){return a.dist(t.canonical)-a.dist(e.canonical)})},mo.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices();},_o.unmodified.get=function(){return this._unmodified},mo.prototype.zoomScale=function(t){return Math.pow(2,t)},mo.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},mo.prototype.project=function(t){return new p(this.lngX(t.lng),this.latY(t.lat))},mo.prototype.unproject=function(t){return new qa(this.xLng(t.x),this.yLat(t.y))},_o.x.get=function(){return this.lngX(this.center.lng)},_o.y.get=function(){return this.latY(this.center.lat)},_o.point.get=function(){return new p(this.x,this.y)},mo.prototype.lngX=function(t){return(180+t)*this.worldSize/360},mo.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},mo.prototype.xLng=function(t){return 360*t/this.worldSize-180},mo.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},mo.prototype.setLocationAtPoint=function(t,e){var i=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(i)),this._renderWorldCopies&&(this.center=this.center.wrap());},mo.prototype.locationPoint=function(t,e){return this.coordinatePoint(this.locationCoordinate(t))},mo.prototype.pointLocation=function(t,e){return this.coordinateLocation(this.pointCoordinate(t))},mo.prototype.locationCoordinate=function(t){var e=t.lat<this.latRange[0]?this.worldSize:t.lat>this.latRange[1]?0:this.latY(t.lat);return new l(this.lngX(t.lng)/this.tileSize,e/this.tileSize,this.zoom).zoomTo(this.tileZoom)},mo.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new qa(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},mo.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];qt(i,i,this.pixelMatrixInverse),qt(r,r,this.pixelMatrixInverse);var a=i[3],n=r[3],o=i[1]/a,s=r[1]/n,u=i[2]/a,p=r[2]/n,c=u===p?0:(0-u)/(p-u);return new l(di(i[0]/a,r[0]/n,c)/this.tileSize,di(o,s,c)/this.tileSize,this.zoom)._zoomTo(e)},mo.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),i=[e.column*this.tileSize,e.row*this.tileSize,0,1];return qt(i,i,this.pixelMatrix),new p(i[0]/i[3],i[1]/i[3])},mo.prototype.calculatePosMatrix=function(t,e){void 0===e&&(e=!1);var i=t.key,r=e?this._alignedPosMatrixCache:this._posMatrixCache;if(r[i])return r[i];var a=t.canonical,n=this.worldSize/this.zoomScale(a.z),o=a.x+Math.pow(2,a.z)*t.wrap,s=nt(new Float64Array(16));return lt(s,s,[o*n,a.y*n,0]),pt(s,s,[n/io,n/io,1]),ut(s,e?this.alignedProjMatrix:this.projMatrix,s),r[i]=new Float32Array(s),r[i]},mo.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,i,r,a=-90,n=90,o=-180,s=180,u=this.size,l=this._unmodified;if(this.latRange){var c=this.latRange;a=this.latY(c[1]),t=(n=this.latY(c[0]))-a<u.y?u.y/(n-a):0;}if(this.lngRange){var h=this.lngRange;o=this.lngX(h[0]),e=(s=this.lngX(h[1]))-o<u.x?u.x/(s-o):0;}var f=Math.max(e||0,t||0);if(f)return this.center=this.unproject(new p(e?(s+o)/2:this.x,t?(n+a)/2:this.y)),this.zoom+=this.scaleZoom(f),this._unmodified=l,void(this._constraining=!1);if(this.latRange){var m=this.y,d=u.y/2;m-d<a&&(r=a+d),m+d>n&&(r=n-d);}if(this.lngRange){var _=this.x,y=u.x/2;_-y<o&&(i=o+y),_+y>s&&(i=s-y);}void 0===i&&void 0===r||(this.center=this.unproject(new p(void 0!==i?i:this.x,void 0!==r?r:this.y))),this._unmodified=l,this._constraining=!1;}},mo.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,i=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),r=this.x,a=this.y,n=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),o=new Float64Array(16);_t(o,this._fov,this.width/this.height,1,n),pt(o,o,[1,-1,1]),lt(o,o,[0,0,-this.cameraToCenterDistance]),ct(o,o,this._pitch),ft(o,o,this.angle),lt(o,o,[-r,-a,0]),this.mercatorMatrix=pt([],o,[this.worldSize,this.worldSize,this.worldSize]),pt(o,o,[1,1,this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180)))),1]),this.projMatrix=o;var s=this.width%2/2,u=this.height%2/2,l=Math.cos(this.angle),p=Math.sin(this.angle),c=r-Math.round(r)+l*s+p*u,h=a-Math.round(a)+l*u+p*s,f=new Float64Array(o);if(lt(f,f,[c>.5?c-1:c,h>.5?h-1:h,0]),this.alignedProjMatrix=f,pt(o=rt(),o,[this.width/2,-this.height/2,1]),lt(o,o,[1,-1,0]),this.pixelMatrix=ut(new Float64Array(16),o,this.projMatrix),!(o=st(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=o,this._posMatrixCache={},this._alignedPosMatrixCache={};}},mo.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;if(this.pitch>60)return 10;var t=this.pointCoordinate(new p(0,0)).zoomTo(this.zoom),e=[t.column*this.tileSize,t.row*this.tileSize,0,1];return qt(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance},mo.prototype.getCameraPoint=function(){var t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p(0,e))},mo.prototype.getCameraQueryGeometry=function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];for(var i=e.x,r=e.y,a=e.x,n=e.y,o=0,s=t;o<s.length;o+=1){var u=s[o];i=Math.min(i,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),n=Math.max(n,u.y);}return[new p(i,r),new p(a,r),new p(a,n),new p(i,n),new p(i,r)]},Object.defineProperties(mo.prototype,_o);var yo=function(t,e){this.origin=void 0!==t?t:[0,0,0],this.direction=void 0!==e?e:[0,0,0];};function go(t){var e=t.transform.getCameraPos(),i=(t.transform.painter,new yo(e,vo(t.canvasX,t.canvasY,.999999,t.transform)).intersectSphere({center:[0,0,0],radius:le.TRANSFORM.R+(t.alt?t.alt*le.TRANSFORM.R_SCALE:0)},[0,0,0]));return i?{lngLat:qa.convert(Wn([],i)),intersectPoint:i}:{lngLat:null}}function vo(t,e,i,r){var a=r.getCameraPos(),n=[2*t/r.width-1,1-2*e/r.height,i,1],o=[(n=function(t,e){var i=[];return qt(i,t,e.td_projectionInverseMatrix),qt(i=[i[0]/i[3],i[1]/i[3],i[2]/i[3],1],i,e.td_viewInverseMatrix),i}(n,r))[0]-a[0],n[1]-a[1],n[2]-a[2]];return Rt(o,o),o}function xo(t,e,i,r,a,n){var o,s,u,l,p=t.locationCoordinate(new qa(e.west,e.north))._zoomTo(a),c=t.locationCoordinate(new qa(e.east,e.south))._zoomTo(a);n?(o=p.column-4<0?0:Math.round(p.column-4),s=c.column+3<0?0:Math.round(c.column+3),u=p.row-4<0?0:Math.round(p.row-4),l=c.row+3<0?0:Math.round(c.row+3)):(o=p.column-1<0?0:Math.round(p.column-1),s=c.column<0?0:Math.round(c.column),u=p.row-1<0?0:Math.round(p.row-1),l=c.row<0?0:Math.round(c.row)),Math.abs(r.x-o)>20&&(o=r.x-20)<0&&(o=0),Math.abs(r.x-s)>20&&(s=r.x+20)>=Math.pow(2,a)&&(s=Math.pow(2,a)-1),Math.abs(r.y-u)>20&&(u=r.y-20)<0&&(u=0),Math.abs(r.y-l)>20&&(l=r.y+20,u>=Math.pow(2,a)&&(u=Math.pow(2,a)-1));for(var h=o;h<=s&&!(h>=Math.pow(2,a));h++)for(var f=u;f<=l&&!(f>=Math.pow(2,a));f++)i[a+"-"+h+"-"+f]=new uo(a,0,a,h,f);}yo.prototype.set=function(t,e){return At(this.origin,t),At(this.direction,e),this},yo.prototype.clone=function(){return new yo(this.origin,this.direction)},yo.prototype.copy=function(t){At(this.origin,t.origin),At(this.direction,t.direction);},yo.prototype.at=function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=[0,0,0]),At(e,this.direction),Et(e,e,t),Tt(e,e,this.origin),e},yo.prototype.lookAt=function(t){return At(this.direction,t),Dt(this.direction,this.direction,this.origin),Rt(this.direction,this.direction),this},yo.prototype.closestPointToPoint=function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=[0,0,0]),Dt(e,t,this.origin);var i=Mt(e,this.direction);return i<0?At(e,this.origin):(At(e,this.direction),Et(e,e,i),Tt(e,e,this.origin),e)},yo.prototype.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},yo.prototype.distanceSqToPoint=function(){var t=[0,0,0],e=Mt(Dt(t,point,this.origin),this.direction);return e<0?It(this.origin,point):(At(t,this.direction),Et(t,t,e),Tt(t,t,this.origin),It(t,point))},yo.prototype.distanceSqToSegment=function(t,e,i,r){var a=[0,0,0],n=[0,0,0],o=[0,0,0];a.copy(t).add(e).multiplyScalar(.5),n.copy(e).sub(t).normalize(),o.copy(this.origin).sub(a);var s,u,l,p,c=.5*t.distanceTo(e),h=-this.direction.dot(n),f=o.dot(this.direction),m=-o.dot(n),d=o.lengthSq(),_=Math.abs(1-h*h);if(_>0)if(u=h*f-m,p=c*_,(s=h*m-f)>=0)if(u>=-p)if(u<=p){var y=1/_;l=(s*=y)*(s+h*(u*=y)+2*f)+u*(h*s+u+2*m)+d;}else u=c,l=-(s=Math.max(0,-(h*u+f)))*s+u*(u+2*m)+d;else u=-c,l=-(s=Math.max(0,-(h*u+f)))*s+u*(u+2*m)+d;else u<=-p?l=-(s=Math.max(0,-(-h*c+f)))*s+(u=s>0?-c:Math.min(Math.max(-c,-m),c))*(u+2*m)+d:u<=p?(s=0,l=(u=Math.min(Math.max(-c,-m),c))*(u+2*m)+d):l=-(s=Math.max(0,-(h*c+f)))*s+(u=s>0?c:Math.min(Math.max(-c,-m),c))*(u+2*m)+d;else u=h>0?-c:c,l=-(s=Math.max(0,-(h*u+f)))*s+u*(u+2*m)+d;return i&&i.copy(this.direction).multiplyScalar(s).add(this.origin),r&&r.copy(n).multiplyScalar(u).add(a),l},yo.prototype.intersectSphere=function(t,e){var i=[0,0,0];Dt(i,t.center,this.origin);var r=Mt(i,this.direction),a=Mt(i,i)-r*r,n=t.radius*t.radius;if(a>n)return null;var o=Math.sqrt(n-a),s=r-o,u=r+o;return s<0&&u<0?null:s<0?this.at(u,e):this.at(s,e)},yo.prototype.intersectsSphere=function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},yo.prototype.distanceToPlane=function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null},yo.prototype.intersectPlane=function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},yo.prototype.intersectsPlane=function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},yo.prototype.intersectBox=function(t,e){var i,r,a,n,o,s,u=1/this.direction[0],l=1/this.direction[1],p=1/this.direction[2],c=this.origin;return u>=0?(i=(t[0][0]-c[0])*u,r=(t[1][0]-c[0])*u):(i=(t[1][0]-c[0])*u,r=(t[0][0]-c[0])*u),l>=0?(a=(t[0][1]-c[1])*l,n=(t[1][1]-c[1])*l):(a=(t[1][1]-c[1])*l,n=(t[0][1]-c[1])*l),i>n||a>r?null:((a>i||i!=i)&&(i=a),(n<r||r!=r)&&(r=n),p>=0?(o=(t[0][2]-c[2])*p,s=(t[1][2]-c[2])*p):(o=(t[1][2]-c[2])*p,s=(t[0][2]-c[2])*p),i>s||o>r?null:((o>i||i!=i)&&(i=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(i>=0?i:r,e)))},yo.prototype.intersectTriangle=function(t,e,i,r,a){var n=[0,0,0],o=[0,0,0],s=[0,0,0],u=[0,0,0];Dt(o,e,t),Dt(s,i,t),zt(u,o,s);var l,p=Mt(this.direction,u);if(p>0){if(r)return null;l=1;}else{if(!(p<0))return null;l=-1,p=-p;}Dt(n,this.origin,t);var c=l*Mt(this.direction,zt(s,n,s));if(c<0)return null;var h=l*Mt(this.direction,zt(o,o,n));if(h<0)return null;if(c+h>p)return null;var f=-l*Mt(n,u);return f<0?null:this.at(f/p,a)},yo.prototype.applyMatrix4=function(t){return qt(this.origin,this.origin,t),qt(this.direction,this.direction,t),this},yo.prototype.equals=function(t){return t.origin===this.origin&&t.direction===this.direction};var bo=function(t){function e(e,i,r,a,n){t.call(this,e,i,r),this.td_projectionInverseMatrix=rt(),this.td_viewMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.td_viewInverseMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.td_sphereRender=a||!1,this.latRange=[le.TRANSFORM.MIN_LAT,le.TRANSFORM.MAX_LAT],this._projection=n,this.td_camPos=[0,0,0,1],this.td_pixelMatrix=rt(),this.pixelMatrixInverse=rt(),this.td_lastRect={},this.td_fPEnabled=!1,this.isFlying=!1,this.td_camHeightOffset=0,this.maxTiles=0,this.panoAnyWhereMoveAngle=0,this.td_projNeedChange=!0,this.td_projZoomChangeNumber=0,this._calcProjectionsMatrix();}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={zoom:{configurable:!0},projection:{configurable:!0},sphereRender:{configurable:!0},pitch:{configurable:!0},center:{configurable:!0},bearing:{configurable:!0},fPMode:{configurable:!0},cameraHeightOffset:{configurable:!0},panoramaMode:{configurable:!0}};return e.prototype.setMap=function(t){this._map=t;},e.prototype.setPainter=function(t){this.painter=t;},e.prototype.clone=function(){var t=new e(this._minZoom,this._maxZoom,this._renderWorldCopies,this.sphereRender,this.projection);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t.setMap(this._map),t},e.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcProjectionsMatrix(!0),this._calcMatrices();},i.zoom.get=function(){return this._zoom},i.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._fov&&this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this.td_cameraDistance=function t(e,i,r){if(i>=3)return r*(Math.sin(Math.PI/4/Math.pow(2,i-2))/Math.tan(e*le.TRANSFORM.DEG_TO_RAD/2)+Math.cos(Math.PI/4/Math.pow(2,i-2)));var a=r/Math.sin(e*le.TRANSFORM.DEG_TO_RAD/2),n=t(e,3,r);return i>=2&&i<3?n+(a-n)*(3-i):a*(2-i+1)}(this.fov,e,le.TRANSFORM.R),this.alt=this.td_cameraDistance-le.TRANSFORM.R,this.current_zoom_tangent_angle=Math.PI/2-Math.asin(le.TRANSFORM.R/this.td_cameraDistance),this._calcProjectionsMatrix(),this._constrain(),this._calcMatrices());},e.prototype._calcProjectionsMatrix=function(){if(0!==this.width&&0!==this.height){if(this.td_projectionMatrix=rt(),this.panoramaMode)_t(this.td_projectionMatrix,65*le.TRANSFORM.DEG_TO_RAD,this.width/this.height,.01,10);else if(this.getCameraPos()){var t=go({canvasX:this.width/2,canvasY:this.height,transform:this}).intersectPoint;if(t){var e=Pt(t,this.getCameraPos());_t(this.td_projectionMatrix,this._fov,this.width/this.height,e*Math.cos(this._fov/2)/4,le.TRANSFORM.R+this.alt);}else _t(this.td_projectionMatrix,this._fov,this.width/this.height,this.alt/2,3*le.TRANSFORM.R+this.alt);}else _t(this.td_projectionMatrix,this._fov,this.width/this.height,le.TRANSFORM.R_SCALE/10,6*le.TRANSFORM.R);st(this.td_projectionInverseMatrix,this.td_projectionMatrix),this.td_pixelMatrix=rt(),pt(this.td_pixelMatrix,this.td_pixelMatrix,[this.width/2,-this.height/2,1]),lt(this.td_pixelMatrix,this.td_pixelMatrix,[1,-1,0]),this.td_projNeedChange=!1;}},i.projection.set=function(t){this._projection=t;},i.projection.get=function(){return this._projection},i.sphereRender.set=function(t){this.pitch>le.TRANSFORM.PLAIN_MAX_PITCH&&!t&&(this.pitch=le.TRANSFORM.PLAIN_MAX_PITCH),this.td_sphereRender=t;},i.sphereRender.get=function(){return this.td_sphereRender},e.prototype.locationPoint=function(t,e){return this.td_sphereRender?this.td_lngLatToScreenPoint(t,e).point:this.coordinatePoint(this.locationCoordinate(t))},e.prototype.locationPointOfScreen=function(t,e){return this.td_lngLatToScreenPoint(t,e)},e.prototype.td_lngLatToScreenPoint=function(t,e){var i=[0,0,0,1];return Gn(i,t.toArray(),le.TRANSFORM.R+(e||0)*le.TRANSFORM.R_SCALE),qt(i,i,this.td_viewMatrix),qt(i,i,this.td_projectionMatrix),qt(i,i,this.td_pixelMatrix),{point:new p(i[0]/i[3],i[1]/i[3]),w:i[3]}},e.prototype.checkPositionForeground=function(t){if(this.td_sphereRender){var e=[0,0,0,1];Gn(e,t.toArray(),le.TRANSFORM.R);var i=this.getCameraPos(),r=Mt(Rt([],e.slice(0,3)),Rt([],i));return Math.acos(r)<=this.current_zoom_tangent_angle}return!0},e.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),i=[e.column*this.tileSize,e.row*this.tileSize,0,1];return qt(i,i,this.pixelMatrix),new p(i[0]/i[3],i[1]/i[3])},e.prototype.lngX=function(t){return Ya(this._projection).lngX(t,this.worldSize)},e.prototype.lngXRoundZoom=function(t){return Ya(this._projection).lngX(t,Math.pow(2,Math.floor(this.zoom)))},e.prototype.latY=function(t){return Ya(this._projection).latY(t,this.worldSize)},e.prototype.latYRoundZoom=function(t){return Ya(this._projection).latY(t,Math.pow(2,Math.floor(this.zoom)))},e.prototype.xLng=function(t){return Ya(this._projection).xLng(t,this.worldSize)},e.prototype.yLat=function(t){return Ya(this._projection).yLat(t,this.worldSize)},i.pitch.get=function(){return this._pitch*le.TRANSFORM.RAD_TO_DEG},i.pitch.set=function(t){var e=_(t,0,this.sphereRender?le.TRANSFORM.SPHERE_MAX_PITCH:le.TRANSFORM.PLAIN_MAX_PITCH)*le.TRANSFORM.DEG_TO_RAD;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcProjectionsMatrix(),this._calcMatrices());},i.center.get=function(){return this._center},i.center.set=function(t){if(t.lat!==this._center.lat||t.lng!==this._center.lng){if(this.fPMode){var e=this._map.style.getTerrainAltitude();e>0&&(this.td_camHeightOffset+=(e-this.td_camHeightOffset)/5);}this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices();}},e.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining&&!this.td_sphereRender){this._constraining=!0;var t,e,i,r,a=-90,n=90,o=-180,s=180,u=this.size,l=this._unmodified;if(this.latRange){var c=this.latRange;a=this.latY(c[1]),t=(n=this.latY(c[0]))-a<u.y?u.y/(n-a):0;}if(this.lngRange){var h=this.lngRange;o=this.lngX(h[0]),e=(s=this.lngX(h[1]))-o<u.x?u.x/(s-o):0;}var f=Math.max(e||0,t||0);if(f)return this.center=this.unproject(new p(e?(s+o)/2:this.x,t?(n+a)/2:this.y)),this.zoom+=this.scaleZoom(f),this._unmodified=l,void(this._constraining=!1);if(this.latRange){var m=this.y,d=u.y/2;m-d<a&&(r=a+d),m+d>n&&(r=n-d);}if(this.lngRange){var _=this.x,y=u.x/2;_-y<o&&(i=o+y),_+y>s&&(i=s-y);}if(void 0!==i||void 0!==r)if(this.td_sphereRender){var g=this.center.lat,v=this.unproject(new p(void 0!==i?i:this.x,void 0!==r?r:this.y));this.center=new qa(v.lng,this._checkLatRange(g));}else this.center=this.unproject(new p(void 0!==i?i:this.x,void 0!==r?r:this.y));this._unmodified=l,this._constraining=!1;}},e.prototype.pointLocation=function(t,e){return this.td_sphereRender?go({canvasX:t.x,canvasY:t.y,transform:this,alt:e||0,accurate:!0}).lngLat:this.coordinateLocation(this.pointCoordinate(t))},e.prototype.setLocationAtPoint=function(t,e){if(this.td_sphereRender){var i=go({canvasX:e.x,canvasY:e.y,transform:this,accurate:!1});if(i.lngLat&&t){var r=[i.lngLat.lng-t.lng,i.lngLat.lat-t.lat],a=this.center.lat-r[1],n=this.center.lng-r[0];a=this._checkLatRange(a),this.center=new qa(n,a).wrap();}}else{var o=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(o)),this._renderWorldCopies&&(this.center=this.center.wrap());}},e.prototype._checkLatRange=function(t){return this.latRange?t>90?90:t<-90?-90:t:t},e.prototype.covering3DTiles=function(t){var e=this,i=this.td_lastRect;if(this.zoom<t.zoom)return{children:{},rect:i};var r=[],a=Math.floor(this.zoom)+t.data.zoomOffset||0;if(t.modelType===le.MODEL_TYPE.OSGB){for(var n in t.data.chd){var o=t.data.chd[n];if(o.rect||(o.rect=e._calcTdTileRect(t.matrix,o.bs)),e.intersectRect(i,o.rect))if(a===t.zoom)r.push({key:n,l:o.l,url:o.url,rect:o.rect,bs:o.bs});else{var s=[];e._checkOSGBChildrenCovered(o,a,t.matrix,s),r=r.concat(s);}}if(a>=18&&r.length>le.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT){r.sort(function(t,i){return Pt(e.td_camPos,t.rect.center)-Pt(e.td_camPos,i.rect.center)});var u=r.slice(0,le.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT),l=r.slice(1*le.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT,2*le.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT),p=this.getOsgbParentsByArr(l,t.data,1),c=r.slice(2*le.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT),h=this.getOsgbParentsByArr(c,t.data,3);r=(r=u.concat(p,h)).slice(0,3*le.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT);}}else{for(var f in t.data.chd){var m=t.data.chd[f];m.rect||(m.rect=e._calcTdTileRect(t.matrix,m.bs)),e.intersectRect(i,m.rect)&&r.push({key:f,l:m.l,url:m.url,rect:m.rect,bs:m.bs});}r.sort(function(t,i){return Pt(e.td_camPos,t.rect.center)-Pt(e.td_camPos,i.rect.center)});}return{children:r,rect:i}},e.prototype.getOSGBParentsKeys=function(t){for(var e={},i=0;i<t.length;i++)e[t[i].key]=t[i].key.split("~")[0];var r=[];for(var a in e)r.push(e[a]);return r},e.prototype.getOsgbParentsByArr=function(t,e,i,r){var a={},n=[];t:for(var o=0;o<t.length;o++){if(r)for(var s=0;s<r.length;s++)if(-1!==t[o].key.indexOf(r[s]))continue t;var u=this.findOsgbParentByChild(t[o],e,i);u&&(a[u.key]=u);}for(var l in a)n.push(a[l]);return n},e.prototype.findOsgbParentByChild=function(t,e,i){if(!t)return null;var r=t.key,a=r.split("~")[1].length-2,n=r.length,o=r.substr(0,n-a),s=e.chd[o];if(a<=i)return{l:s.l,url:s.url,bs:s.bs,rect:s.rect,key:o};for(a-=2;a>2*i;)o=r.substr(0,n-a),s=s.chd[o],a-=2;return{l:s.l,url:s.url,bs:s.bs,rect:s.rect,key:o}},e.prototype._calcTdTileRect=function(t,e){var i=[[],[]];qt(i[0],e[0].concat([1]),t),qt(i[1],e[1].concat([1]),t);var r=-1/0,a=1/0,n=1/0,o=-1/0;Wn(i[0],i[0]),Wn(i[1],i[1]),r<i[0][1]&&(r=i[0][1]),r<i[1][1]&&(r=i[1][1]),a>i[0][1]&&(a=i[0][1]),a>i[1][1]&&(a=i[1][1]),o<i[0][0]&&(o=i[0][0]),o<i[1][0]&&(o=i[1][0]),n>i[0][0]&&(n=i[0][0]),n>i[1][0]&&(n=i[1][0]);var s=.7*(o-n),u=.7*(r-a);return{north:r+u,south:a-u,west:n-s,east:o+s,center:Gn([],[(o+n)/2,(r+a)/2],le.TRANSFORM.R)}},e.prototype._checkOSGBChildrenCovered=function(t,e,i,r){for(var a in t.chd){var n=t.chd[a];if(n.l<e){if(n.rect||(n.rect=this._calcTdTileRect(i,n.bs)),this.intersectRect(this.td_lastRect,n.rect)){if(0===Object.keys(n.chd).length)return void r.push({l:n.l,url:n.url,rect:n.rect,bs:n.bs,key:a});this._checkOSGBChildrenCovered(n,e,i,r);}}else{if(n.l!==e)return;n.rect||(n.rect=this._calcTdTileRect(i,n.bs)),this.intersectRect(this.td_lastRect,n.rect)&&r.push({l:n.l,url:n.url,rect:n.rect,bs:n.bs,key:a});}}},e.prototype._isEmpty=function(t){return t.east-t.west<=0||t.north-t.south<=0},e.prototype.intersectRect=function(t,e){var i={};return i.west=Math.max(t.west,e.west),i.north=Math.min(t.north,e.north),i.east=Math.min(t.east,e.east),i.south=Math.max(t.south,e.south),!this._isEmpty(i)},e.prototype.tangentPointInvisible=function(){return go({canvasX:this.width/2,canvasY:0,transform:this}).lngLat},e.prototype.coveringTiles=function(t){var i=this.coveringZoomLevel(t),r=i;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);var a=this.pointCoordinate(this.centerPoint,i),n=new p(a.column-.5,a.row-.5);if(this.td_sphereRender){if(this.isFlying)return this._computeZoomTiles(3,n);var o=t.renderWithTerrain&&this.zoom>=le.TRANSFORM.TERRAIN_FIND_ZOOM_MIN,s=this.pointCoordinate(o?new p(this.width/2,this.height/4*(3-Math.cos(this._pitch))):this._getEarthViewCalculateCenterPixel(),i);s&&(n=new p(s.column,s.row));var u=[],l=function(t,e,i,r){var a=new p(Math.round(i.x),Math.round(i.y),0),n=e.td_lastRect,o={};return n.antimeridian?(xo(e,{north:n.north,south:n.south,west:n.west,east:180},o,a,t,r),xo(e,{north:n.north,south:n.south,west:-180,east:n.east},o,a,t,r)):n.isPole?xo(e,{north:n.north,south:n.south,west:-180,east:180},o,a,t,r):xo(e,n,o,a,t,r),Object.keys(o).map(function(t){return o[t]})}(t.reparseOverscaled?r:i,this,n,t.isBackground).sort(function(t,e){return n.dist(t.canonical)-n.dist(e.canonical)});if(t.noLowLevelCover)return l.slice(0,64);if(t.isVector)return t.noBox?l.reverse():l.slice(0,64).reverse();if(o){var c=this.maxTiles||64;return u=l.slice(0,c).reverse()}if(l.length>128){u=l.slice(0,40).reverse();var h=e._computeParent(l.slice(40,80),2);u=u.concat(h.reverse());var f=e._computeParent(l.slice(80,320),4);if(u=u.concat(f.reverse()),this.tangentPoint){var m=this.locationCoordinate(qa.convert(this.tangentPoint))._zoomTo(i),d=e._computeParent([new uo(i,0,i,m.column,m.row)],8);return u=u.concat(d.reverse()).reverse()}return u.reverse()}return l}return po(i,[this.pointCoordinate(new p(0,0),i),this.pointCoordinate(new p(this.width,0),i),this.pointCoordinate(new p(this.width,this.height),i),this.pointCoordinate(new p(0,this.height),i)],t.reparseOverscaled?r:i,this._renderWorldCopies).sort(function(t,e){return n.dist(t.canonical)-n.dist(e.canonical)})},e._computeParent=function(t,e){if(0===t.length)return[];for(var i={},r=[],a=t[0].canonical.z-e>=1?e:t[0].canonical.z-1,n=1/Math.pow(2,a),o=0;o<t.length;o++){var s=t[o].canonical.x/Math.pow(2,a),u=t[o].canonical.y/Math.pow(2,a),l=s-Math.floor(s),p=u-Math.floor(u);s=l<=n?Math.floor(s)-2:Math.floor(s)-1,u=p<=n?Math.floor(u)-2:Math.floor(u)-1;for(var c=0;c<4;c++)for(var h=0;h<4;h++)if(!(s+c<0||u+h<0||s+c>=Math.pow(2,t[o].canonical.z-a)||u+h>=Math.pow(2,t[o].canonical.z-a))){var f=new uo(t[o].overscaledZ-a,0,t[o].canonical.z-a,s+c,u+h);i[f.key]||(r.push(f),i[f.key]=!0);}}return r},e.prototype._computeZoomTiles=function(t,e){for(var i={},r=[],a=0;a<Math.pow(2,t);a++)for(var n=0;n<Math.pow(2,t);n++){var o=new uo(t,0,t,a,n);i[o.key]||(r.push(o),i[o.key]=!0);}return r.sort(function(t,i){return e.dist(t.canonical)-e.dist(i.canonical)}).slice(0,40).reverse()},e.prototype._getEarthViewCalculateCenterPixel=function(){return this.fPMode?new p(this.width/2,this.height):new p(this.width/2,this.height*(.5+.5*(1-Math.cos(this._pitch))))},e.prototype._getMaxRectBounds=function(t){for(var e=1/0,i=-1/0,r=1/0,a=-1/0,n=0;n<t.length;n++){var o=t[n];o&&(o[0]>i&&(i=o[0]),o[0]<e&&(e=o[0]),o[1]>a&&(a=o[1]),o[1]<r&&(r=o[1]));}return{north:a,south:r,west:e,east:i,antimeridian:!1,isPole:!1}},e.prototype.computeViewRectangle=function(){var t=this.center.toArray();if(this.zoom<=3)return this._checkBounds({north:t[1]+90>90?90:t[1]+90,south:t[1]-90<-90?-90:t[1]-90,west:t[0]-90,east:t[0]+90,antimeridian:!1,isPole:!1});if(this.zoom<=4)return this._checkBounds({north:t[1]+70>90?90:t[1]+70,south:t[1]-70<-90?-90:t[1]-70,west:t[0]-70,east:t[0]+70,antimeridian:!1,isPole:!1});if(this.zoom<=5)return this._checkBounds({north:t[1]+45>90?90:t[1]+45,south:t[1]-45<-90?-90:t[1]-45,west:t[0]-45,east:t[0]+45,antimeridian:!1,isPole:!1});var e,i=this.tangentPointInvisible(),r=[],a=this.pointLocation(new p(0,this.height)),n=this.pointLocation(new p(this.width,this.height));if(a&&r.push(a.toArray()),n&&r.push(n.toArray()),this.pointLocation(new p(0,0))){var o=this.pointLocation(new p(0,0)),s=this.pointLocation(new p(this.width,0));o&&r.push(o.toArray()),s&&r.push(s.toArray());}else{var u=bt(this.getCameraPos()),l=(Math.pow(this.alt,2)+Math.pow(u,2)-Math.pow(le.TRANSFORM.R,2))/(2*u*this.alt),c=Math.acos(l),h=le.TRANSFORM.R/u,f=Math.asin(h)-c,m=qt([],[0,0,0,1],this.td_thirdPersonViewMatrix),d=Math.atan(this.width/this.height),_=this._getTangentLngLatByCameraRotateAngle({angle:f,cam:m,OC:u,tangentRotateAngle:d}),y=this._getTangentLngLatByCameraRotateAngle({angle:f,cam:m,OC:u,tangentRotateAngle:-d});r.push(y,_);}if(i)this.tangentPoint=i.toArray(),r.push(this.tangentPoint);else{var g=this.pointLocation(new p(0,this.height/2)),v=this.pointLocation(new p(this.width,this.height/2));g&&r.push(g.toArray()),v&&r.push(v.toArray());var x=bt(this.getCameraPos()),b=(Math.pow(this.alt,2)+Math.pow(x,2)-Math.pow(le.TRANSFORM.R,2))/(2*x*this.alt),w=Math.acos(b),A=le.TRANSFORM.R/x,T=Math.asin(A)-w,S=qt([],[0,0,0,1],this.td_thirdPersonViewMatrix),E=this._getTangentLngLatByCameraRotateAngle({angle:T,cam:S,OC:x,tangentRotateAngle:0});this.tangentPoint=E,r.push(E);}return e=this._getMaxRectBounds(r),this._checkBounds(e)},e.prototype._getTangentLngLatByCameraRotateAngle=function(t){var e=[0,Math.sin(t.angle),-Math.cos(t.angle),1];if(0!==t.tangentRotateAngle){var i=rt();ht(i,i,t.tangentRotateAngle),qt(e,e,i);}var r=qt([],e,this.td_thirdPersonViewMatrix),a=Tt([],Et([],Rt([],Dt([],r,t.cam)),Math.sqrt(Math.pow(t.OC,2)-Math.pow(le.TRANSFORM.R,2))),t.cam);return Wn([],[-a[0],a[1],a[2]])},e.prototype._checkBounds=function(t){var e=t.north,i=t.south,r=t.west,a=t.east,n=t.antimeridian,o=t.isPole;for(e>=90&&(e=90,r=-180,a=180,o=!0),i<=-90&&(i=-90,r=-180,a=180,o=!0);r<-180;)r+=360,n=!0;for(;a>180;)a-=360,n=!0;return{north:e,south:i,west:r,east:a,antimeridian:n,isPole:o}},e.prototype.pointCoordinate=function(t,e){if(this.td_sphereRender){var i=go({canvasX:t.x,canvasY:t.y,transform:this,accurate:!0});return i.lngLat?new l(this.lngX(i.lngLat.lng)/this.tileSize,this.latY(i.lngLat.lat)/this.tileSize,this.zoom)._zoomTo(e||this.zoom):this._delegatePointCoordinate(t,e)}return this._delegatePointCoordinate(t,e)},e.prototype._delegatePointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];qt(i,i,this.pixelMatrixInverse),qt(r,r,this.pixelMatrixInverse);var a=i[3],n=r[3],o=i[1]/a,s=r[1]/n,u=i[2]/a,p=r[2]/n,c=u===p?0:(0-u)/(p-u);return new l(di(i[0]/a,r[0]/n,c)/this.tileSize,di(o,s,c)/this.tileSize,this.zoom)._zoomTo(e)},i.bearing.get=function(){return-this.angle/Math.PI*180},i.bearing.set=function(t){var e=-y(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=new Float64Array(4),this.rotationMatrix[1]=1,this.rotationMatrix[3]=1,et(this.rotationMatrix,this.rotationMatrix,this.angle));},e.prototype._getThirdPersonViewMatrix=function(t){t=t||{pitch:this._pitch,bearing:this.angle,altitude:this.alt,lng:this.center.lng,lat:this.center.lat};var e=lt([],rt(),[0,0,t.altitude]),i=ct([],rt(),t.pitch),r=lt([],rt(),[0,0,le.TRANSFORM.R]),a=ft([],rt(),t.bearing),n=ct([],rt(),-t.lat*le.TRANSFORM.DEG_TO_RAD);return ut([],ut([],ut([],ut([],ut([],ht([],rt(),(-90+t.lng)*le.TRANSFORM.DEG_TO_RAD),n),a),r),i),e)},e.prototype._getPanoViewMatrix=function(){var t=rt(),e=.05*(this.zoom-1);e<0?e=0:e>.8&&(e=.8),this.pano_z=e,gt(t,[0,0,0],[0,0,-1],[0,-1,0]),ct(t,t,-this.center.lat*le.TRANSFORM.DEG_TO_RAD),ht(t,t,this.center.lng*le.TRANSFORM.DEG_TO_RAD);var i,r,a,n,o,s,u,l,p=ne();return i=p,r=[0,e],a=[0,0],n=(-90+this.panoAnyWhereMoveAngle)*le.TRANSFORM.DEG_TO_RAD,o=r[0]-a[0],s=r[1]-a[1],u=Math.sin(n),l=Math.cos(n),i[0]=o*l-s*u+a[0],i[1]=o*u+s*l+a[1],lt(t,t,[p[0],0,p[1]])},e.prototype._getFirstPersonViewMatrix=function(t){t=t||{pitch:this._pitch,bearing:this.angle,altitude:(this.td_camHeightOffset||10)*le.TRANSFORM.R_SCALE,lng:this.center.lng,lat:this.center.lat};var e=ct([],rt(),t.pitch),i=lt([],rt(),[0,0,t.altitude]),r=lt([],rt(),[0,0,le.TRANSFORM.R]),a=ft([],rt(),t.bearing),n=ct([],rt(),-t.lat*le.TRANSFORM.DEG_TO_RAD);return ut([],ut([],ut([],ut([],ut([],ht([],rt(),(-90+t.lng)*le.TRANSFORM.DEG_TO_RAD),n),a),r),i),e)},e.prototype._calculateTDSceneMatrix=function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e=[0,0,0,1],i=[0,0,-1,1],r=[0,1,0,1];this.td_fPEnabled&&this.zoom>=15?(this.td_firstPersonViewMatrix=this._getFirstPersonViewMatrix(),qt(e,e,this.td_firstPersonViewMatrix),qt(i,i,this.td_firstPersonViewMatrix),qt(r,r,this.td_firstPersonViewMatrix),gt(t,[e[0]/e[3],e[1]/e[3],e[2]/e[3]],[i[0]/i[3],i[1]/i[3],i[2]/i[3]],[r[0]/r[3],r[1]/r[3],r[2]/r[3]]),pt(t,t,[-1,1,1])):this.panoramaMode?t=this._getPanoViewMatrix():(this.td_thirdPersonViewMatrix=this._getThirdPersonViewMatrix(),qt(e,e,this.td_thirdPersonViewMatrix),qt(i,i,this.td_thirdPersonViewMatrix),qt(r,r,this.td_thirdPersonViewMatrix),gt(t,[e[0]/e[3],e[1]/e[3],e[2]/e[3]],[i[0]/i[3],i[1]/i[3],i[2]/i[3]],[r[0]/r[3],r[1]/r[3],r[2]/r[3]]),pt(t,t,[-1,1,1])),this.td_viewMatrix=t,this.td_camPos=[0,0,0,1],this.td_viewInverseMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],st(this.td_viewInverseMatrix,this.td_viewMatrix),qt(this.td_camPos,this.td_camPos,this.td_viewInverseMatrix),this.td_camPosNormalized=[this.td_camPos[0]/this.td_camPos[3],this.td_camPos[1]/this.td_camPos[3],this.td_camPos[2]/this.td_camPos[3]],this.td_vpMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ut(this.td_vpMatrix,this.td_projectionMatrix,this.td_viewMatrix),this.td_lastRect=this.computeViewRectangle();var a=rt();_t(a,this._fov,this.width/this.height,.001,10);var n=rt();gt(n,[0,0,1/Math.tan(this._fov/2)],[0,0,0],[0,1,0]);var o=rt();ct(o,o,this._pitch),this.td_symbolMVPMatrix=vt([],vt([],a,n),o);},e.prototype.customLayerMatrix=function(){return this.td_sphereRender?at(this.calculateVPMatrix()):at(this.mercatorMatrix)},e.prototype._calcMatrices=function(){if(this.height){this._calculateTDSceneMatrix(),this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,i=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),r=this.x,a=this.y,n=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),o=new Float64Array(16);_t(o,this._fov,this.width/this.height,1,n),pt(o,o,[1,-1,1]),lt(o,o,[0,0,-this.cameraToCenterDistance]),ct(o,o,this.pitch*le.TRANSFORM.DEG_TO_RAD),ft(o,o,this.angle),lt(o,o,[-r,-a,0]),this.td_sphereRender||(this.mercatorMatrix=pt([],o,[this.worldSize,this.worldSize,this.worldSize])),pt(o,o,[1,1,this.worldSize/(2*Math.PI*le.TRANSFORM.REAL_R*Math.abs(Math.cos(this.center.lat*le.TRANSFORM.DEG_TO_RAD))),1]),this.projMatrix=o;var s=this.width%2/2,u=this.height%2/2,l=Math.cos(this.angle),p=Math.sin(this.angle),c=r-Math.round(r)+l*s+p*u,h=a-Math.round(a)+l*u+p*s,f=new Float64Array(o);if(lt(f,f,[c>.5?c-1:c,h>.5?h-1:h,0]),this.alignedProjMatrix=f,o=at(this.td_pixelMatrix),this.pixelMatrix=ut(new Float64Array(16),o,this.projMatrix),!(o=st(new Float64Array(16),this.pixelMatrix))&&!this.td_sphereRender)throw new Error("failed to invert matrix");this.pixelMatrixInverse=o,this._posMatrixCache={},this._alignedPosMatrixCache={};}},e.prototype.calculateAnyCameraMatrix=function(t){var e=[],i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=[0,0,0,1],a=[0,0,-1,1],n=[0,1,0,1];if(t.id===le.CAMERA.SKYBOX_CAMERA_ID)ht(i,i,(-this.center.lng-t.bearing+90)*le.TRANSFORM.DEG_TO_RAD);else if(t.id===le.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID){var o=1+.035*Math.pow(2,-this.zoom);pt(i,this.td_viewMatrix,[-o,o,o]);}else if(t.id===le.CAMERA.SUNLIGHT_CAMERA_ID){var s=t.location||this.center.toArray(),u=this._getThirdPersonViewMatrix({lng:s[0],lat:s[1],pitch:t.pitch*le.TRANSFORM.DEG_TO_RAD,bearing:t.bearing*le.TRANSFORM.DEG_TO_RAD,altitude:t.altitude*le.TRANSFORM.R_SCALE});qt(r,r,u),qt(a,a,u),qt(n,n,u),gt(i,[r[0]/r[3],r[1]/r[3],r[2]/r[3]],[a[0]/a[3],a[1]/a[3],a[2]/a[3]],[n[0]/n[3],n[1]/n[3],n[2]/n[3]]),pt(i,i,[-1,1,1]);}else{var l=this._getFirstPersonViewMatrix({lng:t.location[0],lat:t.location[1],pitch:t.pitch*le.TRANSFORM.DEG_TO_RAD,bearing:t.bearing*le.TRANSFORM.DEG_TO_RAD,altitude:t.altitude*le.TRANSFORM.R_SCALE});qt(r,r,l),qt(a,a,l),qt(n,n,l),gt(i,[r[0]/r[3],r[1]/r[3],r[2]/r[3]],[a[0]/a[3],a[1]/a[3],a[2]/a[3]],[n[0]/n[3],n[1]/n[3],n[2]/n[3]]),pt(i,i,[-1,1,1]);}var p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];st(p,i),qt(e,[0,0,0,1],p),this._lastSunLightStatus={lng:this.center.lng,lat:this.center.lat,pitch:t.pitch,bearing:t.bearing,geographic:e.slice(0,3),camTransformMatrix:i};},e.prototype.calculateVPMatrix=function(t){if(t){if(this.calculateAnyCameraMatrix(t),t.id===le.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID)return ut([],this.td_projectionMatrix,this._lastSunLightStatus.camTransformMatrix);if(t.id===le.CAMERA.SKYBOX_CAMERA_ID){var e=new Float64Array(16);return _t(e,80*le.TRANSFORM.DEG_TO_RAD,this.width/this.height,.01,10),ut([],e,this._lastSunLightStatus.camTransformMatrix)}var i=new Float64Array(16);return _t(i,this._fov,this.width/this.height,.1*le.TRANSFORM.R_SCALE,10*t.farDistance),ut([],i,this._lastSunLightStatus.camTransformMatrix)}return this.td_vpMatrix},e.prototype.getCameraPos=function(){return this.td_camPosNormalized},i.fPMode.get=function(){return this.td_fPEnabled},i.fPMode.set=function(t){this.td_fPEnabled=t;},i.cameraHeightOffset.set=function(t){this.td_camHeightOffset=t;},i.cameraHeightOffset.get=function(){return this.td_camHeightOffset},i.panoramaMode.set=function(t){this._panoramaMode=t,this._calcProjectionsMatrix(!0),t?this._saveSphereStatus():this._restoreSphereStatus(),this._calcMatrices();},i.panoramaMode.get=function(){return this._panoramaMode},e.prototype._saveSphereStatus=function(){this.sphere_save_transform_status={_zoom:0+this._zoom,_pitch:0+this._pitch,angle:0+this.angle,center:new qa(this._center.lng,this._center.lat)},this._zoom=0,this._pitch=0,this.angle=0,this.center=new qa(0,0),this.zoom=0;},e.prototype._restoreSphereStatus=function(){this._zoom=this.sphere_save_transform_status._zoom,this._pitch=this.sphere_save_transform_status._pitch,this.angle=this.sphere_save_transform_status.angle,this.center=this.sphere_save_transform_status.center;},Object.defineProperties(e.prototype,i),e}(mo),wo=function(t){function e(e,i){if(t.call(this),this.id=e.id,this._featureFilter=function(){return!0},"custom"!==e.type){if(e=e,this.metadata=e.metadata,this.type=e.type,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.visibility="visible",this.depthTest=e["depth-test"]||!1,this.shadowCenter=e["shadow-center"]||!1,"background"!==e.type&&"sphere-background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Fa(i.layout)),i.paint){for(var r in this._transitionablePaint=new za(i.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned();}e.clipGround&&(this.clipGround=!0),this.useLayerPosition=!1;}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,i){if(null!==e&&void 0!==e){var r="layers."+this.id+".layout."+t;if(this._validate(aa,r,t,e,i))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility="none"===e?e:"visible";},e.prototype.getPaintProperty=function(t){return T(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,i){if(null!==e&&void 0!==e){var r="layers."+this.id+".paint."+t;if(this._validate(ra,r,t,e,i))return!1}if(T(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var a=this._transitionablePaint._values[t].value.isDataDriven();this._transitionablePaint.setValue(t,e);var n=this._transitionablePaint._values[t].value.isDataDriven();return this._handleSpecialPaintPropertyUpdate(t),n||a},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||(!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility)},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint);},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t);},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,_original_style:this._original_style,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return"none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),E(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,i,r,a){return(!a||!1!==a.validate)&&na(this,t.call(ea,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof La&&Vi(e.property.specification)&&(("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent))return!0}return!1},e.prototype.clearPick=function(){},e}(Ae),Ao=Ja([{name:"a_pos",components:2,type:"Int16"}],4).members,To=function(t){void 0===t&&(t=[]),this.segments=t;};To.prototype.prepareSegment=function(t,e,i){var r=this.segments[this.segments.length-1];return t>To.MAX_VERTEX_ARRAY_LENGTH&&R("Max vertices per segment is "+To.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!r||r.vertexLength+t>To.MAX_VERTEX_ARRAY_LENGTH)&&(r={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},this.segments.push(r)),r},To.prototype.get=function(){return this.segments},To.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var i=e[t];for(var r in i.vaos)i.vaos[r].destroy();}},To.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ca("SegmentVector",To);var So=function(t,e){return 256*(t=_(Math.floor(t),0,255))+(e=_(Math.floor(e),0,255))};function Eo(t,e){return e?[So(t[0],t[1]),So(t[2],t[3])]:[So(255*t.r,255*t.g),So(255*t.b,255*t.a)]}var Po=function(t,e,i){this.value=t,this.name=e,this.type=i,this.statistics={max:-1/0};};Po.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},Po.prototype.populatePaintArray=function(){},Po.prototype.updatePaintArray=function(){},Po.prototype.upload=function(){},Po.prototype.destroy=function(){},Po.prototype.setUniforms=function(t,e,i,r){var a=r.constantOr(this.value),n=t.gl;"color"===this.type?n.uniform4f(e.uniforms["u_"+this.name],a.r,a.g,a.b,a.a):n.uniform1f(e.uniforms["u_"+this.name],a);};var Io=function(t,e,i){this.expression=t,this.name=e,this.type=i,this.statistics={max:-1/0};var r="color"===i?zn:An;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===i?2:1,offset:0}],this.paintVertexArray=new r;};Io.prototype.defines=function(){return[]},Io.prototype.populatePaintArray=function(t,e){var i=this.paintVertexArray,r=i.length;i.reserve(t);var a=this.expression.evaluate(new Ia(0),e,{});if("color"===this.type)for(var n=Eo(a,"color"!==this.name&&"fill_color"!==this.name),o=r;o<t;o++)i.emplaceBack(n[0],n[1]);else{for(var s=r;s<t;s++)i.emplaceBack(a);this.statistics.max=Math.max(this.statistics.max,a);}},Io.prototype.updatePaintArray=function(t,e,i,r){var a=this.paintVertexArray,n=this.expression.evaluate({zoom:0},i,r);if("color"===this.type)for(var o=Eo(n,"color"!==this.name&&"fill_color"!==this.name),s=t;s<e;s++)a.emplace(s,o[0],o[1]);else{for(var u=t;u<e;u++)a.emplace(u,n);this.statistics.max=Math.max(this.statistics.max,n);}},Io.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));},Io.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();},Io.prototype.setUniforms=function(t,e){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],0);};var Ro=function(t,e,i,r,a){this.expression=t,this.name=e,this.type=i,this.useIntegerZoom=r,this.zoom=a,this.statistics={max:-1/0};var n="color"===i?Cn:zn;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===i?4:2,offset:0}],this.paintVertexArray=new n;};Ro.prototype.defines=function(){return[]},Ro.prototype.populatePaintArray=function(t,e){var i=this.paintVertexArray,r=i.length;i.reserve(t);var a=this.expression.evaluate(new Ia(this.zoom),e,{}),n=this.expression.evaluate(new Ia(this.zoom+1),e,{});if("color"===this.type)for(var o=Eo(a),s=Eo(n),u=r;u<t;u++)i.emplaceBack(o[0],o[1],s[0],s[1]);else{for(var l=r;l<t;l++)i.emplaceBack(a,n);this.statistics.max=Math.max(this.statistics.max,a,n);}},Ro.prototype.updatePaintArray=function(t,e,i,r){var a=this.paintVertexArray,n=this.expression.evaluate({zoom:this.zoom},i,r),o=this.expression.evaluate({zoom:this.zoom+1},i,r);if("color"===this.type)for(var s=Eo(n),u=Eo(o),l=t;l<e;l++)a.emplace(l,s[0],s[1],u[0],u[1]);else{for(var p=t;p<e;p++)a.emplace(p,n,o);this.statistics.max=Math.max(this.statistics.max,n,o);}},Ro.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));},Ro.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();},Ro.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},Ro.prototype.setUniforms=function(t,e,i){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],this.interpolationFactor(i.zoom));};var Mo=function(){this.binders={},this.cacheKey="",this._buffers=[],this._idMap={},this._bufferOffset=0;};Mo.createDynamic=function(t,e,i){var r=new Mo,a=[];for(var n in t.paint._values)if(i(n)){var o=t.paint.get(n);if(o instanceof La&&Vi(o.property.specification)){var s=Co(n,t.type),u=o.property.specification.type,l=o.property.useIntegerZoom;"constant"===o.value.kind?(r.binders[n]=new Po(o.value,s,u),a.push("/u_"+s)):"source"===o.value.kind?(r.binders[n]=new Io(o.value,s,u),a.push("/a_"+s)):(r.binders[n]=new Ro(o.value,s,u,l,e),a.push("/z_"+s));}}return r.cacheKey=a.sort().join(""),r},Mo.prototype.populatePaintArrays=function(t,e,i){for(var r in this.binders)this.binders[r].populatePaintArray(t,e);if(e.id){var a=String(e.id);this._idMap[a]=this._idMap[a]||[],this._idMap[a].push({index:i,start:this._bufferOffset,end:t});}this._bufferOffset=t;},Mo.prototype.updatePaintArrays=function(t,e,i){var r=!1;for(var a in t){var n=this._idMap[a];if(n)for(var o=t[a],s=0,u=n;s<u.length;s+=1){var l=u[s],p=e.feature(l.index);for(var c in this.binders){var h=this.binders[c];if(!(h instanceof Po)&&!0===h.expression.isStateDependent){var f=i.paint.get(c);h.expression=f.value,h.updatePaintArray(l.start,l.end,p,o),r=!0;}}}}return r},Mo.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},Mo.prototype.setUniforms=function(t,e,i,r){for(var a in this.binders){this.binders[a].setUniforms(t,e,r,i.get(a));}},Mo.prototype.getPaintVertexBuffers=function(){return this._buffers},Mo.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var i=[];for(var r in this.binders){var a=this.binders[r];(a instanceof Io||a instanceof Ro)&&a.paintVertexBuffer&&i.push(a.paintVertexBuffer);}this._buffers=i;},Mo.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy();};var zo=function(t,e,i,r){void 0===r&&(r=function(){return!0}),this.programConfigurations={};for(var a=0,n=e;a<n.length;a+=1){var o=n[a];this.programConfigurations[o.id]=Mo.createDynamic(o,i,r),this.programConfigurations[o.id].layoutAttributes=t;}this.needsUpload=!1;};function Co(t,e){return{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth","line-border-width":"borderwidth","line-border-opacity":"borderopacity","line-border-color":"bordercolor"}[t]||t.replace(e.replace("sphere-3d-","")+"-","").replace(e.replace("sphere-","")+"-","").replace(/-/g,"_")}zo.prototype.populatePaintArrays=function(t,e,i){for(var r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(t,e,i);this.needsUpload=!0;},zo.prototype.updatePaintArrays=function(t,e,i){for(var r=0,a=i;r<a.length;r+=1){var n=a[r];this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(t,e,n)||this.needsUpload;}},zo.prototype.get=function(t){return this.programConfigurations[t]},zo.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1;}},zo.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy();},ca("ConstantBinder",Po),ca("SourceExpressionBinder",Io),ca("CompositeExpressionBinder",Ro),ca("ProgramConfiguration",Mo,{omit:["_buffers"]}),ca("ProgramConfigurationSet",zo);var Oo,Fo=(Oo=16,{min:-1*Math.pow(2,Oo-1),max:Math.pow(2,Oo-1)-1});function Lo(t){for(var e=io/t.extent,i=t.loadGeometry(),r=0;r<i.length;r++)for(var a=i[r],n=0;n<a.length;n++){var o=a[n];o.x=Math.round(o.x*e),o.y=Math.round(o.y*e),(o.x<Fo.min||o.x>Fo.max||o.y<Fo.min||o.y>Fo.max)&&R("Geometry exceeds allowed extent, reduce your vector tile buffer size");}return i}function Do(t,e,i,r,a){t.emplaceBack(2*e+(r+1)/2,2*i+(a+1)/2);}var No=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new $a,this.indexArray=new Rn,this.segments=new To,this.programConfigurations=new zo(Ao,t.layers,t.zoom);};function ko(t,e){for(var i=0;i<t.length;i++)if(Ho(e,t[i]))return!0;for(var r=0;r<e.length;r++)if(Ho(t,e[r]))return!0;return!!qo(t,e)}function Bo(t,e,i){return!!Ho(t,e)||!!Go(e,t,i)}function Vo(t,e){if(1===t.length)return Yo(e,t[0]);for(var i=0;i<e.length;i++)for(var r=e[i],a=0;a<r.length;a++)if(Ho(t,r[a]))return!0;for(var n=0;n<t.length;n++)if(Yo(e,t[n]))return!0;for(var o=0;o<e.length;o++)if(qo(t,e[o]))return!0;return!1}function Uo(t,e,i){for(var r=0;r<e.length;r++){var a=e[r];if(t.length>=3)for(var n=0;n<a.length;n++)if(Ho(t,a[n]))return!0;if(jo(t,a,i))return!0}return!1}function jo(t,e,i){if(t.length>1){if(qo(t,e))return!0;for(var r=0;r<e.length;r++)if(Go(e[r],t,i))return!0}for(var a=0;a<t.length;a++)if(Go(t[a],e,i))return!0;return!1}function qo(t,e){if(0===t.length||0===e.length)return!1;for(var i=0;i<t.length-1;i++)for(var r=t[i],a=t[i+1],n=0;n<e.length-1;n++){if(Xo(r,a,e[n],e[n+1]))return!0}return!1}function Xo(t,e,i,r){return M(t,i,r)!==M(e,i,r)&&M(t,e,i)!==M(t,e,r)}function Go(t,e,i){var r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(var a=1;a<e.length;a++){if(Wo(t,e[a-1],e[a])<r)return!0}return!1}function Wo(t,e,i){var r=e.distSqr(i);if(0===r)return t.distSqr(e);var a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return a<0?t.distSqr(e):a>1?t.distSqr(i):t.distSqr(i.sub(e)._mult(a)._add(e))}function Yo(t,e){for(var i,r,a,n=!1,o=0;o<t.length;o++)for(var s=0,u=(i=t[o]).length-1;s<i.length;u=s++)r=i[s],a=i[u],r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n);return n}function Ho(t,e){for(var i=!1,r=0,a=t.length-1;r<t.length;a=r++){var n=t[r],o=t[a];n.y>e.y!=o.y>e.y&&e.x<(o.x-n.x)*(e.y-n.y)/(o.y-n.y)+n.x&&(i=!i);}return i}function Qo(t,e,i){var r=i[0],a=i[2];if(t.x<r.x&&e.x<r.x||t.x>a.x&&e.x>a.x||t.y<r.y&&e.y<r.y||t.y>a.y&&e.y>a.y)return!1;var n=M(t,e,i[0]);return n!==M(t,e,i[1])||n!==M(t,e,i[2])||n!==M(t,e,i[3])}function Zo(t,e,i){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).binders[t].statistics.max}function Jo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ko(t,e,i,r,a){if(!e[0]&&!e[1])return t;var n=p.convert(e);"viewport"===i&&n._rotate(-r);for(var o=[],s=0;s<t.length;s++){var u=t[s];o.push(u.sub(n._mult(a)));}return o}No.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}this.x=e.x,this.y=e.y,this.z=e.z;},No.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},No.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},No.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},No.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ao),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},No.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},No.prototype.addFeature=function(t,e,i){for(var r=0,a=e;r<a.length;r+=1)for(var n=0,o=a[r];n<o.length;n+=1){var s=o[n],u=s.x,l=s.y;if(!(u<.2*-io||u>=1.2*io||l<.2*-io||l>=1.2*io)){var p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),c=p.vertexLength;Do(this.layoutVertexArray,u,l,-1,-1),Do(this.layoutVertexArray,u,l,1,-1),Do(this.layoutVertexArray,u,l,1,1),Do(this.layoutVertexArray,u,l,-1,1),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),p.vertexLength+=4,p.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("CircleBucket",No,{omit:["layers"]});var $o={paint:new Ua({"circle-radius":new ka(Te.paint_circle["circle-radius"]),"circle-color":new ka(Te.paint_circle["circle-color"]),"circle-blur":new ka(Te.paint_circle["circle-blur"]),"circle-opacity":new ka(Te.paint_circle["circle-opacity"]),"circle-translate":new Na(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Na(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Na(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Na(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ka(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ka(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ka(Te.paint_circle["circle-stroke-opacity"])})},ts=1e-6,es="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function is(){var t=new es(4);return es!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function rs(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*s,t[1]=a*u+o*s,t[2]=r*-s+n*u,t[3]=a*-s+o*u,t}function as(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=i[0],u=i[1];return t[0]=r*s,t[1]=a*s,t[2]=n*u,t[3]=o*u,t}var ns=function(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=i[0],u=i[1],l=i[2],p=i[3];return t[0]=r*s+n*u,t[1]=a*s+o*u,t[2]=r*l+n*p,t[3]=a*l+o*p,t};function os(){var t=new es(9);return es!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ss(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function us(){var t=new es(16);return es!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ls(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ps(t,e){if(t===e){var i=e[1],r=e[2],a=e[3],n=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=a,t[13]=o,t[14]=s;}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function cs(t,e){var i=e[0],r=e[1],a=e[2],n=e[3],o=e[4],s=e[5],u=e[6],l=e[7],p=e[8],c=e[9],h=e[10],f=e[11],m=e[12],d=e[13],_=e[14],y=e[15],g=i*s-r*o,v=i*u-a*o,x=i*l-n*o,b=r*u-a*s,w=r*l-n*s,A=a*l-n*u,T=p*d-c*m,S=p*_-h*m,E=p*y-f*m,P=c*_-h*d,I=c*y-f*d,R=h*y-f*_,M=g*R-v*I+x*P+b*E-w*S+A*T;return M?(M=1/M,t[0]=(s*R-u*I+l*P)*M,t[1]=(a*I-r*R-n*P)*M,t[2]=(d*A-_*w+y*b)*M,t[3]=(h*w-c*A-f*b)*M,t[4]=(u*E-o*R-l*S)*M,t[5]=(i*R-a*E+n*S)*M,t[6]=(_*x-m*A-y*v)*M,t[7]=(p*A-h*x+f*v)*M,t[8]=(o*I-s*E+l*T)*M,t[9]=(r*E-i*I-n*T)*M,t[10]=(m*w-d*x+y*g)*M,t[11]=(c*x-p*w-f*g)*M,t[12]=(s*S-o*P-u*T)*M,t[13]=(i*P-r*S+a*T)*M,t[14]=(d*v-m*b-_*g)*M,t[15]=(p*b-c*v+h*g)*M,t):null}function hs(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3],s=e[4],u=e[5],l=e[6],p=e[7],c=e[8],h=e[9],f=e[10],m=e[11],d=e[12],_=e[13],y=e[14],g=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*r+x*s+b*c+w*d,t[1]=v*a+x*u+b*h+w*_,t[2]=v*n+x*l+b*f+w*y,t[3]=v*o+x*p+b*m+w*g,v=i[4],x=i[5],b=i[6],w=i[7],t[4]=v*r+x*s+b*c+w*d,t[5]=v*a+x*u+b*h+w*_,t[6]=v*n+x*l+b*f+w*y,t[7]=v*o+x*p+b*m+w*g,v=i[8],x=i[9],b=i[10],w=i[11],t[8]=v*r+x*s+b*c+w*d,t[9]=v*a+x*u+b*h+w*_,t[10]=v*n+x*l+b*f+w*y,t[11]=v*o+x*p+b*m+w*g,v=i[12],x=i[13],b=i[14],w=i[15],t[12]=v*r+x*s+b*c+w*d,t[13]=v*a+x*u+b*h+w*_,t[14]=v*n+x*l+b*f+w*y,t[15]=v*o+x*p+b*m+w*g,t}function fs(t,e,i){var r=i[0],a=i[1],n=i[2],o=void 0,s=void 0,u=void 0,l=void 0,p=void 0,c=void 0,h=void 0,f=void 0,m=void 0,d=void 0,_=void 0,y=void 0;return e===t?(t[12]=e[0]*r+e[4]*a+e[8]*n+e[12],t[13]=e[1]*r+e[5]*a+e[9]*n+e[13],t[14]=e[2]*r+e[6]*a+e[10]*n+e[14],t[15]=e[3]*r+e[7]*a+e[11]*n+e[15]):(o=e[0],s=e[1],u=e[2],l=e[3],p=e[4],c=e[5],h=e[6],f=e[7],m=e[8],d=e[9],_=e[10],y=e[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=p,t[5]=c,t[6]=h,t[7]=f,t[8]=m,t[9]=d,t[10]=_,t[11]=y,t[12]=o*r+p*a+m*n+e[12],t[13]=s*r+c*a+d*n+e[13],t[14]=u*r+h*a+_*n+e[14],t[15]=l*r+f*a+y*n+e[15]),t}function ms(t,e,i){var r=i[0],a=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ds(t,e,i){var r=Math.sin(i),a=Math.cos(i),n=e[0],o=e[1],s=e[2],u=e[3],l=e[4],p=e[5],c=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*a+l*r,t[1]=o*a+p*r,t[2]=s*a+c*r,t[3]=u*a+h*r,t[4]=l*a-n*r,t[5]=p*a-o*r,t[6]=c*a-s*r,t[7]=h*a-u*r,t}function _s(t,e,i,r,a,n,o){var s=1/(e-i),u=1/(r-a),l=1/(n-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*s,t[13]=(a+r)*u,t[14]=(o+n)*l,t[15]=1,t}var ys=hs;function gs(){var t=new es(3);return es!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function vs(t,e,i){var r=new es(3);return r[0]=t,r[1]=e,r[2]=i,r}function xs(t,e,i){var r=e[0],a=e[1],n=e[2],o=i[0],s=i[1],u=i[2];return t[0]=a*u-n*s,t[1]=n*o-r*u,t[2]=r*s-a*o,t}function bs(t,e,i){var r=e[0],a=e[1],n=e[2];return t[0]=r*i[0]+a*i[3]+n*i[6],t[1]=r*i[1]+a*i[4]+n*i[7],t[2]=r*i[2]+a*i[5]+n*i[8],t}var ws=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)};!function(){var t=gs();}();function As(t,e,i){var r=e[0],a=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*a+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*a+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*a+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*a+i[11]*n+i[15]*o,t}!function(){var t,e=(t=new es(4),es!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t);}();function Ts(){var t=new es(4);return es!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ss(t,e,i,r){var a=e[0],n=e[1],o=e[2],s=e[3],u=i[0],l=i[1],p=i[2],c=i[3],h=void 0,f=void 0,m=void 0,d=void 0,_=void 0;return(f=a*u+n*l+o*p+s*c)<0&&(f=-f,u=-u,l=-l,p=-p,c=-c),1-f>ts?(h=Math.acos(f),m=Math.sin(h),d=Math.sin((1-r)*h)/m,_=Math.sin(r*h)/m):(d=1-r,_=r),t[0]=d*a+_*u,t[1]=d*n+_*l,t[2]=d*o+_*p,t[3]=d*s+_*c,t}var Es=function(t,e){var i=e[0],r=e[1],a=e[2],n=e[3],o=i*i+r*r+a*a+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=a*o,t[3]=n*o),t};(function(){var t=gs(),e=vs(1,0,0),i=vs(0,1,0);})(),function(){var t=Ts(),e=Ts();}(),function(){var t=os();}();!function(){var t,e=(t=new es(2),es!=Float32Array&&(t[0]=0,t[1]=0),t);}();var Ps=function(t){function e(e){t.call(this,e,$o);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new No(t)},e.prototype.queryRadius=function(t){var e=t;return Zo("circle-radius",this,e)+Zo("circle-stroke-width",this,e)+Jo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o,s){for(var u=Ko(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),n.angle,o),l=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),p="map"===this.paint.get("circle-pitch-alignment"),c=p?u:function(t,e){return t.map(function(t){return Is(t,e)})}(u,s),h=p?l*o:l,f=0,m=r;f<m.length;f+=1)for(var d=0,_=m[f];d<_.length;d+=1){var y=_[d],g=p?y:Is(y,s),v=h,x=As([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=x[3]/n.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=n.cameraToCenterDistance/x[3]),Bo(c,g,v))return!0}return!1},e}(wo);function Is(t,e){var i=As([],[t.x,t.y,0,1],e);return new p(i[0]/i[3],i[1]/i[3])}function Rs(t,e,i,r,a){t.emplaceBack(2*e+(r+1)/2,2*i+(a+1)/2);}var Ms=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new $a,this.indexArray=new Rn,this.segments=new To,this.programConfigurations=new zo(Ao,t.layers,t.zoom);};function zs(t,e,i,r){var a=e.width,n=e.height;if(r){if(r.length!==a*n*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(a*n*i);return t.width=a,t.height=n,t.data=r,t}function Cs(t,e,i){var r=e.width,a=e.height;if(r!==t.width||a!==t.height){var n=zs({},{width:r,height:a},i);Os(t,n,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,a)},i),t.width=r,t.height=a,t.data=n.data;}}function Os(t,e,i,r,a,n){if(0===a.width||0===a.height)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,u=0;u<a.height;u++)for(var l=((i.y+u)*t.width+i.x)*n,p=((r.y+u)*e.width+r.x)*n,c=0;c<a.width*n;c++)s[p+c]=o[l+c];return e}Ms.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}this.x=e.x,this.y=e.y,this.z=e.z;},Ms.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Ms.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ms.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ms.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ao),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Ms.prototype.addFeature=function(t,e,i){for(var r=0,a=e;r<a.length;r+=1)for(var n=0,o=a[r];n<o.length;n+=1){var s=o[n],u=s.x,l=s.y;if(!(u<0||u>=io||l<0||l>=io)){var p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),c=p.vertexLength;Rs(this.layoutVertexArray,u,l,-1,-1),Rs(this.layoutVertexArray,u,l,1,-1),Rs(this.layoutVertexArray,u,l,1,1),Rs(this.layoutVertexArray,u,l,-1,1),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),p.vertexLength+=4,p.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("HeatmapBucket",Ms,{omit:["layers"]});var Fs=function(t,e){zs(this,t,1,e);};Fs.prototype.resize=function(t){Cs(this,t,1);},Fs.prototype.clone=function(){return new Fs({width:this.width,height:this.height},new Uint8Array(this.data))},Fs.copy=function(t,e,i,r,a){Os(t,e,i,r,a,1);};var Ls=function(t,e){zs(this,t,4,e);};Ls.prototype.resize=function(t){Cs(this,t,4);},Ls.prototype.clone=function(){return new Ls({width:this.width,height:this.height},new Uint8Array(this.data))},Ls.copy=function(t,e,i,r,a){Os(t,e,i,r,a,4);},ca("AlphaImage",Fs),ca("RGBAImage",Ls);var Ds={paint:new Ua({"heatmap-radius":new ka(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ka(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Na(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Va(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Na(Te.paint_heatmap["heatmap-opacity"])})};function Ns(t,e){for(var i=new Uint8Array(1024),r={},a=0,n=0;a<256;a++,n+=4){r[e]=a/255;var o=t.evaluate(r);i[n+0]=Math.floor(255*o.r/o.a),i[n+1]=Math.floor(255*o.g/o.a),i[n+2]=Math.floor(255*o.b/o.a),i[n+3]=Math.floor(255*o.a);}return new Ls({width:256,height:1},i)}var ks=function(t){function e(e){t.call(this,e,Ds),this._updateColorRamp();}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Ms(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp();},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Ns(t,"heatmapDensity"),this.colorRampTexture=null;},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(wo),Bs={paint:new Ua({"hillshade-illumination-direction":new Na(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Na(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Na(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Na(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Na(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Na(Te.paint_hillshade["hillshade-accent-color"])})},Vs=function(t){function e(e){t.call(this,e,Bs);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(wo),Us=Ja([{name:"a_pos",components:3,type:"Int16"}],4).members,js=Xs,qs=Xs;function Xs(t,e,i){i=i||2;var r,a,n,o,s,u,l,p=e&&e.length,c=p?e[0]*i:t.length,h=Gs(t,0,c,i,!0),f=[];if(!h||h.next===h.prev)return f;if(p&&(h=function(t,e,i,r){var a,n,o,s,u,l=[];for(a=0,n=e.length;a<n;a++)o=e[a]*r,s=a<n-1?e[a+1]*r:t.length,(u=Gs(t,o,s,r,!1))===u.next&&(u.steiner=!0),l.push(iu(u));for(l.sort(Ks),a=0;a<l.length;a++)$s(l[a],i),i=Ws(i,i.next);return i}(t,e,h,i)),t.length>80*i){r=n=t[0],a=o=t[1];for(var m=i;m<c;m+=i)s=t[m],u=t[m+1],s<r&&(r=s),u<a&&(a=u),s>n&&(n=s),u>o&&(o=u);l=0!==(l=Math.max(n-r,o-a))?1/l:0;}return Ys(h,f,i,r,a,l),f}function Gs(t,e,i,r,a){var n,o;if(a===du(t,e,i,r)>0)for(n=e;n<i;n+=r)o=hu(n,t[n],t[n+1],o);else for(n=i-r;n>=e;n-=r)o=hu(n,t[n],t[n+1],o);return o&&ou(o,o.next)&&(fu(o),o=o.next),o}function Ws(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!ou(r,r.next)&&0!==nu(r.prev,r,r.next))r=r.next;else{if(fu(r),(r=e=r.prev)===r.next)break;i=!0;}}while(i||r!==e);return e}function Ys(t,e,i,r,a,n,o){if(t){!o&&n&&function(t,e,i,r){var a=t;do{null===a.z&&(a.z=eu(a.x,a.y,e,i,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;}while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,function(t){var e,i,r,a,n,o,s,u,l=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,r=i,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||i.z<=r.z)?(a=i,i=i.nextZ,s--):(a=r,r=r.nextZ,u--),n?n.nextZ=a:t=a,a.prevZ=n,n=a;i=r;}n.nextZ=null,l*=2;}while(o>1)}(a);}(t,r,a,n);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,n?Qs(t,r,a,n):Hs(t))e.push(s.i/i),e.push(t.i/i),e.push(u.i/i),fu(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Ys(t=Zs(Ws(t),e,i),e,i,r,a,n,2):2===o&&Js(t,e,i,r,a,n):Ys(Ws(t),e,i,r,a,n,1);break}}}function Hs(t){var e=t.prev,i=t,r=t.next;if(nu(e,i,r)>=0)return!1;for(var a=t.next.next;a!==t.prev;){if(ru(e.x,e.y,i.x,i.y,r.x,r.y,a.x,a.y)&&nu(a.prev,a,a.next)>=0)return!1;a=a.next;}return!0}function Qs(t,e,i,r){var a=t.prev,n=t,o=t.next;if(nu(a,n,o)>=0)return!1;for(var s=a.x<n.x?a.x<o.x?a.x:o.x:n.x<o.x?n.x:o.x,u=a.y<n.y?a.y<o.y?a.y:o.y:n.y<o.y?n.y:o.y,l=a.x>n.x?a.x>o.x?a.x:o.x:n.x>o.x?n.x:o.x,p=a.y>n.y?a.y>o.y?a.y:o.y:n.y>o.y?n.y:o.y,c=eu(s,u,e,i,r),h=eu(l,p,e,i,r),f=t.prevZ,m=t.nextZ;f&&f.z>=c&&m&&m.z<=h;){if(f!==t.prev&&f!==t.next&&ru(a.x,a.y,n.x,n.y,o.x,o.y,f.x,f.y)&&nu(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,m!==t.prev&&m!==t.next&&ru(a.x,a.y,n.x,n.y,o.x,o.y,m.x,m.y)&&nu(m.prev,m,m.next)>=0)return!1;m=m.nextZ;}for(;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&ru(a.x,a.y,n.x,n.y,o.x,o.y,f.x,f.y)&&nu(f.prev,f,f.next)>=0)return!1;f=f.prevZ;}for(;m&&m.z<=h;){if(m!==t.prev&&m!==t.next&&ru(a.x,a.y,n.x,n.y,o.x,o.y,m.x,m.y)&&nu(m.prev,m,m.next)>=0)return!1;m=m.nextZ;}return!0}function Zs(t,e,i){var r=t;do{var a=r.prev,n=r.next.next;!ou(a,n)&&su(a,r,r.next,n)&&pu(a,n)&&pu(n,a)&&(e.push(a.i/i),e.push(r.i/i),e.push(n.i/i),fu(r),fu(r.next),r=t=n),r=r.next;}while(r!==t);return Ws(r)}function Js(t,e,i,r,a,n){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&au(o,s)){var u=cu(o,s);return o=Ws(o,o.next),u=Ws(u,u.next),Ys(o,e,i,r,a,n),void Ys(u,e,i,r,a,n)}s=s.next;}o=o.next;}while(o!==t)}function Ks(t,e){return t.x-e.x}function $s(t,e){if(e=function(t,e){var i,r=e,a=t.x,n=t.y,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var s=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=a&&s>o){if(o=s,s===a){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next;}}r=r.next;}while(r!==e);if(!i)return null;if(a===o)return i;var u,l=i,p=i.x,c=i.y,h=1/0;r=i;do{a>=r.x&&r.x>=p&&a!==r.x&&ru(n<c?a:o,n,p,c,n<c?o:a,n,r.x,r.y)&&(u=Math.abs(n-r.y)/(a-r.x),pu(r,t)&&(u<h||u===h&&(r.x>i.x||r.x===i.x&&tu(i,r)))&&(i=r,h=u)),r=r.next;}while(r!==l);return i}(t,e)){var i=cu(e,t);Ws(i,i.next);}}function tu(t,e){return nu(t.prev,t,e.prev)<0&&nu(e.next,t,t.next)<0}function eu(t,e,i,r,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function iu(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;}while(e!==t);return i}function ru(t,e,i,r,a,n,o,s){return(a-o)*(e-s)-(t-o)*(n-s)>=0&&(t-o)*(r-s)-(i-o)*(e-s)>=0&&(i-o)*(n-s)-(a-o)*(r-s)>=0}function au(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&su(i,i.next,t,e))return!0;i=i.next;}while(i!==t);return!1}(t,e)&&(pu(t,e)&&pu(e,t)&&function(t,e){var i=t,r=!1,a=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&a<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;}while(i!==t);return r}(t,e)&&(nu(t.prev,t,e.prev)||nu(t,e.prev,e))||ou(t,e)&&nu(t.prev,t,t.next)>0&&nu(e.prev,e,e.next)>0)}function nu(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ou(t,e){return t.x===e.x&&t.y===e.y}function su(t,e,i,r){var a=lu(nu(t,e,i)),n=lu(nu(t,e,r)),o=lu(nu(i,r,t)),s=lu(nu(i,r,e));return a!==n&&o!==s||(!(0!==a||!uu(t,i,e))||(!(0!==n||!uu(t,r,e))||(!(0!==o||!uu(i,t,r))||!(0!==s||!uu(i,e,r)))))}function uu(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function lu(t){return t>0?1:t<0?-1:0}function pu(t,e){return nu(t.prev,t,t.next)<0?nu(t,e,t.next)>=0&&nu(t,t.prev,e)>=0:nu(t,e,t.prev)<0||nu(t,t.next,e)<0}function cu(t,e){var i=new mu(t.i,t.x,t.y),r=new mu(e.i,e.x,e.y),a=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function hu(t,e,i,r){var a=new mu(t,e,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function fu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function mu(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function du(t,e,i,r){for(var a=0,n=e,o=i-r;n<i;n+=r)a+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return a}Xs.deviation=function(t,e,i,r){var a=e&&e.length,n=a?e[0]*i:t.length,o=Math.abs(du(t,0,n,i));if(a)for(var s=0,u=e.length;s<u;s++){var l=e[s]*i,p=s<u-1?e[s+1]*i:t.length;o-=Math.abs(du(t,l,p,i));}var c=0;for(s=0;s<r.length;s+=3){var h=r[s]*i,f=r[s+1]*i,m=r[s+2]*i;c+=Math.abs((t[h]-t[m])*(t[f+1]-t[h+1])-(t[h]-t[f])*(t[m+1]-t[h+1]));}return 0===o&&0===c?0:Math.abs((c-o)/o)},Xs.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,a=0;a<t.length;a++){for(var n=0;n<t[a].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[a][n][o]);a>0&&(r+=t[a-1].length,i.holes.push(r));}return i},js.default=qs;var _u=e(function(t,e){t.exports=function(){function t(t,e,i){var r=t[e];t[e]=t[i],t[i]=r;}function e(t,e){return t<e?-1:t>e?1:0}return function(i,r,a,n,o){!function e(i,r,a,n,o){for(;n>a;){if(n-a>600){var s=n-a+1,u=r-a+1,l=Math.log(s),p=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*p*(s-p)/s)*(u-s/2<0?-1:1),h=Math.max(a,Math.floor(r-u*p/s+c)),f=Math.min(n,Math.floor(r+(s-u)*p/s+c));e(i,r,h,f,o);}var m=i[r],d=a,_=n;for(t(i,a,r),o(i[n],m)>0&&t(i,a,n);d<_;){for(t(i,d,_),d++,_--;o(i[d],m)<0;)d++;for(;o(i[_],m)>0;)_--;}0===o(i[a],m)?t(i,a,_):t(i,++_,n),_<=r&&(a=_+1),r<=_&&(n=_-1);}}(i,r,a||0,n||i.length-1,o||e);}}();});function yu(t,e){var i=t.length;if(i<=1)return[t];for(var r,a,n=[],o=0;o<i;o++){var s=z(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===a&&(a=s<0),a===s<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]));}if(r&&n.push(r),e>1)for(var u=0;u<n.length;u++)n[u].length<=e||(_u(n[u],e,1,n[u].length-1,gu),n[u]=n[u].slice(0,e));return n}function gu(t,e){return e.area-t.area}var vu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new an,this.indexArray=new Rn,this.indexArray2=new Mn,this.programConfigurations=new zo(Us,t.layers,t.zoom),this.segments=new To,this.segments2=new To;};vu.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},vu.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},vu.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},vu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},vu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Us),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0;},vu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());},vu.prototype.addFeature=function(t,e,i){for(var r=0,a=yu(e,500);r<a.length;r+=1){for(var n=a[r],o=0,s=0,u=n;s<u.length;s+=1){o+=u[s].length;}for(var l=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),p=l.vertexLength,c=[],h=[],f=0,m=n;f<m.length;f+=1){var d=m[f];if(0!==d.length){d!==n[0]&&h.push(c.length/2);var _=this.segments2.prepareSegment(d.length,this.layoutVertexArray,this.indexArray2),y=_.vertexLength,g=d[0].x>32767||d[0].x;g=d[0].x<-32768?-32768:d[0].x;var v=d[0].y>32767||d[0].y;v=d[0].y<-32768?-32768:d[0].y;var x=null!==t.properties&&void 0!==t.properties&&t.properties.hasOwnProperty("levels")?10*Number(t.properties.levels):d[0].z;this.layoutVertexArray.emplaceBack(g,v,0!==x?x-500:0),this.indexArray2.emplaceBack(y+d.length-1,y),c.push(d[0].x),c.push(d[0].y);for(var b=1;b<d.length;b++){var w=d[b].x>32767||d[b].x;w=d[b].x<-32768?-32768:d[b].x;var A=d[b].y>32767||d[b].y;A=d[b].y<-32768?-32768:d[b].y;var T=null!==t.properties&&void 0!==t.properties&&t.properties.hasOwnProperty("levels")?10*Number(t.properties.levels):d[b].z;this.layoutVertexArray.emplaceBack(w,A,0!==T?T-500:0),this.indexArray2.emplaceBack(y+b-1,y+b),c.push(d[b].x),c.push(d[b].y);}_.vertexLength+=d.length,_.primitiveLength+=d.length;}}for(var S=js(c,h),E=0;E<S.length;E+=3)this.indexArray.emplaceBack(p+S[E],p+S[E+1],p+S[E+2]);l.vertexLength+=o,l.primitiveLength+=S.length/3;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("FillBucket",vu,{omit:["layers"]});var xu={paint:new Ua({"fill-antialias":new Na(Te.paint_fill["fill-antialias"]),"fill-opacity":new ka(Te.paint_fill["fill-opacity"]),"fill-color":new ka(Te.paint_fill["fill-color"]),"fill-outline-color":new ka(Te.paint_fill["fill-outline-color"]),"fill-translate":new Na(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Na(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ba(Te.paint_fill["fill-pattern"]),"fill-water":new Na(Te.paint_fill["fill-water"]),"render-3d":new Na(Te.paint_fill["render-3d"])})},bu=function(t){function e(e){t.call(this,e,xu);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(t){this.paint=this._transitioningPaint.possiblyEvaluate(t);var e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"]);},e.prototype.createBucket=function(t){return new vu(t)},e.prototype.queryRadius=function(){return Jo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){return Vo(Ko(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),n.angle,o),r)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility},e}(wo),wu=Ja([{name:"a_pos",components:3,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Au=Math.pow(2,13);function Tu(t,e,i,r,a,n,o,s,u){t.emplaceBack(e,i,u-500,2*Math.floor(r*Au)+o,a*Au*2,n*Au*2,Math.round(s));}var Su=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new nn,this.indexArray=new Rn,this.programConfigurations=new zo(wu,t.layers,t.zoom),this.segments=new To;};function Eu(t,e){return t.x===e.x&&(t.x<0||t.x>io)||t.y===e.y&&(t.y<0||t.y>io)}function Pu(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>io})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>io})}Su.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index,!0);}}},Su.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Su.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Su.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Su.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Su.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Su.prototype.addFeature=function(t,e,i){for(var r=0,a=yu(e,500);r<a.length;r+=1){for(var n=a[r],o=0,s=0,u=n;s<u.length;s+=1){o+=u[s].length;}for(var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,c=n;p<c.length;p+=1){var h=c[p];if(0!==h.length&&!Pu(h))for(var f=0,m=0;m<h.length;m++){var d=h[m];if(m>=1){var _=h[m-1];if(!Eu(d,_)){l.vertexLength+4>To.MAX_VERTEX_ARRAY_LENGTH&&(l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=d.sub(_)._perp()._unit(),g=_.dist(d);f+g>32768&&(f=0),Tu(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,f,d.z),Tu(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,f,d.z),f+=g,Tu(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,0,f,d.z),Tu(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,1,f,d.z);var v=l.vertexLength;this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v+1,v+2,v+3),l.vertexLength+=4,l.primitiveLength+=2;}}}}l.vertexLength+o>To.MAX_VERTEX_ARRAY_LENGTH&&(l=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray));for(var x=[],b=[],w=l.vertexLength,A=0,T=n;A<T.length;A+=1){var S=T[A];if(0!==S.length){S!==n[0]&&b.push(x.length/2);for(var E=0;E<S.length;E++){var P=S[E];Tu(this.layoutVertexArray,P.x,P.y,0,0,1,1,0,P.z),x.push(P.x),x.push(P.y);}}}for(var I=js(x,b),R=0;R<I.length;R+=3)this.indexArray.emplaceBack(w+I[R],w+I[R+1],w+I[R+2]);l.primitiveLength+=I.length/3,l.vertexLength+=o;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("FillExtrusionBucket",Su,{omit:["layers"]});var Iu={paint:new Ua({"extrusion-opacity":new Na(Te.paint_extrusion["extrusion-opacity"]),"extrusion-color":new ka(Te.paint_extrusion["extrusion-color"]),"extrusion-translate":new Na(Te.paint_extrusion["extrusion-translate"]),"extrusion-translate-anchor":new Na(Te.paint_extrusion["extrusion-translate-anchor"]),"extrusion-pattern":new Ba(Te.paint_extrusion["extrusion-pattern"]),"extrusion-height":new ka(Te.paint_extrusion["extrusion-height"]),"extrusion-base":new ka(Te.paint_extrusion["extrusion-base"]),"render-road":new Na(Te.paint_extrusion["render-road"])})},Ru=function(t){function e(e){t.call(this,e,Iu);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Su(t)},e.prototype.queryRadius=function(){return Jo(this.paint.get("extrusion-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o,s){var u=Ko(t,this.paint.get("extrusion-translate"),this.paint.get("extrusion-translate-anchor"),n.angle,o),l=this.paint.get("extrusion-height").evaluate(e,i),c=this.paint.get("extrusion-base").evaluate(e,i),h=function(t,e,i,r){for(var a=[],n=0,o=t;n<o.length;n+=1){var s=o[n],u=[s.x,s.y,r,1];qt(u,u,e),a.push(new p(u[0]/u[3],u[1]/u[3]));}return a}(u,s,0,0),f=function(t,e,i,r){for(var a=[],n=[],o=r[8]*e,s=r[9]*e,u=r[10]*e,l=r[11]*e,c=r[8]*i,h=r[9]*i,f=r[10]*i,m=r[11]*i,d=0,_=t;d<_.length;d+=1){for(var y=_[d],g=[],v=[],x=0,b=y;x<b.length;x+=1){var w=b[x],A=w.x,T=w.y,S=r[0]*A+r[4]*T+r[12],E=r[1]*A+r[5]*T+r[13],P=r[2]*A+r[6]*T+r[14],I=r[3]*A+r[7]*T+r[15],R=S+o,M=E+s,z=P+u,C=I+l,O=S+c,F=E+h,L=P+f,D=I+m,N=new p(R/C,M/C);N.z=z/C,g.push(N);var k=new p(O/D,F/D);k.z=L/D,v.push(k);}a.push(g),n.push(v);}return[a,n]}(r,c,l,s);return function(t,e,i){var r=1/0;Vo(i,e)&&(r=zu(i,e[0]));for(var a=0;a<e.length;a++)for(var n=e[a],o=t[a],s=0;s<n.length-1;s++){var u=n[s],l=n[s+1],p=o[s],c=o[s+1],h=[u,l,c,p,u];ko(i,h)&&(r=Math.min(r,zu(i,h)));}return r!==1/0&&r}(f[0],f[1],h)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);},e}(wo);function Mu(t,e){return t.x*e.x+t.y*e.y}function zu(t,e){if(1===t.length){var i=e[0],r=e[1],a=e[3],n=t[0],o=r.sub(i),s=a.sub(i),u=n.sub(i),l=Mu(o,o),p=Mu(o,s),c=Mu(s,s),h=Mu(u,o),f=Mu(u,s),m=l*c-p*p,d=(c*h-p*f)/m,_=(l*f-p*h)/m,y=1-d-_;return i.z*y+r.z*d+a.z*_}for(var g=1/0,v=0,x=e;v<x.length;v+=1){var b=x[v];g=Math.min(g,b.z);}return g}var Cu=Ja([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_ext",components:2,type:"Uint16"}],4).members,Ou=Fu;function Fu(t,e,i,r,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=a,this._version=arguments[5],this._projection=t.projection||"MERCATOR",this.projObj=Ya(this._projection),t.readFields(Lu,this,e);}function Lu(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){var i=t.readVarint()+t.pos;for(;t.pos<i;){var r=e._keys[t.readVarint()],a=e._values[t.readVarint()];e.properties[r]=a;}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos);}function Du(t){for(var e,i,r=0,a=0,n=t.length,o=n-1;a<n;o=a++)e=t[a],r+=((i=t[o]).x-e.x)*(e.y+i.y);return r}Fu.types=["Unknown","Point","LineString","Polygon"],Fu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,a=0,n=0,o=0,s=0,u=[];t.pos<i;){if(a<=0){var l=t.readVarint();r=7&l,a=l>>3;}if(a--,1===r||2===r)n+=t.readSVarint(),o+=t.readSVarint(),this._version>100&&(s+=t.readSVarint()),1===r&&(e&&u.push(e),e=[]),e.push(new p(n,o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone());}}return e&&u.push(e),u},Fu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,a=0,n=0,o=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var p=t.readVarint();i=7&p,r=p>>3;}if(r--,1===i||2===i)a+=t.readSVarint(),n+=t.readSVarint(),a<o&&(o=a),a>s&&(s=a),n<u&&(u=n),n>l&&(l=n);else if(7!==i)throw new Error("unknown command "+i)}return[o,u,s,l]},Fu.prototype.toGeoJSON=function(t,e,i){var r,a,n=this.extent*Math.pow(2,i),o=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=Fu.types[this.type],p=this;function c(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[p.projObj.xLng(i.x+o,n),p.projObj.yLat(i.y+s,n)];}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,a=[],n=0;n<e;n++){var o=Du(t[n]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&a.push(i),i=[t[n]]):i.push(t[n]));}i&&a.push(i);return a}(u),r=0;r<u.length;r++)for(a=0;a<u[r].length;a++)c(u[r][a]);}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Nu=ku;function ku(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Bu,this,e),this.length=this._features.length;}function Bu(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){var e=null,i=t.readVarint()+t.pos;for(;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null;}return e}(i));}function Vu(t,e,i){if(3===t){var r=new Nu(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r);}}ku.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Ou(this._pbf,e,this.extent,this._keys,this._values,this.version)};var Uu={VectorTile:function(t,e,i){t.projection=i,this.layers=t.readFields(Vu,{},e);},VectorTileFeature:Ou,VectorTileLayer:Nu},ju=Uu.VectorTileFeature.types,qu=63,Xu=0,Gu=0,Wu=Math.cos(Math.PI/180*37.5),Yu=.5,Hu=Math.pow(2,14)/Yu;function Qu(t,e,i,r,a,n,o){t.emplaceBack(e.x,e.y,r?1:0,a?1:-1,Math.round(qu*i.x)+128,Math.round(qu*i.y)+128,1+(0===n?0:n<0?-1:1)|(o*Yu&63)<<2,o*Yu>>6,Number(Xu)>0?50*Number(Xu):e.z-500<0?5:e.z-500+5,Gu);}var Zu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new on,this.indexArray=new Rn,this.programConfigurations=new zo(Cu,t.layers,t.zoom),this.segments=new To;};function Ju(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(Hu-1)}Zu.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},Zu.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Zu.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Zu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Zu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Zu.prototype.addFeature=function(t,e,i){var r=this.layers[0].layout,a=r.get("line-join").evaluate(t,{}),n=r.get("line-cap"),o=r.get("line-miter-limit"),s=r.get("line-round-limit");Xu=null!==t.properties&&t.properties.hasOwnProperty("ELEV")?t.properties.ELEV:0;for(var u=0,l=e;u<l.length;u+=1){var p=l[u];this.addLine(p,t,a,n,o,s,i);}},Zu.prototype.addLine=function(t,e,i,r,a,n,o){var s=null;e.properties&&e.properties.hasOwnProperty("minemap_clip_start")&&e.properties.hasOwnProperty("minemap_clip_end")&&(s={start:e.properties.minemap_clip_start,end:e.properties.minemap_clip_end,tileTotal:void 0});for(var u="Polygon"===ju[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var p=0;p<l-1&&t[p].equals(t[p+1]);)p++;if(!(l<(u?3:2))){s&&(s.tileTotal=function(t,e,i){for(var r,a,n=0,o=e;o<i-1;o++)r=t[o],a=t[o+1],n+=r.dist(a);return n}(t,p,l)),"bevel"===i&&(a=1.05);var c=io/(512*this.overscaling)*15,h=t[p],f=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);this.distance=0;var m,d,_,y=r,g=u?"butt":r,v=!0,x=void 0,b=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(m=t[l-2],A=h.sub(m)._unit()._perp());for(var T=p;T<l;T++)if(Gu=T/l*1e3,!(b=u&&T===l-1?t[p+1]:t[T+1])||!t[T].equals(b)){A&&(w=A),m&&(x=m),m=t[T],A=b?b.sub(m)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var E=S.x*A.x+S.y*A.y,P=0!==E?1/E:1/0,I=E<Wu&&x&&b;if(I&&T>p){var R=m.dist(x);if(R>2*c){var M=m.sub(m.sub(x)._mult(c/R)._round());this.distance+=M.dist(x),this.addCurrentVertex(M,this.distance,w.mult(1),0,0,!1,f,s),x=M;}}var z=x&&b,C=z?i:b?y:g;if(z&&"round"===C&&(P<n?C="miter":P<=2&&(C="fakeround")),"miter"===C&&P>a&&(C="bevel"),"bevel"===C&&(P>2&&(C="flipbevel"),P<a&&(C="miter")),x&&(this.distance+=m.dist(x)),"miter"===C)S._mult(P),this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s);else if("flipbevel"===C){if(P>100)S=A.clone().mult(-1);else{var O=w.x*A.y-w.y*A.x>0?-1:1,F=P*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(F*O);}this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,S.mult(-1),0,0,!1,f,s);}else if("bevel"===C||"fakeround"===C){var L=w.x*A.y-w.y*A.x>0,D=-Math.sqrt(P*P-1);if(L?(_=0,d=D):(d=0,_=D),v||this.addCurrentVertex(m,this.distance,w,d,_,!1,f,s),"fakeround"===C){for(var N=Math.floor(8*(.5-(E-.5))),k=void 0,B=0;B<N;B++)k=A.mult((B+1)/(N+1))._add(w)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);this.addPieSliceVertex(m,this.distance,S,L,f,s);for(var V=N-1;V>=0;V--)k=w.mult((V+1)/(N+1))._add(A)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);}b&&this.addCurrentVertex(m,this.distance,A,-d,-_,!1,f,s);}else"butt"===C?(v||this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),b&&this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)):"square"===C?(v||(this.addCurrentVertex(m,this.distance,w,1,1,!1,f,s),this.e1=this.e2=-1),b&&this.addCurrentVertex(m,this.distance,A,-1,-1,!1,f,s)):"round"===C&&(v||(this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,w,1,1,!0,f,s),this.e1=this.e2=-1),b&&(this.addCurrentVertex(m,this.distance,A,-1,-1,!0,f,s),this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)));if(I&&T<l-1){var U=m.dist(b);if(U>2*c){var j=m.add(b.sub(m)._mult(c/U)._round());this.distance+=j.dist(m),this.addCurrentVertex(j,this.distance,A.mult(1),0,0,!1,f,s),m=j;}}v=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},Zu.prototype.addCurrentVertex=function(t,e,i,r,a,n,o,s){var u,l=this.layoutVertexArray,p=this.indexArray;s&&(e=Ju(e,s)),u=i.clone(),r&&u._sub(i.perp()._mult(r)),Qu(l,t,u,n,!1,r,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=i.mult(-1),a&&u._sub(i.perp()._mult(a)),Qu(l,t,u,n,!0,-a,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Hu/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,a,n,o));},Zu.prototype.addPieSliceVertex=function(t,e,i,r,a,n){i=i.mult(r?-1:1);var o=this.layoutVertexArray,s=this.indexArray;n&&(e=Ju(e,n)),Qu(o,t,i,!1,r,0,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;},ca("LineBucket",Zu,{omit:["layers"]});var Ku=new Ua({"line-cap":new Na(Te.layout_line["line-cap"]),"line-join":new ka(Te.layout_line["line-join"]),"line-miter-limit":new Na(Te.layout_line["line-miter-limit"]),"line-round-limit":new Na(Te.layout_line["line-round-limit"]),"border-visibility":new Na(Te.layout_line["border-visibility"])}),$u={paint:new Ua({"line-opacity":new ka(Te.paint_line["line-opacity"]),"line-color":new ka(Te.paint_line["line-color"]),"line-translate":new Na(Te.paint_line["line-translate"]),"line-translate-anchor":new Na(Te.paint_line["line-translate-anchor"]),"line-width":new ka(Te.paint_line["line-width"]),"line-border-width":new ka(Te.paint_line["line-border-width"]),"line-border-opacity":new ka(Te.paint_line["line-border-opacity"]),"line-border-color":new ka(Te.paint_line["line-border-color"]),"line-gap-width":new ka(Te.paint_line["line-gap-width"]),"line-offset":new ka(Te.paint_line["line-offset"]),"line-blur":new ka(Te.paint_line["line-blur"]),"line-dasharray":new Ba(Te.paint_line["line-dasharray"]),"line-pattern":new Ba(Te.paint_line["line-pattern"]),"line-gradient":new Va(Te.paint_line["line-gradient"]),"render-3d":new Na(Te.paint_line["render-3d"])}),layout:Ku},tl=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new Ia(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r,a){return i=v({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r,a)},e}(ka))($u.paint.properties["line-width"].specification);tl.useIntegerZoom=!0;var el=function(t){function e(e){t.call(this,e,$u);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient();},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Ns(t,"lineProgress"),this.gradientTexture=null;},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=tl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e);},e.prototype.createBucket=function(t){return new Zu(t)},e.prototype.queryRadius=function(t){var e=t,i=il(Zo("line-width",this,e),Zo("line-gap-width",this,e)),r=Zo("line-offset",this,e);return i/2+Math.abs(r)+Jo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){var s=Ko(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),n.angle,o),u=o/2*il(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),l=this.paint.get("line-offset").evaluate(e,i);return l&&(r=function(t,e){for(var i=[],r=new p(0,0),a=0;a<t.length;a++){for(var n=t[a],o=[],s=0;s<n.length;s++){var u=n[s-1],l=n[s],c=n[s+1],h=0===s?r:l.sub(u)._unit()._perp(),f=s===n.length-1?r:c.sub(l)._unit()._perp(),m=h._add(f)._unit(),d=m.x*f.x+m.y*f.y;m._mult(1/d),o.push(m._mult(e)._add(l));}i.push(o);}return i}(r,l*o)),Uo(s,r,u)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility},e}(wo);function il(t,e){return e>0?e+2*t:t}var rl=Ja([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_height",components:1,type:"Uint16"}]),al=Ja([{name:"a_projected_pos",components:3,type:"Float32"}],4),nl=(Ja([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ja([{name:"a_placed",components:2,type:"Uint8"}],4)),ol=(Ja([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Ja([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),sl=Ja([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);Ja([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),Ja([{type:"Float32",name:"offsetX"}]),Ja([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);function ul(t,e,i){var r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),Pa.applyArabicShaping&&(t=Pa.applyArabicShaping(t)),t}function ll(t){var e={},i={},r=[],a=0;function n(e){r.push(t[e]),a++;}function o(t,e,a){var n=i[t];return delete i[t],i[e]=n,r[n].geometry[0].pop(),r[n].geometry[0]=r[n].geometry[0].concat(a[0]),n}function s(t,i,a){var n=e[i];return delete e[i],e[t]=n,r[n].geometry[0].shift(),r[n].geometry[0]=a[0].concat(r[n].geometry[0]),n}function u(t,e,i){var r=i?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var l=0;l<t.length;l++){var p=t[l],c=p.geometry,h=p.text;if(h){var f=u(h,c),m=u(h,c,!0);if(f in i&&m in e&&i[f]!==e[m]){var d=s(f,m,c),_=o(f,m,r[d].geometry);delete e[f],delete i[m],i[u(h,r[_].geometry,!0)]=_,r[d].geometry=null;}else f in i?o(f,m,c):m in e?s(f,m,c):(n(l),e[f]=a-1,i[m]=a-1);}else n(l);}return r.filter(function(t){return t.geometry})}var pl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var cl=function(t){function e(e,i,r,a){t.call(this,e,i),this.angle=r,void 0!==a&&(this.segment=a);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(p);function hl(t,e){var i=e.expression;if("constant"===i.kind)return{functionType:"constant",layoutSize:i.evaluate(new Ia(t+1))};if("source"===i.kind)return{functionType:"source"};for(var r=i.zoomStops,a=0;a<r.length&&r[a]<=t;)a++;for(var n=a=Math.max(0,a-1);n<r.length&&r[n]<t+1;)n++;n=Math.min(r.length-1,n);var o={min:r[a],max:r[n]};return"composite"===i.kind?{functionType:"composite",zoomRange:o,propertyValue:e.value}:{functionType:"camera",layoutSize:i.evaluate(new Ia(t+1)),zoomRange:o,sizeRange:{min:i.evaluate(new Ia(o.min)),max:i.evaluate(new Ia(o.max))},propertyValue:e.value}}function fl(t,e,i){var r=e;return"source"===t.functionType?i.lowerSize/10:"composite"===t.functionType?di(i.lowerSize/10,i.upperSize/10,r.uSizeT):r.uSize}function ml(t,e,i){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var r=t.propertyValue,a=t.zoomRange,n=t.sizeRange,o=_(Ar(r,i.specification).interpolationFactor(e,a.min,a.max),0,1);return{uSizeT:0,uSize:n.min+o*(n.max-n.min)}}var s=t.propertyValue,u=t.zoomRange;return{uSizeT:_(Ar(s,i.specification).interpolationFactor(e,u.min,u.max),0,1),uSize:0}}ca("Anchor",cl);var dl=Uu.VectorTileFeature.types,_l=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yl(t,e,i,r,a,n,o,s,u){t.emplaceBack(e,i,Math.round(32*r),Math.round(32*a),n,o,s?s[0]:0,s?s[1]:0,u);}function gl(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i);}var vl=function(t){this.layoutVertexArray=new yn,this.indexArray=new Rn,this.programConfigurations=t,this.segments=new To,this.dynamicLayoutVertexArray=new mn,this.opacityVertexArray=new gn,this.placedSymbolArray=new Dn;};vl.prototype.upload=function(t,e,i,r){i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,al.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_l,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t);},vl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());},ca("SymbolBuffers",vl);var xl=function(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new To,this.collisionVertexArray=new bn;};xl.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,nl.members,!0);},xl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());},ca("CollisionBuffers",xl);var bl=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hl(this.zoom,e["text-size"]),this.iconSizeData=hl(this.zoom,e["icon-size"]);var i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sourceID=t.sourceID;};function wl(t,e){return e.replace(/{([^{}]+)}/g,function(e,i){return i in t?String(t[i]):""})}bl.prototype.createArrays=function(){this.text=new vl(new zo(rl.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new vl(new zo(rl.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new xl(xn,ol.members,Mn),this.collisionCircle=new xl(xn,sl.members,Rn),this.glyphOffsetArray=new kn,this.lineVertexArray=new Vn;},bl.prototype.populate=function(t,e){var i=this.layers[0],r=i.layout,a=r.get("text-font"),n=r.get("text-field"),o=r.get("icon-image"),s=("constant"!==n.value.kind||n.value.value.length>0)&&("constant"!==a.value.kind||a.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0;if(this.features=[],s||u){for(var l=e.iconDependencies,p=e.glyphDependencies,c=new Ia(this.zoom),h=0,f=t;h<f.length;h+=1){var m=f[h],d=m.feature,_=m.index,y=m.sourceLayerIndex;if(i._featureFilter(c,d)){var g=void 0;s&&(g=ul(g=i.getValueAndResolveTokens("text-field",d),i,d));var v=void 0;if(u&&(v=i.getValueAndResolveTokens("icon-image",d)),g||v){var x={text:g,icon:v,index:_,sourceLayerIndex:y,geometry:Lo(d),properties:d.properties,type:dl[d.type]};if(void 0!==d.id&&(x.id=d.id),this.features.push(x),v&&(l[v]=!0),g)for(var b=a.evaluate(d,{}).join(","),w=p[b]=p[b]||{},A="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),T=ya(g),S=0;S<g.length;S++)if(w[g.charCodeAt(S)]=!0,A&&T){var E=pl[g.charAt(S)];E&&(w[E.charCodeAt(0)]=!0);}}}}"line"===r.get("symbol-placement")&&(this.features=ll(this.features));}},bl.prototype.update=function(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));},bl.prototype.isEmpty=function(){return 0===this.symbolInstances.length},bl.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},bl.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;},bl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();},bl.prototype.addToLineVertexArray=function(t,e){var i=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),a=t.dist(e[t.segment]),n={},o=t.segment+1;o<e.length;o++)n[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:r},o<e.length-1&&(r+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)n[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:a},s>0&&(a+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=n[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor);}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},bl.prototype.addSymbols=function(t,e,i,r,a,n,o,s,u,l){for(var p=t.indexArray,c=t.layoutVertexArray,h=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),m=this.glyphOffsetArray.length,d=f.vertexLength,_=0,y=e;_<y.length;_+=1){var g=y[_],v=g.tl,x=g.tr,b=g.bl,w=g.br,A=g.tex,T=f.vertexLength,S=g.glyphOffset[1],E=null!==n.properties&&void 0!==n.properties&&n.properties.hasOwnProperty("levels")?n.properties.levels:0;yl(c,s.x,s.y,v.x,S+v.y,A.x,A.y,i,E),yl(c,s.x,s.y,x.x,S+x.y,A.x+A.w,A.y,i,E),yl(c,s.x,s.y,b.x,S+b.y,A.x,A.y+A.h,i,E),yl(c,s.x,s.y,w.x,S+w.y,A.x+A.w,A.y+A.h,i,E),gl(h,s,0),p.emplaceBack(T,T+1,T+2),p.emplaceBack(T+1,T+2,T+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(g.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,d,u,l,s.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],o,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,n,n.index);},bl.prototype._addCollisionDebugVertex=function(t,e,i,r,a){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,r.x,r.y,Math.round(a.x),Math.round(a.y))},bl.prototype.addCollisionDebugVertices=function(t,e,i,r,a,n,o,s){var u=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),l=u.vertexLength,c=a.layoutVertexArray,h=a.collisionVertexArray;if(this._addCollisionDebugVertex(c,h,n,o.anchor,new p(t,e)),this._addCollisionDebugVertex(c,h,n,o.anchor,new p(i,e)),this._addCollisionDebugVertex(c,h,n,o.anchor,new p(i,r)),this._addCollisionDebugVertex(c,h,n,o.anchor,new p(t,r)),u.vertexLength+=4,s){var f=a.indexArray;f.emplaceBack(l,l+1,l+2),f.emplaceBack(l,l+2,l+3),u.primitiveLength+=2;}else{var m=a.indexArray;m.emplaceBack(l,l+1),m.emplaceBack(l+1,l+2),m.emplaceBack(l+2,l+3),m.emplaceBack(l+3,l),u.primitiveLength+=4;}},bl.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var i=e[t];i.textCollisionFeature={boxStartIndex:i.textBoxStartIndex,boxEndIndex:i.textBoxEndIndex},i.iconCollisionFeature={boxStartIndex:i.iconBoxStartIndex,boxEndIndex:i.iconBoxEndIndex};for(var r=0;r<2;r++){var a=i[0===r?"textCollisionFeature":"iconCollisionFeature"];if(a)for(var n=a.boxStartIndex;n<a.boxEndIndex;n++){var o=this.collisionBoxArray.get(n),s=o.x1,u=o.y1,l=o.x2,p=o.y2,c=o.radius>0;this.addCollisionDebugVertices(s,u,l,p,c?this.collisionCircle:this.collisionBox,o.anchorPoint,i,c);}}}},bl.prototype.deserializeCollisionBoxes=function(t,e,i,r,a){for(var n={},o=e;o<i;o++){var s=t.get(o);if(0===s.radius){n.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},n.textFeatureIndex=s.featureIndex;break}n.textCircles||(n.textCircles=[],n.textFeatureIndex=s.featureIndex);n.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1);}for(var u=r;u<a;u++){var l=t.get(u);if(0===l.radius){n.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},n.iconFeatureIndex=l.featureIndex;break}}return n},bl.prototype.hasTextData=function(){return this.text.segments.get().length>0},bl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},bl.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},bl.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},bl.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var i=[],r=0;r<this.symbolInstances.length;r++)i.push(r);var a=Math.sin(t),n=Math.cos(t);i.sort(function(t,i){var r=e.symbolInstances[t],o=e.symbolInstances[i];return(0|Math.round(a*r.anchor.x+n*r.anchor.y))-(0|Math.round(a*o.anchor.x+n*o.anchor.y))||o.featureIndex-r.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var o=0,s=i;o<s.length;o+=1){var u=s[o],l=e.symbolInstances[u];e.featureSortOrder.push(l.featureIndex);for(var p=0,c=l.placedTextSymbolIndices;p<c.length;p+=1)for(var h=c[p],f=e.text.placedSymbolArray.get(h),m=f.vertexStartIndex+4*f.numGlyphs,d=f.vertexStartIndex;d<m;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var _=e.icon.placedSymbolArray.get(u);if(_.numGlyphs){var y=_.vertexStartIndex;e.icon.indexArray.emplaceBack(y,y+1,y+2),e.icon.indexArray.emplaceBack(y+1,y+2,y+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}},ca("SymbolBucket",bl,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),bl.MAX_GLYPHS=65535,bl.addDynamicAttributes=gl;var Al=new Ua({"symbol-placement":new Na(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Na(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Na(Te.layout_symbol["symbol-avoid-edges"]),"icon-allow-overlap":new Na(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Na(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Na(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Na(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new ka(Te.layout_symbol["icon-size"]),"icon-text-fit":new Na(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Na(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new ka(Te.layout_symbol["icon-image"]),"icon-rotate":new ka(Te.layout_symbol["icon-rotate"]),"icon-padding":new Na(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Na(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new ka(Te.layout_symbol["icon-offset"]),"icon-anchor":new ka(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Na(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Na(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Na(Te.layout_symbol["text-rotation-alignment"]),"text-field":new ka(Te.layout_symbol["text-field"]),"text-font":new ka(Te.layout_symbol["text-font"]),"text-size":new ka(Te.layout_symbol["text-size"]),"text-max-width":new ka(Te.layout_symbol["text-max-width"]),"text-line-height":new Na(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new ka(Te.layout_symbol["text-letter-spacing"]),"text-justify":new ka(Te.layout_symbol["text-justify"]),"text-anchor":new ka(Te.layout_symbol["text-anchor"]),"text-max-angle":new Na(Te.layout_symbol["text-max-angle"]),"text-rotate":new ka(Te.layout_symbol["text-rotate"]),"text-padding":new Na(Te.layout_symbol["text-padding"]),"text-keep-upright":new Na(Te.layout_symbol["text-keep-upright"]),"text-transform":new ka(Te.layout_symbol["text-transform"]),"text-offset":new ka(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Na(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Na(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Na(Te.layout_symbol["text-optional"])}),Tl={paint:new Ua({"icon-opacity":new ka(Te.paint_symbol["icon-opacity"]),"icon-color":new ka(Te.paint_symbol["icon-color"]),"icon-halo-color":new ka(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new ka(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ka(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Na(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Na(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new ka(Te.paint_symbol["text-opacity"]),"text-color":new ka(Te.paint_symbol["text-color"]),"text-halo-color":new ka(Te.paint_symbol["text-halo-color"]),"text-halo-width":new ka(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new ka(Te.paint_symbol["text-halo-blur"]),"text-translate":new Na(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Na(Te.paint_symbol["text-translate-anchor"]),"render-3d":new Na(Te.paint_symbol["render-3d"]),"render-road-mark":new Na(Te.paint_symbol["render-road-mark"]),"symbol-height-offset":new Na(Te.paint_symbol["symbol-height-offset"])}),layout:Al},Sl=function(t){function e(e){t.call(this,e,Tl);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));},e.prototype.getValueAndResolveTokens=function(t,e){var i=this.layout.get(t).evaluate(e,{}),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||yr(r.value)?i:wl(e.properties,i)},e.prototype.createBucket=function(t){return new bl(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility},e}(wo),El={paint:new Ua({"background-color":new Na(Te.paint_background["background-color"]),"background-pattern":new Ba(Te.paint_background["background-pattern"]),"background-opacity":new Na(Te.paint_background["background-opacity"])})},Pl=function(t){function e(e){t.call(this,e,El);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wo),Il={paint:new Ua({"background-color":new Na(Te["paint_sphere-background"]["background-color"]),"background-pattern":new Ba(Te["paint_sphere-background"]["background-pattern"]),"background-opacity":new Na(Te["paint_sphere-background"]["background-opacity"])})},Rl=function(t){function e(e){t.call(this,e,Il);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wo),Ml={paint:new Ua({"raster-opacity":new Na(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Na(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Na(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Na(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Na(Te.paint_raster["raster-saturation"]),"raster-contrast":new Na(Te.paint_raster["raster-contrast"]),"raster-resampling":new Na(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Na(Te.paint_raster["raster-fade-duration"])})},zl=function(t){function e(e){t.call(this,e,Ml);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wo),Cl=Ja([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4).members,Ol=Uu.VectorTileFeature.types,Fl=63,Ll=Math.cos(Math.PI/180*37.5),Dl=.5,Nl=Math.pow(2,14)/Dl;function kl(t,e,i,r,a,n,o,s){t.emplaceBack(e.x,e.y,r?1:0,a?1:-1,Math.round(Fl*i.x)+128,Math.round(Fl*i.y)+128,1+(0===n?0:n<0?-1:1)|(o*Dl&63)<<2,o*Dl>>6,s);}var Bl=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new sn,this.indexArray=new Rn,this.programConfigurations=new zo(Cl,t.layers,t.zoom),this.segments=new To;};Bl.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},Bl.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Bl.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Bl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bl.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Bl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Bl.prototype.addFeature=function(t,e,i){for(var r=this.layers[0].layout,a=r.get("tracking-join").evaluate(t,{}),n=r.get("tracking-cap"),o=r.get("tracking-miter-limit"),s=r.get("tracking-round-limit"),u=Number(t.properties.link_seq),l=0,p=e;l<p.length;l+=1){var c=p[l];this.addLine(c,t,a,n,o,s,i,u);}},Bl.prototype.addLine=function(t,e,i,r,a,n,o,s){for(var u="Polygon"===Ol[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var p=0;p<l-1&&t[p].equals(t[p+1]);)p++;if(!(l<(u?3:2))){"bevel"===i&&(a=1.05);var c=io/(512*this.overscaling)*15,h=t[p],f=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);this.distance=0;var m,d,_,y=r,g=u?"butt":r,v=!0,x=void 0,b=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(m=t[l-2],A=h.sub(m)._unit()._perp());for(var T=p;T<l;T++)if(s+=1,!(b=u&&T===l-1?t[p+1]:t[T+1])||!t[T].equals(b)){A&&(w=A),m&&(x=m),m=t[T],A=b?b.sub(m)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var E=S.x*A.x+S.y*A.y,P=0!==E?1/E:1/0,I=E<Ll&&x&&b;if(I&&T>p){var R=m.dist(x);if(R>2*c){var M=m.sub(m.sub(x)._mult(c/R)._round());this.distance+=M.dist(x),this.addCurrentVertex(M,this.distance,w.mult(1),0,0,!1,f,s),x=M;}}var z=x&&b,C=z?i:b?y:g;if(z&&"round"===C&&(P<n?C="miter":P<=2&&(C="fakeround")),"miter"===C&&P>a&&(C="bevel"),"bevel"===C&&(P>2&&(C="flipbevel"),P<a&&(C="miter")),x&&(this.distance+=m.dist(x)),"miter"===C)S._mult(P),this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s);else if("flipbevel"===C){if(P>100)S=A.clone().mult(-1);else{var O=w.x*A.y-w.y*A.x>0?-1:1,F=P*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(F*O);}this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,S.mult(-1),0,0,!1,f,s);}else if("bevel"===C||"fakeround"===C){var L=w.x*A.y-w.y*A.x>0,D=-Math.sqrt(P*P-1);if(L?(_=0,d=D):(d=0,_=D),v||this.addCurrentVertex(m,this.distance,w,d,_,!1,f,s),"fakeround"===C){for(var N=Math.floor(8*(.5-(E-.5))),k=void 0,B=0;B<N;B++)k=A.mult((B+1)/(N+1))._add(w)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);this.addPieSliceVertex(m,this.distance,S,L,f,s);for(var V=N-1;V>=0;V--)k=w.mult((V+1)/(N+1))._add(A)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);}b&&this.addCurrentVertex(m,this.distance,A,-d,-_,!1,f,s);}else"butt"===C?(v||this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),b&&this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)):"square"===C?(v||(this.addCurrentVertex(m,this.distance,w,1,1,!1,f,s),this.e1=this.e2=-1),b&&this.addCurrentVertex(m,this.distance,A,-1,-1,!1,f,s)):"round"===C&&(v||(this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,w,1,1,!0,f,s),this.e1=this.e2=-1),b&&(this.addCurrentVertex(m,this.distance,A,-1,-1,!0,f,s),this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)));if(I&&T<l-1){var U=m.dist(b);if(U>2*c){var j=m.add(b.sub(m)._mult(c/U)._round());this.distance+=j.dist(m),this.addCurrentVertex(j,this.distance,A.mult(1),0,0,!1,f,s),m=j;}}v=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},Bl.prototype.addCurrentVertex=function(t,e,i,r,a,n,o,s){var u,l=this.layoutVertexArray,p=this.indexArray;u=i.clone(),r&&u._sub(i.perp()._mult(r)),kl(l,t,u,n,!1,r,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=i.mult(-1),a&&u._sub(i.perp()._mult(a)),kl(l,t,u,n,!0,-a,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Nl/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,a,n,o,s));},Bl.prototype.addPieSliceVertex=function(t,e,i,r,a,n){i=i.mult(r?-1:1);var o=this.layoutVertexArray,s=this.indexArray;kl(o,t,i,!1,r,0,e,n),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;},ca("TrackingBucket",Bl,{omit:["layers"]});var Vl=new Ua({"tracking-cap":new Na(Te.layout_tracking["tracking-cap"]),"tracking-join":new ka(Te.layout_tracking["tracking-join"]),"tracking-miter-limit":new Na(Te.layout_tracking["tracking-miter-limit"]),"tracking-round-limit":new Na(Te.layout_tracking["tracking-round-limit"]),"tracking-display-mode":new Na(Te.layout_tracking["tracking-display-mode"])}),Ul={paint:new Ua({"tracking-opacity":new ka(Te.paint_tracking["tracking-opacity"]),"tracking-color":new ka(Te.paint_tracking["tracking-color"]),"tracking-translate":new Na(Te.paint_tracking["tracking-translate"]),"tracking-translate-anchor":new Na(Te.paint_tracking["tracking-translate-anchor"]),"tracking-width":new ka(Te.paint_tracking["tracking-width"]),"tracking-gap-width":new ka(Te.paint_tracking["tracking-gap-width"]),"tracking-offset":new ka(Te.paint_tracking["tracking-offset"]),"tracking-blur":new ka(Te.paint_tracking["tracking-blur"]),"tracking-type":new Na(Te.paint_tracking["tracking-type"]),"tracking-seg-count":new Na(Te.paint_tracking["tracking-seg-count"]),"tracking-seg-group":new Na(Te.paint_tracking["tracking-seg-group"]),"tracking-speed":new Na(Te.paint_tracking["tracking-speed"]),"tracking-delay":new Na(Te.paint_tracking["tracking-delay"]),"tracking-speed-factor":new Na(Te.paint_tracking["tracking-speed-factor"])}),layout:Vl},jl=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new Ia(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r,a){return i=v({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r,a)},e}(ka))(Ul.paint.properties["tracking-width"].specification);jl.useIntegerZoom=!0;var ql=function(t){function e(e){t.call(this,e,Ul);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["tracking-floorwidth"]=jl.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,e);},e.prototype.createBucket=function(t){return new Bl(t)},e.prototype.queryRadius=function(t){var e=t,i=Xl(Zo("tracking-width",this,e),Zo("tracking-gap-width",this,e)),r=Zo("tracking-offset",this,e);return i/2+Math.abs(r)+Jo(this.paint.get("tracking-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){var s=Ko(t,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),n.angle,o),u=o/2*Xl(this.paint.get("tracking-width").evaluate(e,i),this.paint.get("tracking-gap-width").evaluate(e,i)),l=this.paint.get("tracking-offset").evaluate(e,i);return l&&(r=function(t,e){for(var i=[],r=new p(0,0),a=0;a<t.length;a++){for(var n=t[a],o=[],s=0;s<n.length;s++){var u=n[s-1],l=n[s],c=n[s+1],h=0===s?r:l.sub(u)._unit()._perp(),f=s===n.length-1?r:c.sub(l)._unit()._perp(),m=h._add(f)._unit(),d=m.x*f.x+m.y*f.y;m._mult(1/d),o.push(m._mult(e)._add(l));}i.push(o);}return i}(r,l*o)),Uo(s,r,u)},e}(wo);function Xl(t,e){return e>0?e+2*t:t}var Gl={paint:new Ua({"sphere-raster-opacity":new Na(Te["paint_sphere-raster"]["sphere-raster-opacity"]),"sphere-raster-hue-rotate":new Na(Te["paint_sphere-raster"]["sphere-raster-hue-rotate"]),"sphere-raster-brightness-min":new Na(Te["paint_sphere-raster"]["sphere-raster-brightness-min"]),"sphere-raster-brightness-max":new Na(Te["paint_sphere-raster"]["sphere-raster-brightness-max"]),"sphere-raster-saturation":new Na(Te["paint_sphere-raster"]["sphere-raster-saturation"]),"sphere-raster-contrast":new Na(Te["paint_sphere-raster"]["sphere-raster-contrast"]),"sphere-raster-resampling":new Na(Te["paint_sphere-raster"]["sphere-raster-resampling"]),"sphere-raster-fade-duration":new Na(Te["paint_sphere-raster"]["sphere-raster-fade-duration"])})},Wl=function(t){function e(e){t.call(this,e,Gl);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wo),Yl=Ja([{name:"a_pos",components:3,type:"Float32"}],4).members,Hl=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new mn,this.indexArray=new Rn,this.indexArray2=new Mn,this.programConfigurations=new zo(Yl,t.layers,t.zoom),this.segments=new To,this.segments2=new To;};Hl.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.projType=e.projType,this.tilePlane=Qn(this.x,this.y,this.z,e.projType||Xa.MERCATOR));for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},Hl.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Hl.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Hl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Hl.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yl),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0;},Hl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());},Hl.prototype.calcTDSpacePoint=function(t,e){var i=Gn([],Hn(this.x+t/8192,this.y+e/8192,this.zPow,this.projType),le.TRANSFORM.R);return new p(i[0]-this.tilePlane.out1[0],i[1]-this.tilePlane.out1[1],i[2]-this.tilePlane.out1[2])},Hl.prototype.addFeature=function(t,e,i){for(var r=0,a=yu(e,500);r<a.length;r+=1){for(var n=a[r],o=0,s=0,u=n;s<u.length;s+=1){o+=u[s].length;}for(var l=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),p=l.vertexLength,c=[],h=[],f=0,m=n;f<m.length;f+=1){var d=m[f];if(0!==d.length){d!==n[0]&&h.push(c.length/2);var _=this.segments2.prepareSegment(d.length,this.layoutVertexArray,this.indexArray2),y=_.vertexLength,g=d[0].x>32767||d[0].x;g=d[0].x<-32768?-32768:d[0].x;var v=d[0].y>32767||d[0].y;v=d[0].y<-32768?-32768:d[0].y;var x=this.calcTDSpacePoint(g,v);this.layoutVertexArray.emplaceBack(x.x,x.y,x.z),this.indexArray2.emplaceBack(y+d.length-1,y),c.push(d[0].x),c.push(d[0].y);for(var b=1;b<d.length;b++){var w=d[b].x>32767||d[b].x;w=d[b].x<-32768?-32768:d[b].x;var A=d[b].y>32767||d[b].y;A=d[b].y<-32768?-32768:d[b].y;var T=this.calcTDSpacePoint(w,A);this.layoutVertexArray.emplaceBack(T.x,T.y,T.z),this.indexArray2.emplaceBack(y+b-1,y+b),c.push(d[b].x),c.push(d[b].y);}_.vertexLength+=d.length,_.primitiveLength+=d.length;}}for(var S=js(c,h),E=0;E<S.length;E+=3)this.indexArray.emplaceBack(p+S[E],p+S[E+1],p+S[E+2]);l.vertexLength+=o,l.primitiveLength+=S.length/3;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("SphereFillBucket",Hl,{omit:["layers"]});var Ql={paint:new Ua({"fill-antialias":new Na(Te["paint_sphere-fill"]["fill-antialias"]),"fill-opacity":new ka(Te["paint_sphere-fill"]["fill-opacity"]),"fill-color":new ka(Te["paint_sphere-fill"]["fill-color"]),"fill-outline-color":new ka(Te["paint_sphere-fill"]["fill-outline-color"]),"fill-translate":new Na(Te["paint_sphere-fill"]["fill-translate"]),"fill-translate-anchor":new Na(Te["paint_sphere-fill"]["fill-translate-anchor"]),"fill-pattern":new Ba(Te["paint_sphere-fill"]["fill-pattern"])})},Zl=function(t){function e(e){t.call(this,e,Ql);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint=this._transitioningPaint.possiblyEvaluate(e);var i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"]);},e.prototype.createBucket=function(t){return new Hl(t)},e.prototype.queryRadius=function(){return Jo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){return Vo(Ko(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),n.angle,o),r)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility},e}(wo),Jl=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"}],4).members,Kl=Uu.VectorTileFeature.types,$l=63,tp=Math.cos(Math.PI/180*37.5),ep=.5,ip=Math.pow(2,14)/ep;function rp(t,e,i,r,a,n,o){t.emplaceBack(e.x,e.y,e.z,r?1:0,a?1:-1,Math.round($l*i.x)+128,Math.round($l*i.y)+128,1+(0===n?0:n<0?-1:1)|(o*ep&63)<<2,o*ep>>6);}var ap=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new fn,this.indexArray=new Rn,this.programConfigurations=new zo(Jl,t.layers,t.zoom),this.segments=new To;};function np(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(ip-1)}ap.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.projType=e.projType,this.tilePlane=Qn(this.x,this.y,this.z,e.projType||Xa.MERCATOR));for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},ap.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},ap.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ap.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ap.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},ap.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},ap.prototype.addFeature=function(t,e,i){for(var r=this.layers[0].layout,a=r.get("line-join").evaluate(t,{}),n=r.get("line-cap"),o=r.get("line-miter-limit"),s=r.get("line-round-limit"),u=0,l=e;u<l.length;u+=1){var p=l[u];this.addLine(p,t,a,n,o,s,i);}},ap.prototype.addLine=function(t,e,i,r,a,n,o){var s=null;e.properties&&e.properties.hasOwnProperty("minemap_clip_start")&&e.properties.hasOwnProperty("minemap_clip_end")&&(s={start:e.properties.minemap_clip_start,end:e.properties.minemap_clip_end,tileTotal:void 0});for(var u="Polygon"===Kl[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var p=0;p<l-1&&t[p].equals(t[p+1]);)p++;if(!(l<(u?3:2))){s&&(s.tileTotal=function(t,e,i){for(var r,a,n=0,o=e;o<i-1;o++)r=t[o],a=t[o+1],n+=r.dist(a);return n}(t,p,l)),"bevel"===i&&(a=1.05);var c=io/(512*this.overscaling)*15,h=t[p],f=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);this.distance=0;var m,d,_,y=r,g=u?"butt":r,v=!0,x=void 0,b=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(m=t[l-2],A=h.sub(m)._unit()._perp());for(var T=p;T<l;T++)if(!(b=u&&T===l-1?t[p+1]:t[T+1])||!t[T].equals(b)){A&&(w=A),m&&(x=m),m=t[T],A=b?b.sub(m)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var E=S.x*A.x+S.y*A.y,P=0!==E?1/E:1/0,I=E<tp&&x&&b;if(I&&T>p){var R=m.dist(x);if(R>2*c){var M=m.sub(m.sub(x)._mult(c/R)._round());this.distance+=M.dist(x),this.addCurrentVertex(M,this.distance,w.mult(1),0,0,!1,f,s),x=M;}}var z=x&&b,C=z?i:b?y:g;if(z&&"round"===C&&(P<n?C="miter":P<=2&&(C="fakeround")),"miter"===C&&P>a&&(C="bevel"),"bevel"===C&&(P>2&&(C="flipbevel"),P<a&&(C="miter")),x&&(this.distance+=m.dist(x)),"miter"===C)S._mult(P),this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s);else if("flipbevel"===C){if(P>100)S=A.clone().mult(-1);else{var O=w.x*A.y-w.y*A.x>0?-1:1,F=P*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(F*O);}this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,S.mult(-1),0,0,!1,f,s);}else if("bevel"===C||"fakeround"===C){var L=w.x*A.y-w.y*A.x>0,D=-Math.sqrt(P*P-1);if(L?(_=0,d=D):(d=0,_=D),v||this.addCurrentVertex(m,this.distance,w,d,_,!1,f,s),"fakeround"===C){for(var N=Math.floor(8*(.5-(E-.5))),k=void 0,B=0;B<N;B++)k=A.mult((B+1)/(N+1))._add(w)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);this.addPieSliceVertex(m,this.distance,S,L,f,s);for(var V=N-1;V>=0;V--)k=w.mult((V+1)/(N+1))._add(A)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);}b&&this.addCurrentVertex(m,this.distance,A,-d,-_,!1,f,s);}else"butt"===C?(v||this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),b&&this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)):"square"===C?(v||(this.addCurrentVertex(m,this.distance,w,1,1,!1,f,s),this.e1=this.e2=-1),b&&this.addCurrentVertex(m,this.distance,A,-1,-1,!1,f,s)):"round"===C&&(v||(this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,w,1,1,!0,f,s),this.e1=this.e2=-1),b&&(this.addCurrentVertex(m,this.distance,A,-1,-1,!0,f,s),this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)));if(I&&T<l-1){var U=m.dist(b);if(U>2*c){var j=m.add(b.sub(m)._mult(c/U)._round());this.distance+=j.dist(m),this.addCurrentVertex(j,this.distance,A.mult(1),0,0,!1,f,s),m=j;}}v=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},ap.prototype.calcTDSpacePoint=function(t){var e=Gn([],Hn(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projType),le.TRANSFORM.R);return new p(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])},ap.prototype.addCurrentVertex=function(t,e,i,r,a,n,o,s){var u,l=this.layoutVertexArray,p=this.indexArray;s&&(e=np(e,s)),u=i.clone(),r&&u._sub(i.perp()._mult(r));var c=this.calcTDSpacePoint(t);rp(l,c,u,n,!1,r,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=i.mult(-1),a&&u._sub(i.perp()._mult(a)),rp(l,c,u,n,!0,-a,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>ip/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,a,n,o));},ap.prototype.addPieSliceVertex=function(t,e,i,r,a,n){i=i.mult(r?-1:1);var o=this.layoutVertexArray,s=this.indexArray;n&&(e=np(e,n)),rp(o,this.calcTDSpacePoint(t),i,!1,r,0,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;},ca("SphereLineBucket",ap,{omit:["layers"]});var op=new Ua({"line-cap":new Na(Te["layout_sphere-line"]["line-cap"]),"line-join":new ka(Te["layout_sphere-line"]["line-join"]),"line-miter-limit":new Na(Te["layout_sphere-line"]["line-miter-limit"]),"line-round-limit":new Na(Te["layout_sphere-line"]["line-round-limit"]),"border-visibility":new Na(Te["layout_sphere-line"]["border-visibility"])}),sp={paint:new Ua({"line-opacity":new ka(Te["paint_sphere-line"]["line-opacity"]),"line-color":new ka(Te["paint_sphere-line"]["line-color"]),"line-translate":new Na(Te["paint_sphere-line"]["line-translate"]),"line-translate-anchor":new Na(Te["paint_sphere-line"]["line-translate-anchor"]),"line-width":new ka(Te["paint_sphere-line"]["line-width"]),"line-border-width":new ka(Te["paint_sphere-line"]["line-border-width"]),"line-border-opacity":new ka(Te["paint_sphere-line"]["line-border-opacity"]),"line-border-color":new ka(Te["paint_sphere-line"]["line-border-color"]),"line-gap-width":new ka(Te["paint_sphere-line"]["line-gap-width"]),"line-offset":new ka(Te["paint_sphere-line"]["line-offset"]),"line-blur":new ka(Te["paint_sphere-line"]["line-blur"]),"line-dasharray":new Ba(Te["paint_sphere-line"]["line-dasharray"]),"line-pattern":new Ba(Te["paint_sphere-line"]["line-pattern"]),"line-gradient":new Va(Te["paint_sphere-line"]["line-gradient"])}),layout:op},up=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new Ia(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r,a){return i=v({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r,a)},e}(ka))(sp.paint.properties["line-width"].specification);up.useIntegerZoom=!0;var lp=function(t){function e(e){t.call(this,e,sp);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient();},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Ns(t,"lineProgress"),this.gradientTexture=null;},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=up.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e);},e.prototype.createBucket=function(t){return new ap(t)},e.prototype.queryRadius=function(t){var e=t,i=pp(Zo("line-width",this,e),Zo("line-gap-width",this,e)),r=Zo("line-offset",this,e);return i/2+Math.abs(r)+Jo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){var s=Ko(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),n.angle,o),u=o/2*pp(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),l=this.paint.get("line-offset").evaluate(e,i);return l&&(r=function(t,e){for(var i=[],r=new p(0,0),a=0;a<t.length;a++){for(var n=t[a],o=[],s=0;s<n.length;s++){var u=n[s-1],l=n[s],c=n[s+1],h=0===s?r:l.sub(u)._unit()._perp(),f=s===n.length-1?r:c.sub(l)._unit()._perp(),m=h._add(f)._unit(),d=m.x*f.x+m.y*f.y;m._mult(1/d),o.push(m._mult(e)._add(l));}i.push(o);}return i}(r,l*o)),Uo(s,r,u)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility},e}(wo);function pp(t,e){return e>0?e+2*t:t}var cp=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_extra",components:2,type:"Int16"}],4).members;function hp(t,e,i,r,a,n){t.emplaceBack(e,i,r,a,n);}var fp=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new _n,this.indexArray=new Rn,this.segments=new To,this.programConfigurations=new zo(cp,t.layers,t.zoom);};fp.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.projType=e.projType||e.projection,this.tilePlane=Qn(this.x,this.y,this.z,this.projType||Xa.MERCATOR));for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}this.x=e.x,this.y=e.y,this.z=e.z;},fp.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},fp.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},fp.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fp.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},fp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},fp.prototype.calcTDSpacePoint=function(t,e){var i=Gn([],Hn(this.x+t/8192,this.y+e/8192,this.zPow,this.projType),le.TRANSFORM.R);return[i[0]-this.tilePlane.out1[0],i[1]-this.tilePlane.out1[1],i[2]-this.tilePlane.out1[2]]},fp.prototype.addFeature=function(t,e,i){for(var r=0,a=e;r<a.length;r+=1)for(var n=0,o=a[r];n<o.length;n+=1){var s=o[n],u=s.x,l=s.y;if(!(u<.2*-io||u>=1.2*io||l<.2*-io||l>=1.2*io)){var p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),c=p.vertexLength,h=this.calcTDSpacePoint(u,l);hp.apply(void 0,[this.layoutVertexArray].concat(h,[-1],[-1])),hp.apply(void 0,[this.layoutVertexArray].concat(h,[1],[-1])),hp.apply(void 0,[this.layoutVertexArray].concat(h,[1],[1])),hp.apply(void 0,[this.layoutVertexArray].concat(h,[-1],[1])),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),p.vertexLength+=4,p.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("SphereCircleBucket",fp,{omit:["layers"]});var mp=function(t){function e(e){t.call(this,e,$o);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new fp(t)},e.prototype.queryRadius=function(t){var e=t;return Zo("circle-radius",this,e)+Zo("circle-stroke-width",this,e)+Jo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o,s){for(var u=Ko(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),n.angle,o),l=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),p="map"===this.paint.get("circle-pitch-alignment"),c=p?u:function(t,e){return t.map(function(t){return dp(t,e)})}(u,s),h=p?l*o:l,f=0,m=r;f<m.length;f+=1)for(var d=0,_=m[f];d<_.length;d+=1){var y=_[d],g=p?y:dp(y,s),v=h,x=As([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=x[3]/n.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=n.cameraToCenterDistance/x[3]),Bo(c,g,v))return!0}return!1},e}(wo);function dp(t,e){var i=As([],[t.x,t.y,0,1],e);return new p(i[0]/i[3],i[1]/i[3])}var _p=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_extrude",components:2,type:"Int8"}],4).members;function yp(t,e,i,r,a,n){t.emplaceBack(e,i,r,a,n);}var gp=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new pn,this.indexArray=new Rn,this.segments=new To,this.programConfigurations=new zo(_p,t.layers,t.zoom),this.projection=t.projection;};gp.prototype.populate=function(t,e){this.x=e.x,this.y=e.y,this.z=e.z;for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},gp.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},gp.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},gp.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},gp.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_p),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},gp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},gp.prototype.addFeature=function(t,e,i){for(var r=0,a=e;r<a.length;r+=1)for(var n=0,o=a[r];n<o.length;n+=1){var s=o[n],u=s.x,l=s.y,p=Yn(s.x,s.y,0,this.x,this.y,this.z,this.projection);if(!(u<0||u>=io||l<0||l>=io)){var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=c.vertexLength;yp(this.layoutVertexArray,p[0],p[1],p[2],-1,-1),yp(this.layoutVertexArray,p[0],p[1],p[2],1,-1),yp(this.layoutVertexArray,p[0],p[1],p[2],1,1),yp(this.layoutVertexArray,p[0],p[1],p[2],-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("SphereHeatmapBucket",gp,{omit:["layers"]});var vp={paint:new Ua({"heatmap-radius":new ka(Te["paint_sphere-heatmap"]["heatmap-radius"]),"heatmap-weight":new ka(Te["paint_sphere-heatmap"]["heatmap-weight"]),"heatmap-intensity":new Na(Te["paint_sphere-heatmap"]["heatmap-intensity"]),"heatmap-color":new Va(Te["paint_sphere-heatmap"]["heatmap-color"]),"heatmap-opacity":new Na(Te["paint_sphere-heatmap"]["heatmap-opacity"])})},xp=function(t){function e(e){t.call(this,e,vp),this._updateColorRamp();}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new gp(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp();},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Ns(t,"heatmapDensity"),this.colorRampTexture=null;},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(wo),bp=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),wp=Ja([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ap=(Ja([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ja([{name:"a_placed",components:2,type:"Uint8"}],4)),Tp=(Ja([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Sp=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ep=(Ja([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),Ja([{type:"Float32",name:"offsetX"}]),Ja([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Uu.VectorTileFeature.types),Pp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ip(t,e,i,r,a,n,o){t.emplaceBack(e.x,e.y,e.z,Math.round(32*i),Math.round(32*r),a,n,o?o[0]:0,o?o[1]:0);}function Rp(t,e,i,r){t.emplaceBack(e.x-r.x,e.y-r.y,i),t.emplaceBack(e.x-r.x,e.y-r.y,i),t.emplaceBack(e.x-r.x,e.y-r.y,i),t.emplaceBack(e.x-r.x,e.y-r.y,i);}var Mp=function(t){this.layoutVertexArray=new En,this.indexArray=new Rn,this.programConfigurations=t,this.segments=new To,this.dynamicLayoutVertexArray=new mn,this.opacityVertexArray=new gn,this.placedSymbolArray=new Dn;};Mp.prototype.upload=function(t,e,i,r){i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,wp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Pp,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t);},Mp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());},ca("SphereSymbolBuffers",Mp);var zp=function(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new To,this.collisionVertexArray=new bn;};zp.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ap.members,!0);},zp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());},ca("SphereCollisionBuffers",zp);var Cp=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hl(this.zoom,e["text-size"]),this.iconSizeData=hl(this.zoom,e["icon-size"]);var i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sourceID=t.sourceID;};Cp.prototype.createArrays=function(){this.text=new Mp(new zo(bp.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Mp(new zo(bp.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new zp(Pn,Tp.members,Mn),this.collisionCircle=new zp(Pn,Sp.members,Rn),this.glyphOffsetArray=new kn,this.lineVertexArray=new Vn;},Cp.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.projType=e.projType,this.tilePlane=Qn(this.x,this.y,this.z,e.projType||Xa.MERCATOR));var i=this.layers[0],r=i.layout,a=r.get("text-font"),n=r.get("text-field"),o=r.get("icon-image"),s=("constant"!==n.value.kind||n.value.value.length>0)&&("constant"!==a.value.kind||a.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0;if(this.features=[],s||u){for(var l=e.iconDependencies,p=e.glyphDependencies,c=new Ia(this.zoom),h=0,f=t;h<f.length;h+=1){var m=f[h],d=m.feature,_=m.index,y=m.sourceLayerIndex;if(i._featureFilter(c,d)){var g=void 0;s&&(g=ul(g=i.getValueAndResolveTokens("text-field",d),i,d));var v=void 0;if(u&&(v=i.getValueAndResolveTokens("icon-image",d)),g||v){var x={text:g,icon:v,index:_,sourceLayerIndex:y,geometry:Lo(d),properties:d.properties,type:Ep[d.type]};if(void 0!==d.id&&(x.id=d.id),this.features.push(x),v&&(l[v]=!0),g)for(var b=a.evaluate(d,{}).join(","),w=p[b]=p[b]||{},A="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),T=ya(g),S=0;S<g.length;S++)if(w[g.charCodeAt(S)]=!0,A&&T){var E=pl[g.charAt(S)];E&&(w[E.charCodeAt(0)]=!0);}}}}"line"===r.get("symbol-placement")&&(this.features=ll(this.features));}},Cp.prototype.update=function(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));},Cp.prototype.isEmpty=function(){return 0===this.symbolInstances.length},Cp.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Cp.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;},Cp.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();},Cp.prototype.addToLineVertexArray=function(t,e){var i=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),a=t.dist(e[t.segment]),n={},o=t.segment+1;o<e.length;o++)n[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:r},o<e.length-1&&(r+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)n[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:a},s>0&&(a+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=n[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor);}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},Cp.prototype.addSymbols=function(t,e,i,r,a,n,o,s,u,l){for(var p=t.indexArray,c=t.layoutVertexArray,h=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),m=this.glyphOffsetArray.length,d=f.vertexLength,_=0,y=e;_<y.length;_+=1){var g=y[_],v=g.tl,x=g.tr,b=g.bl,w=g.br,A=g.tex,T=f.vertexLength,S=g.glyphOffset[1],E=this.calcTDSpacePoint(s.x,s.y);Ip(c,E,v.x,S+v.y,A.x,A.y,i),Ip(c,E,x.x,S+x.y,A.x+A.w,A.y,i),Ip(c,E,b.x,S+b.y,A.x,A.y+A.h,i),Ip(c,E,w.x,S+w.y,A.x+A.w,A.y+A.h,i),Rp(h,s,0,s),p.emplaceBack(T,T+1,T+2),p.emplaceBack(T+1,T+2,T+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(g.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,d,u,l,s.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],o,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,n,n.index);},Cp.prototype._addCollisionDebugVertex=function(t,e,i,r,a){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,i.z,r.x,r.y,Math.round(a.x),Math.round(a.y))},Cp.prototype.addCollisionDebugVertices=function(t,e,i,r,a,n,o,s){var u=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),l=u.vertexLength,c=a.layoutVertexArray,h=a.collisionVertexArray,f=this.calcTDSpacePoint(n.x,n.y);if(this._addCollisionDebugVertex(c,h,f,o.anchor,new p(t,e)),this._addCollisionDebugVertex(c,h,f,o.anchor,new p(i,e)),this._addCollisionDebugVertex(c,h,f,o.anchor,new p(i,r)),this._addCollisionDebugVertex(c,h,f,o.anchor,new p(t,r)),u.vertexLength+=4,s){var m=a.indexArray;m.emplaceBack(l,l+1,l+2),m.emplaceBack(l,l+2,l+3),u.primitiveLength+=2;}else{var d=a.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),u.primitiveLength+=4;}},Cp.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var i=e[t];i.textCollisionFeature={boxStartIndex:i.textBoxStartIndex,boxEndIndex:i.textBoxEndIndex},i.iconCollisionFeature={boxStartIndex:i.iconBoxStartIndex,boxEndIndex:i.iconBoxEndIndex};for(var r=0;r<2;r++){var a=i[0===r?"textCollisionFeature":"iconCollisionFeature"];if(a)for(var n=a.boxStartIndex;n<a.boxEndIndex;n++){var o=this.collisionBoxArray.get(n),s=o.x1,u=o.y1,l=o.x2,p=o.y2,c=o.radius>0;this.addCollisionDebugVertices(s,u,l,p,c?this.collisionCircle:this.collisionBox,o.anchorPoint,i,c);}}}},Cp.prototype.deserializeCollisionBoxes=function(t,e,i,r,a){for(var n={},o=e;o<i;o++){var s=t.get(o);if(0===s.radius){n.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},n.textFeatureIndex=s.featureIndex;break}n.textCircles||(n.textCircles=[],n.textFeatureIndex=s.featureIndex);n.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1);}for(var u=r;u<a;u++){var l=t.get(u);if(0===l.radius){n.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},n.iconFeatureIndex=l.featureIndex;break}}return n},Cp.prototype.hasTextData=function(){return this.text.segments.get().length>0},Cp.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Cp.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},Cp.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},Cp.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var i=[],r=0;r<this.symbolInstances.length;r++)i.push(r);var a=Math.sin(t),n=Math.cos(t);i.sort(function(t,i){var r=e.symbolInstances[t],o=e.symbolInstances[i];return(0|Math.round(a*r.anchor.x+n*r.anchor.y))-(0|Math.round(a*o.anchor.x+n*o.anchor.y))||o.featureIndex-r.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var o=0,s=i;o<s.length;o+=1){var u=s[o],l=e.symbolInstances[u];e.featureSortOrder.push(l.featureIndex);for(var p=0,c=l.placedTextSymbolIndices;p<c.length;p+=1)for(var h=c[p],f=e.text.placedSymbolArray.get(h),m=f.vertexStartIndex+4*f.numGlyphs,d=f.vertexStartIndex;d<m;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var _=e.icon.placedSymbolArray.get(u);if(_.numGlyphs){var y=_.vertexStartIndex;e.icon.indexArray.emplaceBack(y,y+1,y+2),e.icon.indexArray.emplaceBack(y+1,y+2,y+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}},Cp.prototype.calcTDSpacePoint=function(t,e){var i=Gn([],Hn(this.x+t/8192,this.y+e/8192,this.zPow,this.projType),le.TRANSFORM.R);return new p(i[0]-this.tilePlane.out1[0],i[1]-this.tilePlane.out1[1],i[2]-this.tilePlane.out1[2])},ca("SphereSymbolBucket",Cp,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),Cp.MAX_GLYPHS=65535,Cp.addDynamicAttributes=Rp;var Op=new Ua({"symbol-placement":new Na(Te["layout_sphere-symbol"]["symbol-placement"]),"symbol-spacing":new Na(Te["layout_sphere-symbol"]["symbol-spacing"]),"symbol-avoid-edges":new Na(Te["layout_sphere-symbol"]["symbol-avoid-edges"]),"icon-allow-overlap":new Na(Te["layout_sphere-symbol"]["icon-allow-overlap"]),"icon-ignore-placement":new Na(Te["layout_sphere-symbol"]["icon-ignore-placement"]),"icon-optional":new Na(Te["layout_sphere-symbol"]["icon-optional"]),"icon-rotation-alignment":new Na(Te["layout_sphere-symbol"]["icon-rotation-alignment"]),"icon-size":new ka(Te["layout_sphere-symbol"]["icon-size"]),"icon-text-fit":new Na(Te["layout_sphere-symbol"]["icon-text-fit"]),"icon-text-fit-padding":new Na(Te["layout_sphere-symbol"]["icon-text-fit-padding"]),"icon-image":new ka(Te["layout_sphere-symbol"]["icon-image"]),"icon-rotate":new ka(Te["layout_sphere-symbol"]["icon-rotate"]),"icon-padding":new Na(Te["layout_sphere-symbol"]["icon-padding"]),"icon-keep-upright":new Na(Te["layout_sphere-symbol"]["icon-keep-upright"]),"icon-offset":new ka(Te["layout_sphere-symbol"]["icon-offset"]),"icon-anchor":new ka(Te["layout_sphere-symbol"]["icon-anchor"]),"icon-pitch-alignment":new Na(Te["layout_sphere-symbol"]["icon-pitch-alignment"]),"text-pitch-alignment":new Na(Te["layout_sphere-symbol"]["text-pitch-alignment"]),"text-rotation-alignment":new Na(Te["layout_sphere-symbol"]["text-rotation-alignment"]),"text-field":new ka(Te["layout_sphere-symbol"]["text-field"]),"text-font":new ka(Te["layout_sphere-symbol"]["text-font"]),"text-size":new ka(Te["layout_sphere-symbol"]["text-size"]),"text-max-width":new ka(Te["layout_sphere-symbol"]["text-max-width"]),"text-line-height":new Na(Te["layout_sphere-symbol"]["text-line-height"]),"text-letter-spacing":new ka(Te["layout_sphere-symbol"]["text-letter-spacing"]),"text-justify":new ka(Te["layout_sphere-symbol"]["text-justify"]),"text-anchor":new ka(Te["layout_sphere-symbol"]["text-anchor"]),"text-max-angle":new Na(Te["layout_sphere-symbol"]["text-max-angle"]),"text-rotate":new ka(Te["layout_sphere-symbol"]["text-rotate"]),"text-padding":new Na(Te["layout_sphere-symbol"]["text-padding"]),"text-keep-upright":new Na(Te["layout_sphere-symbol"]["text-keep-upright"]),"text-transform":new ka(Te["layout_sphere-symbol"]["text-transform"]),"text-offset":new ka(Te["layout_sphere-symbol"]["text-offset"]),"text-allow-overlap":new Na(Te["layout_sphere-symbol"]["text-allow-overlap"]),"text-ignore-placement":new Na(Te["layout_sphere-symbol"]["text-ignore-placement"]),"text-optional":new Na(Te["layout_sphere-symbol"]["text-optional"])}),Fp={paint:new Ua({"icon-opacity":new ka(Te["paint_sphere-symbol"]["icon-opacity"]),"icon-color":new ka(Te["paint_sphere-symbol"]["icon-color"]),"icon-halo-color":new ka(Te["paint_sphere-symbol"]["icon-halo-color"]),"icon-halo-width":new ka(Te["paint_sphere-symbol"]["icon-halo-width"]),"icon-halo-blur":new ka(Te["paint_sphere-symbol"]["icon-halo-blur"]),"icon-translate":new Na(Te["paint_sphere-symbol"]["icon-translate"]),"icon-translate-anchor":new Na(Te["paint_sphere-symbol"]["icon-translate-anchor"]),"text-opacity":new ka(Te["paint_sphere-symbol"]["text-opacity"]),"text-color":new ka(Te["paint_sphere-symbol"]["text-color"]),"text-halo-color":new ka(Te["paint_sphere-symbol"]["text-halo-color"]),"text-halo-width":new ka(Te["paint_sphere-symbol"]["text-halo-width"]),"text-halo-blur":new ka(Te["paint_sphere-symbol"]["text-halo-blur"]),"text-translate":new Na(Te["paint_sphere-symbol"]["text-translate"]),"text-translate-anchor":new Na(Te["paint_sphere-symbol"]["text-translate-anchor"])}),layout:Op},Lp=function(t){function e(e){t.call(this,e,Fp);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));},e.prototype.getValueAndResolveTokens=function(t,e){var i=this.layout.get(t).evaluate(e,{}),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||yr(r.value)?i:wl(e.properties,i)},e.prototype.createBucket=function(t){return new Cp(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility},e}(wo),Dp=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal_ed",components:3,type:"Float32"},{name:"a_st",components:3,type:"Float32"}],4).members;function Np(t,e){if(t.length<=0)return[];var i=[];i.push(new Up(new p(0,0),new p(8192,0))),i.push(new Up(new p(8192,0),new p(8192,8192))),i.push(new Up(new p(8192,8192),new p(0,8192))),i.push(new Up(new p(0,8192),new p(0,0))),e=e||i;var r,a=[],n=[],o=t[t.length-1];for(var s in t)a.push(t[s]);for(var u in e){for(var l in r=!kp(o=a[a.length-1],e[u]),a)kp(a[l],e[u])?(r&&(r=!1,n.push(Vp(o,a[l],e[u].start,e[u].end))),n.push(a[l])):r||(r=!0,n.push(Vp(o,a[l],e[u].start,e[u].end))),o=a[l];for(var c in a=[],n)a.push(n[c]);n=[];}return a.push(a[a.length-1]),a}function kp(t,e){return!!t&&Bp(t,e.start,e.end)>=0}function Bp(t,e,i){return(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)}function Vp(t,e,i,r){var a=(Bp(t,r,i)*e.x-Bp(e,r,i)*t.x)/(Bp(t,r,i)-Bp(e,r,i)),n=(Bp(t,r,i)*e.y-Bp(e,r,i)*t.y)/(Bp(t,r,i)-Bp(e,r,i));return new p(a,n)}function Up(t,e){this.start=t,this.end=e;}function jp(t,e,i,r,a,n,o,s,u,l){t.emplaceBack(e,i,r,a,n,o,s,u,l);}var qp=function(t){this.featureTrangles=[],this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new cn,this.indexArray=new Rn,this.programConfigurations=new zo(Dp,t.layers,t.zoom),this.segments=new To,this.projection=t.projection;};function Xp(t,e){return t.x===e.x&&(t.x<0||t.x>io)||t.y===e.y&&(t.y<0||t.y>io)}function Gp(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>io})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>io})}function Wp(t){return!(t.every(function(t){return t.x>=0})&&t.every(function(t){return t.x<=io})&&t.every(function(t){return t.y>=0})&&t.every(function(t){return t.y<=io}))}function Yp(t,e){return t.x===e.x&&(0===t.x||8192===t.x)||t.y===e.y&&(0===t.y||8192===t.y)}function Hp(t){for(var e=1/0,i=-1/0,r=1/0,a=-1/0,n=0,o=t;n<o.length;n+=1)for(var s=0,u=o[n];s<u.length;s+=1){var l=u[s];e>l.x&&(e=l.x),i<l.x&&(i=l.x),r>l.y&&(r=l.y),a<l.y&&(a=l.y);}var p=i-e<512?512:i-e;return p<a-r&&(p=a-r),{minX:e,maxX:i,minY:r,maxY:a,maxLength:p}}qp.prototype.populate=function(t,e){this.x=e.x,this.y=e.y,this.z=e.z;for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var s=Lo(n);this.addFeature(n,s,o,[]);}}this.baseP&&(this.matrix=Jn(0,this.baseP,!1));},qp.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},qp.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},qp.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qp.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},qp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},qp.prototype.addFeature=function(t,e,i,r){var a=0,n=this.layers[0].paint.get("extrusion-height").value,o=this.layers[0].paint.get("extrusion-base"),s=o.value&&o.value.value&&Number(o.value.value)||0;if(n&&"constant"===n.kind)a=Number(n.value);else if(n&&"source"===n.kind){var u=n._parameters&&n._parameters.property;a=u?Number(t.properties[u]):0;}for(var l=0,p=yu(e,500);l<p.length;l+=1){for(var c=p[l],h=0,f=0,m=c;f<m.length;f+=1){h+=m[f].length;}for(var d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),_=0,y=c;_<y.length;_+=1){var g=y[_];if(0!==g.length&&!Gp(g)){Wp(g)&&(g=Np(g));for(var v=0;v<g.length;v++){var x=g[v];if(v>=1){var b=g[v-1];if(Yp(x,b))continue;if(!Xp(x,b)){d.vertexLength+4>To.MAX_VERTEX_ARRAY_LENGTH&&(d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var w=Yn(x.x,x.y,s,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=w);var A=Yn(x.x,x.y,a,this.x,this.y,this.z,this.projection),T=Yn(b.x,b.y,s,this.x,this.y,this.z,this.projection),S=Yn(b.x,b.y,a,this.x,this.y,this.z,this.projection),E=this.baseP,P=zt([],Dt([],w,A),Dt([],w,T));jp(this.layoutVertexArray,w[0]-E[0],w[1]-E[1],w[2]-E[2],P[0],P[1],P[2],0,s/5,0),jp(this.layoutVertexArray,A[0]-E[0],A[1]-E[1],A[2]-E[2],P[0],P[1],P[2],0,a/5,0);var I=20*Nt(T,w);jp(this.layoutVertexArray,T[0]-E[0],T[1]-E[1],T[2]-E[2],P[0],P[1],P[2],I,s/5,0),jp(this.layoutVertexArray,S[0]-E[0],S[1]-E[1],S[2]-E[2],P[0],P[1],P[2],I,a/5,0);var R=d.vertexLength;this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R+1,R+2,R+3),r.push([w,A,T],[A,T,S]),d.vertexLength+=4,d.primitiveLength+=2;}}}}}d.vertexLength+h>To.MAX_VERTEX_ARRAY_LENGTH&&(d=this.segments.prepareSegment(h,this.layoutVertexArray,this.indexArray));for(var M=[],z=[],C=d.vertexLength,O=[],F=0,L=c;F<L.length;F+=1){var D=L[F];if(0!==D.length){D!==c[0]&&z.push(M.length/2);for(var N=Hp(c),k=0;k<D.length;k++){var B=D[k],V=[(B.x-N.minX)/N.maxLength,(B.y-N.minY)/N.maxLength],U=Yn(B.x,B.y,a+(this.x%2+this.y%2)/256,this.x,this.y,this.z,this.projection);O.push(U),this.baseP||(this.baseP=U),jp(this.layoutVertexArray,U[0]-this.baseP[0],U[1]-this.baseP[1],U[2]-this.baseP[2],0,8,0,V[0],V[1],1),M.push(B.x),M.push(B.y);}}}for(var j=js(M,z),q=0;q<j.length;q+=3)this.indexArray.emplaceBack(C+j[q],C+j[q+1],C+j[q+2]),r.push([O[j[q]],O[j[q+1]],O[j[q+2]]]);d.primitiveLength+=j.length/3,d.vertexLength+=h;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("SphereExtrusionBucket",qp,{omit:["layers"]});var Qp={paint:new Ua({"extrusion-opacity":new Na(Te["paint_sphere-extrusion"]["extrusion-opacity"]),"extrusion-color":new ka(Te["paint_sphere-extrusion"]["extrusion-color"]),"extrusion-translate":new Na(Te["paint_sphere-extrusion"]["extrusion-translate"]),"extrusion-translate-anchor":new Na(Te["paint_sphere-extrusion"]["extrusion-translate-anchor"]),"extrusion-pattern":new Ba(Te["paint_sphere-extrusion"]["extrusion-pattern"]),"extrusion-top-pattern":new Ba(Te["paint_sphere-extrusion"]["extrusion-top-pattern"]),"extrusion-height":new ka(Te["paint_sphere-extrusion"]["extrusion-height"]),"extrusion-base":new ka(Te["paint_sphere-extrusion"]["extrusion-base"]),"render-road":new Na(Te["paint_sphere-extrusion"]["render-road"])})},Zp=function(t){function e(e){t.call(this,e,Qp),this.radiationRegions=[];for(var i=e["radiation-regions"]||[],r=0;r<i.length&&r<20;r++)this.radiationRegions.push({geo:Gn([],i[r].location,le.TRANSFORM.R).concat([i[r].radius])});e.hasOwnProperty("viewshed-render")?this.viewshedRender=!!e["viewshed-render"]:this.viewshedRender=!0;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new qp(t)},e.prototype.queryRadius=function(){return Jo(this.paint.get("extrusion-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){Ko(t,this.paint.get("extrusion-translate"),this.paint.get("extrusion-translate-anchor"),n.angle,o);return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);},e}(wo),Jp=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4).members,Kp=Uu.VectorTileFeature.types,$p=63,tc=Math.cos(Math.PI/180*37.5),ec=.5,ic=Math.pow(2,14)/ec;function rc(t,e,i,r,a,n,o,s){t.emplaceBack(e.x,e.y,e.z,r?1:0,a?1:-1,Math.round($p*i.x)+128,Math.round($p*i.y)+128,1+(0===n?0:n<0?-1:1)|(o*ec&63)<<2,o*ec>>6,s);}var ac=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new dn,this.indexArray=new Rn,this.programConfigurations=new zo(Jp,t.layers,t.zoom),this.segments=new To;};ac.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.projType=e.projType,this.tilePlane=Qn(this.x,this.y,this.z,e.projType||Xa.MERCATOR));for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},ac.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},ac.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ac.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ac.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},ac.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},ac.prototype.addFeature=function(t,e,i){for(var r=this.layers[0].layout,a=r.get("tracking-join").evaluate(t,{}),n=r.get("tracking-cap"),o=r.get("tracking-miter-limit"),s=r.get("tracking-round-limit"),u=Number(t.properties.link_seq),l=0,p=e;l<p.length;l+=1){var c=p[l];this.addLine(c,t,a,n,o,s,i,u);}},ac.prototype.addLine=function(t,e,i,r,a,n,o,s){for(var u="Polygon"===Kp[e.type],l=t.length;l>=2&&t[l-1].equals(t[l-2]);)l--;for(var p=0;p<l-1&&t[p].equals(t[p+1]);)p++;if(!(l<(u?3:2))){"bevel"===i&&(a=1.05);var c=io/(512*this.overscaling)*15,h=t[p],f=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);this.distance=0;var m,d,_,y=r,g=u?"butt":r,v=!0,x=void 0,b=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(m=t[l-2],A=h.sub(m)._unit()._perp());for(var T=p;T<l;T++)if(s+=1,!(b=u&&T===l-1?t[p+1]:t[T+1])||!t[T].equals(b)){A&&(w=A),m&&(x=m),m=t[T],A=b?b.sub(m)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var E=S.x*A.x+S.y*A.y,P=0!==E?1/E:1/0,I=E<tc&&x&&b;if(I&&T>p){var R=m.dist(x);if(R>2*c){var M=m.sub(m.sub(x)._mult(c/R)._round());this.distance+=M.dist(x),this.addCurrentVertex(M,this.distance,w.mult(1),0,0,!1,f,s),x=M;}}var z=x&&b,C=z?i:b?y:g;if(z&&"round"===C&&(P<n?C="miter":P<=2&&(C="fakeround")),"miter"===C&&P>a&&(C="bevel"),"bevel"===C&&(P>2&&(C="flipbevel"),P<a&&(C="miter")),x&&(this.distance+=m.dist(x)),"miter"===C)S._mult(P),this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s);else if("flipbevel"===C){if(P>100)S=A.clone().mult(-1);else{var O=w.x*A.y-w.y*A.x>0?-1:1,F=P*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(F*O);}this.addCurrentVertex(m,this.distance,S,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,S.mult(-1),0,0,!1,f,s);}else if("bevel"===C||"fakeround"===C){var L=w.x*A.y-w.y*A.x>0,D=-Math.sqrt(P*P-1);if(L?(_=0,d=D):(d=0,_=D),v||this.addCurrentVertex(m,this.distance,w,d,_,!1,f,s),"fakeround"===C){for(var N=Math.floor(8*(.5-(E-.5))),k=void 0,B=0;B<N;B++)k=A.mult((B+1)/(N+1))._add(w)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);this.addPieSliceVertex(m,this.distance,S,L,f,s);for(var V=N-1;V>=0;V--)k=w.mult((V+1)/(N+1))._add(A)._unit(),this.addPieSliceVertex(m,this.distance,k,L,f,s);}b&&this.addCurrentVertex(m,this.distance,A,-d,-_,!1,f,s);}else"butt"===C?(v||this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),b&&this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)):"square"===C?(v||(this.addCurrentVertex(m,this.distance,w,1,1,!1,f,s),this.e1=this.e2=-1),b&&this.addCurrentVertex(m,this.distance,A,-1,-1,!1,f,s)):"round"===C&&(v||(this.addCurrentVertex(m,this.distance,w,0,0,!1,f,s),this.addCurrentVertex(m,this.distance,w,1,1,!0,f,s),this.e1=this.e2=-1),b&&(this.addCurrentVertex(m,this.distance,A,-1,-1,!0,f,s),this.addCurrentVertex(m,this.distance,A,0,0,!1,f,s)));if(I&&T<l-1){var U=m.dist(b);if(U>2*c){var j=m.add(b.sub(m)._mult(c/U)._round());this.distance+=j.dist(m),this.addCurrentVertex(j,this.distance,A.mult(1),0,0,!1,f,s),m=j;}}v=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},ac.prototype.calcTDSpacePoint=function(t){var e=Gn([],Hn(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projType),le.TRANSFORM.R);return new p(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])},ac.prototype.addCurrentVertex=function(t,e,i,r,a,n,o,s){var u,l=this.layoutVertexArray,p=this.indexArray;u=i.clone(),r&&u._sub(i.perp()._mult(r));var c=this.calcTDSpacePoint(t);rc(l,c,u,n,!1,r,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=i.mult(-1),a&&u._sub(i.perp()._mult(a)),rc(l,c,u,n,!0,-a,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>ic/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,a,n,o,s));},ac.prototype.addPieSliceVertex=function(t,e,i,r,a,n){i=i.mult(r?-1:1);var o=this.layoutVertexArray,s=this.indexArray;rc(o,this.calcTDSpacePoint(t),i,!1,r,0,e,n),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;},ca("SphereTrackingBucket",ac,{omit:["layers"]});var nc=new Ua({"tracking-cap":new Na(Te["layout_sphere-tracking"]["tracking-cap"]),"tracking-join":new ka(Te["layout_sphere-tracking"]["tracking-join"]),"tracking-miter-limit":new Na(Te["layout_sphere-tracking"]["tracking-miter-limit"]),"tracking-round-limit":new Na(Te["layout_sphere-tracking"]["tracking-round-limit"]),"tracking-display-mode":new Na(Te["layout_sphere-tracking"]["tracking-display-mode"])}),oc={paint:new Ua({"tracking-opacity":new ka(Te["paint_sphere-tracking"]["tracking-opacity"]),"tracking-color":new ka(Te["paint_sphere-tracking"]["tracking-color"]),"tracking-translate":new Na(Te["paint_sphere-tracking"]["tracking-translate"]),"tracking-translate-anchor":new Na(Te["paint_sphere-tracking"]["tracking-translate-anchor"]),"tracking-width":new ka(Te["paint_sphere-tracking"]["tracking-width"]),"tracking-gap-width":new ka(Te["paint_sphere-tracking"]["tracking-gap-width"]),"tracking-offset":new ka(Te["paint_sphere-tracking"]["tracking-offset"]),"tracking-blur":new ka(Te["paint_sphere-tracking"]["tracking-blur"]),"tracking-type":new Na(Te["paint_sphere-tracking"]["tracking-type"]),"tracking-seg-count":new Na(Te["paint_sphere-tracking"]["tracking-seg-count"]),"tracking-seg-group":new Na(Te["paint_sphere-tracking"]["tracking-seg-group"]),"tracking-speed":new Na(Te["paint_sphere-tracking"]["tracking-speed"]),"tracking-delay":new Na(Te["paint_sphere-tracking"]["tracking-delay"]),"tracking-speed-factor":new Na(Te["paint_sphere-tracking"]["tracking-speed-factor"])}),layout:nc},sc=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new Ia(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r,a){return i=v({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r,a)},e}(ka))(oc.paint.properties["tracking-width"].specification);sc.useIntegerZoom=!0;var uc=function(t){function e(e){t.call(this,e,oc);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["tracking-floorwidth"]=sc.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,e);},e.prototype.createBucket=function(t){return new ac(t)},e.prototype.queryRadius=function(t){var e=t,i=lc(Zo("tracking-width",this,e),Zo("tracking-gap-width",this,e)),r=Zo("tracking-offset",this,e);return i/2+Math.abs(r)+Jo(this.paint.get("tracking-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){var s=Ko(t,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),n.angle,o),u=o/2*lc(this.paint.get("tracking-width").evaluate(e,i),this.paint.get("tracking-gap-width").evaluate(e,i)),l=this.paint.get("tracking-offset").evaluate(e,i);return l&&(r=function(t,e){for(var i=[],r=new p(0,0),a=0;a<t.length;a++){for(var n=t[a],o=[],s=0;s<n.length;s++){var u=n[s-1],l=n[s],c=n[s+1],h=0===s?r:l.sub(u)._unit()._perp(),f=s===n.length-1?r:c.sub(l)._unit()._perp(),m=h._add(f)._unit(),d=m.x*f.x+m.y*f.y;m._mult(1/d),o.push(m._mult(e)._add(l));}i.push(o);}return i}(r,l*o)),Uo(s,r,u)},e}(wo);function lc(t,e){return e>0?e+2*t:t}var pc={paint:new Ua({"3d-model-opacity":new Na(Te["paint_3d-model"]["3d-model-opacity"])})},cc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};var hc=setTimeout;function fc(t){return Boolean(t&&void 0!==t.length)}function mc(){}function dc(t){if(!(this instanceof dc))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],xc(t,this);}function _c(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,dc._immediateFn(function(){var i=1===t._state?e.onFulfilled:e.onRejected;if(null!==i){var r;try{r=i(t._value);}catch(t){return void gc(e.promise,t)}yc(e.promise,r);}else(1===t._state?yc:gc)(e.promise,t._value);})):t._deferreds.push(e);}function yc(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var i=e.then;if(e instanceof dc)return t._state=3,t._value=e,void vc(t);if("function"==typeof i)return void xc((r=i,a=e,function(){r.apply(a,arguments);}),t)}t._state=1,t._value=e,vc(t);}catch(e){gc(t,e);}var r,a;}function gc(t,e){t._state=2,t._value=e,vc(t);}function vc(t){2===t._state&&0===t._deferreds.length&&dc._immediateFn(function(){t._handled||dc._unhandledRejectionFn(t._value);});for(var e=0,i=t._deferreds.length;e<i;e++)_c(t,t._deferreds[e]);t._deferreds=null;}function xc(t,e){var i=!1;try{t(function(t){i||(i=!0,yc(e,t));},function(t){i||(i=!0,gc(e,t));});}catch(t){if(i)return;i=!0,gc(e,t);}}dc.prototype.catch=function(t){return this.then(null,t)},dc.prototype.then=function(t,e){var i=new this.constructor(mc);return _c(this,new function(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i;}(t,e,i)),i},dc.prototype.finally=function(t){var e=this.constructor;return this.then(function(i){return e.resolve(t()).then(function(){return i})},function(i){return e.resolve(t()).then(function(){return e.reject(i)})})},dc.all=function(t){return new dc(function(e,i){if(!fc(t))return i(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var a=r.length;function n(t,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var s=o.then;if("function"==typeof s)return void s.call(o,function(e){n(t,e);},i)}r[t]=o,0==--a&&e(r);}catch(t){i(t);}}for(var o=0;o<r.length;o++)n(o,r[o]);})},dc.resolve=function(t){return t&&"object"==typeof t&&t.constructor===dc?t:new dc(function(e){e(t);})},dc.reject=function(t){return new dc(function(e,i){i(t);})},dc.race=function(t){return new dc(function(e,i){if(!fc(t))return i(new TypeError("Promise.race accepts an array"));for(var r=0,a=t.length;r<a;r++)dc.resolve(t[r]).then(e,i);})},dc._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t);}||function(t){hc(t,0);},dc._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t);};var bc=function(){this.jsonRequest=null,this.binRequest=null;};function wc(t,e,i,r,a){var n,o=t.meshes,s=o[e].primitives[i||0].attributes,u=[];for(var l in s){var p=s[l],c=t.accessors[p],h=t.bufferViews[c.bufferView],f=(c.byteOffset?c.byteOffset:0)+(h.byteOffset?h.byteOffset:0),m=h.byteStride?h.byteStride:h.byteLength/c.count,d=c.componentType;"POSITION"===l&&(r.VB={offset:f,byteStride:m,type:d}),u.push({name:"a_"+l,type:d,components:cc[c.type],offset:f,byteStride:m});}if(a)for(var _=0;_<o[e].primitives[i||0].targets.length;_++){var y=o[e].primitives[i||0].targets[_];for(var g in y){var v=y[g],x=t.accessors[v],b=t.bufferViews[x.bufferView],w=(x.byteOffset?x.byteOffset:0)+(b.byteOffset?b.byteOffset:0),A=b.byteStride?b.byteStride:b.byteLength/x.count,T=x.componentType;u.push({name:"a_"+g+"_"+(_+1),type:T,components:cc[x.type],offset:w,byteStride:A});}}return void 0===n&&(n=1),{members:u.map(function(t){var e=t.components||1;return{name:t.name,type:t.type,components:e,offset:t.offset||0,byteStride:t.byteStride||4}}),size:Ka(0,Math.max(0,n)),alignment:n}}bc.prototype.load=function(t,e){var i=this,r=null,a=[];this.jsonRequest=de(t,function(n,o){if(n)e(n,null);else if((r=o)&&Array.isArray(r.buffers)){for(var s=[],u=0,l=r.buffers;u<l.length;u+=1){var p=l[u];p&&"string"==typeof p.uri?function(e,r,a){a.push(new dc(function(e,a){var n,o=t.url;-1!==r.indexOf("base64")?e((n=r,atob(n.substring(n.indexOf(",")+1)).split("").map(function(t){return t.charCodeAt(0)}))):i.binRequest=_e({url:o.substring(0,o.lastIndexOf("/")+1)+r},function(t,i){t?a(t):e(i?i.data:null);});}));}(0,p.uri,s):e("Missing buffer info",null);}dc.all(s).then(function(t){for(var i=0;i<t.length;i++)a.push(new Uint8Array(t[i]));r.buffer=null,delete r.buffer,e(null,{bufferData:a,gltf:r});});}else e("no buffer item",null);});},bc.prototype.abort=function(){this.jsonRequest&&this.jsonRequest.cancel(),this.binRequest&&this.binRequest.cancel();},bc.prototype.dealWithLocation=function(t){};var Ac=self.HTMLImageElement,Tc=self.HTMLCanvasElement,Sc=self.HTMLVideoElement,Ec=self.ImageData,Pc=function(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!(!r||!r.flipY),this.update(e,r);};Pc.prototype.update=function(t,e){var i=t.width,r=t.height,a=!this.size||this.size[0]!==i||this.size[1]!==r,n=this.context,o=n.gl;this.useMipmap=Boolean(e&&e.useMipmap),o.bindTexture(o.TEXTURE_2D,this.texture),n.pixelStoreUnpackFlipY.set(this.flipY),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!e||!1!==e.premultiply)),a?(this.size=[i,r],this.format!==o.RGBA||e&&!1===e.premultiply||n.pixelStoreUnpackPremultiplyAlpha.set(!0),t instanceof Ac||t instanceof Tc||t instanceof Sc||t instanceof Ec?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,t):o.texImage2D(o.TEXTURE_2D,0,this.format,i,r,0,this.format,o.UNSIGNED_BYTE,t.data)):t instanceof Ac||t instanceof Tc||t instanceof Sc||t instanceof Ec?o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,t):o.texSubImage2D(o.TEXTURE_2D,0,0,0,i,r,o.RGBA,o.UNSIGNED_BYTE,t.data),a&&(this._powerOfTwoCalculated=!1),this.isSizePowerOfTwoNoneSquare()&&this.useMipmap&&o.generateMipmap(o.TEXTURE_2D);},Pc.prototype.bind=function(t,e){var i,r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),i=this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?r.LINEAR_MIPMAP_NEAREST:r.LINEAR,t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e);},Pc.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Pc.prototype.isSizePowerOfTwoNoneSquare=function(){return this._powerOfTwoCalculated?this.powerOfTwoNoneSquareFlag:(this._powerOfTwoCalculated=!0,this.powerOfTwoNoneSquareFlag=Math.log(this.size[0])/Math.LN2%1==0&&Math.log(this.size[1])/Math.LN2%1==0,this.powerOfTwoNoneSquareFlag)},Pc.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null;};var Ic=function(t,e,i,r,a,n,o,s){this.context=t;var u=t.gl;this.dynamicDraw=Boolean(o),this.offset=n,this.count=r,this.mode=i,this.type=a,this.unbindVAO(),s?this.buffer=s:(this.buffer=u.createBuffer(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,e,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW));};Ic.prototype.getBuffer=function(){return this.buffer},Ic.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);},Ic.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer);},Ic.prototype.updateData=function(t){var e=this.context.gl;this.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t);},Ic.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer);};var Rc=function(t,e,i,r,a){this.length=e.length,this.attributes=i,this.dynamicDraw=r,this.context=t;var n=t.gl;a?this.buffer=a:(this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW));};Rc.prototype.getBuffer=function(){return this.buffer},Rc.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer);},Rc.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t);},Rc.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var r=this.attributes[i],a=e.attributes[r.name];void 0!==a&&t.enableVertexAttribArray(a);}},Rc.prototype.setVertexAttribPointers=function(t,e,i){for(var r=0;r<this.attributes.length;r++){var a=this.attributes[r],n=e.attributes[a.name];void 0!==n&&t.vertexAttribPointer(n,a.components,a.type,!1,a.byteStride,a.offset);}},Rc.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer);};var Mc=function(t,e,i){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;};Mc.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);},Mc.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer);},Mc.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer);},Mc.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer);};var zc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Cc=function(t,e,i,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var a=t.gl;this.buffer=a.createBuffer(),t.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;};Cc.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer);},Cc.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer);},Cc.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var r=this.attributes[i],a=e.attributes[r.name];void 0!==a&&t.enableVertexAttribArray(a);}},Cc.prototype.setVertexAttribPointers=function(t,e,i){for(var r=0;r<this.attributes.length;r++){var a=this.attributes[r],n=e.attributes[a.name];void 0!==n&&t.vertexAttribPointer(n,a.components,t[zc[a.type]],!1,this.itemSize,a.offset+this.itemSize*(i||0));}},Cc.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer);};var Oc=function(t){this.context=t,this.default=We.transparent,this.current=this.default,this.dirty=!1;};Oc.prototype.get=function(){return this.current},Oc.prototype.setDefault=function(){this.set(this.default);},Oc.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!0!==this.dirty||(this.context.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1);};var Fc=function(t){this.context=t,this.default=1,this.current=this.default,this.dirty=!1;};Fc.prototype.get=function(){return this.current},Fc.prototype.setDefault=function(){this.set(this.default);},Fc.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.clearDepth(t),this.current=t,this.dirty=!1);};var Lc=function(t){this.context=t,this.default=0,this.current=this.default,this.dirty=!1;};Lc.prototype.get=function(){return this.current},Lc.prototype.setDefault=function(){this.set(this.default);},Lc.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.clearStencil(t),this.current=t,this.dirty=!1);};var Dc=function(t){this.context=t,this.default=[!0,!0,!0,!0],this.current=this.default,this.dirty=!1;};Dc.prototype.get=function(){return this.current},Dc.prototype.setDefault=function(){this.set(this.default);},Dc.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!0!==this.dirty||(this.context.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1);};var Nc=function(t){this.context=t,this.default=!0,this.current=this.default,this.dirty=!1;};Nc.prototype.get=function(){return this.current},Nc.prototype.setDefault=function(){this.set(this.default);},Nc.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.depthMask(t),this.current=t,this.dirty=!1);};var kc=function(t){this.context=t,this.default=255,this.current=this.default,this.dirty=!1;};kc.prototype.get=function(){return this.current},kc.prototype.setDefault=function(){this.set(this.default);},kc.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.stencilMask(t),this.current=t,this.dirty=!1);};var Bc=function(t){this.context=t,this.default={func:t.gl.ALWAYS,ref:0,mask:255},this.current=this.default,this.dirty=!1;};Bc.prototype.get=function(){return this.current},Bc.prototype.setDefault=function(){this.set(this.default);},Bc.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask&&!0!==this.dirty||(this.context.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1);};var Vc=function(t){this.context=t;var e=this.context.gl;this.default=[e.KEEP,e.KEEP,e.KEEP],this.current=this.default,this.dirty=!1;};Vc.prototype.get=function(){return this.current},Vc.prototype.setDefault=function(){this.set(this.default);},Vc.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&!0!==this.dirty||(this.context.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1);};var Uc=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};Uc.prototype.get=function(){return this.current},Uc.prototype.setDefault=function(){this.set(this.default);},Uc.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1;}};var jc=function(t){this.context=t,this.default=[0,1],this.current=this.default,this.dirty=!1;};jc.prototype.get=function(){return this.current},jc.prototype.setDefault=function(){this.set(this.default);},jc.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!0!==this.dirty||(this.context.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1);};var qc=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};qc.prototype.get=function(){return this.current},qc.prototype.setDefault=function(){this.set(this.default);},qc.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1;}};var Xc=function(t){this.context=t,this.default=t.gl.LESS,this.current=this.default,this.dirty=!1;};Xc.prototype.get=function(){return this.current},Xc.prototype.setDefault=function(){this.set(this.default);},Xc.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.depthFunc(t),this.current=t,this.dirty=!1);};var Gc=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};Gc.prototype.get=function(){return this.current},Gc.prototype.setDefault=function(){this.set(this.default);},Gc.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1;}};var Wc=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};Wc.prototype.get=function(){return this.current},Wc.prototype.setDefault=function(){this.set(this.default);},Wc.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1;}};var Yc=function(t){this.context=t;var e=this.context.gl;this.default=[e.ONE,e.ZERO],this.current=this.default,this.dirty=!1;};Yc.prototype.get=function(){return this.current},Yc.prototype.setDefault=function(){this.set(this.default);},Yc.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!0!==this.dirty||(this.context.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1);};var Hc=function(t){this.context=t,this.default=We.transparent,this.current=this.default,this.dirty=!1;};Hc.prototype.get=function(){return this.current},Hc.prototype.setDefault=function(){this.set(this.default);},Hc.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!0!==this.dirty||(this.context.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1);};var Qc=function(t){this.context=t,this.default=this.context.gl.FUNC_ADD,this.current=this.default,this.dirty=!1;};Qc.prototype.get=function(){return this.current},Qc.prototype.setDefault=function(){this.set(this.default);},Qc.prototype.set=function(t){t===this.current&&!0!==this.dirty||(this.context.gl.blendEquation(t),this.current=t,this.dirty=!1);};var Zc=function(t){this.context=t,this.current=this.context.gl.CCW;};Zc.prototype.set=function(t){t!==this.current&&(this.context.gl.frontFace(t),this.current=t);},Zc.prototype.get=function(){return this.current||this.context.gl.CCW};var Jc=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};Jc.prototype.get=function(){return this.current},Jc.prototype.setDefault=function(){this.set(this.default);},Jc.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.useProgram(t),this.current=t,this.dirty=!1);};var Kc=function(t){this.context=t,this.default=t.gl.TEXTURE0,this.current=this.default,this.dirty=!1;};Kc.prototype.get=function(){return this.current},Kc.prototype.setDefault=function(){this.set(this.default);},Kc.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.activeTexture(t),this.current=t,this.dirty=!1);};var $c=function(t){this.context=t;var e=this.context.gl;this.default=[0,0,e.drawingBufferWidth,e.drawingBufferHeight],this.current=this.default,this.dirty=!1;};$c.prototype.get=function(){return this.current},$c.prototype.setDefault=function(){this.set(this.default);},$c.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!0!==this.dirty||(this.context.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1);};var th=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};th.prototype.get=function(){return this.current},th.prototype.setDefault=function(){this.set(this.default);},th.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1;}};var eh=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};eh.prototype.get=function(){return this.current},eh.prototype.setDefault=function(){this.set(this.default);},eh.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1;}};var ih=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};ih.prototype.get=function(){return this.current},ih.prototype.setDefault=function(){this.set(this.default);},ih.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1;}};var rh=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};rh.prototype.get=function(){return this.current},rh.prototype.setDefault=function(){this.set(this.default);},rh.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1;}};var ah=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};ah.prototype.get=function(){return this.current},ah.prototype.setDefault=function(){this.set(this.default);},ah.prototype.set=function(t){var e=this.context.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1;};var nh=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};nh.prototype.get=function(){return this.current},nh.prototype.setDefault=function(){this.set(this.default);},nh.prototype.set=function(t){(this.current!==t&&this.context.extVertexArrayObject||!0===this.dirty)&&(this.context.extVertexArrayObject.bindVertexArrayOES(t),this.current=t,this.dirty=!1);};var oh=function(t){this.context=t,this.default=4,this.current=this.default,this.dirty=!1;};oh.prototype.get=function(){return this.current},oh.prototype.setDefault=function(){this.set(this.default);},oh.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1;}};var sh=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};sh.prototype.get=function(){return this.current},sh.prototype.setDefault=function(){this.set(this.default);},sh.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1;}};var uh=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};uh.prototype.get=function(){return this.current},uh.prototype.setDefault=function(){this.set(this.default);},uh.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1;}};var lh=function(t,e){this.context=t,this.default=null,this.current=this.default,this.dirty=!1,this.parent=e;};lh.prototype.get=function(){return this.current};var ph=function(t){function e(e,i){t.call(this,e,i),this.dirty=!1;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDefault=function(){this.set(this.default);},e.prototype.set=function(t){if(this.dirty||this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1;}},e.prototype.setDirty=function(){this.dirty=!0;},e}(lh),ch=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDefault=function(){this.set(this.default);},e.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1;}},e}(lh),hh=function(t){this.context=t,this.current=this.context.gl.BACK;};hh.prototype.set=function(t){t!==this.current&&(this.context.gl.cullFace(t),this.current=t);},hh.prototype.get=function(){return this.current};var fh=function(t,e,i,r){this.context=t,this.width=e,this.height=i,this.depthPick=r||!1;var a=t.gl,n=this.framebuffer=a.createFramebuffer();this.colorAttachment=new ph(t,n),this.depthAttachment=new ch(t,n,r);};fh.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var i=this.depthAttachment.get();i&&(this.depthPick?t.deleteTexture(i):t.deleteRenderbuffer(i)),t.deleteFramebuffer(this.framebuffer);};var mh=function(t,e,i){this.func=t,this.mask=e,this.range=i;};mh.ReadOnly=!1,mh.ReadWrite=!0,mh.ALWAYS=519,mh.disabled=new mh(519,mh.ReadOnly,[0,1]);var dh=function(t,e,i,r,a,n){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=a,this.pass=n;};dh.disabled=new dh({func:519,mask:0},0,0,7680,7680,7680),dh.enableClipGround=new dh({func:519,mask:255},1,255,7680,7680,7681),dh.openClipGround=new dh({func:517,mask:255},1,0,7680,7680,7680);var _h=function(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i;};_h.Replace=[1,0],_h.disabled=new _h(_h.Replace,We.transparent,[!1,!1,!1,!1]),_h.unblended=new _h(_h.Replace,We.transparent,[!0,!0,!0,!0]),_h.alphaBlended=new _h([1,771],We.transparent,[!0,!0,!0,!0]);var yh=function(t,e,i){this.enable=t,this.mode=e,this.frontFace=i;};yh.disabled=new yh(!1,1029,2305),yh.backCCW=new yh(!0,1029,2305);var gh=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Oc(this),this.clearDepth=new Fc(this),this.clearStencil=new Lc(this),this.colorMask=new Dc(this),this.depthMask=new Nc(this),this.cullFace=new Gc(this),this.cullFaceSide=new hh(this),this.frontFace=new Zc(this),this.stencilMask=new kc(this),this.stencilFunc=new Bc(this),this.stencilOp=new Vc(this),this.stencilTest=new Uc(this),this.depthRange=new jc(this),this.depthTest=new qc(this),this.depthFunc=new Xc(this),this.blend=new Wc(this),this.blendFunc=new Yc(this),this.blendColor=new Hc(this),this.blendEquation=new Qc(this),this.program=new Jc(this),this.activeTexture=new Kc(this),this.viewport=new $c(this),this.bindFramebuffer=new th(this),this.bindRenderbuffer=new eh(this),this.bindTexture=new ih(this),this.bindVertexBuffer=new rh(this),this.bindElementBuffer=new ah(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new nh(this),this.pixelStoreUnpack=new oh(this),this.pixelStoreUnpackPremultiplyAlpha=new sh(this),this.pixelStoreUnpackFlipY=new uh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.extDepthTexture=t.getExtension("WEBGL_depth_texture"),this.extDepthTexture||t.getExtension("WEBKIT_WEBGL_depth_texture"),this.extElementIndexUint||t.getExtension("OES_element_index_uint");for(var e=t.getSupportedExtensions(),i=0;i<e.length;i++)"EXT_frag_depth"===e[i]&&(this.extFragDepth=t.getExtension("EXT_frag_depth"));};gh.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.cullFace.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0;},gh.prototype.createIndexBuffer=function(t,e){return new Mc(this,t,e)},gh.prototype.createVertexBuffer=function(t,e,i){return new Cc(this,t,e,i)},gh.prototype.createRenderbuffer=function(t,e,i){var r=this.gl,a=r.createRenderbuffer();return this.bindRenderbuffer.set(a),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),a},gh.prototype.createFramebuffer=function(t,e,i){return new fh(this,t,e,i||!1)},gh.prototype.clear=function(t){var e=t.color,i=t.depth,r=this.gl,a=0;e&&(a|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(a|=r.DEPTH_BUFFER_BIT,this.clearDepth.set(i),this.depthMask.set(!0)),r.clear(a);},gh.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1);},gh.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1);},gh.prototype.setColorMode=function(t){h(t.blendFunction,_h.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask);},gh.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace));},gh.prototype.czm_unpackDepth=function(t){return(t[0]+t[1]/255+t[2]/65025+t[3]/16581375)/255},gh.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null);};var vh=function(t,e,i){this.bounds=ja.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24;};vh.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},vh.prototype.contains=function(t){var e=Math.floor(this.lngX(this.bounds.getWest(),t.z)),i=Math.floor(this.latY(this.bounds.getNorth(),t.z)),r=Math.ceil(this.lngX(this.bounds.getEast(),t.z)),a=Math.ceil(this.latY(this.bounds.getSouth(),t.z));return t.x>=e&&t.x<r&&t.y>=i&&t.y<a},vh.prototype.lngX=function(t,e){return(t+180)*(Math.pow(2,e)/360)},vh.prototype.latY=function(t,e){var i=_(Math.sin(Math.PI/180*t),-.9999,.9999),r=Math.pow(2,e)/(2*Math.PI);return Math.pow(2,e-1)+.5*Math.log((1+i)/(1-i))*-r};var xh=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null;};xh.prototype.bind=function(t,e,i,r,a,n,o,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==r.length,l=0;!u&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(u=!0);var p=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||u||this.boundIndexBuffer!==a||this.boundVertexOffset!==n||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||p?this.freshBind(e,i,r,a,n,o,s):(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),a&&a.dynamicDraw&&a.bind(),s&&s.bind());},xh.prototype.freshBind=function(t,e,i,r,a,n,o){var s,u=t.numAttributes,l=this.context,p=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=a,this.boundDynamicVertexBuffer=n,this.boundDynamicVertexBuffer2=o;else{s=l.currentNumAttributes||0;for(var c=u;c<s;c++)p.disableVertexAttribArray(c);}e.enableAttributes(p,t);for(var h=0,f=i;h<f.length;h+=1){f[h].enableAttributes(p,t);}n&&n.enableAttributes(p,t),o&&o.enableAttributes(p,t),e.bind(),e.setVertexAttribPointers(p,t,a);for(var m=0,d=i;m<d.length;m+=1){var _=d[m];_.bind(),_.setVertexAttribPointers(p,t,a);}n&&(n.bind(),n.setVertexAttribPointers(p,t,a)),r&&r.bind(),o&&(o.bind(),o.setVertexAttribPointers(p,t,a)),l.currentNumAttributes=u;},xh.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null);};var bh=Ja([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),wh=Ja([{name:"a_pos",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2}]),Ah=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.dispatcher=r,this.type="3d-tile",this.minzoom=15,this.maxzoom=22,this.scheme="xyz",this.reparseOverscaled=!0,this.isTileClipped=!0,this.tileUsage="sphere",this.tileJson={},this.vectorLayerIds=[],this.identityMatrix=!0,v(this,x(i,["url","scheme","modelFolder","location","translation","filter"])),this._options=v({type:"3d-tile"},i),this.translation||(this.translation=[0,0,0]),this.flipYZ=i.flipYZ||!1,this.noQuery=!i.hasOwnProperty("noQuery")||i.noQuery,this.videoMatchOption=i.videoMatchOption,this.videoMatchEnabled=!!i.videoMatchOption&&i.videoMatchOption.enabled,this._processVideoMatch(),this.ratioRange=i.ratioRange||[[0,1],[0,1],[0,1]],this.clampBox=i.clampBox||{x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0,translation:[0,0,0]},this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.clampPlane=i.clampPlane||[0,0,0,0],this._clampEnabled=i.clampEnabled||!1,this.noHighlighting=i.noHighlighting,this.maxTiles=i.maxTiles||4,this._pickable=i.pickable||!1,this._collectResourceTiming=i.collectResourceTiming,this.filter&&this.setFilter(this.filter),this.setEventedParent(a);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={clampEnabled:{configurable:!0}};return i.clampEnabled.set=function(t){this._clampEnabled=t;},i.clampEnabled.get=function(){return this._clampEnabled},e.prototype._processVideoMatch=function(){if(this.videoMatchOption&&this.videoMatchOption.bounds){var t=this.videoMatchOption.bounds;this.videoBounds=function(t,e,i,r){var a=[],n=[],o=[],s=[];Gn(a,t,le.TRANSFORM.R+t[2]*le.TRANSFORM.R_SCALE),Gn(n,e,le.TRANSFORM.R+e[2]*le.TRANSFORM.R_SCALE),Gn(o,i,le.TRANSFORM.R+i[2]*le.TRANSFORM.R_SCALE),Gn(s,r,le.TRANSFORM.R+r[2]*le.TRANSFORM.R_SCALE);var u=zt([],Dt([],a,n),Dt([],s,a)),l=zt([],Dt([],n,a),u),p=zt([],Dt([],o,n),u),c=zt([],Dt([],s,o),u),h=zt([],Dt([],a,s),u),f=-(a[0]*l[0]+a[1]*l[1]+a[2]*l[2]),m=-(n[0]*p[0]+n[1]*p[1]+n[2]*p[2]),d=-(o[0]*c[0]+o[1]*c[1]+o[2]*c[2]),_=-(s[0]*h[0]+s[1]*h[1]+s[2]*h[2]);return{planeP1P2:l,planeP2P3:p,planeP3P4:c,planeP4P1:h,p1:a,p2:n,p3:o,p4:s,d1Sqrt:[f,Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])],d2Sqrt:[m,Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])],d3Sqrt:[d,Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])],d4Sqrt:[_,Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])]}}(t[0],t[1],t[2],t[3]);}},e.prototype.enableVideoMatch=function(){this.videoMatchOption&&(this.videoMatchEnabled=!0);},e.prototype.disableVideoMatch=function(){this.videoMatchEnabled=!1;},e.prototype.setClampRange=function(t){Array.isArray(t)&&(this.ratioRange=t,this.fire(new be("data",{data:t})));},e.prototype.setClampBox=function(t){!t instanceof Object&&(console.warn("参数应为裁剪盒子对象"),t={x:1,y:1,z:1,rotateX:0,rotateY:0,rotateZ:0,anchor:this.location,inner:!0,translation:[0,0,0]}),this.clampBox=Object.assign(this.clampBox,t),this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.fire(new be("data",{data:this.clampBox}));},e.prototype.getClampBoxMatrix=function(t,e){var i=t.rotateX,r=t.rotateY,a=t.rotateZ,n=t.anchor,o=t.translation,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];o&&(n=to(n,o)),ft(s,s,-a*le.TRANSFORM.DEG_TO_RAD),ct(s,s,-i*le.TRANSFORM.DEG_TO_RAD),ht(s,s,-r*le.TRANSFORM.DEG_TO_RAD);var u=$n(n,e,!1);return lt(s,s,[-u[0],-u[1],-u[2]]),s},e.prototype.setClampPlane=function(t){Array.isArray(t)&&(this.clampPlane=t,this.fire(new be("data",{data:t})));},e.prototype.clearClampPlane=function(){this.clampPlane=[0,0,0,0],this.fire(new be("data",{data:this.clampPlane}));},e.prototype.clearClampBox=function(){this.clampBox={x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0},this.fire(new be("data",{data:this.clampBox}));},e.prototype.enablePick=function(){this._pickable=!0;},e.prototype.disablePick=function(){this._pickable=!1;},e.prototype.clearPick=function(){},e.prototype.setFilter=function(t){this._featureFilter=Cr(t);},e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this._tileJSONRequest=de(this.map._transformRequest(B(this._options.url||""),he.Source),function(e,i){t._tileJSONRequest=null,e?t.fire(new we(e)):i&&(t.tileJson=i,t.fire(new be("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new be("data",{dataType:"source",sourceDataType:"content"})));}),this.videoMatchOption&&this.videoMatchOption.videoUrl&&ge([this.videoMatchOption.videoUrl],function(e,i){e?t.fire(new we(e)):i&&(t.video=i,t.video.loop=!0,t.video.addEventListener("playing",function(){t.map.triggerRepaint();}),t.map&&t.video.play());});},e.prototype.prepare=function(){if(this.gltfModelVAO||(this.gltfModelVAO=new xh),this.video&&!(this.video.readyState<2)){var t=this.map.painter.context,e=t.gl;this.videoTexture?this.video.paused||(this.videoTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGB,e.UNSIGNED_BYTE,this.video)):(this.videoTexture=new Pc(t,this.video,e.RGB),this.videoTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE));}},e.prototype.hasTile=function(t){return!0},e.prototype.onAdd=function(t){this.map=t,this.load();},e.prototype.onRemove=function(t){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},e.prototype.serialize=function(){return v({},this._options)},e.prototype._getGltfFolder=function(t){return t.split("~")[0]},e.prototype.loadTile=function(t,e){var i=this.tileJson.type===le.MODEL_TYPE.OSGB?this.modelFolder+"/"+this._getGltfFolder(t.tileID)+"/"+t.childJson.url:this.modelFolder+"/"+t.childJson.url,r=B(i,this.url),a={request:this.map._transformRequest(n.resolveURL(r),he.Tile),uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,isCarto:this.tileJson.isCarto};function o(i,r){return t.aborted?e(null):i?e(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),t.loadVectorData(r,this.map.painter),e(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}a.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",a,o.bind(this)):"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",a,o.bind(this),t.workerID);},e.prototype.abortTile=function(t,e){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID);},e.prototype.unloadTile=function(t,e){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID),t=null;},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return!0},Object.defineProperties(e.prototype,i),e}(Ae),Th=function(t){this.textures={},this.requests={},this.source=t||{fire:function(){}};};Th.prototype.addATexture=function(t,e,i,r){var a=this,n=i.gl;this.getATexture(t)||this.requests[t]||(this.requests[t]=ye({url:e},function(e,o){if(e)throw new we(e);if(o){var s=new Pc(i,o,n.RGBA,{useMipmap:!(r instanceof Wd)});if(s.bind(n.LINEAR,n.CLAMP_TO_EDGE),a.textures[t]=s,r&&r instanceof Wd&&(r.state="loaded",r.childJson.PK&&r.childJson.PK.length>0)){var u=r.childJson.PK;r.childJson.PK="",a.source.fire(new be("data-remove-pk",{dataType:"removePK",pk:u}));}a.requests[t]=null,delete a.requests[t],a.source.fire(new be("data",{dataType:"gltf-data-loaded"}));}}));},Th.prototype.getATexture=function(t){return this.textures[t]},Th.prototype.removeATexture=function(t){this.textures[t]&&(this.textures[t].destroy(),this.textures[t]=null,delete this.textures[t]);},Th.prototype.removeAllTexture=function(){for(var t in this.textures)this.removeATexture(t),this.requests[t].cancel();};var Sh=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i;}};Sh.prototype.encode=function(t){return this._stringToNumber[t]},Sh.prototype.decode=function(t){return this._numberToString[t]};var Eh=function(t,e,i,r,a){var n,o,s=8*a-r-1,u=(1<<s)-1,l=u>>1,p=-7,c=i?a-1:0,h=i?-1:1,f=t[e+c];for(c+=h,n=f&(1<<-p)-1,f>>=-p,p+=s;p>0;n=256*n+t[e+c],c+=h,p-=8);for(o=n&(1<<-p)-1,n>>=-p,p+=r;p>0;o=256*o+t[e+c],c+=h,p-=8);if(0===n)n=1-l;else{if(n===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),n-=l;}return(f?-1:1)*o*Math.pow(2,n-r)},Ph=function(t,e,i,r,a,n){var o,s,u,l=8*n-a-1,p=(1<<l)-1,c=p>>1,h=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:n-1,m=r?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=p):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+c>=1?h/u:h*Math.pow(2,1-c))*u>=2&&(o++,u/=2),o+c>=p?(s=0,o=p):o+c>=1?(s=(e*u-1)*Math.pow(2,a),o+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,a),o=0));a>=8;t[i+f]=255&s,f+=m,s/=256,a-=8);for(o=o<<a|s,l+=a;l>0;t[i+f]=255&o,f+=m,o/=256,l-=8);t[i+f-m]|=128*d;},Ih=Rh;function Rh(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length;}Rh.Varint=0,Rh.Fixed64=1,Rh.Bytes=2,Rh.Fixed32=5;var Mh="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function zh(t){return t.type===Rh.Bytes?t.readVarint()+t.pos:t.pos+1}function Ch(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Oh(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var a=i.pos-1;a>=t;a--)i.buf[a+r]=i.buf[a];}function Fh(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i]);}function Lh(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i]);}function Dh(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i]);}function Nh(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i]);}function kh(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i]);}function Bh(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i]);}function Vh(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i]);}function Uh(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i]);}function jh(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i]);}function qh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Xh(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24;}function Gh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Rh.prototype={destroy:function(){this.buf=null;},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),a=r>>3,n=this.pos;this.type=7&r,t(a,e,this),this.pos===n&&this.skip(r);}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=qh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Gh(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=qh(this.buf,this.pos)+4294967296*qh(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=qh(this.buf,this.pos)+4294967296*Gh(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Eh(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Eh(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,a,n=i.buf;if(a=n[i.pos++],r=(112&a)>>4,a<128)return Ch(t,r,e);if(a=n[i.pos++],r|=(127&a)<<3,a<128)return Ch(t,r,e);if(a=n[i.pos++],r|=(127&a)<<10,a<128)return Ch(t,r,e);if(a=n[i.pos++],r|=(127&a)<<17,a<128)return Ch(t,r,e);if(a=n[i.pos++],r|=(127&a)<<24,a<128)return Ch(t,r,e);if(a=n[i.pos++],r|=(1&a)<<31,a<128)return Ch(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Mh?function(t,e,i){return Mh.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){var r="",a=e;for(;a<i;){var n,o,s,u=t[a],l=null,p=u>239?4:u>223?3:u>191?2:1;if(a+p>i)break;1===p?u<128&&(l=u):2===p?128==(192&(n=t[a+1]))&&(l=(31&u)<<6|63&n)<=127&&(l=null):3===p?(n=t[a+1],o=t[a+2],128==(192&n)&&128==(192&o)&&((l=(15&u)<<12|(63&n)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===p&&(n=t[a+1],o=t[a+2],s=t[a+3],128==(192&n)&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&n)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,p=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),a+=p;}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Rh.Bytes)return t.push(this.readVarint(e));var i=zh(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Rh.Bytes)return t.push(this.readSVarint());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Rh.Bytes)return t.push(this.readBoolean());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Rh.Bytes)return t.push(this.readFloat());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Rh.Bytes)return t.push(this.readDouble());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Rh.Bytes)return t.push(this.readFixed32());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Rh.Bytes)return t.push(this.readSFixed32());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Rh.Bytes)return t.push(this.readFixed64());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Rh.Bytes)return t.push(this.readSFixed64());var e=zh(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Rh.Varint)for(;this.buf[this.pos++]>127;);else if(e===Rh.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Rh.Fixed32)this.pos+=4;else{if(e!==Rh.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8;}},writeTag:function(t,e){this.writeVarint(t<<3|e);},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e;}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Xh(this.buf,t,this.pos),this.pos+=4;},writeSFixed32:function(t){this.realloc(4),Xh(this.buf,t,this.pos),this.pos+=4;},writeFixed64:function(t){this.realloc(8),Xh(this.buf,-1&t,this.pos),Xh(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8;},writeSFixed64:function(t){this.realloc(8),Xh(this.buf,-1&t,this.pos),Xh(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8;},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t;}(i,0,e),function(t,e){var i=(7&t)<<4;if(e.buf[e.pos++]|=i|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t;}(r,e);}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))));},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t);},writeBoolean:function(t){this.writeVarint(Boolean(t));},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,a,n=0;n<e.length;n++){if((r=e.charCodeAt(n))>55295&&r<57344){if(!a){r>56319||n+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):a=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,a=r;continue}r=a-55296<<10|r-56320|65536,a=null;}else a&&(t[i++]=239,t[i++]=191,t[i++]=189,a=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128);}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Oh(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i;},writeFloat:function(t){this.realloc(4),Ph(this.buf,t,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(t){this.realloc(8),Ph(this.buf,t,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i];},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Oh(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r;},writeMessage:function(t,e,i){this.writeTag(t,Rh.Bytes),this.writeRawMessage(e,i);},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Fh,e);},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Lh,e);},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,kh,e);},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Dh,e);},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Nh,e);},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Bh,e);},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Vh,e);},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Uh,e);},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,jh,e);},writeBytesField:function(t,e){this.writeTag(t,Rh.Bytes),this.writeBytes(e);},writeFixed32Field:function(t,e){this.writeTag(t,Rh.Fixed32),this.writeFixed32(e);},writeSFixed32Field:function(t,e){this.writeTag(t,Rh.Fixed32),this.writeSFixed32(e);},writeFixed64Field:function(t,e){this.writeTag(t,Rh.Fixed64),this.writeFixed64(e);},writeSFixed64Field:function(t,e){this.writeTag(t,Rh.Fixed64),this.writeSFixed64(e);},writeVarintField:function(t,e){this.writeTag(t,Rh.Varint),this.writeVarint(e);},writeSVarintField:function(t,e){this.writeTag(t,Rh.Varint),this.writeSVarint(e);},writeStringField:function(t,e){this.writeTag(t,Rh.Bytes),this.writeString(e);},writeFloatField:function(t,e){this.writeTag(t,Rh.Fixed32),this.writeFloat(e);},writeDoubleField:function(t,e){this.writeTag(t,Rh.Fixed64),this.writeDouble(e);},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e));}};var Wh=function(t,e,i,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=r,this.properties=t.properties,null!=t.id&&(this.id=t.id);},Yh={geometry:{configurable:!0}};Yh.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Yh.geometry.set=function(t){this._geometry=t;},Wh.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Wh.prototype,Yh);var Hh=function(t,e,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new oa(io,16,0),this.grid3D=new oa(io,16,0),this.featureIndexArray=i||new jn;};function Qh(t,e){return e-t}function Zh(t){for(var e=1/0,i=1/0,r=-1/0,a=-1/0,n=0,o=t;n<o.length;n+=1){var s=o[n];e=Math.min(e,s.x),i=Math.min(i,s.y),r=Math.max(r,s.x),a=Math.max(a,s.y);}return{minX:e,minY:i,maxX:r,maxY:a}}Hh.prototype.insert=function(t,e,i,r,a,n){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,a);for(var s=n?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],p=[1/0,1/0,-1/0,-1/0],c=0;c<l.length;c++){var h=l[c];p[0]=Math.min(p[0],h.x),p[1]=Math.min(p[1],h.y),p[2]=Math.max(p[2],h.x),p[3]=Math.max(p[3],h.y);}p[0]<io&&p[1]<io&&p[2]>=0&&p[3]>=0&&s.insert(o,p[0],p[1],p[2],p[3]);}},Hh.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Uu.VectorTile(new Ih(this.rawTileData)).layers,this.sourceLayerCoder=new Sh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Hh.prototype.query=function(t,e,i){var r=this;this.loadVTLayers();for(var a=t.params||{},n=io/t.tileSize/t.scale,o=Cr(a.filter),s=t.queryGeometry,u=t.queryPadding*n,l=Zh(s),c=this.grid.query(l.minX-u,l.minY-u,l.maxX+u,l.maxY+u),h=Zh(t.cameraQueryGeometry),f=this.grid3D.query(h.minX-u,h.minY-u,h.maxX+u,h.maxY+u,function(e,i,r,a){return function(t,e,i,r,a){for(var n=0,o=t;n<o.length;n+=1){var s=o[n];if(e<=s.x&&i<=s.y&&r>=s.x&&a>=s.y)return!0}var u=[new p(e,i),new p(e,a),new p(r,a),new p(r,i)];if(t.length>2)for(var l=0,c=u;l<c.length;l+=1)if(Ho(t,c[l]))return!0;for(var h=0;h<t.length-1;h++)if(Qo(t[h],t[h+1],u))return!0;return!1}(t.cameraQueryGeometry,e-u,i-u,r+u,a+u)}),m=0,d=f;m<d.length;m+=1){var _=d[m];c.push(_);}c.sort(Qh);for(var y,g={},v=function(u){var l=c[u];if(l!==y){y=l;var p=r.featureIndexArray.get(l),h=null;r.loadMatchingFeature(g,p.bucketIndex,p.sourceLayerIndex,p.featureIndex,o,a.layers,e,function(e,a){h||(h=Lo(e));var o={};return e.id&&(o=i.getState(a.sourceLayer||"_geojsonTileLayer",String(e.id))),a.queryIntersectsFeature(s,e,o,h,r.z,t.transform,n,t.posMatrix)});}},x=0;x<c.length;x++)v(x);return g},Hh.prototype.loadMatchingFeature=function(t,e,i,r,a,n,o,s){var u=this.bucketLayerIDs[e];if(!n||function(t,e){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(n,u)){var l=this.sourceLayerCoder.decode(i),p=this.vtLayers[l].feature(r);if(a(new Ia(this.tileID.overscaledZ),p))for(var c=0;c<u.length;c++){var h=u[c];if(!(n&&n.indexOf(h)<0)){var f=o[h];if(f){var m=!s||s(p,f);if(m){var d=new Wh(p,this.z,this.x,this.y);d.layer=f.serialize();var _=t[h];void 0===_&&(_=t[h]=[]),_.push({featureIndex:r,feature:d,intersectionZ:m});}}}}}},Hh.prototype.lookupSymbolFeatures=function(t,e,i,r,a,n){var o={};this.loadVTLayers();for(var s=Cr(r),u=0,l=t;u<l.length;u+=1){var p=l[u];this.loadMatchingFeature(o,e,i,p,s,a,n);}return o},Hh.prototype.hasLayer=function(t){for(var e=0,i=this.bucketLayerIDs;e<i.length;e+=1)for(var r=0,a=i[e];r<a.length;r+=1){if(t===a[r])return!0}return!1},ca("FeatureIndex",Hh,{omit:["rawTileData","sourceLayerCoder"]});var Jh=Ja([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_extra",components:2,type:"Uint16"}]),Kh=Ja([{name:"a_projected_pos",components:3,type:"Float32"}],4),$h=(Ja([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ja([{name:"a_placed",components:2,type:"Uint8"}],4)),tf=(Ja([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Ja([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),ef=Ja([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rf=(Ja([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),Ja([{type:"Float32",name:"offsetX"}]),Ja([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Uu.VectorTileFeature.types),af=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nf(t,e,i,r,a,n,o,s,u){t.emplaceBack(e,i,Math.round(32*r),Math.round(32*a),n,o,s?s[0]:0,s?s[1]:0,u,0);}function of(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i);}var sf=function(t){this.layoutVertexArray=new Sn,this.indexArray=new Rn,this.programConfigurations=t,this.segments=new To,this.dynamicLayoutVertexArray=new mn,this.opacityVertexArray=new gn,this.placedSymbolArray=new Dn;};sf.prototype.upload=function(t,e,i,r){i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Kh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,af,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t);},sf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());},ca("SymtrackingBuffers",sf);var uf=function(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new To,this.collisionVertexArray=new bn;};uf.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$h.members,!0);},uf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());},ca("SymtrackingCollisionBuffers",uf);var lf=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hl(this.zoom,e["text-size"]),this.iconSizeData=hl(this.zoom,e["icon-size"]);var i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sourceID=t.sourceID;};lf.prototype.createArrays=function(){this.text=new sf(new zo(Jh.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new sf(new zo(Jh.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new uf(xn,tf.members,Mn),this.collisionCircle=new uf(xn,ef.members,Rn),this.glyphOffsetArray=new kn,this.lineVertexArray=new Vn;},lf.prototype.populate=function(t,e){var i=this.layers[0],r=i.layout,a=r.get("text-font"),n=r.get("text-field"),o=r.get("icon-image"),s=("constant"!==n.value.kind||n.value.value.length>0)&&("constant"!==a.value.kind||a.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0;if(this.features=[],s||u){for(var l=e.iconDependencies,p=e.glyphDependencies,c=new Ia(this.zoom),h=0,f=t;h<f.length;h+=1){var m=f[h],d=m.feature,_=m.index,y=m.sourceLayerIndex;if(i._featureFilter(c,d)){var g=void 0;s&&(g=ul(g=i.getValueAndResolveTokens("text-field",d),i,d));var v=void 0;if(u&&(v=i.getValueAndResolveTokens("icon-image",d)),g||v){var x={text:g,icon:v,index:_,sourceLayerIndex:y,geometry:Lo(d),properties:d.properties,type:rf[d.type]};if(void 0!==d.id&&(x.id=d.id),this.features.push(x),v&&(l[v]=!0),g)for(var b=a.evaluate(d,{}).join(","),w=p[b]=p[b]||{},A="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),T=ya(g),S=0;S<g.length;S++)if(w[g.charCodeAt(S)]=!0,A&&T){var E=pl[g.charAt(S)];E&&(w[E.charCodeAt(0)]=!0);}}}}"line"===r.get("symbol-placement")&&(this.features=ll(this.features));}},lf.prototype.update=function(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));},lf.prototype.isEmpty=function(){return 0===this.symbolInstances.length},lf.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},lf.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;},lf.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();},lf.prototype.addToLineVertexArray=function(t,e){var i=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),a=t.dist(e[t.segment]),n={},o=t.segment+1;o<e.length;o++)n[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:r},o<e.length-1&&(r+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)n[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:a},s>0&&(a+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=n[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor);}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},lf.prototype.addSymbols=function(t,e,i,r,a,n,o,s,u,l){for(var p=t.indexArray,c=t.layoutVertexArray,h=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),m=this.glyphOffsetArray.length,d=f.vertexLength,_=0,y=e;_<y.length;_+=1){var g=y[_],v=g.tl,x=g.tr,b=g.bl,w=g.br,A=g.tex,T=f.vertexLength,S=g.glyphOffset[1];nf(c,s.x,s.y,v.x,S+v.y,A.x,A.y,i,n.properties.link_seq),nf(c,s.x,s.y,x.x,S+x.y,A.x+A.w,A.y,i,n.properties.link_seq),nf(c,s.x,s.y,b.x,S+b.y,A.x,A.y+A.h,i,n.properties.link_seq),nf(c,s.x,s.y,w.x,S+w.y,A.x+A.w,A.y+A.h,i,n.properties.link_seq),of(h,s,0),p.emplaceBack(T,T+1,T+2),p.emplaceBack(T+1,T+2,T+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(g.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,d,u,l,s.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],o,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,n,n.index);},lf.prototype._addCollisionDebugVertex=function(t,e,i,r,a){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,r.x,r.y,Math.round(a.x),Math.round(a.y))},lf.prototype.addCollisionDebugVertices=function(t,e,i,r,a,n,o,s){var u=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),l=u.vertexLength,c=a.layoutVertexArray,h=a.collisionVertexArray;if(this._addCollisionDebugVertex(c,h,n,o.anchor,new p(t,e)),this._addCollisionDebugVertex(c,h,n,o.anchor,new p(i,e)),this._addCollisionDebugVertex(c,h,n,o.anchor,new p(i,r)),this._addCollisionDebugVertex(c,h,n,o.anchor,new p(t,r)),u.vertexLength+=4,s){var f=a.indexArray;f.emplaceBack(l,l+1,l+2),f.emplaceBack(l,l+2,l+3),u.primitiveLength+=2;}else{var m=a.indexArray;m.emplaceBack(l,l+1),m.emplaceBack(l+1,l+2),m.emplaceBack(l+2,l+3),m.emplaceBack(l+3,l),u.primitiveLength+=4;}},lf.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var i=e[t];i.textCollisionFeature={boxStartIndex:i.textBoxStartIndex,boxEndIndex:i.textBoxEndIndex},i.iconCollisionFeature={boxStartIndex:i.iconBoxStartIndex,boxEndIndex:i.iconBoxEndIndex};for(var r=0;r<2;r++){var a=i[0===r?"textCollisionFeature":"iconCollisionFeature"];if(a)for(var n=a.boxStartIndex;n<a.boxEndIndex;n++){var o=this.collisionBoxArray.get(n),s=o.x1,u=o.y1,l=o.x2,p=o.y2,c=o.radius>0;this.addCollisionDebugVertices(s,u,l,p,c?this.collisionCircle:this.collisionBox,o.anchorPoint,i,c);}}}},lf.prototype.deserializeCollisionBoxes=function(t,e,i,r,a){for(var n={},o=e;o<i;o++){var s=t.get(o);if(0===s.radius){n.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},n.textFeatureIndex=s.featureIndex;break}n.textCircles||(n.textCircles=[],n.textFeatureIndex=s.featureIndex);n.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1);}for(var u=r;u<a;u++){var l=t.get(u);if(0===l.radius){n.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},n.iconFeatureIndex=l.featureIndex;break}}return n},lf.prototype.hasTextData=function(){return this.text.segments.get().length>0},lf.prototype.hasIconData=function(){return this.icon.segments.get().length>0},lf.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},lf.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},lf.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var i=[],r=0;r<this.symbolInstances.length;r++)i.push(r);var a=Math.sin(t),n=Math.cos(t);i.sort(function(t,i){var r=e.symbolInstances[t],o=e.symbolInstances[i];return(0|Math.round(a*r.anchor.x+n*r.anchor.y))-(0|Math.round(a*o.anchor.x+n*o.anchor.y))||o.featureIndex-r.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var o=0,s=i;o<s.length;o+=1){var u=s[o],l=e.symbolInstances[u];e.featureSortOrder.push(l.featureIndex);for(var p=0,c=l.placedTextSymbolIndices;p<c.length;p+=1)for(var h=c[p],f=e.text.placedSymbolArray.get(h),m=f.vertexStartIndex+4*f.numGlyphs,d=f.vertexStartIndex;d<m;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var _=e.icon.placedSymbolArray.get(u);if(_.numGlyphs){var y=_.vertexStartIndex;e.icon.indexArray.emplaceBack(y,y+1,y+2),e.icon.indexArray.emplaceBack(y+1,y+2,y+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}},ca("SymtrackingBucket",lf,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),lf.MAX_GLYPHS=65535,lf.addDynamicAttributes=of;var pf=Ja([{name:"a_pos",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2}]);function cf(t,e,i){var r=function(t,e){if(t)return i(t);if(e){var r=x(e,["tiles","minzoom","maxzoom","attribution","minemap_logo","bounds"]);e.vector_layers&&(r.vectorLayers=e.vector_layers,r.vectorLayerIds=r.vectorLayers.map(function(t){return t.id})),i(null,r);}};return t.url?de(e(N(t.url),he.Source),r):n.frame(function(){return r(null,t)})}var hf=function(t){function e(e,i,r,a){if(t.call(this),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this.tileUsage=i.tileUsage||"plain",v(this,x(i,["url","scheme","tileSize"])),this._options=v({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this._tileJSONRequest=cf(this._options,this.map._transformRequest,function(e,i){t._tileJSONRequest=null,e?t.fire(new we(e)):i&&(v(t,i),i.bounds&&(t.tileBounds=new vh(i.bounds,t.minzoom,t.maxzoom)),t.fire(new be("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new be("data",{dataType:"source",sourceDataType:"content"})));});},e.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},e.prototype.onAdd=function(t){this.map=t,this.load();},e.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},e.prototype.serialize=function(){return v({},this._options)},e.prototype.loadTile=function(t,e){var i=B(t.tileID.canonical.url(this.tiles,this.scheme),this.url),r={request:this.map._transformRequest(i,he.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function a(i,r){return t.aborted?e(null):i?e(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",r,a.bind(this)):"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",r,a.bind(this),t.workerID);},e.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID);},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID);},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},e}(Ae),ff=function(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.callbackID=0,A(["receive"],this),this.target.addEventListener("message",this.receive,!1);};ff.prototype.send=function(t,e,i,r){var a=i?this.mapId+":"+this.callbackID++:null;i&&(this.callbacks[a]=i);var n=[];this.target.postMessage({targetMapId:r,sourceMapId:this.mapId,type:t,id:String(a),data:fa(e,n)},n);},ff.prototype.receive=function(t){var e,i=this,r=t.data,a=r.id;if(!r.targetMapId||this.mapId===r.targetMapId){var n=function(t,e){var r=[];i.target.postMessage({sourceMapId:i.mapId,type:"<response>",id:String(a),error:t?fa(t):null,data:fa(e,r)},r);};if("<response>"===r.type)e=this.callbacks[r.id],delete this.callbacks[r.id],e&&r.error?e(ma(r.error)):e&&e(null,ma(r.data));else if(void 0!==r.id&&this.parent[r.type])this.parent[r.type](r.sourceMapId,ma(r.data),n);else if(void 0!==r.id&&this.parent.getWorkerSource){var o=r.type.split("."),s=ma(r.data);this.parent.getWorkerSource(r.sourceMapId,o[0],s.source)[o[1]](s,n);}else this.parent[r.type](ma(r.data));}},ff.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1);};var mf=function t(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=w();for(var r=this.workerPool.acquire(this.id),a=0;a<r.length;a++){var n=r[a],o=new t.Actor(n,i,this.id);o.name="Worker "+a,this.actors.push(o);}};mf.prototype.broadcast=function(t,e,i){i=i||function(){},g(this.actors,function(i,r){i.send(t,e,r);},i);},mf.prototype.send=function(t,e,i,r){return("number"!=typeof r||isNaN(r))&&(r=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[r].send(t,e,i),r},mf.prototype.remove=function(){this.actors.forEach(function(t){t.remove();}),this.actors=[],this.workerPool.release(this.id);},mf.Actor=ff;var df=function(t,e){this.maxCacheSize=e||1e3,this.terrainTiles={},this.dispatcher=t,this.order=[],this.clearTileCacheInstance=null;};df.prototype.addATerrainTile=function(t,e,i,r){var a=this;if(this.translation||(this.translation=r),this.clearTileCacheInstance?(clearTimeout(this.clearTileCacheInstance),this.clearTileCacheInstance=setTimeout(function(){a.setMaxCacheSize(a.maxCacheSize);},1e4)):this.clearTileCacheInstance=setTimeout(function(){a.setMaxCacheSize(a.maxCacheSize);},1e4),this.terrainTiles[t.key])return this.getTerrainTileByKey(t.key);if(this.order.push(t.key),!e.terrainData||e.terrainData&&(0===e.terrainData.row||0===e.terrainData.col))return null;var n=this.terrainTiles[t.key]={terrainJson:e.terrainData,triangleData:[],sphereSegments:new To,sphereMaskedBoundsBuffer:null,sphereMaskedIndexBuffer:null,col:0,row:0,dpi:0,inUse:!0,withDepthRange:!1,rP:[0,0,0],matrix:[]},o=n.sphereSegments,s=new en,u=new Rn;o.prepareSegment(0,s,u);for(var l=le.TRANSFORM.R_SCALE,p=n.terrainJson.row,c=n.terrainJson.col,h=n.terrainJson.minlon,f=n.terrainJson.minlat,m=n.terrainJson.maxlon,d=[h,n.terrainJson.maxlat],_=[m,f],y=n.terrainJson.Geometrys[0],g=Gn([],[y.x/36e4,y.y/36e4],le.TRANSFORM.R),v=[g[0]+r[0]*l,g[1]+y.z*l,g[2]+r[2]*l],x=_[0]-d[0],b=_[1]-d[1],w=[],A=0;A<p-1;A++){var T=o.prepareSegment(2*c,s,u);a._pushArrData(n.terrainJson.Geometrys[A*c],x,b,s,w,v,d,r),a._pushArrData(n.terrainJson.Geometrys[(A+1)*c],x,b,s,w,v,d,r),T.vertexLength+=2;for(var S=1;S<c;S++){a._pushArrData(n.terrainJson.Geometrys[A*c+S],x,b,s,w,v,d,r),a._pushArrData(n.terrainJson.Geometrys[(A+1)*c+S],x,b,s,w,v,d,r);var E=T.vertexLength;u.emplaceBack(E-2,E-1,E),u.emplaceBack(E,E-1,E+1),T.vertexLength+=2,T.primitiveLength+=2,n.triangleData.push([w[E-2],w[E-1],w[E]]),n.triangleData.push([w[E],w[E-1],w[E+1]]);}}return v=[v[0]+r[0]*l,v[1]+r[1]*l,v[2]+r[2]*l],n.sphereMaskedBoundsBuffer=i.createVertexBuffer(s,pf.members),n.sphereMaskedIndexBuffer=i.createIndexBuffer(u),n.col=c,n.row=p,n.dpi=n.terrainJson.dpi,n.rP=v,n.matrix=Jn(0,v,!1),n},df.prototype._pushArrData=function(t,e,i,r,a,n,o,s){var u=le.TILE.EXTENT,l=le.TRANSFORM.R_SCALE,p=Gn([],[t.x/36e4,t.y/36e4],le.TRANSFORM.R);r.emplaceBack(p[0]-n[0],p[1]+t.z*l-n[1],p[2]-n[2],(t.x-o[0])/(e*(t.z<15?513/512:1))*u,(t.y-o[1])/(i*(t.z<15?513/512:1))*u),a.push([p[0]+s[0]*l,p[1]+t.z*l+s[1]*l,p[2]+s[2]*l]);},df.prototype.getTerrainTileByKey=function(t){return this.terrainTiles[t]},df.prototype.getTerrainTileByID=function(t){return this.getTerrainTileByKey(t.key)},df.prototype.removeATerrainTile=function(t){var e=this.terrainTiles[t];e&&!e.inUse&&(e.sphereSegments.destroy(),e.sphereMaskedBoundsBuffer.destroy(),e.sphereMaskedIndexBuffer.destroy(),this.terrainTiles[t]=null,delete this.terrainTiles[t],this.order.splice(this.order.indexOf(t),1));},df.prototype.clearInUseStatus=function(){for(var t in this.terrainTiles)this.terrainTiles[t].inUse=!1,this.terrainTiles[t].withDepthRange=!1;},df.prototype.setMaxCacheSize=function(t){this.maxCacheSize=t;for(var e=this.order.length;e>this.maxCacheSize;){var i=this.order[0];this.terrainTiles[i]&&this.terrainTiles[i].inUse?(this.order.splice(this.order.indexOf(i),1),this.order.push(i)):(this.removeATerrainTile(i),e--);}this.clearTileCacheInstance=null;},df.prototype.removeAllTerrainTile=function(){for(var t in this.terrainTiles)this.removeATerrainTile(t);},df.prototype._calcAabb=function(t){for(var e=1/0,i=1/0,r=1/0,a=-1/0,n=-1/0,o=-1/0,s=0;s<t.length;s++)for(var u=t[s],l=0;l<3;l++){var p=u[l];e>p[0]&&(e=p[0]),a<p[0]&&(a=p[0]),i>p[1]&&(i=p[1]),n<p[1]&&(n=p[1]),r>p[2]&&(r=p[2]),o<p[2]&&(o=p[2]);}for(var c=[[e,i,r],[a,n,o]],h=[[1,3,2],[1,4,3],[1,2,5],[2,6,5],[2,3,6],[3,7,6],[5,6,8],[8,6,7],[1,5,4],[4,5,8],[3,4,8],[3,8,7]],f=[[c[0][0],c[0][1],c[0][2]],[c[0][0],c[0][1],c[1][2]],[c[1][0],c[0][1],c[1][2]],[c[1][0],c[0][1],c[0][2]],[c[0][0],c[1][1],c[0][2]],[c[0][0],c[1][1],c[1][2]],[c[1][0],c[1][1],c[1][2]],[c[1][0],c[1][1],c[0][2]]],m=[],d=0;d<h.length;d++){var _=h[d];m.push([f[_[0]-1],f[_[1]-1],f[_[2]-1]]);}return m},df.prototype._findHeight=function(t,e){for(var i=t[0].z,r=i,a=1;a<t.length;a++)t[a].z>i&&(i=t[a].z),t[a].z<r&&(r=t[a].z);return{max:i,min:r,middle:(i+r)/2}},df.prototype.queryOneTileIntersectPoint=function(t){var e=Math.floor(t.zoom),i=Wn([],t.td_camPos),r=new l(t.lngX(i[0])/t.tileSize,t.latY(i[1])/t.tileSize,t.zoom)._zoomTo(e),a=r.column,n=r.row;return this._findParentTileHeightOffset(a,n,e,t)},df.prototype._findParentTileHeightOffset=function(t,e,i,r){var a=this.translation?this.translation[1]+10:10,n=new uo(i,0,i,Math.round(t),Math.round(e)),o=this.getTerrainTileByKey(n.key);if(o){if(o.hasOwnProperty("_h"))return o._h+a;var s=this._findHeight(o.terrainJson.Geometrys,r.zoom).max;return o._h=s,s+a}var u=1/0,l=0;for(var p in this.terrainTiles){var c=p.split("_");c[1]!==i&&(c[2]/=Math.pow(2,c[1]-i),c[3]/=Math.pow(2,c[1]-i),c[1]=i);var h=Math.sqrt(Math.pow(t-c[2],2)+Math.pow(e-c[3],2));if(h<u){u=h;var f=this.terrainTiles[p];if(f.hasOwnProperty("_h"))l=f._h+a;else{var m=this._findHeight(f.terrainJson.Geometrys,r.zoom).max;f._h=m,l=m+a;}}}return l},df.prototype.queryTileIntersectPoint=function(t,e,i,r,a){for(var n,o=t.coveringTiles({tileSize:e.tileSize,minzoom:e.minzoom,maxzoom:e.maxzoom,roundZoom:e.roundZoom,reparseOverscaled:e.reparseOverscaled}),s=1/0,u=0;u<o.length;u++){var l=this.getTerrainTileByKey(o[u].key);if(l){l.placedAabb||(l.placedAabb=this._calcAabb(l.triangleData));for(var p=0;p<l.placedAabb.length;p++){if(r.intersectTriangle.apply(r,l.placedAabb[p].concat([!1],[[]])))for(var c=0;c<l.triangleData.length;c++){var h=r.intersectTriangle.apply(r,l.triangleData[c].concat([!1],[[]]));if(h){var f=Nt(r.origin,h);f<s&&(n=h,s=f);}}}}}var m=Wn([],n);return n?{intersectionZ:s,intersectionPoint:n,lngLat:[m[0],m[1]],alt:m[2]*le.TRANSFORM.R_ZOOM-le.TRANSFORM.REAL_R}:{}};var _f=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.dispatcher=r,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.tileUsage="plain",this.noLowLevelCover=!!i.noLowLevelCover,this._options=v({},i),v(this,x(i,["url","scheme","tileSize","tileUsage","tiles","renderWithTerrain","terrainTiles","translation"])),this.translation||(this.translation=[0,0,0]);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setSharedTerrainTileCache=function(t){this.sttc=t;},e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this._tileJSONRequest=cf(this._options,this.map._transformRequest,function(e,i){t._tileJSONRequest=null,e?t.fire(new we(e)):i&&(v(t,i),i.bounds&&(t.tileBounds=new vh(i.bounds,t.minzoom,t.maxzoom)),t.fire(new be("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new be("data",{dataType:"source",sourceDataType:"content"})));});},e.prototype.onAdd=function(t){this.map=t,this.load();},e.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},e.prototype.serialize=function(){return v({},this._options)},e.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},e.prototype.loadTile=function(t,e){var i=B(t.tileID.canonical.url(this.tiles,this.scheme),this.url),r=this.renderWithTerrain?B(t.tileID.canonical.url(this.terrainTiles,this.scheme),this.url):"",a={request:this.map._transformRequest(i,he.Tile),terrainRequest:{url:r},renderWithTerrain:this.renderWithTerrain&&t.tileID.canonical.z>=le.TRANSFORM.TERRAIN_FIND_ZOOM_MIN,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:n.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function o(i,r){return t.aborted?e(null):i?e(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadImgAOTerrainData(r,this.map.painter,!1,this.renderWithTerrain&&t.tileID.canonical.z>=le.TRANSFORM.TERRAIN_FIND_ZOOM_MIN,this.translation,this.sttc,e),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",a,o.bind(this)):"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",a,o.bind(this),t.workerID);},e.prototype.abortTile=function(t,e){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID),e();},e.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID),e();},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},e}(Ae),yf=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.tileUsage=i.tileUsage||"plain",this.dispatcher=r,this.setEventedParent(a),this._data=i.data,this._options=v({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.noBox=i.noBox;var n=io/this.tileSize;this.workerOptions=v({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*n,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*n,extent:io,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:io,radius:(i.clusterRadius||50)*n,log:!1}},i.workerOptions);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)t.fire(new we(e));else{var i={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(i.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new be("data",i));}});},e.prototype.onAdd=function(t){this.map=t,this.load();},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire(new be("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)e.fire(new we(t));else{var i={dataType:"source",sourceDataType:"content"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new be("data",i));}}),this},e.prototype.getClusterExpansionZoom=function(t,e){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e,this.workerID),this},e.prototype.getClusterChildren=function(t,e){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e,this.workerID),this},e.prototype.getClusterLeaves=function(t,e,i,r){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},r,this.workerID),this},e.prototype._updateWorkerData=function(t){var e=this,i=v({},this.workerOptions),r=this._data;"string"==typeof r?(i.request=this.map._transformRequest(n.resolveURL(r),he.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this.workerID=this.dispatcher.send(this.type+".loadData",i,function(r,a){e._removed||a&&a.abandoned||(e._loaded=!0,a&&a.resourceTiming&&a.resourceTiming[e.id]&&(e._resourceTiming=a.resourceTiming[e.id].slice(0)),e.dispatcher.send(e.type+".coalesce",{source:i.source},null,e.workerID),t(r));},this.workerID);},e.prototype.loadTile=function(t,e){var i=this,r=void 0===t.workerID?"loadTile":"reloadTile",a={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:n.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send(r,a,function(a,n){return t.unloadVectorData(),t.aborted?e(null):a?e(a):(t.loadVectorData(n,i.map.painter,"reloadTile"===r),e(null))},this.workerID);},e.prototype.abortTile=function(t){t.aborted=!0;},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID);},e.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);},e.prototype.serialize=function(){return v({},this._options,{type:this.type,data:this._data})},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},e}(Ae);function gf(t){for(var e=0,i=Object.getOwnPropertyNames(t.constructor.prototype);e<i.length;e+=1){var r=i[e],a=t[r];"constructor"!==r&&"function"==typeof a&&(t[r]=a.bind(t));}return t}var vf=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.grid=i.grid,this.wms=!!i.wms&&i.wms,this.url=i.url,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(a),this.options=i,this.tileUsage=i.tileUsage,gf(this);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._moveFn=function(){var t=this.map,e=t.unproject([0,0]),i=t.unproject([t.transform.width,0]),r=t.unproject([t.transform.width,t.transform.height]),a=t.unproject([0,t.transform.height]),n=Math.min(e.lat,i.lat,r.lat,a.lat),o=Math.min(e.lng,i.lng,r.lng,a.lng),s=Math.max(e.lat,i.lat,r.lat,a.lat),u=Math.max(e.lng,i.lng,r.lng,a.lng),l=o+","+n+","+u+","+s,p=Math.ceil(t.transform.width),c=Math.ceil(t.transform.height),h=Math.ceil(t.transform.zoom);this.options.url=this.wmsUrl.replace("{bounds}",l).replace("{width}",p).replace("{height}",c).replace("{z}",h);var f=[[o,s],[u,s],[u,n],[o,n]];this.setUrl(this.options.url,f);},e.prototype.setUrl=function(t,e){var i=this;this.url=t,this.options.url=t,ye(this.map._transformRequest(this.url,he.Image),function(t,r){t?i.fire(new we(t)):r&&(i.image=n.getImageData(r),delete i.texture,e&&(i.coordinates=e),i._finishLoading());});},e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this.url=this.options.url,ye(this.map._transformRequest(this.url,he.Image),function(e,i){e?t.fire(new we(e)):i&&(t.image=n.getImageData(i),t._finishLoading());});},e.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new be("data",{dataType:"source",sourceDataType:"metadata"})));},e.prototype.onAdd=function(t){if(this.map=t,this.wms){this.wmsUrl||(this.wmsUrl=this.options.url);var e=Math.ceil(t.transform.width),i=Math.ceil(t.transform.height),r=Math.ceil(t.transform.zoom),a=t.getBounds()._sw.lng+","+t.getBounds()._sw.lat+","+t.getBounds()._ne.lng+","+t.getBounds()._ne.lat;this.options.url=this.wmsUrl.replace("{bounds}",a).replace("{width}",e).replace("{height}",i).replace("{z}",r),this.coordinates=[t.getBounds().getNorthWest().toArray(),t.getBounds().getNorthEast().toArray(),t.getBounds().getSouthEast().toArray(),t.getBounds().getSouthWest().toArray()],this.setCoordinates(this.coordinates),this.map.on("moveend",this._moveFn);}this.load();},e.prototype.onRemove=function(){this.map.off("moveend",this._moveFn);},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,i=t.map(function(t){return e.transform.locationCoordinate(qa.convert(t)).zoomTo(0)}),r=this.centerCoord=function(t){for(var e=1/0,i=1/0,r=-1/0,a=-1/0,n=0;n<t.length;n++)e=Math.min(e,t[n].column),i=Math.min(i,t[n].row),r=Math.max(r,t[n].column),a=Math.max(a,t[n].row);var o=r-e,s=a-i,u=Math.max(o,s),p=Math.max(0,Math.floor(-Math.log(u)/Math.LN2));return new l((e+r)/2,(i+a)/2,0).zoomTo(p)}(i);r.column=Math.floor(r.column),r.row=Math.floor(r.row),this.tileID=new oo(r.zoom,r.column,r.row),this.minzoom=this.maxzoom=r.zoom;var a=i.map(function(t){var e=t.zoomTo(r.zoom);return new p(Math.round((e.column-r.column)*io),Math.round((e.row-r.row)*io))}),n=[a[3].x,a[3].y],o=[a[2].x,a[2].y],s=[a[0].x,a[0].y],u=[a[1].x,a[1].y],c=!1,h=null;"all"!==this.tileUsage&&"sphere"!==this.tileUsage||(c=!0,this._sphereBoundsArray=new en,this._sphereIndexArray=new Rn,this.sphereSegments=new To,this.sphereSegments.prepareSegment(0,this._sphereBoundsArray,this._sphereIndexArray),h=this.sphereSegments.prepareSegment(4,this._sphereBoundsArray,this._sphereIndexArray)),this._boundsArray=new tn,this._indexArray=new Rn,this.segments=new To,this.segments.prepareSegment(0,this._boundsArray,this._indexArray);for(var f=this.segments.prepareSegment(4,this._boundsArray,this._indexArray),m=0;m<=19;m++)for(var d=[n[0]+(s[0]-n[0])/19*m,n[1]+(s[1]-n[1])/19*m],_=[o[0]+(u[0]-o[0])/19*m,o[1]+(u[1]-o[1])/19*m],y=0;y<=19;y++){var g=[d[0]+(_[0]-d[0])/19*y,d[1]+(_[1]-d[1])/19*y],v=[y/19*io,(1-m/19)*io];if(this._boundsArray.emplaceBack(parseInt(g[0]),parseInt(g[1]),parseInt(v[0]),parseInt(v[1])),f.vertexLength++,c){var x=Yn(g[0],g[1],1,r.column,r.row,r.zoom,null);this.spaceBasePos||(this.spaceBasePos=x,this.matrix=Jn(0,this.spaceBasePos,!1)),this._sphereBoundsArray.emplaceBack(x[0]-this.spaceBasePos[0],x[1]-this.spaceBasePos[1],x[2]-this.spaceBasePos[2],parseInt(v[0]),parseInt(v[1])),h.vertexLength++;}var b=y+20*m;19!==m&&19!==y&&(this._indexArray.emplaceBack(b,b+20+1,b+20),this._indexArray.emplaceBack(b,b+1,b+20+1),f.primitiveLength+=2,c&&(this._sphereIndexArray.emplaceBack(b,b+20+1,b+20),this._sphereIndexArray.emplaceBack(b,b+1,b+20+1),h.primitiveLength+=2));}return this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.indexBuffer&&(this.indexBuffer.destroy(),delete this.indexBuffer),this.sphereBoundsBuffer&&(this.sphereBoundsBuffer.destroy(),delete this.sphereBoundsBuffer),this.sphereIndexBuffer&&(this.sphereIndexBuffer.destroy(),delete this.sphereIndexBuffer),this.fire(new be("data",{dataType:"source",sourceDataType:"content"})),this},e.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,e=t.gl;for(var i in"all"!==this.tileUsage&&"plane"!==this.tileUsage||this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,bh.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),"all"!==this.tileUsage&&"sphere"!==this.tileUsage||this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,wh.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture||(this.texture=new Pc(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture);}}},e.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null));},e.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},e}(Ae),xf=function(t){function e(e,i,r,a){t.call(this,e,i,r,a),this.roundZoom=!0,this.type="video",this.options=i;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this,e=this.options;this.urls=[];for(var i=0,r=e.urls;i<r.length;i+=1){var a=r[i];t.urls.push(t.map._transformRequest(a,he.Source).url);}ge(this.urls,function(e,i){e?t.fire(new we(e)):i&&(t.video=i,t.video.loop=!0,t.video.addEventListener("playing",function(){t.map.triggerRepaint();}),t.map&&t.video.play(),t._finishLoading());});},e.prototype.getVideo=function(){return this.video},e.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)));},e.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,e=t.gl;for(var i in"all"!==this.tileUsage&&"plane"!==this.tileUsage||this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,bh.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),"all"!==this.tileUsage&&"sphere"!==this.tileUsage||this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,wh.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new Pc(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture);}}},e.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},e.prototype.hasTransition=function(){return this.video&&!this.video.paused},e}(vf),bf=function(t){function e(e,i,r,a){t.call(this,e,i,r,a),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new we(new Se("sources."+e,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new we(new Se("sources."+e,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new we(new Se("sources."+e,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof self.HTMLCanvasElement||this.fire(new we(new Se("sources."+e,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new we(new Se("sources."+e,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof self.HTMLCanvasElement?this.options.canvas:self.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new we(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint();},this.pause=function(){this._playing=!1;},this._finishLoading());},e.prototype.getCanvas=function(){return this.canvas},e.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play();},e.prototype.onRemove=function(){this.pause();},e.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var e=this.map.painter.context,i=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,bh.members)),this.boundsVAO||(this.boundsVAO=new xh),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.canvas)):(this.texture=new Pc(e,this.canvas,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var a=this.tiles[r];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture);}}},e.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},e.prototype.hasTransition=function(){return this._playing},e.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},e.prototype.isEarthSource=function(){return!1},e}(vf),wf=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.dispatcher=r,this.type="sphere-image",this.minzoom=0,this.maxzoom=22,this.setEventedParent(a),this._options=i,this.renderAtmosphere=i.renderAtmosphere||!1,this.dayTextureUrl=i.dayTextureUrl||null,this.nightTextureUrl=i.nightTextureUrl||null;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this.url=this._options.url;var e=[];ye(this.map._transformRequest(this.url,he.Image),function(i,r){i?t.fire(new we(i)):r&&(t.image=r),e.push(0),t._promiseDelegate(e);}),this.dayTextureUrl?ye(this.map._transformRequest(this.dayTextureUrl,he.Image),function(i,r){i?t.fire(new we(i)):r&&(t.dayTextureImage=r),e.push(0),t._promiseDelegate(e);}):this.nightTextureUrl&&ye(this.map._transformRequest(this.nightTextureUrl,he.Image),function(i,r){i?t.fire(new we(i)):r&&(t.nightTextureImage=r),e.push(0),t._promiseDelegate(e);});},e.prototype._promiseDelegate=function(t){this.dayTextureUrl&&2!==t.length||this.nightTextureUrl&&2!==t.length||this._finishLoading();},e.prototype._finishLoading=function(){this.map&&(this.prepare(),this.fire(new be("data",{dataType:"source",sourceDataType:"metadata"})));},e.prototype.onAdd=function(t){this.map=t,this.load();},e.prototype.prepare=function(){var t=this.map.painter.context,e=t.gl;!this.texture&&this.image&&(this.texture=new Pc(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.dayTextureImage&&!this.dayTexture&&(this.dayTexture=new Pc(t,this.dayTextureImage,e.RGBA),this.dayTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.nightTextureImage&&!this.nightTexture&&(this.nightTexture=new Pc(t,this.nightTextureImage,e.RGBA),this.nightTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE));},e.prototype.serialize=function(){return{type:"sphere-image",url:this._options.url,renderInner:this._options.renderInner,radius:this._options.radius,gridSamples:this._options.gridSamples,extractRadius:this._options.extractRadius,debug:this._options.debug||!1,renderAtmosphere:this._options.renderAtmosphere||!1,dayTextureUrl:this._options.dayTextureUrl||null,nightTextureUrl:this._options.nightTextureUrl||null}},e.prototype.loadTile=function(){},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return!0},e}(Ae),Af=function(t,e,i,r,a,n){void 0===n&&(n=!1),this.gltf=t,this.context=e,this.bufferData=i,this.dataContext=r,this.filter=a,this.primitiveInd=0,this.primitiveDataInd=0,this.vbuffer=[],this.ibuffer=[],this.nodeInd=void 0,this.needTriangle=n,this.processGLTF();};Af.prototype.processGLTF=function(){var t=this,e=this.dataContext,i=this.gltf,r=i.scene||0;this.sceneName=i.scenes[r].name,this.processAnimation(),i.scenes.forEach(function(e,i){t.processScene(i);}),i.materials.forEach(function(e,i){t.processMaterial(i);}),i.asset.range&&(e.range=i.asset.range);},Af.prototype.processAnimation=function(){var t=this.dataContext,e=this.gltf,i=this.bufferData;e.animations&&e.animations.length>0&&(t.animations=[],t._hasModelAnimation=!0);for(var r=0;e.animations&&r<e.animations.length;r++){for(var a=e.animations[r],n={channels:[]},o=0;o<a.channels.length;o++){var s=a.samplers[a.channels[o].sampler],u=Object.assign({},e.bufferViews[e.accessors[s.input].bufferView]);u.count=e.accessors[s.input].count,u.type=e.accessors[s.input].type,u.componentType=e.accessors[s.input].componentType,u.byteOffset+=e.accessors[s.input].byteOffset||0;var l=Object.assign({},e.bufferViews[e.accessors[s.output].bufferView]);l.count=e.accessors[s.output].count,l.type=e.accessors[s.output].type,l.componentType=e.accessors[s.output].componentType,l.byteOffset+=e.accessors[s.output].byteOffset||0;var p=Kd(i[l.buffer],u,l);n.channels.push({count:p.input.length,node:a.channels[o].target.node,path:a.channels[o].target.path,input:p.input,output:p.output,interpolation:s.interpolation});}t.animations.push(n);}},Af.prototype.processScene=function(t){var e=this;this.dataContext;this.gltf.scenes[t].nodes.forEach(function(t){e.processNode(t);});},Af.prototype.processNode=function(t,e){var i=this,r=this.dataContext,a=this.gltf,n=this.filter;this.context;if(!r.nodes||!r.nodes.hasOwnProperty(t)){var o=a.nodes[t];this.nodeInd=t;var s={};r.nodes[t]=s;var u=null;if(a.animations&&a.animations.length>0&&r.animations.map(function(t,e){return t.channels.map(function(t,r){return i.nodeInd===t.node&&(u={ani:e,cha:r}),null})}),o.children&&o.children.length>0&&(r.nodes[t]=Object.assign(s,{hasChild:!0,nodeInd:t,children:o.children,properties:{name:o.name||"",sceneName:this.sceneName,fatherName:e}}),o.children.forEach(function(t){i.processNode(t,o.name);})),o.hasOwnProperty("mesh")){var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=o.name||"",c=o.extras,h=[],f=!0;if(n&&!n(new Ia(17),{properties:{name:p}}))return;o.translation&&(o.translation[0]||o.translation[1]||o.translation[2])&&(lt(l,l,o.translation),f=!1),o.rotation&&(f=!1,3===o.rotation.length?(o.rotation[0]&&(f=!1,ct(l,l,o.rotation[0]*le.TRANSFORM.DEG_TO_RAD)),o.rotation[1]&&(f=!1,ht(l,l,o.rotation[1]*le.TRANSFORM.DEG_TO_RAD)),o.rotation[2]&&(f=!1,ft(l,l,o.rotation[2]*le.TRANSFORM.DEG_TO_RAD))):4===o.rotation.length&&vt(l,l,dt([],o.rotation))),!o.scale||1===o.scale[0]&&1===o.scale[1]&&1===o.scale[2]||(pt(l,l,o.scale),f=!1),o.location&&(h=o.location),r.nodes[t]=Object.assign(s,{nodeInd:t,meshInd:o.mesh,mesh:o.mesh,matrix:l,location:h,identityMatrix:f,properties:{name:o.name||"",sceneName:this.sceneName,fatherName:e,flowTexture:o.flowTexture||!1},userNodeData:c,animation:u||null}),this.processMesh(o.mesh);}}},Af.prototype.processMesh=function(t){var e=this,i=this.dataContext,r=this.gltf,a=this.context,n=this.bufferData,o=this.vbuffer,s=this.ibuffer,u=r.meshes[t];if(!i.meshes[t]){var l,p={primitivesInd:[],properties:{meshName:u.name||""}};if(u.primitives&&u.primitives.length>0)for(var c=0;c<u.primitives.length;c++){var h={},f=!!(u.primitives[c].targets&&u.primitives[c].targets.length>0),m=wc(r,t,c,h,f),d=u.primitives[c].indices,_=r.accessors[d],y=r.bufferViews[_.bufferView];o[y.buffer]?l=new Rc(a,n[y.buffer],m.members,!1,o[y.buffer]):(l=new Rc(a,n[y.buffer],m.members,!1),o[y.buffer]=l.getBuffer());var g=u.primitives[c].attributes.POSITION,v=r.accessors[g],x=v?[v.min.concat(1),v.max.concat(1)]:[],b=u.primitives[c].mode,w=u.primitives[c].material||0,A=void 0,T=(_.byteOffset?_.byteOffset:0)+(y.byteOffset?y.byteOffset:0),S=_.componentType,E=_.count;h.IB={offset:T,byteStride:2,count:E,type:S},s[y.buffer]?A=new Ic(a,n[y.buffer],void 0===b?a.gl.TRIANGLES:b,E,S,T,!1,s[y.buffer]):(A=new Ic(a,n[y.buffer],void 0===b?a.gl.TRIANGLES:b,E,S,T,!1),s[y.buffer]=A.getBuffer()),p.primitivesInd.push(e.primitiveInd),i.primitives[e.primitiveInd]={primitiveInd:e.primitiveInd,gltfVertexBuffer:l,gltfIndexBuffer:A,material:w,aabb:x,intersectOptions:{bufViewBufferIndex:y.buffer,bufferDataConfig:h,triangleData:[],placedTriangleData:[]},properties:{primitiveName:u.primitives[c].name||"PrimitiveID"+e.primitiveInd},isSkinModel:f,triangleData:e.needTriangle?$d(n[y.buffer],h):void 0},e.primitiveInd++,e.primitiveDataInd++;}i.meshes[t]=p;}var P=i.meshes[t];P&&(Array.isArray(i.nodes[this.nodeInd].primitiveStack)||(i.nodes[this.nodeInd].primitiveStack=[]),P.primitivesInd.forEach(function(t){var r={primitiveDataInd:e.primitiveDataInd++,placedTriangleData:[],primitiveInd:t};i.nodes[e.nodeInd].primitiveStack.push(r);}));},Af.prototype.processMaterial=function(t){var e=this.dataContext,i=this.gltf,r=this.context,a=(this.bufferData,this.vbuffer,this.ibuffer,r.gl);if(i.materials&&!e.materials[t]){var o=i.materials[t],s={baseColorFactor:o.pbrMetallicRoughness.baseColorFactor?o.pbrMetallicRoughness.baseColorFactor:null,baseColorTexture:{index:o.pbrMetallicRoughness.baseColorTexture?o.pbrMetallicRoughness.baseColorTexture.index:le.SOURCE.ERROR_IMG_INDEX},alphaMode:o.alphaMode||"OPAQUE",doubleSided:o.doubleSided||!1,materialParams:null,sampler:0};if(s.name=o.name||void 0,i.textures&&i.textures.length>0&&(s.sampler=i.textures[o.pbrMetallicRoughness.baseColorTexture?o.pbrMetallicRoughness.baseColorTexture.index:0].sampler),o.materialParams&&(s.materialParams=o.materialParams),e.materials[t]=s,i.images&&0!==i.images.length){var u=i.textures,l=o.pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.index;if(l||0===l){if(e.textures[l])return e.textures[l];if(e instanceof Wd){var p=i.images[u[l].source].uri,c=e.modelType===le.MODEL_TYPE.OSGB?e.modelFolder+"/"+p.substr(0,14)+"/"+p:e.modelFolder+"/"+p;p=n.resolveURL(c),e.textures[l]=i.images[u[l].source].uri,e.sharedTexture.addATexture(i.images[u[l].source].uri,p,r);}else{var h=i.images[u[l].source].uri;if(h.startsWith("data:image")){var f=new Image;f.onload=function(){var t=new Pc(r,f,a.RGBA,{useMipmap:!0});t.bind(a.LINEAR,a.CLAMP_TO_EDGE),e.textures[l]=t;},f.src=h;}else d=l,ye((m=e).map._transformRequest(e.modelFolder+"\\"+h,he.Image),function(t,e){if(t)m.fire(new we(t));else if(e){var i=new Pc(r,e,a.RGBA,{useMipmap:!0});i.bind(a.LINEAR,a.CLAMP_TO_EDGE),m.textures[d]=i,m.fire(new be("data",{data:"texture"}));}});}var m,d;}}}};var Tf=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.type="3d-model",this.minzoom=15,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=r,this.setEventedParent(a),this.textures=[],this.scenes=[],this.nodes=[],this.meshes=[],this.primitives=[],this._data=i.data,this._options=v({},i),this.location=i.location||[0,0],this.upAxis=i["up-axis"]||"Y-UP",this.materials=[],this.modelFolder=i.modelFolder,this.scale=i.scale,this.rotation=i.rotation,this.translation=i.translation||[0,0,0],this.noBox=i.noBox,this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.filter=i.filter,this._pickable=i.pickable||!1,this.boolAABBCalculated=!1,this.noQuery=!!i.hasOwnProperty("noQuery")&&i.noQuery,this.workerOptions=v({location:this.location,upAxis:this.upAxis},i.workerOptions),this.filter&&this.setFilter(this.filter),i.aabbFilter&&this.setAABBFilter(i.aabbFilter),this.ratioRange=i.ratioRange||[[0,1],[0,1],[0,1]],this.clampBox=i.clampBox||{x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0,translation:[0,0,0]},this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.maxClampBounds=[-1/0,-1/0,-1/0],this.minClampBounds=[1/0,1/0,1/0],this.clampPlane=i.clampPlane||[0,0,0,0],this._clampEnabled=i.clampEnabled||!1,this.uploaded=!1,this.isModeling=i.isModeling,this.respectiveTransformation=i.respectiveTransformation||!1,this.configuration=i.configuration?"string"==typeof i.configuration?JSON.parse(i.configuration):i.configuration:{},this.identityMatrix=!0,this.noHighlighting=i.noHighlighting||!1;}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={clampEnabled:{configurable:!0}};return i.clampEnabled.set=function(t){this._clampEnabled=t;},i.clampEnabled.get=function(){return this._clampEnabled},e.prototype.setClampRange=function(t){Array.isArray(t)&&(this.ratioRange=t,this.fire(new be("data",{data:t})));},e.prototype.setClampBox=function(t){!t instanceof Object&&(console.warn("参数应为裁剪盒子对象"),t={x:1,y:1,z:1,rotateX:0,rotateY:0,rotateZ:0,anchor:this.location,inner:!0,translation:[0,0,0]}),this.clampBox=Object.assign(this.clampBox,t),this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.fire(new be("data",{data:this.clampBox}));},e.prototype.getClampBoxMatrix=function(t,e){var i=t.rotateX,r=t.rotateY,a=t.rotateZ,n=t.anchor,o=t.translation;o&&(n=to(n,o));var s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ft(s,s,-a*le.TRANSFORM.DEG_TO_RAD),ct(s,s,-i*le.TRANSFORM.DEG_TO_RAD),ht(s,s,-r*le.TRANSFORM.DEG_TO_RAD);var u=$n(n,e);return lt(s,s,[-u[0],-u[1],-u[2]]),s},e.prototype.setClampPlane=function(t){Array.isArray(t)&&(this.clampPlane=t,this.fire(new be("data",{data:t})));},e.prototype.clearClampPlane=function(){this.clampPlane=[0,0,0,0],this.fire(new be("data",{data:this.clampPlane}));},e.prototype.clearClampBox=function(){this.clampBox={x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0},this.fire(new be("data",{data:this.clampBox}));},e.prototype.setFilter=function(t){this._featureFilter=Cr(t),this.boolAABBCalculated=!1;},e.prototype.enablePick=function(){this._pickable=!0;},e.prototype.setAABBFilter=function(t){this._aabbFilter=Cr(t);},e.prototype.disablePick=function(){this._pickable=!1;},e.prototype.clearPick=function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];if(e.primitiveStack)for(var i=0;i<e.primitiveStack.length;i++){e.primitiveStack[i].highlight=!1;}}this.fire(new be("data",{}));},e.prototype.queryRenderedFeatures=function(t,e,i,r,a,n){for(var o,s=[],u=1/0,l=[],p=0;p<this.nodes.length;p++){var c=this.nodes[p],h=this.meshes[this.nodes[p].mesh];if(c.primitiveStack)for(var f=0;f<h.primitivesInd.length;f++){for(var m=this.primitives[h.primitivesInd[f]],d=Zd(this,this,c,m.aabb),_=0;_<d.length;_++){if(a.intersectTriangle.apply(a,d[_].concat([!1],[[]]))){for(var y=Qd(this,this,c,$d(this.gltfParser.bufferData[m.intersectOptions.bufViewBufferIndex],m.intersectOptions.bufferDataConfig)),g=0;g<y.length;g++){var v=a.intersectTriangle.apply(a,y[g].concat([!1],[[]]));if(v){var x=Nt(a.origin,v);x<u&&(l=v,u=x,s[0]=c.primitiveStack[f],o=c.properties);}}y=null;}}d=null;}}return s[0]?[{_parent:this,properties:Object.assign({},o),primitiveData:s[0],intersectionPoint:l,intersectionZ:u}]:s},e.prototype.highlightMesh=function(t){if(this.clearPick(),!this.noHighlighting)for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e];if(i.primitiveStack)for(var r=0;r<i.primitiveStack.length;r++){var a=i.primitiveStack[r];a.primitiveDataInd===t.primitiveData.primitiveDataInd&&(a.highlight=!0);}}},e.prototype._calAccessorBox=function(t){Qd(this,this,t);},e.prototype.setGltfData=function(t){for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e];if(i.primitiveStack)for(var r=0;r<i.primitiveStack.length;r++){var a=i.primitiveStack[r],n=this.primitives[a.primitiveInd];n.gltfIndexBuffer.destroy(),n.gltfVertexBuffer.destroy();}}this.nodes=[],this.meshes=[],this.primitives=[];for(var o=0;o<this.textures.length;o++)this.textures[o].destroy();this.textures=[],this.materials=[],t&&t.data&&(this._data=t.data,this.modelFolder=t.modelFolder||this.modelFolder,this.load());},e.prototype.changeGltfOption=function(t){if((t=t||{}).material){var e=t.material,i=e.name,r=e.options;this.materials.forEach(function(t){if(t.name===i&&r.hasOwnProperty("opacity")){var e=r.opacity;console.log(t,t.baseColorFactor),t.baseColorFactor&&t.baseColorFactor instanceof Array?t.baseColorFactor[3]=e:t.baseColorFactor=[1,1,1,e];}});}},e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)t.fire(new we(e));else{var i={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(i.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new be("data",i));}});},e.prototype.onAdd=function(t){this.map=t,this.load();},e.prototype.setLocation=function(t){var e=this;return this.location=t,this.fire(new be("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)e.fire(new we(t));else{var i={dataType:"source",sourceDataType:"content"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new be("data",i));}}),this},e.prototype.prepare=function(){this.uploaded||(this._processGLBuffers(),this.uploaded=!0);},e.prototype._updateWorkerData=function(t){var e=this,i=v({},this.workerOptions);i.location=this.location,i.source=this.id;var r=this._data;"string"==typeof r?(i.request=this.map._transformRequest(n.resolveURL(r),he.Source),i.request.collectResourceTiming=this._collectResourceTiming,this.workerID=this.dispatcher.send(this.type+".loadData",i,function(r,a){e._removed||a&&a.abandoned||(e._loaded=!0,e.result=a,e._processGLBuffers(),a&&a.resourceTiming&&a.resourceTiming[e.id]&&(e._resourceTiming=a.resourceTiming[e.id].slice(0)),e.dispatcher.send(e.type+".coalesce",{source:i.source},null,e.workerID),t(r));},this.workerID)):(this.result={gltf:this._data,bufferData:this._data.buffers.map(function(t){return t.data[0]}),resourceTiming:{}},this._processGLBuffers());},e.prototype.calcBaseMatrix=function(){Jd(this,this);},e.prototype._processGLBuffers=function(){var t=this.result;if(t){this.gltfModelVAO||(this.gltfModelVAO=new xh);var e=t.gltf;Jd(this,this);var i=this.map.painter.context;this.samplers=e.samplers||[{magFilter:9729,minFilter:9986,wrapS:i.gl.CLAMP_TO_EDGE,wrapT:10497}],this.gltfParser=new Af(e,i,t.bufferData,this,this._featureFilter,"airline"===this.configuration.renderType),e.scenes[0].extras&&(this.sceneConf=e.scenes[0].extras);for(var r=0;r<e.meshes.length;r++)for(var a=0;a<e.meshes[r].primitives.length;a++)for(var n=e.meshes[r].primitives[a].attributes.POSITION,o=e.accessors[n],s=o.min,u=o.max,l=0;l<3;l++)s[l]<this.minClampBounds[l]&&(this.minClampBounds[l]=s[l]),u[l]>this.maxClampBounds[l]&&(this.maxClampBounds[l]=u[l]);}},e.prototype.loadTile=function(t,e){},e.prototype.abortTile=function(t){t.aborted=!0;},e.prototype.unloadGPUData=function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];if(e.primitiveStack)for(var i=0;i<e.primitiveStack.length;i++){var r=e.primitiveStack[i],a=this.primitives[r.primitiveInd];a.gltfIndexBuffer.destroy(),a.gltfVertexBuffer.destroy();}}this.uploaded=!1,this.nodes=[],this.meshes=[],this.primitives=[];},e.prototype.unloadTile=function(t){},e.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);},e.prototype.serialize=function(){return v({},this._options,{type:this.type,data:this._data,maxzoom:this.maxzoom,bounds:this.bounds,location:this.location,"up-axis":this.upAxis})},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return!0},Object.defineProperties(e.prototype,i),e}(Ae),Sf=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.dispatcher=r,this.type="panorama",this.minzoom=0,this.maxzoom=22,this.dataType=i.dataType||"equirectangular",this.setEventedParent(a),this._options=i,this._location=i.location,this._photoId=i.photoId,this._staticImgUrl=this._options.url.substring(0,this._options.url.indexOf("get-panorama"))+"static/pano/",this._strictRefresh=!0,this._eles=[],gf(this);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._animateMapZoom=function(t,e,i,r){this._frame&&this.map._cancelRenderFrame(this._frame);var a=Date.now()-this._startTime;a<1e3?(this.map.setZoom(a/1e3*6.5),this._frame=this.map._requestRenderFrame(this._animateMapZoom.bind(this,t,e,i,r))):this.setPhotoId(t,e,i,r);},e.prototype._distanceMouseMoveCallBack=function(t){var e=this.map;if(this._panoJson&&e.panoramaMode){var i=this._panoJson.properties.angle.pitch*Math.sin(Math.abs(t.lngLat.lat/2));if(!e.panoramaMode||t.lngLat.lat-i<0||t.lngLat.lat-i>17)this._distanceNodeElementWrapper&&(this._distanceNodeElementWrapper.style.display="none");else{this._distanceNodeElementWrapper&&(this._distanceNodeElementWrapper.style.display="block"),this._distanceNodeElementWrapper||(this._distanceNodeElementWrapper=q.create("div","minemap-panorama-distance-wrapper",e.getCanvasContainer()),this._distanceNodeElement=q.create("div","minemap-panorama-distance-circle",this._distanceNodeElementWrapper),this._distanceNodeText=q.create("div","minemap-panorama-distance-text",this._distanceNodeElementWrapper),this._distanceNodeText.innerText="向前移动5米",this._distanceNodeElement.extra={distance:0,directional:"front",directionalId:"",directionalChange:0},q.addEventListener(this._distanceNodeElement,"click",this._panoControlCallBack));for(var r=this._panoJson.properties.links,a=null,n=t.lngLat.lng-180,o=0;o<r.length;o++){var s=r[o].angleRange;s.min>s.max?(n>=-180&&n<=s.max||n>=s.min&&n<=180)&&(a=r[o]):n>=s.min&&n<=s.max&&(a=r[o]);}if(!a)return this._distanceNodeElement.extra={distance:0,directional:null,directionalId:"",directionalChange:0},void(this._distanceNodeElementWrapper.style.display="none");if(this._distanceNodeElementWrapper.style.top=t.point.y-80+"px",this._distanceNodeElementWrapper.style.left=t.point.x-80+"px",this._distanceNodeElement.style["background-size"]=100-(18-t.lngLat.lat)/18*100+"% "+(100-(18-t.lngLat.lat)/18*100)+"%",this._wrapperDOM&&"block"===this._wrapperDOM.style.display)parseInt(this._wrapperDOM.style.top)-parseInt(this._distanceNodeElementWrapper.style.top)<4&&(this._distanceNodeElementWrapper.style.display="none");var u=(18-t.lngLat.lat)/18*100;this._distanceNodeText.innerText="向前移动"+u.toFixed(0)+"米",this._distanceNodeElement.extra={distance:u,directional:a.directional,directionalId:a.name,directionalChange:a.directionalChange,dir:a.dir},q.setTransform(this._distanceNodeElement,"rotateX(75deg) rotateZ(0deg)");}}},e.prototype._mouseOverCallBack=function(){this._showControlBtn();},e.prototype._panoControlCallBack=function(t){var e=t.target.extra;if(e.hasOwnProperty("distance")){if(e.distance<=2)return;this._startTime=Date.now(),console.log("cirmov",e,this._panoAngleYaw),this.map.transform.panoAnyWhereMoveAngle=-e.dir+this._panoAngleYaw,this._animateMapZoom(e.directionalId,e.directional,e.distance,e.directionalChange);}else{var i=e.name;this._startTime=Date.now(),console.log("btn",e,this._panoAngleYaw),this.map.transform.panoAnyWhereMoveAngle=-e.dir+this._panoAngleYaw,this._animateMapZoom(i);}},e.prototype._parseControlBtn=function(t){var e=this.map;if(this._eles&&this._eles.length>0){for(var i=0;i<this._eles.length;i++)q.removeEventListener(this._eles[i],"click",this._panoControlCallBack),q.remove(this._eles[i]);q.remove(this._wrapperDOM);}this._distanceNodeElement&&(q.removeEventListener(this._distanceNodeElement,"click",this._panoControlCallBack),this._distanceNodeElementWrapper&&q.remove(this._distanceNodeElementWrapper),this._distanceNodeElementWrapper=null),this._eles=[],this._wrapperDOM=q.create("div","minemap-panorama-wrapper",this.map.getCanvasContainer()),this._wrapperDOM.style.top=e.transform.height/2+150+"px",this._wrapperDOM.style.left=e.transform.width/2-150+"px",this._wrapperDOM.style.display="none";for(var r=0;r<t.length;r++){var a=q.create("div","minemap-panorama",this._wrapperDOM);a.innerText=t[r]&&t[r].dirName,a.style.transform="rotateZ("+(t[r].dir-this._panoAngleYaw)+"deg) translateY(-100px)",a.extra=t[r];for(var n=t[r].dir-this._panoAngleYaw-20,o=t[r].dir-this._panoAngleYaw+20;n>180;)n-=360;for(;n<-180;)n+=360;for(;o>180;)o-=360;for(;o<-180;)o+=360;t[r].angleRange={min:n,max:o},q.addEventListener(a,"click",this._panoControlCallBack),this._eles.push(a);}q.setTransform(this._wrapperDOM,"rotateX(75deg) rotateZ("+(this.map.getCenter().lng+90)+"deg)");},e.prototype._showControlBtn=function(){this._wrapperDOM&&(this._wrapperDOM.style.display="block");},e.prototype._hideControlBtn=function(){this._wrapperDOM&&(this._wrapperDOM.style.display="none");},e.prototype.load=function(){var t=this;this.fire(new be("dataloading",{dataType:"source"})),this._location?this.url=this._options.url.replace("{location}",this._location).replace("{photoId}",-1).replace("{directional}",-1).replace("{distance}",0).replace("{directionalChange}",0):this._directional?this.url=this._options.url.replace("{location}",-1).replace("{photoId}",this._photoId).replace("{directional}",this._directional).replace("{distance}",this._distance).replace("{directionalChange}",this._directionalChange):this.url=this._options.url.replace("{location}",-1).replace("{photoId}",this._photoId).replace("{directional}",-1).replace("{distance}",0).replace("{directionalChange}",0),de(this.map._transformRequest(this.url),function(e,i){e?t.fire(new we(e)):(t._panoAngleYaw=i.properties.angle.yaw,t._parseControlBtn(i.properties.links),t._panoJson=i,ye(t.map._transformRequest(t._staticImgUrl+i.properties.name+i.properties.suffix,he.Image),function(i,r){i?t.fire(new we(e)):r&&(t.image=r),t._finishLoading();}));});},e.prototype.setLocation=function(t){t&&(this._strictRefresh=!0,this._location=t,this.load());},e.prototype.setPhotoId=function(t,e,i,r){t&&(this._strictRefresh=!0,this._photoId=t,this._directional=e,this._distance=i,this._location=null,this._directionalChange=r,this.load());},e.prototype._finishLoading=function(){this.map&&(this.sphereArray?this.prepare(!0):(this.sphereArray=new en,qn(1,7,256,Xa.LATLON,this.sphereArray),this.prepare(!0),this.fire(new be("data",{dataType:"source",sourceDataType:"metadata"}))));},e.prototype._panoUpdateArrowDirCallBack=function(){var t=this.map;this._wrapperDOM&&(t.transform._center.lat>30||t.transform._center.lat<-8||!t.panoramaMode?this._hideControlBtn():(this._showControlBtn(),q.setTransform(this._wrapperDOM,"rotateX("+(60-t.transform._center.lat)+"deg) rotateZ("+(this.map.getCenter().lng+90)+"deg)")),this.map.fire(new be("panorama-change-bearing",{angle:-this._panoAngleYaw+t.getCenter().lng+90})));},e.prototype._panoUpdateArrowMoveednCallBack=function(){},e.prototype._panoDragPan=function(){var t;this.map.getCenter().lng<=0&&this.map.getCenter().lng>=-180?t=360+this.map.getCenter().lng:this.map.getCenter().lng>0&&this.map.getCenter().lng<=180&&(t=this.map.getCenter().lng),this.map.fire(new be("panorama-drag",{angle:t,lng:this.map.getCenter().lng}));},e.prototype.onAdd=function(t){this.map=t,t.on("move",this._panoUpdateArrowDirCallBack),t.on("mousemove",this._distanceMouseMoveCallBack),t.on("drag",this._panoDragPan),this.load();},e.prototype.onRemove=function(){this.map.off("move",this._panoUpdateArrowDirCallBack),this.map.off("mousemove",this._distanceMouseMoveCallBack),this.map.off("drag",this._panoDragPan);for(var t=0;t<this._eles.length;t++)q.removeEventListener(this._eles[t],"click",this._panoControlCallBack),q.remove(this._eles[t]);this.map._cancelRenderFrame(this._frame),this._eles=[],this.map=null;},e.prototype.setNewDataCallback=function(t){this._newDataCallback=t;},e.prototype.prepare=function(t){var e=this.map.painter.context,i=e.gl;this._strictRefresh&&t&&this.sphereArray&&(this.sphereBuffer||(this.sphereBuffer=e.createVertexBuffer(this.sphereArray,wh.members)),this.sphereVAO||(this.sphereVAO=new xh),!this.texture&&this.image?(this.texture=new Pc(e,this.image,i.RGBA,{flipY:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.fire(new be("data",{type:"panoram-changed"}))):(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.pixelStoreUnpackFlipY.set(!0),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.image),this.map._cancelRenderFrame(this._frame),this._newDataCallback&&this._newDataCallback(this._panoJson.properties.name),this.map.setCenter([-90,this.map.getCenter().lat]),this.map.fire(new be("panorama-change-bearing",{angle:90-this._panoAngleYaw})),this.map.setZoom(0),this.fire(new be("data",{type:"panoram-changed"}))),this._strictRefresh=!1);},e.prototype.serialize=function(){return{type:"panorama",url:this._options.url,debug:this._options.debug||!1}},e.prototype.hasTransition=function(){return!1},e.prototype.isEarthSource=function(){return!0},e}(Ae),Ef={vector:hf,raster:_f,geojson:yf,video:xf,image:vf,canvas:bf,"sphere-image":wf,"3d-model":Tf,"3d-tile":Ah,panorama:Sf},Pf=function(t,e,i,r){var a=new Ef[e.type](t,e,i,r);if(a.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+a.id);return A(["load","abort","unload","serialize","prepare"],a),a},If=function(t,e){this.max=t,this.onRemove=e,this.reset();};If.prototype.reset=function(){for(var t in this.data)for(var e=0,i=this.data[t];e<i.length;e+=1){var r=i[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);}return this.data={},this.order=[],this},If.prototype.add=function(t,e,i){var r=this,a=t.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);var n={value:e,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout(function(){r.remove(t,n);},i)),this.data[a].push(n),this.order.push(a),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o);}return this},If.prototype.has=function(t){return t.wrapped().key in this.data},If.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},If.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},If.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},If.prototype.remove=function(t,e){if(!this.has(t))return this;var i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),a=this.data[i][r];return this.data[i].splice(r,1),a.timeout&&clearTimeout(a.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(a.value),this.order.splice(this.order.indexOf(i),1),this},If.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this};var Rf=function(t){function e(e,i,r,a){var n=this;t.call(this),this.id=e,this.dispatcher=r,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(n._sourceLoaded=!0),n._sourceLoaded&&!n._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(n.reload(),n.transform&&n.update(n.transform));}),this.on("error",function(){n._sourceErrored=!0;});var o=Pf(e,i,r,this);if(o instanceof Ah)throw new Error;this._source=o,this._source instanceof _f&&(this._source.setSharedTerrainTileCache(a),this.sttc=a),this._tiles={},this._cache=new If(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={},this._state=new qd;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t);},e.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t);},e.prototype.clearSTTCInUseStatus=function(){this.sttc&&this.sttc.clearInUseStatus();},e.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},e.prototype.getSource=function(){return this._source},e.prototype.pause=function(){this._paused=!0;},e.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform);}},e.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},e.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},e.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},e.prototype.serialize=function(){return this._source.serialize()},e.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles)this._tiles[e].upload(t);},e.prototype.getIds=function(){var t=this;return Object.keys(this._tiles).map(String).sort(function(e,i){var r=t._tiles[e].tileID,a=t._tiles[i].tileID;return r.overscaledZ-a.overscaledZ})},e.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},e.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0,{});return!!e&&this._isIdRenderable(e.tileID.key)},e.prototype._isIdRenderable=function(t){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]},e.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._source instanceof Tf&&(this._source.unloadGPUData(),this._source.prepare()),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading");},e.prototype._reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)));},e.prototype._tileLoaded=function(t,e,i,r){if(r)return t.state="errored",void(404!==r.status?this._source.fire(new we(r,{tile:t})):this.update(this.transform));t.timeAdded=n.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new be("data",{dataType:"source",tile:t,coord:t.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null);},e.prototype.getTile=function(t){return this.getTileByID(t.key)},e.prototype.getTileByID=function(t){return this._tiles[t]},e.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},e.prototype._findLoadedChildren=function(t,e,i){var r=!1;for(var a in this._tiles){var n=this._tiles[a];if(!(i[a]||!n.hasData()||n.tileID.overscaledZ<=t.overscaledZ||n.tileID.overscaledZ>e)){var o=Math.pow(2,n.tileID.canonical.z-t.canonical.z);if(Math.floor(n.tileID.canonical.x/o)===t.canonical.x&&Math.floor(n.tileID.canonical.y/o)===t.canonical.y)for(i[a]=n.tileID,r=!0;n&&n.tileID.overscaledZ-1>t.overscaledZ;){var s=n.tileID.scaledTo(n.tileID.overscaledZ-1);if(!s)break;(n=this._tiles[s.key])&&n.hasData()&&(delete i[a],i[s.key]=s);}}}return r},e.prototype.findLoadedParent=function(t,e,i){for(var r=t.overscaledZ-1;r>=e;r--){var a=t.scaledTo(r);if(!a)return;var n=String(a.key),o=this._tiles[n];if(o&&o.hasData())return i[n]=a,o;if(this._cache.has(a))return i[n]=a,this._cache.get(a)}},e.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),i=Math.floor(5*e),r="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(r);},e.prototype.handleWrapJump=function(t){var e=(t-(void 0===this._prevLng?t:this._prevLng))/360,i=Math.round(e);if(this._prevLng=t,i){var r={};for(var a in this._tiles){var n=this._tiles[a];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+i),r[n.tileID.key]=n;}for(var o in this._tiles=r,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var s in this._tiles){var u=this._tiles[s];this._setTileReloadTimer(s,u);}}},e.prototype.update=function(t){var i=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var r;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(t){return new uo(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)}):(r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,isVector:-1===this._source.type.indexOf("raster"),renderWithTerrain:this._source.renderWithTerrain,noBox:!!this._source.noBox,noLowLevelCover:!!this._source.noLowLevelCover}),this._source.hasTile&&(r=r.filter(function(t){return i._source.hasTile(t)}))):r=[];var a,o=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),s=Math.max(o-e.maxOverzooming,this._source.minzoom),u=Math.max(o+e.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(r,o),p={};if(zf(this._source.type))for(var c=Object.keys(l),h=0;h<c.length;h++){var f=c[h],m=l[f],d=i._tiles[f];if(d&&(void 0===d.fadeEndTime||d.fadeEndTime>=n.now())){i._findLoadedChildren(m,u,l)&&(l[f]=m);var _=i.findLoadedParent(m,s,p);_&&i._addTile(_.tileID);}}for(a in p)l[a]||(i._coveredTiles[a]=!0);for(a in p)l[a]=p[a];for(var y=function(t,e){var i=[];for(var r in t)r in e||i.push(r);return i}(this._tiles,l),g=0;g<y.length;g++)i._removeTile(y[g]);}},e.prototype._updateRetainedTiles=function(t,i){for(var r={},a={},n=Math.max(i-e.maxOverzooming,this._source.minzoom),o=Math.max(i+e.maxUnderzooming,this._source.minzoom),s=0;s<t.length;s++){var u=t[s],l=this._addTile(u),p=!1;if(l.hasData())r[u.key]=u;else{p=l.wasRequested(),r[u.key]=u;var c=!0;if(i+1>this._source.maxzoom){var h=u.children(this._source.maxzoom)[0],f=this.getTile(h);f&&f.hasData()?r[h.key]=h:c=!1;}else{this._findLoadedChildren(u,o,r);for(var m=u.children(this._source.maxzoom),d=0;d<m.length;d++)if(!r[m[d].key]){c=!1;break}}if(!c)for(var _=u.overscaledZ-1;_>=n;--_){var y=u.scaledTo(_);if(a[y.key])break;if(a[y.key]=!0,!(l=this.getTile(y))&&p&&(l=this._addTile(y)),l&&(r[y.key]=y,p=l.wasRequested(),l.hasData()))break}}}return r},e.prototype._addTile=function(t){var e=this._tiles[t.key];if(e)return e;(e=this._cache.getAndRemove(t))&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));var i=Boolean(e);return i||(e=new jd(t,this._source.tileSize*t.overscaleFactor(),this.map.projection,"raster"===this._source.type,this.map.sphereRender),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire(new be("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null},e.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout(function(){i._reloadTile(t,"expired"),delete i._timers[t];},r));},e.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))));},e.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset();},e.prototype.tilesInOfSphereExtrusion=function(t,e,i){var r=this;return e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,isVector:-1===this._source.type.indexOf("raster"),renderWithTerrain:this._source.renderWithTerrain,noBox:!!this._source.noBox,noLowLevelCover:!!this._source.noLowLevelCover}).map(function(t){return r.getTile(t).getBucket(i)})},e.prototype.tilesIn=function(t,e,i){var r=this,a=[],n=this.transform;if(!n)return a;for(var o=i?n.getCameraQueryGeometry(t):t,s=t.map(function(t){return n.pointCoordinate(t)}),u=o.map(function(t){return n.pointCoordinate(t)}),c=this.getIds(),h=1/0,f=1/0,m=-1/0,d=-1/0,_=s[0].zoom,y=0,g=u;y<g.length;y+=1){var v=g[y];h=Math.min(h,v.column),f=Math.min(f,v.row),m=Math.max(m,v.column),d=Math.max(d,v.row);}for(var x=function(t){var i=r._tiles[c[t]],o=i.tileID,y=Math.pow(2,n.zoom-i.tileID.overscaledZ),g=e*i.queryPadding*io/i.tileSize/y,v=[Mf(o,new l(h,f,_)),Mf(o,new l(m,d,_))];if(v[0].x-g<io&&v[0].y-g<io&&v[1].x+g>=0&&v[1].y+g>=0){var x=s.map(function(t){var e=t.zoomTo(o.canonical.z);return o.getTilePoint(new p(e.column,e.row))}),b=u.map(function(t){var e=t.zoomTo(o.canonical.z);return o.getTilePoint(new p(e.column,e.row))});a.push({tile:i,tileID:o,queryGeometry:x,cameraQueryGeometry:b,scale:y});}},b=0;b<c.length;b++)x(b);return a},e.prototype.getVisibleCoordinates=function(){for(var t=this,e=this.getRenderableIds().map(function(e){return t._tiles[e].tileID}),i=0,r=e;i<r.length;i+=1){var a=r[i];a.posMatrix=t.transform.calculatePosMatrix(a.toUnwrapped());}return e},e.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(zf(this._source.type))for(var t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=n.now())return!0}return!1},e.prototype.setFeatureState=function(t,e,i){t=t||"_geojsonTileLayer",this._state.updateState(t,e,i);},e.prototype.getFeatureState=function(t,e){return t=t||"_geojsonTileLayer",this._state.getState(t,e)},e}(Ae);function Mf(t,e){var i=e.zoomTo(t.canonical.z);return new p((i.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*io,(i.row-t.canonical.y)*io)}function zf(t){return"raster"===t||"image"===t||"video"===t}function Cf(t,e,i){return e*(io/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}Rf.maxOverzooming=10,Rf.maxUnderzooming=3;var Of=Ja([{name:"a_pos",type:"Int16",components:2}]),Ff=512/io/2,Lf=function(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var r=0,a=e;r<a.length;r+=1){var n=a[r],o=n.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)});}};Lf.prototype.getScaledCoordinates=function(t,e){var i=e.canonical.z-this.tileID.canonical.z,r=Ff/Math.pow(2,i),a=t.anchor;return{x:Math.floor((e.canonical.x*io+a.x)*r),y:Math.floor((e.canonical.y*io+a.y)*r)}},Lf.prototype.findMatches=function(t,e,i){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),a=0,n=t;a<n.length;a+=1){var o=n[a];if(!o.crossTileID){var s=this.indexedSymbolInstances[o.key];if(s)for(var u=this.getScaledCoordinates(o,e),l=0,p=s;l<p.length;l+=1){var c=p[l];if(Math.abs(c.coord.x-u.x)<=r&&Math.abs(c.coord.y-u.y)<=r&&!i[c.crossTileID]){i[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Df=function(){this.maxCrossTileID=0;};Df.prototype.generate=function(){return++this.maxCrossTileID};var Nf=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0;};Nf.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var i in this.indexes){var r=this.indexes[i],a={};for(var n in r){var o=r[n];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),a[o.tileID.key]=o;}this.indexes[i]=a;}this.lng=t;},Nf.prototype.addBucket=function(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key]);}for(var r=0,a=e.symbolInstances;r<a.length;r+=1){a[r].crossTileID=0;}this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var n=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var s=this.indexes[o];if(Number(o)>t.overscaledZ)for(var u in s){var l=s[u];l.tileID.isChildOf(t)&&l.findMatches(e.symbolInstances,t,n);}else{var p=s[t.scaledTo(Number(o)).key];p&&p.findMatches(e.symbolInstances,t,n);}}for(var c=0,h=e.symbolInstances;c<h.length;c+=1){var f=h[c];f.crossTileID||(f.crossTileID=i.generate(),n[f.crossTileID]=!0);}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Lf(t,e.symbolInstances,e.bucketInstanceId),!0},Nf.prototype.removeBucketCrossTileIDs=function(t,e){for(var i in e.indexedSymbolInstances)for(var r=0,a=e.indexedSymbolInstances[i];r<a.length;r+=1){var n=a[r];delete this.usedCrossTileIDs[t][n.crossTileID];}},Nf.prototype.removeStaleBuckets=function(t){var e=!1;for(var i in this.indexes){var r=this.indexes[i];for(var a in r)t[r[a].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[a]),delete r[a],e=!0);}return e};var kf=function(){this.layerIndexes={},this.crossTileIDs=new Df,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={};};kf.prototype.addLayer=function(t,e,i){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Nf);var a=!1,n={};r.handleWrapJump(i);for(var o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,l,this.crossTileIDs)&&(a=!0),n[l.bucketInstanceId]=!0);}return r.removeStaleBuckets(n)&&(a=!0),a},kf.prototype.pruneUnusedLayers=function(t){var e={};for(var i in t.forEach(function(t){e[t]=!0;}),this.layerIndexes)e[i]||delete this.layerIndexes[i];};function Bf(t){return t}var Vf={prelude:{fragmentSource:Bf("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n#define VIEWSHED_COUNT 1\nfloat czm_unpackDepth(vec4 packedDepth){return dot(packedDepth,vec4(1.0,1.0/255.0,1.0/65025.0,1.0/16581375.0));}\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX 8.0\n#endif\nvec4 fxaa(sampler2D tex,vec2 fragCoord,vec2 resolution,vec2 v_rgbNW,vec2 v_rgbNE,vec2 v_rgbSW,vec2 v_rgbSE,vec2 v_rgbM){vec4 color;mediump vec2 inverseVP=vec2(1.0/resolution.x,1.0/resolution.y);vec3 rgbNW=texture2D(tex,v_rgbNW).xyz;vec3 rgbNE=texture2D(tex,v_rgbNE).xyz;vec3 rgbSW=texture2D(tex,v_rgbSW).xyz;vec3 rgbSE=texture2D(tex,v_rgbSE).xyz;vec4 texColor=texture2D(tex,v_rgbM);vec3 rgbM=texColor.xyz;vec3 luma=vec3(0.299,0.587,0.114);float lumaNW=dot(rgbNW,luma);float lumaNE=dot(rgbNE,luma);float lumaSW=dot(rgbSW,luma);float lumaSE=dot(rgbSE,luma);float lumaM=dot(rgbM,luma);float lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));float lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));mediump vec2 dir;dir.x=-((lumaNW+lumaNE)-(lumaSW+lumaSE));dir.y=((lumaNW+lumaSW)-(lumaNE+lumaSE));float dirReduce=max((lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),FXAA_REDUCE_MIN);float rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);dir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),max(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),dir*rcpDirMin))*inverseVP;vec3 rgbA=0.5*(texture2D(tex,fragCoord*inverseVP+dir*(1.0/3.0-0.5)).xyz+texture2D(tex,fragCoord*inverseVP+dir*(2.0/3.0-0.5)).xyz);vec3 rgbB=rgbA*0.5+0.25*(texture2D(tex,fragCoord*inverseVP+dir*-0.5).xyz+texture2D(tex,fragCoord*inverseVP+dir*0.5).xyz);float lumaB=dot(rgbB,luma);if((lumaB<lumaMin)||(lumaB>lumaMax)){color=vec4(rgbA,texColor.a);}else{color=vec4(rgbB,texColor.a);}return color;}void texcoords(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}vec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}float decodeFloat(vec4 color){return dot(color,vec4(1.0,1./255.0,1./65025.0,1./16581375.0));}float AMBIENT_STRENGTH=0.6;vec3 L_AMBBIENT=vec3(0.19225);vec3 L_DIFFUSE=vec3(0.50754);vec3 L_SPECULAR=vec3(0.508273);float L_SHINESS=0.4;vec3 ProcessNormalLight(vec3 ilight,vec4 t_color,vec3 cam_pos,vec3 frag_pos,vec3 inormal){vec3 ambient=L_AMBBIENT*t_color.rgb;vec3 normal=normalize(inormal);vec3 light=normalize(ilight);float nDotL=max(dot(light,normal),0.0);vec3 diffuse=L_DIFFUSE*t_color.rgb*nDotL;return(ambient+diffuse);}/***@license*Copyright(c)2014-2015,NVIDIA CORPORATION. All rights reserved.**Redistribution and use in source and binary forms,with or without*modification,are permitted provided that the following conditions*are met:**Redistributions of source code must retain the above copyright*notice,this list of conditions and the following disclaimer.**Redistributions in binary form must reproduce the above copyright*notice,this list of conditions and the following disclaimer in the*documentation and/or other materials provided with the distribution.**Neither the name of NVIDIA CORPORATION nor the names of its*contributors may be used to endorse or promote products derived*from this software without specific prior written permission.**THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY*EXPRESS OR IMPLIED WARRANTIES,INCLUDING,BUT NOT LIMITED TO,THE*IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR*PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR*CONTRIBUTORS BE LIABLE FOR ANY DIRECT,INDIRECT,INCIDENTAL,SPECIAL,*EXEMPLARY,OR CONSEQUENTIAL DAMAGES(INCLUDING,BUT NOT LIMITED TO,*PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;LOSS OF USE,DATA,OR*PROFITS;OR BUSINESS INTERRUPTION)HOWEVER CAUSED AND ON ANY THEORY*OF LIABILITY,WHETHER IN CONTRACT,STRICT LIABILITY,OR TORT*(INCLUDING NEGLIGENCE OR OTHERWISE)ARISING IN ANY WAY OUT OF THE USE*OF THIS SOFTWARE,EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.*/\n#if (FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.y;}FxaaFloat4 FxaaPixelShader(FxaaFloat2 pos,FxaaTex tex,FxaaFloat2 fxaaQualityRcpFrame,FxaaFloat fxaaQualitySubpix,FxaaFloat fxaaQualityEdgeThreshold,FxaaFloat fxaaQualityEdgeThresholdMin){FxaaFloat2 posM;posM.x=pos.x;posM.y=pos.y;FxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,0),fxaaQualityRcpFrame.xy));FxaaFloat maxSM=max(lumaS,lumaM);FxaaFloat minSM=min(lumaS,lumaM);FxaaFloat maxESM=max(lumaE,maxSM);FxaaFloat minESM=min(lumaE,minSM);FxaaFloat maxWN=max(lumaN,lumaW);FxaaFloat minWN=min(lumaN,lumaW);FxaaFloat rangeMax=max(maxWN,maxESM);FxaaFloat rangeMin=min(minWN,minESM);FxaaFloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;FxaaFloat range=rangeMax-rangeMin;FxaaFloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);FxaaBool earlyExit=range<rangeMaxClamped;if(earlyExit)return rgbyM;FxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNS=lumaN+lumaS;FxaaFloat lumaWE=lumaW+lumaE;FxaaFloat subpixRcpRange=1.0/range;FxaaFloat subpixNSWE=lumaNS+lumaWE;FxaaFloat edgeHorz1=(-2.0*lumaM)+lumaNS;FxaaFloat edgeVert1=(-2.0*lumaM)+lumaWE;FxaaFloat lumaNESE=lumaNE+lumaSE;FxaaFloat lumaNWNE=lumaNW+lumaNE;FxaaFloat edgeHorz2=(-2.0*lumaE)+lumaNESE;FxaaFloat edgeVert2=(-2.0*lumaN)+lumaNWNE;FxaaFloat lumaNWSW=lumaNW+lumaSW;FxaaFloat lumaSWSE=lumaSW+lumaSE;FxaaFloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);FxaaFloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);FxaaFloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;FxaaFloat edgeVert3=(-2.0*lumaS)+lumaSWSE;FxaaFloat edgeHorz=abs(edgeHorz3)+edgeHorz4;FxaaFloat edgeVert=abs(edgeVert3)+edgeVert4;FxaaFloat subpixNWSWNESE=lumaNWSW+lumaNESE;FxaaFloat lengthSign=fxaaQualityRcpFrame.x;FxaaBool horzSpan=edgeHorz>=edgeVert;FxaaFloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;if(!horzSpan)lumaN=lumaW;if(!horzSpan)lumaS=lumaE;if(horzSpan)lengthSign=fxaaQualityRcpFrame.y;FxaaFloat subpixB=(subpixA*(1.0/12.0))-lumaM;FxaaFloat gradientN=lumaN-lumaM;FxaaFloat gradientS=lumaS-lumaM;FxaaFloat lumaNN=lumaN+lumaM;FxaaFloat lumaSS=lumaS+lumaM;FxaaBool pairN=abs(gradientN)>=abs(gradientS);FxaaFloat gradient=max(abs(gradientN),abs(gradientS));if(pairN)lengthSign=-lengthSign;FxaaFloat subpixC=FxaaSat(abs(subpixB)*subpixRcpRange);FxaaFloat2 posB;posB.x=posM.x;posB.y=posM.y;FxaaFloat2 offNP;offNP.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;offNP.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)posB.x+=lengthSign*0.5;if(horzSpan)posB.y+=lengthSign*0.5;FxaaFloat2 posN;posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;FxaaFloat2 posP;posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;FxaaFloat subpixD=((-2.0)*subpixC)+3.0;FxaaFloat lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));FxaaFloat subpixE=subpixC*subpixC;FxaaFloat lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));if(!pairN)lumaNN=lumaSS;FxaaFloat gradientScaled=gradient*1.0/4.0;FxaaFloat lumaMM=lumaM-lumaNN*0.5;FxaaFloat subpixF=subpixD*subpixE;FxaaBool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;FxaaBool doneN=abs(lumaEndN)>=gradientScaled;FxaaBool doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;FxaaBool doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;if(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12;}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}FxaaFloat dstN=posM.x-posN.x;FxaaFloat dstP=posP.x-posM.x;if(!horzSpan)dstN=posM.y-posN.y;if(!horzSpan)dstP=posP.y-posM.y;FxaaBool goodSpanN=(lumaEndN<0.0)!=lumaMLTZero;FxaaFloat spanLength=(dstP+dstN);FxaaBool goodSpanP=(lumaEndP<0.0)!=lumaMLTZero;FxaaFloat spanLengthRcp=1.0/spanLength;FxaaBool directionN=dstN<dstP;FxaaFloat dst=min(dstN,dstP);FxaaBool goodSpan=directionN ? goodSpanN : goodSpanP;FxaaFloat subpixG=subpixF*subpixF;FxaaFloat pixelOffset=(dst*(-spanLengthRcp))+0.5;FxaaFloat subpixH=subpixG*fxaaQualitySubpix;FxaaFloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;FxaaFloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if(!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;if(horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;return FxaaFloat4(FxaaTexTop(tex,posM).xyz,lumaM);}"),vertexSource:Bf("#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue){int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity){int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor){return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0);}float unpack_mix_vec2(const vec2 packedValue,const float t){return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_vec4(const vec4 packedColors,const float t){vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos){vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return(tile_units_to_pixels*pos+offset)/pattern_size;}vec3 get_interp_color(const vec3 in_color,const vec3 out_color,const float percent){return mix(in_color,out_color,percent)/255.0;}void texcoords(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}\n#define VIEWSHED_COUNT 1\nbool isBackOfEarth(vec3 spacePos,vec3 camPos,float tangentAngle){float val=dot(normalize(spacePos),normalize(camPos));float angle=acos(val);return angle>tangentAngle;}\n#define DISCARD_VARYING_NUMBER 100.0\nfloat atan2(float dx,float dy){float ax=abs(dx),ay=abs(dy);float a=min(ax,ay)/(max(ax,ay)+0.00000001);float s=a*a;float r=((-0.0464964749*s+0.15931422)*s-0.327622764)*s*a+a;if(ay>ax)r=1.57079637-r;if(dx<0.)r=3.14159274-r;if(dy<0.)r=-r;return r;}")},background:{fragmentSource:Bf("uniform vec4 u_color;uniform float u_opacity;void main(){gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}")},backgroundPattern:{fragmentSource:Bf("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main(){vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}")},sphereBackground:{fragmentSource:Bf("uniform vec4 u_color;uniform float u_opacity;void main(){gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1.);}")},sphereBackgroundPattern:{fragmentSource:Bf("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;void main(){vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1.0);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_texture_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_texture_pos);}")},circle:{fragmentSource:Bf("#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width<0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;void main(void){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if(u_pitch_with_map){vec2 corner_position=circle_center;if(u_scale_with_map){corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;}else{vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);}else{gl_Position=u_matrix*vec4(circle_center,0,1);if(u_scale_with_map){gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;}else{gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}")},clippingMask:{fragmentSource:Bf("void main(){gl_FragColor=vec4(1.0);}"),vertexSource:Bf("attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}")},heatmap:{fragmentSource:Bf("#pragma minemap: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(){\n#pragma minemap: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("#pragma minemap: define highp float weight\n#pragma minemap: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void){\n#pragma minemap: initialize highp float weight\n#pragma minemap: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}")},heatmapTexture:{fragmentSource:Bf("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main(){float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}")},collisionBox:{fragmentSource:Bf("varying float v_placed;varying float v_notUsed;void main(){float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){gl_FragColor*=.1;}}"),vertexSource:Bf("attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main(){vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=a_extrude*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}")},collisionCircle:{fragmentSource:Bf("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){color=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}"),vertexSource:Bf("attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}")},debug:{fragmentSource:Bf("uniform highp vec4 u_color;void main(){gl_FragColor=u_color;}"),vertexSource:Bf("attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}")},fill:{fragmentSource:Bf("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}")},fillOutline:{fragmentSource:Bf("#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvarying vec2 v_pos;void main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},fillOutlinePattern:{fragmentSource:Bf("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_mix)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},fillPattern:{fragmentSource:Bf("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform float u_zoom_factor;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos.xy,a_pos.z/10.0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;}")},fillExtrusion:{fragmentSource:Bf("varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec3 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos.xy,t>0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);}")},fillExtrusionPattern:{fragmentSource:Bf("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;varying float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\nvec2 imagecoord_b=mod(v_pos_b,1.0);if(v_is_top>=100.0){imagecoord_b=vec2(0.0,0.0);}vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);if(v_is_top>=100.0){gl_FragColor=vec4(color2.rgb,1.)*v_lighting;}else{gl_FragColor=color2*v_lighting;}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform float u_height_factor;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;varying float v_directional;varying float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\nvec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t>0.0 ? height : base;v_is_top=t>0.0 ? 100.0 :-100.0;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0&&normal.y==0.0&&normal.z==16384.0? a_pos: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));}")},extrusionTexture:{fragmentSource:Bf("uniform sampler2D u_image;uniform float u_opacity;varying vec2 v_pos;void main(){gl_FragColor=texture2D(u_image,v_pos)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}")},line:{fragmentSource:Bf("#ifdef MINEMAP_EXT_DEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nuniform mediump float u_hasBorder;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=gl_FragCoord.z;\n#endif\nif(u_hasBorder!=1.0){gl_FragColor=color*(alpha*opacity);}else{gl_FragColor=bordercolor*(alpha*borderopacity);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=clamp(gl_FragCoord.z+0.001,0.,1.);\n#endif\n}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;uniform lowp float u_half_render;uniform lowp float normaldirection;uniform mediump float u_hasBorder;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_hasBorder==1.0)?(borderwidth*2.0+width)/2.0 : width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;if(u_half_render==1.){if(normaldirection==1.){outset=gapwidth+(normal.y>0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}else{outset=gapwidth+(normal.y<0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}}mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},lineGradient:{fragmentSource:Bf("\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},linePattern:{fragmentSource:Bf("uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/u_pattern_size_a.x,1.0);float x_b=mod(v_linesofar/u_pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_a.y+2.0)/2.0)/u_pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_b.y+2.0)/2.0)/u_pattern_size_b.y);vec2 pos_a=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}")},lineSDF:{fragmentSource:Bf("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}")},raster:{fragmentSource:Bf("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main(){vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if(color0.a>0.0){color0.rgb=color0.rgb/color0.a;}if(color1.a>0.0){color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale)+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}")},symbolIcon:{fragmentSource:Bf("uniform sampler2D u_texture;\n#pragma minemap: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;void main(){\n#pragma minemap: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;attribute float a_height;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mediump float u_height_offset;\n#pragma minemap: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;void main(){\n#pragma minemap: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},symbolSDF:{fragmentSource:Bf("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;attribute float a_height;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform mediump float u_height_offset;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}")},tracking:{fragmentSource:Bf("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform float u_reverse;uniform float u_reserve;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nmediump float drive_opacity=1.0;if(u_reserve==1.0){if(v_seq>u_end){discard;}}else{if(v_seq<u_start||v_seq>u_end){discard;}drive_opacity=(v_seq-u_start)/u_segments;if(u_reverse==1.0){drive_opacity=1.0-drive_opacity;}}float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 tmpColor=vec4(color.xyz,0.25);gl_FragColor=tmpColor*(alpha*opacity)*drive_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;attribute float a_seq;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_seq;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphere:{fragmentSource:Bf("uniform sampler2D u_image0;uniform sampler2D u_image1;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform vec3 u_cam;uniform sampler2D u_image2;uniform bool u_with_nighttexture;uniform highp float u_fog_distance;uniform highp float u_fog_length;uniform mediump float u_atm_c_percent;uniform bool u_fog_render;uniform highp float u_daytex_percent;uniform bool u_with_daytexture;varying vec2 v_pos;varying vec3 v_normal;varying float v_fog_len;varying vec3 v_fragPos;varying vec4 v_Color;void main(){vec4 calColor=texture2D(u_image0,v_pos);vec4 nightColor=vec4(1.0);vec4 dayColor=vec4(1.0);if(u_with_daytexture){dayColor=texture2D(u_image1,v_pos);calColor=mix(calColor,dayColor,u_daytex_percent);}if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*v_Color.rgb*nDotL;nightColor=texture2D(u_image2,v_pos);if(u_with_nighttexture){if(diffuse.x>0.25){calColor=calColor;}else if(diffuse.x<0.02){calColor=nightColor;}else{float t=(diffuse.x-0.02)/0.23;calColor=t*calColor+(1.0-t)*nightColor;}}else{diffuse=u_lightcolor*calColor.rgb*nDotL;vec3 ambient=vec3(0.4,0.4,0.4)*calColor.rgb;calColor=vec4(diffuse+ambient,calColor.a);}}if(u_fog_render){float rate=clamp((v_fog_len-u_fog_distance)/u_fog_length,0.0,1.0);gl_FragColor=mix(calColor,vec4(1.,1.,1.,1.0),rate*u_atm_c_percent);}else{gl_FragColor=calColor;}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec3 u_cam_pos;uniform bool u_fog_render;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;varying vec3 v_normal;varying highp float v_fog_len;varying vec3 v_fragPos;varying vec4 v_Color;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos;v_normal=a_pos;v_fragPos=a_pos;vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;if(u_fog_render){v_fog_len=distance(u_cam_pos,a_pos);}}")},sphereAtmosphere:{fragmentSource:Bf("void main(){gl_FragColor=vec4(0.9725,0.9725,1.0,0.5);}"),vertexSource:Bf("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereRaster:{fragmentSource:Bf("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;varying highp float v_fog_len;varying highp vec4 v_pos_from_light;uniform float u_brightness_low;uniform float u_brightness_high;uniform bool u_isPole;uniform bool u_isNorth;uniform bool u_draw_to_shadow_fb;uniform vec2 u_resolution;uniform highp float u_shadow_off;uniform highp float u_fog_distance;uniform highp float u_fog_length;uniform bool u_fog_render;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform bool u_terrain;uniform bool u_edgediscard;uniform float u_tile_zoom;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;uniform int u_is_image;varying vec3 v_normal;varying vec4 v_Color;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform vec3 u_cam;void main(){float minVal=0.;float maxVal=1.;if(u_tile_zoom<=14.){if(u_terrain&&u_edgediscard&&(v_pos0.s<minVal||v_pos1.s<minVal||v_pos0.s>maxVal||v_pos0.t>maxVal||v_pos1.s>maxVal||v_pos1.t>maxVal)){discard;}}else{if(u_terrain&&u_edgediscard&&(v_pos0.s<minVal||v_pos0.t<minVal||v_pos1.s<minVal||v_pos1.t<minVal||v_pos0.s>maxVal||v_pos0.t>maxVal||v_pos1.s>maxVal||v_pos1.t>maxVal)){discard;}}vec4 color0,color1;if(u_isPole){if(u_isNorth){color0=texture2D(u_image0,vec2(v_pos0.x,0.0));color1=texture2D(u_image1,vec2(v_pos1.x,0.0));}else{color0=texture2D(u_image0,vec2(v_pos0.x,1.0));color1=texture2D(u_image1,vec2(v_pos1.x,1.0));}}else{color0=texture2D(u_image0,v_pos0);color1=texture2D(u_image1,v_pos1);}if(color0.a>0.0){color0.rgb=color0.rgb/color0.a;}if(color1.a>0.0){color1.rgb=color1.rgb/color1.a;}vec4 color=u_terrain ? color0 : mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec4 out_color=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);if(u_draw_to_shadow_fb){gl_FragColor=encodeFloat(gl_FragCoord.z);}else if(u_is_image==1){gl_FragColor=vec4(out_color.xyz,out_color.w*u_opacity);}else{float drawnInShadow=0.;vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;if(u_with_shadow){vec4 rgbaDepth=texture2D(u_shadow_sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){drawnInShadow+=1.0;}}if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*v_Color.rgb*nDotL;if(diffuse.x>0.0){vec3 diffuse=u_lightcolor*out_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*out_color.rgb;out_color=vec4(diffuse+ambient,out_color.a);}else{vec3 ambient=vec3(0.2,0.2,0.2)*out_color.rgb;out_color=vec4(ambient,out_color.a);}}if(u_fog_render){float rate=clamp((v_fog_len-u_fog_distance)/u_fog_length,0.0,1.0);out_color=mix(out_color,vec4(1.,1.,1.,1.0),rate);}gl_FragColor=vec4(out_color.xyz*(1.-0.5*drawnInShadow),out_color.w*u_opacity);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_sun_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform bool u_fog_render;uniform bool u_draw_to_shadow_fb;uniform vec3 u_cam_pos;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;varying float v_fog_len;varying highp vec4 v_pos_from_light;varying vec3 v_normal;varying vec4 v_Color;uniform mat4 u_sunlight_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,1);if(u_fog_render){vec4 geographic=u_model_matrix*vec4(a_pos,1.);v_fog_len=distance(u_cam_pos,geographic.xyz);}if(u_draw_to_shadow_fb){v_pos_from_light=u_sun_matrix*vec4(a_pos,1.);}vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale)+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;vec4 sunlight_position=u_model_matrix*vec4(a_pos,1.);v_normal=sunlight_position.xyz;}")},sphereTexture:{fragmentSource:Bf("uniform sampler2D u_image;varying vec2 v_pos;void main(){gl_FragColor=texture2D(u_image,v_pos);}"),vertexSource:Bf("uniform mat4 u_matrix;uniform float u_deta_zoom;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos/8192.0*(1.0+u_deta_zoom)/2.0;}")},sphereSymbolIcon:{fragmentSource:Bf("uniform sampler2D u_texture;\n#pragma minemap: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nif(v_front_of_earth<0.){discard;}lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("const float PI=3.141592653589793;attribute vec3 a_pos;attribute vec2 a_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform vec2 u_gl_units_to_pixels;uniform highp float u_bearing;uniform bool u_along_line;\n#pragma minemap: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform mat4 u_symbol_mvp_matrix;uniform mat2 u_pitch_matrix;uniform mat2 u_rot_matrix;uniform vec3 u_camPos;uniform float u_tangentAngle;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=1.0;float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(u_rotate_symbol){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else{if(u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;if(u_pitch_with_map){angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(u_pitch_with_map){if(u_along_line){vec2 moveDist=u_pitch_matrix*u_rot_matrix*a_projected_pos.xy;vec4 added=vec4(u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+u_pitch_matrix*u_rot_matrix*vec2(a_projected_pos.x,a_projected_pos.y)/u_gl_units_to_pixels+vec2(moveDist.y*sin(lineRotAngle),0.)/u_gl_units_to_pixels,0.0,1.0);gl_Position.xyz+=added.xyz/added.w;}else{gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}else{if(u_along_line){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+a_projected_pos.xy/u_gl_units_to_pixels;}else if(u_rotate_symbol){gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else{gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},sphereSymbolSDF:{fragmentSource:Bf("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nif(v_front_of_earth<0.0){discard;}vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("const float PI=3.141592653589793;attribute vec3 a_pos;attribute vec2 a_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform vec2 u_gl_units_to_pixels;uniform highp float u_bearing;uniform bool u_along_line;uniform highp float u_zoom_factor;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform mat4 u_symbol_mvp_matrix;uniform mat2 u_pitch_matrix;uniform mat2 u_pitch_rot_matrix;uniform mat2 u_rot_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec3 u_camPos;uniform float u_tangentAngle;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(u_rotate_symbol){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else{if(u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;if(u_pitch_with_map){angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(u_pitch_with_map){if(u_along_line){vec2 moveDist=u_pitch_rot_matrix*a_projected_pos.xy;vec2 added=u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale+u_pitch_rot_matrix*a_projected_pos.xy+vec2(moveDist.y*sin(lineRotAngle));added-=fract(added);gl_Position.xy+=added/u_gl_units_to_pixels;}else{gl_Position.xy+=u_pitch_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}else{if(u_along_line){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+a_projected_pos.xy/u_gl_units_to_pixels;}else if(u_rotate_symbol){gl_Position.xy+=u_pitch_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else{gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}gl_Position.z=0.0;float gamma_scale=gl_Position.w*u_zoom_factor;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(1.,size,interpolated_fade_opacity);}")},sphereFill:{fragmentSource:Bf("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\nif(v_front_of_earth<0.0){discard;}gl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("attribute vec3 a_pos;uniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform vec3 u_camPos;uniform float u_tangentAngle;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}gl_Position=u_matrix*vec4(a_pos,1);}")},sphereFillPattern:{fragmentSource:Bf("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nif(v_front_of_earth<0.0){discard;}vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform float u_zoom_factor;uniform mat4 u_modelMatrix;uniform vec3 u_camPos;uniform float u_tangentAngle;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}gl_Position=u_matrix*vec4(a_pos,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;}")},sphereFillOutline:{fragmentSource:Bf("#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvarying vec2 v_pos;void main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("attribute vec3 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},sphereFillOutlinePattern:{fragmentSource:Bf("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_mix)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},sphereLine:{fragmentSource:Bf("#ifdef MINEMAP_EXT_DEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nuniform mediump float u_hasBorder;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=gl_FragCoord.z;\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;uniform lowp float u_half_render;uniform lowp float normaldirection;uniform mediump float u_hasBorder;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_hasBorder==1.0)?(borderwidth*2.0+width)/2.0 : width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;if(u_half_render==1.){if(normaldirection==1.){outset=gapwidth+(normal.y>0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}else{outset=gapwidth+(normal.y<0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereLineSDF:{fragmentSource:Bf("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}")},sphereLinePattern:{fragmentSource:Bf("uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/u_pattern_size_a.x,1.0);float x_b=mod(v_linesofar/u_pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_a.y+2.0)/2.0)/u_pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_b.y+2.0)/2.0)/u_pattern_size_b.y);vec2 pos_a=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}")},sphereLineGradient:{fragmentSource:Bf("\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereHeatmap:{fragmentSource:Bf("#pragma minemap: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;varying float v_value;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(){\n#pragma minemap: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);if(v_value>0.0){gl_FragColor=vec4(val,1.0,0.0,1.0);}else{gl_FragColor=vec4(0.0,0.0,1.0,1.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("#pragma minemap: define highp float weight\n#pragma minemap: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform float u_deviceWidth;uniform float u_deviceHeight;uniform vec3 u_camera_pos;attribute vec3 a_pos;attribute vec2 a_extrude;varying vec2 v_extrude;varying float v_value;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void){\n#pragma minemap: initialize highp float weight\n#pragma minemap: initialize mediump float radius\nfloat S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*a_extrude;v_value=dot(a_pos,u_camera_pos);vec4 temppos=vec4(a_pos,1);vec4 trans_pos=u_matrix*temppos;vec2 screen_pos=vec2(trans_pos.x/trans_pos.w*u_deviceHeight/2.0+v_extrude.x*radius*u_deviceHeight/u_deviceWidth,trans_pos.y/trans_pos.w*u_deviceHeight/2.0+v_extrude.y*radius);gl_Position=vec4(screen_pos*trans_pos.w*2.0/u_deviceHeight,trans_pos.z,trans_pos.w);}")},sphereCircle:{fragmentSource:Bf("#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nif(v_front_of_earth<0.){discard;}vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width<0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("#define scale 0.015873016\nuniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform mat2 u_pixel_matrix;uniform vec2 u_gl_units_to_pixels;uniform vec3 u_camPos;uniform float u_tangentAngle;attribute vec3 a_pos;attribute vec2 a_extra;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;varying float v_front_of_earth;void main(void){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}vec2 extrude=a_extra;mediump vec2 dist=u_pixel_matrix*(radius+stroke_width)*extrude;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}")},sphereExtrusion:{fragmentSource:Bf("struct Region{bool use;vec4 pos;};varying vec3 v_normal;varying vec3 v_pos_region;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[20];uniform highp float u_region_percent;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*color.rgb;float inRegion=0.0;for(int i=0;i<20;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion):(diffuse+ambient),u_opacity-inRegion*0.1);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec3 v_pos_region;varying highp float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos_region=vec3(u_model*vec4(a_pos,1));}")},sphereExtrusionPattern:{fragmentSource:Bf("struct Region{bool use;vec4 pos;};uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform sampler2D u_image;uniform sampler2D u_image_top;varying vec2 v_pos;varying highp float v_is_top;varying vec3 v_pos_region;varying vec3 v_normal;uniform lowp float u_opacity;uniform bool u_top_tex_rend;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[20];uniform highp float u_region_percent;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec2 imagecoord_b=mod(v_pos,1.0);vec2 pos=vec2(1.0);vec4 t_color=vec4(1.0);if(v_is_top==0.){pos=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);t_color=texture2D(u_image,pos);}else{if(u_top_tex_rend){t_color=texture2D(u_image_top,imagecoord_b);}else{t_color=color;}}float t_opacity=1.0;if(t_color.a==0.){t_color=vec4(1.0);t_opacity=0.7;}vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*t_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*t_color.rgb;float inRegion=0.0;for(int i=0;i<20;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion):(diffuse+ambient),u_opacity*t_opacity-inRegion*0.1);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec2 v_pos;varying vec3 v_pos_region;varying highp float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos=a_st.xy;v_pos_region=vec3(u_model*vec4(a_pos,1));v_is_top=a_st.z;}")},sphereExtrusionShadow:{fragmentSource:Bf("void main(){gl_FragColor=encodeFloat(gl_FragCoord.z);}"),vertexSource:Bf("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereExtrusionPatternShadow:{fragmentSource:Bf("void main(){gl_FragColor=encodeFloat(gl_FragCoord.z);}"),vertexSource:Bf("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereExtrusionCameraView:{fragmentSource:Bf("struct Region{bool use;vec4 pos;};varying vec3 v_normal;varying vec3 v_pos_region;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;varying vec4 v_pos_from_light;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[20];uniform highp float u_region_percent;uniform lowp float u_viewshed_count;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;uniform highp float u_shadow_off;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nfloat getAmountInLight(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=u_viewshed_eye0;float my_dist=u_viewshed_dist0;vec4 my_pos=v_viewshed_pos;vec4 my_spacepos=v_view_spacepos;if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLight(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*color.rgb;float inRegion=0.0;for(int i=0;i<20;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}if(u_with_shadow){vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;vec4 c=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color:(diffuse+ambient+viewshed_color),u_opacity-inRegion*0.1);if(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.){gl_FragColor=c;}else{float amountInLight=getAmountInLight(u_shadow_sampler,shadowCoord);gl_FragColor=vec4(c.rgb*(1.-amountInLight*0.5),c.a);}}else{gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color:(diffuse+ambient+viewshed_color),u_opacity-inRegion*0.1);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;uniform mat4 u_sun_matrix;uniform mat4 u_viewshed_mat0;uniform mat4 u_view_modelmat0;uniform bool u_viewshed_used0;uniform bool u_with_shadow;attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec3 v_pos_region;varying highp float v_is_top;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;varying vec4 v_pos_from_light;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos_region=vec3(u_model*vec4(a_pos,1));if(u_with_shadow){v_pos_from_light=u_sun_matrix*vec4(a_pos,1.);}if(u_viewshed_used0){v_viewshed_pos=u_viewshed_mat0*vec4(a_pos,1.);v_view_spacepos=u_model*vec4(a_pos,1.);}}")},sphereExtrusionPatternCameraView:{fragmentSource:Bf("struct Region{bool use;vec4 pos;};uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform sampler2D u_image;uniform sampler2D u_image_top;uniform lowp float u_viewshed_count;uniform highp float u_shadow_off;varying vec2 v_pos;varying highp float v_is_top;varying vec3 v_pos_region;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;varying vec3 v_normal;uniform lowp float u_opacity;uniform lowp float u_top_tex_rend;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[20];uniform highp float u_region_percent;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nfloat getAmountInLightSimple(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=vec3(0.);float my_dist=0.0;vec4 my_pos=vec4(1.0);vec4 my_spacepos=vec4(1.0);my_eye=u_viewshed_eye0;my_dist=u_viewshed_dist0;my_pos=v_viewshed_pos;my_spacepos=v_view_spacepos;if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLightSimple(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec2 imagecoord_b=mod(v_pos,1.0);vec2 pos=vec2(1.0);vec4 t_color=vec4(1.0);if(v_is_top==0.){pos=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);t_color=texture2D(u_image,pos);}else{if(u_top_tex_rend==1.0){t_color=texture2D(u_image_top,imagecoord_b);}else{t_color=color;}}float t_opacity=1.0;if(t_color.a==0.){t_color=vec4(1.0);t_opacity=0.7;}vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*t_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*t_color.rgb;float inRegion=0.0;for(int i=0;i<20;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color : diffuse+ambient+viewshed_color,u_opacity*t_opacity-inRegion*0.1);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;uniform mat4 u_viewshed_mat0;uniform mat4 u_view_modelmat0;uniform bool u_viewshed_used0;attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec2 v_pos;varying vec3 v_pos_region;varying highp float v_is_top;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos=a_st.xy;v_pos_region=vec3(u_model*vec4(a_pos,1));v_is_top=a_st.z;for(int i=0;i<VIEWSHED_COUNT;i++){if(u_viewshed_used0){v_viewshed_pos=u_viewshed_mat0*vec4(a_pos,1.);v_view_spacepos=u_view_modelmat0*vec4(a_pos,1.);}}}")},sphereTracking:{fragmentSource:Bf("#ifdef MINEMAP_EXT_DEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform bool u_reverse;uniform bool u_reserve;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nmediump float drive_opacity=1.0;if(u_reserve){if(v_seq>u_end){discard;}}else{if(v_seq<u_start||v_seq>u_end){discard;}drive_opacity=(v_seq-u_start)/u_segments;if(u_reverse){drive_opacity=1.0-drive_opacity;}}float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=gl_FragCoord.z;\n#endif\nvec4 tmpColor=vec4(color.xyz,0.25);gl_FragColor=tmpColor*(alpha*opacity)*drive_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;attribute float a_seq;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_seq;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereSprite:{fragmentSource:Bf("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nif(v_discard<0.0){discard;}float opacity_m=v_opacity;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity)*opacity_m;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;attribute vec3 a_extra_m;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform vec2 u_gl_units_to_pixels;uniform vec4 u_speed_mat;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec3 f_extra_m=vec3(a_extra_m[0]*3.0/255.0,a_extra_m[1],a_extra_m[2]);float status=f_extra_m[2];float link_seq=f_extra_m[1];v_opacity=f_extra_m[0];float speed1=u_speed_mat[0];float speed2=u_speed_mat[1];float speed3=u_speed_mat[2];float speed4=u_speed_mat[3];if(status==1.0){if(link_seq!=speed1){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==2.0){if(link_seq!=speed2){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==3.0){if(link_seq!=speed3){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==4.0){if(link_seq!=speed4){v_discard=-100.0;}else{v_discard=100.0;}}vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sprite:{fragmentSource:Bf("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nif(v_discard<0.0){discard;}float opacity_m=v_opacity;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity)*opacity_m;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;attribute vec3 a_extra_m;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;uniform vec4 u_speed_mat;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec3 f_extra_m=vec3(a_extra_m[0]*3.0/255.0,a_extra_m[1],a_extra_m[2]);float status=f_extra_m[2];float link_seq=f_extra_m[1];v_opacity=f_extra_m[0];float speed1=u_speed_mat[0];float speed2=u_speed_mat[1];float speed3=u_speed_mat[2];float speed4=u_speed_mat[3];if(status==1.0){if(link_seq!=speed1){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==2.0){if(link_seq!=speed2){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==3.0){if(link_seq!=speed3){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==4.0){if(link_seq!=speed4){v_discard=-100.0;}else{v_discard=100.0;}}vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},symtrackingIcon:{fragmentSource:Bf("uniform sampler2D u_texture;\n#pragma minemap: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;varying float v_seq;void main(){\n#pragma minemap: initialize lowp float opacity\nif(v_seq<0.0){discard;}lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute vec2 a_extra;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mediump float u_height_offset;\n#pragma minemap: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform float u_seq;varying vec2 v_tex;varying float v_fade_opacity;varying float v_seq;void main(){\n#pragma minemap: initialize lowp float opacity\nfloat a_seq=a_extra[0];if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,a_extra[1]/10.0+u_height_offset/10.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},symtrackingSDF:{fragmentSource:Bf("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nif(v_seq<0.0){discard;}vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;attribute vec2 a_extra;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mediump float u_height_offset;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform float u_seq;varying vec2 v_data0;varying vec3 v_data1;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nfloat a_seq=a_extra[0];if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,a_extra[1]/10.0+u_height_offset/10.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}")},histogram:{fragmentSource:Bf("varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_FragColor=v_color*v_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_is_max_length;uniform float u_fluorescent;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t>0.0 ?(u_is_max_length==1.0 ? height*100.0 : height): base*100.0,1);if(t>0.0){v_opacity=1.2;}else{v_opacity=0.1;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);}")},histogramColor:{fragmentSource:Bf("uniform vec4 u_color_a;uniform vec4 u_color_b;uniform vec4 u_color_c;uniform vec4 u_color_d;uniform vec4 u_color_e;uniform float u_max_height;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;varying float v_height;varying float v_directional;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nif(v_height<0.25*u_max_height){vec4 tmp=u_color_b-u_color_a;vec4 real=tmp*((v_height)/0.25/u_max_height)+u_color_a;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.5*u_max_height){vec4 tmp=u_color_c-u_color_b;vec4 real=tmp*((v_height-0.25*u_max_height)/0.25/u_max_height)+u_color_b;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.75*u_max_height){vec4 tmp=u_color_d-u_color_c;vec4 real=tmp*((v_height-0.5*u_max_height)/0.25/u_max_height)+u_color_c;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.8*u_max_height){vec4 tmp=u_color_e-u_color_d;vec4 real=tmp*((v_height-0.75*u_max_height)/0.25/u_max_height)+u_color_d;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else{gl_FragColor=vec4(u_color_e.rgb*v_directional,1.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_is_max_length;uniform float u_fluorescent;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;varying float v_height;varying float v_directional;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t>0.0 ?(u_is_max_length==1.0 ? height*100.0 : height): base*100.0,1);if(t>0.0){v_opacity=1.2;v_height=height*3.0;}else{v_opacity=0.1;v_height=0.0;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);if(u_fluorescent<=0.0){v_directional=directional;}else{v_directional=1.0;}}")},histogramDynamic:{fragmentSource:Bf("varying vec4 v_color;uniform vec4 u_color_a;uniform vec4 u_color_b;uniform vec4 u_color_c;uniform vec4 u_color_d;uniform vec4 u_color_e;uniform float u_max_height;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;varying float v_height;varying float v_directional;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nif(v_height<0.2*u_max_height){vec4 tmp=u_color_b-u_color_a;vec4 real=tmp*((v_height)/0.2/u_max_height)+u_color_a;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.4*u_max_height){vec4 tmp=u_color_c-u_color_b;vec4 real=tmp*((v_height-0.2*u_max_height)/0.2/u_max_height)+u_color_b;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.6*u_max_height){vec4 tmp=u_color_d-u_color_c;vec4 real=tmp*((v_height-0.4*u_max_height)/0.2/u_max_height)+u_color_c;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.8*u_max_height){vec4 tmp=u_color_e-u_color_d;vec4 real=tmp*((v_height-0.6*u_max_height)/0.2/u_max_height)+u_color_d;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else{gl_FragColor=vec4(u_color_e.rgb*v_directional,1.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform lowp float u_dyn_count;uniform float u_fluorescent;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;varying float v_opacity;varying float v_height;varying float v_directional;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\n#pragma minemap: define highp vec4 heightArr1\n#pragma minemap: define highp vec4 heightArr2\n#pragma minemap: define highp vec4 heightArr3\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize highp vec4 heightArr1\n#pragma minemap: initialize highp vec4 heightArr2\n#pragma minemap: initialize highp vec4 heightArr3\nfloat _height=0.0;float _num=0.0;float _height1=0.0;float _height2=0.0;_num=abs(u_dyn_count)/500.0;if(_num<1.0){_height1=abs(height);_height2=abs(heightArr1[0])*255.0;}else if(_num<2.0){_height1=abs(heightArr1[0])*255.0;_height2=abs(heightArr1[1])*255.0;}else if(_num<3.0){_height1=abs(heightArr1[1])*255.0;_height2=abs(heightArr1[2])*255.0;}else if(_num<4.0){_height1=abs(heightArr1[2])*255.0;_height2=abs(heightArr1[3])*255.0;}else if(_num<5.0){_height1=abs(heightArr1[3])*255.0;_height2=abs(heightArr2[0])*255.0;}else if(_num<6.0){_height1=abs(heightArr2[0])*255.0;_height2=abs(heightArr2[1])*255.0;}else if(_num<7.0){_height1=abs(heightArr2[1])*255.0;_height2=abs(heightArr2[2])*255.0;}else if(_num<8.0){_height1=abs(heightArr2[2])*255.0;_height2=abs(heightArr2[3])*255.0;}else if(_num<9.0){_height1=abs(heightArr2[3])*255.0;_height2=abs(heightArr3[0])*255.0;}else if(_num<10.0){_height1=abs(heightArr3[0])*255.0;_height2=abs(heightArr3[1])*255.0;}else if(_num<11.0){_height1=abs(heightArr3[1])*255.0;_height2=abs(heightArr3[2])*255.0;}else if(_num<12.0){_height1=abs(heightArr3[2])*255.0;_height2=abs(heightArr3[3])*255.0;}_height=20.0+(_height1+(_height2-_height1)/500.0*mod(abs(u_dyn_count),500.0))*1.0;vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t>0.0 ? _height : base,1);if(t>0.0){v_opacity=1.2;v_height=_height*3.0;}else{v_opacity=0.1;v_height=0.0;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_directional=directional;}")},gltfModel:{fragmentSource:Bf("struct Light{vec4 color;};varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying highp float v_heatmap_cl;varying vec3 v_pos;uniform bool u_r_heatmap;uniform lowp float u_h_heatmap;uniform bool u_bgr2rgb;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;uniform bool u_flow_text;uniform highp float u_flow_text_off;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform Light u_specialcolor[10];uniform int u_specialindex;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);vec4 color1=vec4(0.5294117647058824,0.807843137254902,0.9215686274509803,0.8);vec4 color2=vec4(0.,1.,0.4980392156862745,0.8);vec4 color3=vec4(1.,1.,0.,0.8);vec4 color4=vec4(1.,0.1,0.,0.8);void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=1.;vec4 t_color=vec4(1.);if(u_use_text){if(u_flow_text){t_color=texture2D(u_BaseColorSampler,v_coord+vec2(u_flow_text_off,0.));}else{t_color=texture2D(u_BaseColorSampler,v_coord);}out_opacity=u_fill_color.a*t_color.a;if(out_opacity==0.&&u_r_heatmap){discard;}}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){for(int i=0;i<10;i++){if(i==u_specialindex){t_color=mix(t_color,u_specialcolor[i].color,0.4);}}}if(u_r_heatmap){if(v_heatmap_cl<u_h_heatmap/3.0){gl_FragColor=mix(color1,color2,clamp((v_heatmap_cl)/u_h_heatmap*3.0,0.,1.0));}else if(v_heatmap_cl<u_h_heatmap/3.0*2.0){gl_FragColor=mix(color2,color3,(v_heatmap_cl-u_h_heatmap/3.0)/u_h_heatmap*3.0);}else{gl_FragColor=mix(color3,color4,(v_heatmap_cl-u_h_heatmap/3.0*2.0)/u_h_heatmap*3.0);}}else{if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);if(u_use_text){vec3 h_color=vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b);vec3 diffuse=u_lightcolor*h_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*h_color.rgb;gl_FragColor=vec4((diffuse+ambient),out_opacity);}else{vec3 diffuse=u_lightcolor*t_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*t_color.rgb;gl_FragColor=vec4((diffuse+ambient),out_opacity);}}else{if(u_use_text){if(u_bgr2rgb){gl_FragColor=vec4(t_color.b*u_fill_color.r,t_color.g*u_fill_color.g,t_color.r*u_fill_color.b,out_opacity);}else{gl_FragColor=vec4(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b,out_opacity);}}else{gl_FragColor=t_color;}}}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_clamp_model_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform bool u_morph_weight;uniform lowp float u_target_length;attribute vec3 a_POSITION_1;attribute vec3 a_POSITION_2;attribute vec3 a_POSITION_3;attribute vec3 a_POSITION_4;attribute vec3 a_POSITION_5;attribute vec3 a_POSITION_6;attribute vec3 a_POSITION_7;attribute vec3 a_POSITION_8;uniform lowp float u_weight0;uniform lowp float u_weight1;uniform lowp float u_weight2;uniform lowp float u_weight3;uniform lowp float u_weight4;uniform lowp float u_weight5;uniform lowp float u_weight6;uniform lowp float u_weight7;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform bool u_r_heatmap;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_pos;varying highp float v_heatmap_cl;void main(){if(u_morph_weight){vec3 pos=a_POSITION+a_POSITION_1*u_weight0+a_POSITION_2*u_weight1+a_POSITION_3*u_weight2+a_POSITION_4*u_weight3+a_POSITION_5*u_weight4+a_POSITION_6*u_weight5+a_POSITION_7*u_weight6+a_POSITION_8*u_weight7;gl_Position=u_matrix*vec4(pos,1);v_normal=normalize(vec3(u_normal*a_NORMAL));if(u_r_heatmap){v_heatmap_cl=pos[1];}}else{gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));}vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;v_coord=a_TEXCOORD_0;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfTile:{fragmentSource:Bf("struct VideoStruct{bool use;highp vec3 planeP1P2;highp vec3 planeP2P3;highp vec3 planeP3P4;highp vec3 planeP4P1;highp vec3 p1;highp vec3 p2;highp vec3 p3;highp vec3 p4;highp vec2 d1Sqrt;highp vec2 d2Sqrt;highp vec2 d3Sqrt;highp vec2 d4Sqrt;lowp vec4 offset;};varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying highp float v_heatmap_cl;varying vec3 v_pos;uniform bool u_bgr2rgb;uniform VideoStruct u_vs;uniform sampler2D u_video_sampler;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;varying highp vec2 v_uv_for_video;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=1.;vec4 t_color=vec4(1.);if(u_use_text){bool use_video=false;if(v_uv_for_video.s>u_vs.offset.w&&v_uv_for_video.s<(1.-u_vs.offset.y)&&v_uv_for_video.t>u_vs.offset.x&&v_uv_for_video.t<(1.-u_vs.offset.z)){use_video=true;}if(use_video){t_color=texture2D(u_video_sampler,v_uv_for_video);}else{t_color=texture2D(u_BaseColorSampler,v_coord);}out_opacity=u_fill_color.a*t_color.a;}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){t_color=mix(t_color,highligh_color,0.4);}if(u_use_text){if(u_bgr2rgb){gl_FragColor=vec4(t_color.b*u_fill_color.r,t_color.g*u_fill_color.g,t_color.r*u_fill_color.b,out_opacity);}else{gl_FragColor=vec4(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b,out_opacity);}}else{gl_FragColor=t_color;}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("struct VideoStruct{bool use;highp vec3 planeP1P2;highp vec3 planeP2P3;highp vec3 planeP3P4;highp vec3 planeP4P1;highp vec3 p1;highp vec3 p2;highp vec3 p3;highp vec3 p4;highp vec2 d1Sqrt;highp vec2 d2Sqrt;highp vec2 d3Sqrt;highp vec2 d4Sqrt;lowp vec4 offset;};uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_clamp_model_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform VideoStruct u_vs;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_pos;varying highp float v_heatmap_cl;varying highp vec2 v_uv_for_video;highp vec2 getVideoST(highp vec3 p){highp vec2 st=vec2(0.);highp float lp1p2=abs(u_vs.planeP1P2.x*p.x+u_vs.planeP1P2.y*p.y+u_vs.planeP1P2.z*p.z+u_vs.d1Sqrt.x)/u_vs.d1Sqrt.y;highp float lp2p3=abs(u_vs.planeP2P3.x*p.x+u_vs.planeP2P3.y*p.y+u_vs.planeP2P3.z*p.z+u_vs.d2Sqrt.x)/u_vs.d2Sqrt.y;highp float lp3p4=abs(u_vs.planeP3P4.x*p.x+u_vs.planeP3P4.y*p.y+u_vs.planeP3P4.z*p.z+u_vs.d3Sqrt.x)/u_vs.d3Sqrt.y;highp float lp4p1=abs(u_vs.planeP4P1.x*p.x+u_vs.planeP4P1.y*p.y+u_vs.planeP4P1.z*p.z+u_vs.d4Sqrt.x)/u_vs.d4Sqrt.y;highp float theta1=dot(vec3(p.x-u_vs.p1.x,p.y-u_vs.p1.y,p.z-u_vs.p1.z),u_vs.planeP1P2);highp float theta2=dot(vec3(p.x-u_vs.p2.x,p.y-u_vs.p2.y,p.z-u_vs.p2.z),u_vs.planeP2P3);highp float theta3=dot(vec3(p.x-u_vs.p3.x,p.y-u_vs.p3.y,p.z-u_vs.p3.z),u_vs.planeP3P4);highp float theta4=dot(vec3(p.x-u_vs.p4.x,p.y-u_vs.p4.y,p.z-u_vs.p4.z),u_vs.planeP4P1);if(theta1<0.0){lp1p2=-lp1p2;}if(theta2<0.0){lp2p3=-lp2p3;}if(theta3<0.0){lp3p4=-lp3p4;}if(theta4<0.0){lp4p1=-lp4p1;}highp vec2 result=vec2(lp4p1/(lp4p1+lp2p3),lp1p2/(lp1p2+lp3p4));return result;}void main(){if(u_vs.use){highp vec4 spacePos=u_model_matrix*vec4(a_POSITION,1);v_uv_for_video=getVideoST(spacePos.xyz);}gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;v_coord=a_TEXCOORD_0;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfModelCameraView:{fragmentSource:Bf("varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec4 v_viewshed_pos[VIEWSHED_COUNT];varying vec4 v_view_spacepos[VIEWSHED_COUNT];varying vec3 v_pos;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;uniform lowp float u_viewshed_count;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;uniform highp float u_shadow_off;uniform bool u_bgr2rgb;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);float getAmountInLight(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=vec3(0.);float my_dist=0.0;vec4 my_pos=vec4(1.0);vec4 my_spacepos=vec4(1.0);my_eye=u_viewshed_eye0;my_dist=u_viewshed_dist0;my_pos=v_viewshed_pos[0];my_spacepos=v_view_spacepos[0];if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLight(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){float amountInLight=0.;if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=1.;vec4 t_color=vec4(1.);if(u_use_text){t_color=texture2D(u_BaseColorSampler,v_coord);out_opacity=t_color.a;if(out_opacity==0.){discard;}}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){t_color=mix(t_color,highligh_color,0.4);}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=vec3(0.0);vec3 ambient=vec3(0.0);if(u_use_text){vec3 h_color=vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b);diffuse=u_lightcolor*h_color.rgb*nDotL;ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*h_color.rgb;}else{diffuse=u_lightcolor*u_fill_color.rgb*nDotL;ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*u_fill_color.rgb;}if(u_with_shadow){vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;if(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.){gl_FragColor=vec4(diffuse+ambient+viewshed_color,out_opacity);}else{amountInLight=getAmountInLight(u_shadow_sampler,shadowCoord);gl_FragColor=vec4((diffuse+ambient)*(1.-amountInLight*0.5)+viewshed_color,out_opacity);}}else{gl_FragColor=vec4(diffuse+ambient+viewshed_color,out_opacity);}}else{if(u_use_text){if(u_bgr2rgb){gl_FragColor=vec4(vec3(t_color.b*u_fill_color.r,t_color.g*u_fill_color.g,t_color.r*u_fill_color.b)+viewshed_color,out_opacity);}else{gl_FragColor=vec4(vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b)+viewshed_color,out_opacity);}}else{gl_FragColor=vec4(t_color.rgb+viewshed_color,t_color.a);}}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_sun_matrix;uniform mat4 u_viewshed_mat0;uniform mat4 u_clamp_model_matrix;uniform mat4 u_model_matrix;uniform bool u_viewshed_used0;uniform bool u_with_shadow;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform bool u_morph_weight;uniform lowp float u_target_length;uniform vec2 u_weight;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_pos;varying vec4 v_viewshed_pos[VIEWSHED_COUNT];varying vec4 v_view_spacepos[VIEWSHED_COUNT];void main(){if(u_morph_weight){if(u_target_length==1.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0])));}else if(u_target_length==2.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]+a_POSITION_2*u_weight[1],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0]+a_NORMAL_2*u_weight[1])));}}else{gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));}v_coord=a_TEXCOORD_0;if(u_with_shadow){v_pos_from_light=u_sun_matrix*vec4(a_POSITION,1.);}if(u_viewshed_used0){v_viewshed_pos[0]=u_viewshed_mat0*vec4(a_POSITION,1.);v_view_spacepos[0]=u_model_matrix*vec4(a_POSITION,1.);}vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfSkin:{fragmentSource:Bf("varying vec3 v_normal;varying vec2 v_coord;uniform vec4 u_ambient;uniform vec4 u_diffuse;uniform vec4 u_emission;uniform sampler2D u_texture;void main(void){vec3 normal=normalize(v_normal);if(gl_FrontFacing==false)normal=-normal;vec4 color=texture2D(u_texture,v_coord);vec4 diffuse=vec4(0.,0.,0.,1.);vec4 emission;vec4 ambient;ambient=u_ambient;diffuse=u_diffuse;emission=u_emission;diffuse.xyz*=max(dot(normal,vec3(0.,0.,1.)),0.);color.xyz+=diffuse.xyz;color.xyz+=emission.xyz;color=vec4(color.rgb*diffuse.a,diffuse.a);gl_FragColor=color;}"),vertexSource:Bf("attribute vec3 a_position;attribute vec3 a_normal;varying vec3 v_normal;attribute vec4 a_joint;attribute vec4 a_weight;uniform mat4 u_jointMat[16];uniform mat3 u_normal;uniform mat4 u_matrix;void main(void){mat4 skinMat=a_weight.x*u_jointMat[int(a_joint.x)];skinMat+=a_weight.y*u_jointMat[int(a_joint.y)];skinMat+=a_weight.z*u_jointMat[int(a_joint.z)];skinMat+=a_weight.w*u_jointMat[int(a_joint.w)];v_normal=u_normal*mat3(skinMat)*a_normal;gl_Position=u_matrix*skinMat*vec4(a_position,1.0);}")},gltfShadowEncode:{fragmentSource:Bf("varying vec3 v_pos;varying vec2 v_coord;varying vec3 v_clamp_show;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform lowp float u_clamp_ratio;uniform float u_depth_range_max;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}vec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}gl_FragColor=encodeFloat(gl_FragCoord.z);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_clamp_model_matrix;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform lowp float u_target_length;uniform vec2 u_weight;uniform bool u_morph_weight;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;varying vec2 v_coord;varying vec3 v_clamp_show;varying vec3 v_pos;void main(){if(u_morph_weight){if(u_target_length==1.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0],1);}else if(u_target_length==2.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]+a_POSITION_2*u_weight[1],1);}}else{gl_Position=u_matrix*vec4(a_POSITION,1);}v_coord=a_TEXCOORD_0;vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfSkinShadowEncode:{fragmentSource:Bf("varying vec3 v_pos;varying vec2 v_coord;varying vec3 v_clamp_show;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform lowp float u_clamp_ratio;uniform float u_depth_range_max;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}vec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}gl_FragColor=encodeFloat(gl_FragCoord.z);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_clamp_model_matrix;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying vec2 v_coord;varying vec3 v_clamp_show;varying vec3 v_pos;void main(){gl_Position=u_matrix*vec4(a_POSITION,1);v_coord=a_TEXCOORD_0;vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfLineModel:{fragmentSource:Bf("precision mediump float;uniform sampler2D u_alphaMap;uniform bool u_useMap;uniform bool u_useAlphaMap;uniform bool u_useDash;uniform float u_dashArray;uniform float u_dashOffset;uniform float u_dashRatio;uniform float u_visibility;uniform float u_alphaTest;uniform vec2 u_repeat;varying vec4 v_Color;varying float v_Counters;varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;void main(){vec4 tempColor=v_Color;if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);if(u_use_text){vec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}if(u_hightlight){t_color=mix(t_color,vec4(1.0,0.2,0.1,1.0),0.4);}vec3 h_color=vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b);vec3 diffuse=u_lightcolor*h_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*h_color.rgb;gl_FragColor=vec4(diffuse+ambient,t_color.a);}else{gl_FragColor=u_fill_color;vec3 diffuse=u_lightcolor*u_fill_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*u_fill_color.rgb;gl_FragColor=vec4(diffuse+ambient,u_fill_color.a);}}else{if(u_use_text&&u_useMap){tempColor*=texture2D(u_BaseColorSampler,v_coord*u_repeat);}if(u_useAlphaMap){tempColor.a*=texture2D(u_alphaMap,v_coord*u_repeat).a;}if(tempColor.a<u_alphaTest)discard;if(u_hightlight){tempColor=mix(tempColor,vec4(1.0,0.2,0.1,1.0),0.4);}if(u_useDash){if((mod(v_Counters+u_dashOffset,u_dashArray)-(u_dashArray*u_dashRatio))>=0.0){discard;}}gl_FragColor=tempColor;if(u_visibility<1.&&step(v_Counters,u_visibility)==1.0){discard;}}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("precision highp float;uniform mat4 u_proj_matrix;uniform vec2 u_resolution;uniform float u_lineWidth;uniform vec3 u_color;uniform float u_opacity;uniform float u_sizeAttenuation;attribute vec3 a_PREVIOUS;attribute vec3 a_NEXT;attribute float a_SIDE;attribute float a_WIDTH;attribute float a_COUNTERS;varying vec4 v_Color;varying float v_Counters;uniform mat4 u_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;varying vec2 v_coord;varying vec3 v_normal;vec2 fix(vec4 i,float aspect){v_Counters=a_COUNTERS;vec2 res=i.xy/i.w;res.x*=aspect;return res;}void main(){float aspect=u_resolution.x/u_resolution.y;float pixelWidthRatio=1./(u_resolution.x*u_proj_matrix[0][0]);v_Color=vec4(u_color,u_opacity);mat4 m=u_matrix;vec4 finalPosition=m*vec4(a_POSITION,1.0);vec4 prevPos=m*vec4(a_PREVIOUS,1.0);vec4 nextPos=m*vec4(a_NEXT,1.0);vec2 currentP=fix(finalPosition,aspect);vec2 prevP=fix(prevPos,aspect);vec2 nextP=fix(nextPos,aspect);float pixelWidth=finalPosition.w*pixelWidthRatio;float w=1.8*pixelWidth*u_lineWidth*a_WIDTH;if(u_sizeAttenuation==1.){w=1.8*u_lineWidth*a_WIDTH;}vec2 dir;if(nextP==currentP)dir=normalize(currentP-prevP);else if(prevP==currentP)dir=normalize(nextP-currentP);else{vec2 dir1=normalize(currentP-prevP);vec2 dir2=normalize(nextP-currentP);dir=normalize(dir1+dir2);vec2 perp=vec2(-dir1.y,dir1.x);vec2 miter=vec2(-dir.y,dir.x);}vec2 normal=vec2(-dir.y,dir.x);normal.x/=aspect;normal*=.5*w;vec4 offset=vec4(normal*a_SIDE,0.0,1.0);finalPosition.xy+=offset.xy;gl_Position=finalPosition;v_coord=a_TEXCOORD_0;v_normal=normalize(vec3(u_normal*a_NORMAL));}")},gltfParticleModel:{fragmentSource:Bf("precision mediump float;uniform vec4 uColor;uniform highp float uTime;varying float vLifetime;varying vec2 vTextureCoords;uniform sampler2D u_BaseColorSampler;void main(void){float time=mod(uTime,vLifetime);float percentOfLife=time/vLifetime;percentOfLife=clamp(percentOfLife,0.0,1.0);float offset=floor(16.0*percentOfLife);float offsetX=floor(mod(offset,4.0))/4.0;float offsetY=0.75-floor(offset/4.0)/4.0;vec4 texColor=texture2D(u_BaseColorSampler,vec2((vTextureCoords.x/4.0)+offsetX,(vTextureCoords.y/4.0)+offsetY));gl_FragColor=uColor*texColor;gl_FragColor.a*=vLifetime;}"),vertexSource:Bf("uniform float uTime;uniform vec3 uFirePos;attribute float a_LIFETIMES;attribute vec2 a_TEXCOORDS;attribute vec2 a_TRICORNERS;attribute vec3 a_CENTEROFFSETS;attribute vec3 a_VELOCITIES;uniform mat4 u_matrix;uniform mat4 uViewMatrix;uniform bool uUseBillboarding;varying float vLifetime;varying vec2 vTextureCoords;void main(void){float time=mod(uTime,a_LIFETIMES);vec4 position=vec4(uFirePos+a_CENTEROFFSETS+(time*a_VELOCITIES),1.0);vLifetime=1.3-(time/a_LIFETIMES);vLifetime=clamp(vLifetime,0.0,1.0);float size=(vLifetime*vLifetime)*0.05;if(uUseBillboarding){vec3 cameraRight=vec3(uViewMatrix[0].x,uViewMatrix[1].x,uViewMatrix[2].x);vec3 cameraUp=vec3(uViewMatrix[0].y,uViewMatrix[1].y,uViewMatrix[2].y);position.xyz+=(cameraRight*a_TRICORNERS.x*size)+(cameraUp*a_TRICORNERS.y*size);}else{position.xy+=a_TRICORNERS.xy*size;}gl_Position=u_matrix*position;vTextureCoords=a_TEXCOORDS;vLifetime=a_LIFETIMES;}")},pointCloud:{fragmentSource:Bf("varying vec4 col;varying vec3 fpos;void main(){gl_FragColor=col;}"),vertexSource:Bf("attribute vec3 a_POSITION;attribute vec3 a_COLOR_0;attribute float a_INTENSITY;attribute float a_CLASSIFICATION;uniform mat4 u_matrix;uniform int u_mode;uniform float u_pointSize;uniform float u_opacity;uniform vec2 u_class_range;uniform vec2 u_z_range;uniform vec2 u_intensity_range;varying vec4 col;varying vec3 fpos;void main(){gl_Position=u_matrix*vec4(a_POSITION.x,a_POSITION.y,a_POSITION.z,1);vec3 color;if(u_mode==0){color=a_COLOR_0;}else if(u_mode==2){float i_height=(a_POSITION.z-u_z_range.x)/(u_z_range.y-u_z_range.x);color=vec3(i_height,i_height,i_height);}else if(u_mode==3){float i_class=(a_CLASSIFICATION-u_class_range.x)/(u_class_range.y-u_class_range.x);color=vec3(i_class,i_class,i_class);}else{float i_intensity=(a_INTENSITY-u_intensity_range.x)/(u_intensity_range.y-u_intensity_range.x);color=vec3(i_intensity,i_intensity,i_intensity);}gl_PointSize=u_pointSize;col=vec4(color,u_opacity);}")},airLine:{fragmentSource:Bf("uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform bool u_hightlight;uniform sampler2D u_alphaMap;uniform bool u_useMap;uniform bool u_useAlphaMap;uniform bool u_useDash;uniform float u_dashArray;uniform float u_dashOffset;uniform float u_dashRatio;uniform float u_visibility;uniform float u_alphaTest;uniform vec2 u_repeat;uniform float u_count;uniform float u_segments;varying vec4 vColor;varying float vSeq;varying float vSide;varying float v_Counters;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;void main(){vec4 tempColor=vColor;if(u_use_text&&u_useMap){tempColor*=texture2D(u_BaseColorSampler,v_coord*u_repeat);}if(u_useAlphaMap){tempColor.a*=texture2D(u_alphaMap,v_coord*u_repeat).a;}if(tempColor.a<u_alphaTest)discard;if(u_hightlight){tempColor=mix(tempColor,vec4(1.0,0.2,0.1,1.0),0.4);}if(u_useDash){if((mod(v_Counters+u_dashOffset,u_dashArray)-(u_dashArray*u_dashRatio))>=0.0){discard;}}if(u_visibility<1.&&step(v_Counters,u_visibility)==1.0){discard;}float startSeq=u_count-u_segments;float endSeq=u_count;if(vSeq<startSeq||vSeq>endSeq){discard;}float drive_opacity=1.0;drive_opacity=(vSeq-startSeq)/u_segments;vec3 color1=tempColor.rgb+(1.0-abs(vSide))*vec3(0.2,0.2,0.2);gl_FragColor=vec4(color1.rgb,(1.0-abs(vSide))*drive_opacity)*tempColor.a;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("precision highp float;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec3 a_PREVIOUS;attribute vec3 a_NEXT;attribute float a_SIDE;attribute float a_WIDTH;attribute float a_COUNTERS;attribute float a_SEQ;uniform mat4 u_proj_matrix;uniform vec2 u_resolution;uniform float u_lineWidth;uniform vec3 u_color;uniform float u_opacity;uniform float u_sizeAttenuation;uniform mat4 u_matrix;uniform mat4 u_cam_matrix;uniform mat4 u_normal;varying vec4 vColor;varying float v_Counters;varying float vSeq;varying float vSide;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;vec2 fix(vec4 i,float aspect){v_Counters=a_COUNTERS;vec2 res=i.xy/i.w;res.x*=aspect;return res;}void main(){float aspect=u_resolution.x/u_resolution.y;float pixelWidthRatio=1.0/(u_resolution.x*u_proj_matrix[0][0]);vColor=vec4(u_color,u_opacity);vSeq=a_SEQ;mat4 m=u_matrix;vec4 finalPosition=m*vec4(a_POSITION,1.0);vec4 prevPos=m*vec4(a_PREVIOUS,1.0);vec4 nextPos=m*vec4(a_NEXT,1.0);vec2 currentP=fix(finalPosition,aspect);vec2 prevP=fix(prevPos,aspect);vec2 nextP=fix(nextPos,aspect);float pixelWidth=finalPosition.w*pixelWidthRatio;float w=1.8*pixelWidth*u_lineWidth*a_WIDTH;if(u_sizeAttenuation==1.){w=1.8*u_lineWidth*a_WIDTH;}vec2 dir;if(nextP==currentP)dir=normalize(currentP-prevP);else if(prevP==currentP)dir=normalize(nextP-currentP);else{vec2 dir1=normalize(currentP-prevP);vec2 dir2=normalize(nextP-currentP);dir=normalize(dir1+dir2);vec2 perp=vec2(-dir1.y,dir1.x);vec2 miter=vec2(-dir.y,dir.x);}vec2 normal=vec2(-dir.y,dir.x);normal.x/=aspect;normal*=.5*w;vec4 offset=vec4(normal*a_SIDE,0.0,1.0);finalPosition.xy+=offset.xy;vSide=a_SIDE;gl_Position=finalPosition;v_coord=a_TEXCOORD_0;v_normal=normalize(vec3(u_normal*a_NORMAL));v_pos_from_light=u_cam_matrix*vec4(a_POSITION,1.);}")},fxaaFlsify:{fragmentSource:Bf("uniform highp vec2 u_resolution;uniform sampler2D u_image;const float fxaaQualitySubpix=0.5;const float fxaaQualityEdgeThreshold=0.125;const float fxaaQualityEdgeThresholdMin=0.0833;varying vec2 v_coord;void main(){vec2 fxaaQualityRcpFrame=vec2(1.0)/u_resolution;vec4 color=FxaaPixelShader(v_coord,u_image,fxaaQualityRcpFrame,fxaaQualitySubpix,fxaaQualityEdgeThreshold,fxaaQualityEdgeThresholdMin);float alpha=texture2D(u_image,v_coord).a;gl_FragColor=vec4(color.rgb,alpha);}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;uniform highp vec2 u_resolution;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBrightFilter:{fragmentSource:Bf("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_image;void main(){vec4 c=texture2D(u_image,v_coord);float bright=(c.r*0.2126)+(c.g*0.7152)+(c.b*0.0722);gl_FragColor=(bright>0.5)? c : vec4(.0);}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBlur:{fragmentSource:Bf("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_image;uniform vec2 u_dir;uniform float u_kernel[12];uniform int u_kernelLen;uniform vec2 u_resolution;uniform float u_extent;vec4 FungiBlurx(sampler2D tex,vec2 uv,vec2 dir){vec2 pxSize=u_resolution*dir;vec4 c=vec4(0.0);c+=texture2D(tex,uv-pxSize*u_extent*4.)*0.000229;c+=texture2D(tex,uv-pxSize*u_extent*3.)*0.005977;c+=texture2D(tex,uv-pxSize*u_extent*2.)*0.060598;c+=texture2D(tex,uv-pxSize*u_extent*1.)*0.241732;c+=texture2D(tex,uv)*0.382928;c+=texture2D(tex,uv+pxSize*u_extent*1.)*0.241732;c+=texture2D(tex,uv+pxSize*u_extent*2.)*0.060598;c+=texture2D(tex,uv+pxSize*u_extent*3.)*0.005977;c+=texture2D(tex,uv+pxSize*u_extent*4.)*0.000229;return c;}void main(){gl_FragColor=FungiBlurx(u_image,v_coord,u_dir);}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBlend:{fragmentSource:Bf("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_base;uniform sampler2D u_over;const float u_overStrength=0.99;void main(){vec3 cBase=texture2D(u_base,v_coord).rgb;vec3 cOver=texture2D(u_over,v_coord).rgb;gl_FragColor=vec4(cBase+cOver*u_overStrength,1.0);/*https:float exposure=1.0;float gamma=2.2;vec3 blend=cBase+cOver*1.0;blend=vec3(1.0)-exp(-blend*exposure);blend=pow(blend,vec3(1.0/gamma));oFragColor=vec4(blend,1.0);*/}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},screen:{fragmentSource:Bf("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_image;void main(){gl_FragColor=texture2D(u_image,v_coord);}"),vertexSource:Bf("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},specialLight:{fragmentSource:Bf("struct Light{bool use;vec3 position;vec3 direction;float cutOff;float outerCutOff;vec3 ambient;vec3 diffuse;vec3 specular;float constant;float linear;float quadratic;float shininess;};uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;uniform bool u_with_light;uniform highp float u_shadow_off;uniform vec2 u_resolution;uniform Light u_light[50];uniform vec3 u_camera_pos;varying vec2 v_coord;varying vec3 v_normal;varying vec3 v_clamp_show;varying vec3 v_fragPos;varying vec3 v_pos;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);vec3 CalcPointLight(Light light,vec4 t_color){vec3 ambient=light.ambient*t_color.rgb;vec3 normal=normalize(v_normal);vec3 lightDir=normalize(light.position-v_fragPos);float nDotL=max(dot(lightDir,normal),0.0);vec3 diffuse=light.diffuse*t_color.rgb*nDotL;vec3 viewDir=normalize(u_camera_pos-v_fragPos);vec3 reflectDir=reflect(-lightDir,normal);float spec=pow(max(dot(viewDir,reflectDir),0.0),light.shininess);vec3 specular=light.specular*spec*t_color.rgb;float theta=dot(lightDir,normalize(light.direction));float epsilon=(light.cutOff-light.outerCutOff);float intensity=clamp((theta-light.outerCutOff)/epsilon,0.0,1.0);diffuse*=intensity;specular*=intensity;float distance=length(light.position-v_fragPos);float attenuation=1.0/(light.constant+light.linear*distance+light.quadratic*(distance*distance));ambient*=attenuation;diffuse*=attenuation;specular*=attenuation;return(ambient+diffuse+specular);}void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=1.;vec4 t_color=vec4(1.);if(u_use_text){t_color=texture2D(u_BaseColorSampler,v_coord)*u_fill_color;out_opacity=t_color.a;if(out_opacity==0.){discard;}}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){t_color=mix(t_color,highligh_color,0.4);}if(u_with_light){vec3 result=vec3(0.0,0.0,0.0);for(int i=0;i<100;i++){if(!u_light[i].use)break;result+=CalcPointLight(u_light[i],t_color);}gl_FragColor=vec4(result,out_opacity);}else{gl_FragColor=t_color;}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_clamp_model_matrix;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform bool u_morph_weight;uniform lowp float u_target_length;uniform vec2 u_weight;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform mat4 u_model_matrix;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_fragPos;varying vec3 v_pos;void main(){if(u_morph_weight){if(u_target_length==1.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0])));}else if(u_target_length==2.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]+a_POSITION_2*u_weight[1],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0]+a_NORMAL_2*u_weight[1])));}}else{gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));}v_coord=a_TEXCOORD_0;v_fragPos=vec3(u_model_matrix*vec4(a_POSITION,1.0));vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},tdModelHeatmap:{fragmentSource:Bf("varying highp float v_heatmap_cl;uniform lowp float u_h_heatmap;uniform sampler2D u_BaseColorSampler;uniform vec4 u_fill_color;vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);vec4 u_color1=vec4(0.5294117647058824,0.807843137254902,0.9215686274509803,0.8);vec4 u_color2=vec4(0.,1.,0.4980392156862745,0.8);vec4 u_color3=vec4(1.,1.,0.,0.8);vec4 u_color4=vec4(1.,0.1,0.,0.8);void main(){if(v_heatmap_cl<=u_h_heatmap/3.0){vec4 c=mix(u_color1,u_color2,clamp((v_heatmap_cl)/u_h_heatmap*3.0,0.,1.0));gl_FragColor=vec4(c.xyz,c.z*v_heatmap_cl/(u_h_heatmap/3.0));}else if(v_heatmap_cl<=u_h_heatmap/3.0*2.0){gl_FragColor=mix(u_color2,u_color3,(v_heatmap_cl-u_h_heatmap/3.0)/u_h_heatmap*3.0);}else{gl_FragColor=mix(u_color3,u_color4,(v_heatmap_cl-u_h_heatmap/3.0*2.0)/u_h_heatmap*3.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_clamp_model_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;uniform highp float u_animate_pos;uniform highp float u_animate_seg_percent;uniform highp float u_height_scale;attribute vec3 a_POSITION_1;attribute vec3 a_POSITION_2;attribute vec3 a_POSITION_3;attribute vec3 a_POSITION_4;attribute vec3 a_POSITION_5;attribute vec3 a_POSITION_6;attribute vec3 a_POSITION_7;attribute vec3 a_POSITION_8;attribute vec3 a_POSITION_9;attribute vec3 a_POSITION_10;attribute vec3 a_POSITION_11;attribute vec3 a_POSITION_12;attribute vec3 a_POSITION_13;attribute vec3 a_POSITION_14;attribute vec3 a_POSITION_15;attribute vec3 a_POSITION_16;attribute vec3 a_POSITION_17;attribute vec3 a_POSITION_18;attribute vec3 a_POSITION_19;attribute vec3 a_POSITION_20;attribute vec3 a_POSITION_21;attribute vec3 a_POSITION_22;attribute vec3 a_POSITION_23;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying highp float v_heatmap_cl;void main(){vec3 pos=vec3(1.0);if(u_animate_pos==0.0){pos=vec3(a_POSITION.x,a_POSITION.y*(1.-u_animate_seg_percent)+a_POSITION_1.y*u_animate_seg_percent,a_POSITION.z);}else if(u_animate_pos==1.0){pos=vec3(a_POSITION_1.x,a_POSITION_1.y*(1.-u_animate_seg_percent)+a_POSITION_2.y*u_animate_seg_percent,a_POSITION_1.z);}else if(u_animate_pos==2.0){pos=vec3(a_POSITION_2.x,a_POSITION_2.y*(1.-u_animate_seg_percent)+a_POSITION_3.y*u_animate_seg_percent,a_POSITION_2.z);}else if(u_animate_pos==3.0){pos=vec3(a_POSITION_3.x,a_POSITION_3.y*(1.-u_animate_seg_percent)+a_POSITION_4.y*u_animate_seg_percent,a_POSITION_3.z);}else if(u_animate_pos==4.0){pos=vec3(a_POSITION_4.x,a_POSITION_4.y*(1.-u_animate_seg_percent)+a_POSITION_5.y*u_animate_seg_percent,a_POSITION_4.z);}else if(u_animate_pos==5.0){pos=vec3(a_POSITION_5.x,a_POSITION_5.y*(1.-u_animate_seg_percent)+a_POSITION_6.y*u_animate_seg_percent,a_POSITION_5.z);}else if(u_animate_pos==6.0){pos=vec3(a_POSITION_6.x,a_POSITION_6.y*(1.-u_animate_seg_percent)+a_POSITION_7.y*u_animate_seg_percent,a_POSITION_6.z);}else if(u_animate_pos==7.0){pos=vec3(a_POSITION_7.x,a_POSITION_7.y*(1.-u_animate_seg_percent)+a_POSITION_8.y*u_animate_seg_percent,a_POSITION_7.z);}else if(u_animate_pos==8.0){pos=vec3(a_POSITION_8.x,a_POSITION_8.y*(1.-u_animate_seg_percent)+a_POSITION_9.y*u_animate_seg_percent,a_POSITION_8.z);}else if(u_animate_pos==9.0){pos=vec3(a_POSITION_9.x,a_POSITION_9.y*(1.-u_animate_seg_percent)+a_POSITION_10.y*u_animate_seg_percent,a_POSITION_9.z);}else if(u_animate_pos==10.0){pos=vec3(a_POSITION_10.x,a_POSITION_10.y*(1.-u_animate_seg_percent)+a_POSITION_11.y*u_animate_seg_percent,a_POSITION_10.z);}else if(u_animate_pos==11.0){pos=vec3(a_POSITION_11.x,a_POSITION_11.y*(1.-u_animate_seg_percent)+a_POSITION_12.y*u_animate_seg_percent,a_POSITION_11.z);}pos.y=pos.y*u_height_scale;gl_Position=u_matrix*vec4(pos,1);v_heatmap_cl=pos.y;}")},panorama:{fragmentSource:Bf("uniform sampler2D u_normal_resolution;uniform sampler2D u_low_resolution;varying vec2 v_pos;void main(){vec4 calColor=texture2D(u_normal_resolution,vec2(1.0-v_pos.x,v_pos.y));gl_FragColor=calColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:Bf("uniform mat4 u_matrix;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos;}")}},Uf=/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,jf=function(t){var e=Vf[t],i={};e.fragmentSource=e.fragmentSource.replace(Uf,function(t,e,r,a,n){return i[n]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nvarying "+r+" "+a+" "+n+";\n#else\nuniform "+r+" "+a+" u_"+n+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+n+"\n    "+r+" "+a+" "+n+" = u_"+n+";\n#endif\n"}),e.vertexSource=e.vertexSource.replace(Uf,function(t,e,r,a,n){var o="float"===a?"vec2":"vec4";return i[n]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float a_"+n+"_t;\nattribute "+r+" "+o+" a_"+n+";\nvarying "+r+" "+a+" "+n+";\n#else\nuniform "+r+" "+a+" u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+n+" = unpack_mix_"+o+"(a_"+n+", a_"+n+"_t);\n#else\n    "+r+" "+a+" "+n+" = u_"+n+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+n+"\nuniform lowp float a_"+n+"_t;\nattribute "+r+" "+o+" a_"+n+";\n#else\nuniform "+r+" "+a+" u_"+n+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+n+"\n    "+r+" "+a+" "+n+" = unpack_mix_"+o+"(a_"+n+", a_"+n+"_t);\n#else\n    "+r+" "+a+" "+n+" = u_"+n+";\n#endif\n"});};for(var qf in Vf)jf(qf);var Xf=function(t,e,i,r){var a=t.gl;this.program=a.createProgram();var o=i.defines().concat("#define DEVICE_PIXEL_RATIO "+n.devicePixelRatio.toFixed(1)+" \r\n #define FXAA_QUALITY_PRESET 13");r&&o.push("#define OVERDRAW_INSPECTOR;");var s=o.concat(Vf.prelude.fragmentSource,e.fragmentSource).join("\n"),u=o.concat(Vf.prelude.vertexSource,e.vertexSource).join("\n"),l=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(l,s),a.compileShader(l),a.attachShader(this.program,l);var p=a.createShader(a.VERTEX_SHADER);a.shaderSource(p,u),a.compileShader(p),a.attachShader(this.program,p);for(var c=i.layoutAttributes||[],h=0;h<c.length;h++)a.bindAttribLocation(this.program,h,c[h].name);a.linkProgram(this.program),this.numAttributes=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(var f=0;f<this.numAttributes;f++){var m=a.getActiveAttrib(this.program,f);m&&(this.attributes[m.name]=a.getAttribLocation(this.program,m.name));}for(var d=a.getProgramParameter(this.program,a.ACTIVE_UNIFORMS),_=0;_<d;_++){var y=a.getActiveUniform(this.program,_);y&&(this.uniforms[y.name]=a.getUniformLocation(this.program,y.name));}};function Gf(t,e,i,r,a){for(var n=0;n<i.length;n++){var o=i[n];if(r.isLessThan(o.tileID))break;if(e.key===o.tileID.key)return;if(o.tileID.isChildOf(e)){for(var s=e.children(1/0),u=0;u<s.length;u++){Gf(t,s[u],i.slice(n),r,a);}return}}var l=e.overscaledZ-t.overscaledZ,p=new oo(l,e.canonical.x-(t.canonical.x<<l),e.canonical.y-(t.canonical.y<<l));a[p.key]=a[p.key]||p;}function Wf(t,e,i,r,a){var n=t.context,o=n.gl,s=a?t.useProgram("collisionCircle"):t.useProgram("collisionBox");n.setDepthMode(mh.disabled),n.setStencilMode(dh.disabled),n.setColorMode(t.colorModeForRenderPass());for(var u=0;u<r.length;u++){var l=r[u],p=e.getTile(l),c=p.getBucket(i);if(c){var h=a?c.collisionCircle:c.collisionBox;if(h){o.uniformMatrix4fv(s.uniforms.u_matrix,!1,l.posMatrix),o.uniform1f(s.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance);var f=Cf(p,1,t.transform.zoom),m=Math.pow(2,t.transform.zoom-p.tileID.overscaledZ);o.uniform1f(s.uniforms.u_pixels_to_tile_units,f),o.uniform2f(s.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits[0]/(f*m),t.transform.pixelsToGLUnits[1]/(f*m)),o.uniform1f(s.uniforms.u_overscale_factor,p.tileID.overscaleFactor()),s.draw(n,a?o.TRIANGLES:o.LINES,i.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,null,h.collisionVertexBuffer,null);}}}}function Yf(t,e,i,r){Wf(t,e,i,r,!1),Wf(t,e,i,r,!0);}Xf.prototype.draw=function(t,e,i,r,a,n,o,s,u){for(var l,p=t.gl,c=(l={},l[p.LINES]=2,l[p.TRIANGLES]=3,l)[e],h=0,f=n.get();h<f.length;h+=1){var m=f[h],d=m.vaos||(m.vaos={});(d[i]||(d[i]=new xh)).bind(t,this,r,o?o.getPaintVertexBuffers():[],a,m.vertexOffset,s,u),p.drawElements(e,m.primitiveLength*c,p.UNSIGNED_SHORT,m.primitiveOffset*c*2);}};var Hf={horizontal:1,vertical:2,horizontalOnly:3};var Qf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zf={};function Jf(t,e,i,r){var a=Math.pow(t-e,2);return r?t<e?a/2:2*a:a+Math.abs(i)*i}function Kf(t,e){var i=0;return 10===t&&(i-=1e4),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function $f(t,e,i,r,a,n){for(var o=null,s=Jf(e,i,a,n),u=0,l=r;u<l.length;u+=1){var p=l[u],c=Jf(e-p.x,i,a,n)+p.badness;c<=s&&(o=p,s=c);}return{index:t,x:e,priorBreak:o,badness:s}}function tm(t,e,i,r){if(!i)return[];if(!t)return[];for(var a,n=[],o=function(t,e,i,r){for(var a=0,n=0;n<t.length;n++){var o=r[t.charCodeAt(n)];o&&(a+=o.metrics.advance+e);}return a/Math.max(1,Math.ceil(a/i))}(t,e,i,r),s=0,u=0;u<t.length;u++){var l=t.charCodeAt(u),p=r[l];p&&!Qf[l]&&(s+=p.metrics.advance+e),u<t.length-1&&(Zf[l]||!((a=l)<11904)&&(_a["Bopomofo Extended"](a)||_a.Bopomofo(a)||_a["CJK Compatibility Forms"](a)||_a["CJK Compatibility Ideographs"](a)||_a["CJK Compatibility"](a)||_a["CJK Radicals Supplement"](a)||_a["CJK Strokes"](a)||_a["CJK Symbols and Punctuation"](a)||_a["CJK Unified Ideographs Extension A"](a)||_a["CJK Unified Ideographs"](a)||_a["Enclosed CJK Letters and Months"](a)||_a["Halfwidth and Fullwidth Forms"](a)||_a.Hiragana(a)||_a["Ideographic Description Characters"](a)||_a["Kangxi Radicals"](a)||_a["Katakana Phonetic Extensions"](a)||_a.Katakana(a)||_a["Vertical Forms"](a)||_a["Yi Radicals"](a)||_a["Yi Syllables"](a)))&&n.push($f(u+1,s,o,n,Kf(l,t.charCodeAt(u+1)),!1));}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}($f(t.length,s,o,n,0,!0))}function em(t){var e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0;}return{horizontalAlign:e,verticalAlign:i}}function im(t,e,i,r,a){if(a){var n=e[t[r].glyph];if(n)for(var o=n.metrics.advance,s=(t[r].x+o)*a,u=i;u<=r;u++)t[u].x-=s;}}Zf[10]=!0,Zf[32]=!0,Zf[38]=!0,Zf[40]=!0,Zf[41]=!0,Zf[43]=!0,Zf[45]=!0,Zf[47]=!0,Zf[173]=!0,Zf[183]=!0,Zf[8203]=!0,Zf[8208]=!0,Zf[8211]=!0,Zf[8231]=!0;var rm=Tl.layout;function am(t,e,i,r,a){var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e?(ms(n,n,[1/a,1/a,1]),i||ds(n,n,r.angle)):(ms(n,n,[r.width/2,-r.height/2,1]),fs(n,n,[1,-1,0]),hs(n,n,t)),n}function nm(t,e,i,r,a,n){var o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e?(n||hs(o,o,t),ms(o,o,[a,a,1]),i||ds(o,o,-r.angle)):(ms(o,o,[1,-1,1]),fs(o,o,[-1,-1,0]),ms(o,o,[2/r.width,2/r.height,1])),o}function om(t,e){var i=[t.x,t.y,0,1];_m(i,i,e);var r=i[3];return{point:new p(i[0]/r,i[1]/r),signedDistanceFromCamera:r}}function sm(t,e){var i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function um(t,e,i,r,a,n,o,s){var u=r?t.textSizeData:t.iconSizeData,l=ml(u,i.transform.zoom,rm.properties[r?"text-size":"icon-size"]),c=[256/i.width*2+1,256/i.height*2+1],h=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;h.clear();for(var f=t.lineVertexArray,m=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,d=i.transform.width/i.transform.height,_=!1,y=0;y<m.length;y++){var g=m.get(y);if(g.hidden||g.writingMode===Hf.vertical&&!_)dm(g.numGlyphs,h);else{_=!1;var v=[g.anchorX,g.anchorY,0,1];if(As(v,v,e),sm(v,c)){var x=.5+v[3]/i.transform.cameraToCenterDistance*.5,b=fl(u,l,g),w=o?b*x:b/x,A=new p(g.anchorX,g.anchorY),T=om(A,a).point,S={},E=cm(g,w,!1,s,e,a,n,t.glyphOffsetArray,f,h,T,A,S,d,t instanceof Cp?t:null);_=E.useVertical,(E.notEnoughRoom||_||E.needsFlipping&&cm(g,w,!0,s,e,a,n,t.glyphOffsetArray,f,h,T,A,S,d,t instanceof Cp?t:null).notEnoughRoom)&&dm(g.numGlyphs,h);}else dm(g.numGlyphs,h);}}r?t.text.dynamicLayoutVertexBuffer.updateData(h):t.icon.dynamicLayoutVertexBuffer.updateData(h);}function lm(t,e,i,r,a,n,o,s,u,l,p,c){var h=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,m=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),_=e.getoffsetX(h-1),y=fm(t*d,i,r,a,n,o,s.segment,f,m,u,l,p,c);if(!y)return null;var g=fm(t*_,i,r,a,n,o,s.segment,f,m,u,l,p,c);return g?{first:y,last:g}:null}function pm(t,e,i,r){if(t===Hf.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*r)return{useVertical:!0};return(t===Hf.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function cm(t,e,i,r,a,n,o,s,u,l,c,h,f,m,d){var _,y=e/24,g=t.lineOffsetX*e,v=t.lineOffsetY*e;if(t.numGlyphs>1){var x=t.glyphStartIndex+t.numGlyphs,b=t.lineStartIndex,w=t.lineStartIndex+t.lineLength,A=lm(y,s,g,v,i,c,h,t,u,n,f,!1);if(!A)return{notEnoughRoom:!0};var T=om(A.first.point,o).point,S=om(A.last.point,o).point;if(r&&!i){var E=pm(t.writingMode,T,S,m);if(E)return E}_=[A.first];for(var P=t.glyphStartIndex+1;P<x-1;P++)_.push(fm(y*s.getoffsetX(P),g,v,i,c,h,t.segment,b,w,u,n,f,!1));_.push(A.last);}else{if(r&&!i){var I=om(h,a).point,R=t.lineStartIndex+t.segment+1,M=new p(u.getx(R),u.gety(R)),z=om(M,a),C=z.signedDistanceFromCamera>0?z.point:hm(h,M,I,1,a),O=pm(t.writingMode,I,C,m);if(O)return O}var F=fm(y*s.getoffsetX(t.glyphStartIndex),g,v,i,c,h,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,u,n,f,!1);if(!F)return{notEnoughRoom:!0};_=[F];}for(var L=0,D=_;L<D.length;L+=1){var N=D[L];d?Rp(l,N.point,N.angle,N.anchorPoint):gl(l,N.point,N.angle);}return{}}function hm(t,e,i,r,a){var n=om(t.add(t.sub(e)._unit()),a).point,o=i.sub(n);return i.add(o._mult(r/o.mag()))}function fm(t,e,i,r,a,n,o,s,u,l,c,h,f){var m=r?t-e:t+e,d=m>0?1:-1,_=0;r&&(d*=-1,_=Math.PI),d<0&&(_+=Math.PI);for(var y=d>0?s+o:s+o+1,g=y,v=a,x=a,b=0,w=0,A=Math.abs(m);b+w<=A;){if((y+=d)<s||y>=u)return null;if(x=v,void 0===(v=h[y])){var T=new p(l.getx(y),l.gety(y)),S=om(T,c);if(S.signedDistanceFromCamera>0)v=h[y]=S.point;else{var E=y-d;v=hm(0===b?n:new p(l.getx(E),l.gety(E)),T,x,A-b+1,c);}}b+=w,w=x.dist(v);}var P=(A-b)/w,I=v.sub(x),R=I.mult(P)._add(x);return R._add(I._unit()._perp()._mult(i*d)),{point:R,angle:_+Math.atan2(v.y-x.y,v.x-x.x),anchorPoint:a,tileDistance:f?{prevTileDistance:y-d===g?0:l.gettileUnitDistanceFromAnchor(y-d),lastSegmentViewportDistance:A-b}:null}}var mm=new Float64Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dm(t,e){for(var i=0;i<t;i++){var r=e.length;e.resize(r+4),e.float32.set(mm,3*r);}}function _m(t,e,i){var r=e[0],a=e[1];return t[0]=i[0]*r+i[4]*a+i[12],t[1]=i[1]*r+i[5]*a+i[13],t[3]=i[3]*r+i[7]*a+i[15],t}function ym(t,e){var i=t.context,r=i.gl,a=e.viewportFrame;if(t.depthRboNeedsClear&&t.setupOffscreenDepthRenderbuffer(),!a){var n=new Pc(i,{width:t.width,height:t.height,data:null},r.RGBA);n.bind(r.LINEAR,r.CLAMP_TO_EDGE),(a=e.viewportFrame=i.createFramebuffer(t.width,t.height)).colorAttachment.set(n.texture);}i.bindFramebuffer.set(a.framebuffer),a.depthAttachment.set(t.depthRbo),t.depthRboNeedsClear&&(i.clear({depth:1}),t.depthRboNeedsClear=!1),i.clear({color:We.transparent}),i.setStencilMode(dh.disabled),i.setDepthMode(new mh(r.LEQUAL,mh.ReadWrite,[0,1])),i.setColorMode(t.colorModeForRenderPass());}function gm(t,e){var i=e.viewportFrame;if(i){var r=t.context,a=r.gl,n=t.useProgram("extrusionTexture");r.setStencilMode(dh.disabled),r.setDepthMode(mh.disabled),r.setColorMode(t.colorModeForRenderPass()),r.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,i.colorAttachment.get()),"object"==typeof e.paint.get(e.type+"-opacity")?a.uniform1f(n.uniforms.u_opacity,e.paint.get(e.type+"-opacity").value.value):a.uniform1f(n.uniforms.u_opacity,e.paint.get(e.type+"-opacity")),a.uniform1i(n.uniforms.u_image,0);var o=us();_s(o,0,t.width,t.height,0,0,1),a.uniformMatrix4fv(n.uniforms.u_matrix,!1,o),a.uniform2f(n.uniforms.u_world,a.drawingBufferWidth,a.drawingBufferHeight),t.viewportVAO.bind(r,n,t.viewportBuffer,[]),a.drawArrays(a.TRIANGLE_STRIP,0,4);}}var vm=ls(new Float32Array(16)),xm=Tl.layout;function bm(t,e,i,r,a,n,o,s,u,l){var p,c=t.context,h=c.gl,f=t.transform,m="map"===s,d="map"===u,_=m&&"point"!==i.layout.get("symbol-placement"),y=m&&!d&&!_;if(i.paint.get("render-3d"))h.enable(h.DEPTH_TEST);else{var g=d;c.setDepthMode(g?t.depthModeForSublayer(0,mh.ReadOnly):mh.disabled);}for(var v=0,x=r;v<x.length;v+=1){var b=x[v],w=e.getTile(b),A=w.getBucket(i);if(A){var T=a?A.text:A.icon;if(T&&T.segments.get().length){var S=T.programConfigurations.get(i.id),E=a||A.sdfIcons,P=a?A.textSizeData:A.iconSizeData;if(p||(p=t.useProgram(E?"symbolSDF":"symbolIcon",S),S.setUniforms(t.context,p,i.paint,{zoom:t.transform.zoom}),wm(p,t,i,a,y,d,P)),c.activeTexture.set(h.TEXTURE0),h.uniform1i(p.uniforms.u_texture,0),a)w.glyphAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.uniform2fv(p.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var I=1!==i.layout.get("icon-size").constantOr(0)||A.iconsNeedLinear,R=d||0!==f.pitch;w.iconAtlasTexture.bind(E||t.options.rotating||t.options.zooming||I||R?h.LINEAR:h.NEAREST,h.CLAMP_TO_EDGE),h.uniform2fv(p.uniforms.u_texsize,w.iconAtlasTexture.size);}h.uniformMatrix4fv(p.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(b.posMatrix,w,n,o)));var M=Cf(w,1,t.transform.zoom),z=am(b.posMatrix,d,m,t.transform,M),C=nm(b.posMatrix,d,m,t.transform,M);h.uniformMatrix4fv(p.uniforms.u_gl_coord_matrix,!1,new Float32Array(t.translatePosMatrix(C,w,n,o,!0))),_?(h.uniformMatrix4fv(p.uniforms.u_label_plane_matrix,!1,vm),um(A,b.posMatrix,t,a,z,C,d,l)):h.uniformMatrix4fv(p.uniforms.u_label_plane_matrix,!1,z),h.uniform1f(p.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),h.uniform1f(p.uniforms.u_height_offset,Number(i.paint.get("symbol-height-offset"))),Am(p,S,t,i,w,T,a,E,d);}}}}function wm(t,e,i,r,a,n,o){var s=e.context.gl,u=e.transform;s.uniform1i(t.uniforms.u_pitch_with_map,n?1:0),s.uniform1f(t.uniforms.u_is_text,r?1:0),s.uniform1f(t.uniforms.u_pitch,u.pitch/360*2*Math.PI);var l="constant"===o.functionType||"source"===o.functionType,p="constant"===o.functionType||"camera"===o.functionType;s.uniform1i(t.uniforms.u_is_size_zoom_constant,l?1:0),s.uniform1i(t.uniforms.u_is_size_feature_constant,p?1:0),s.uniform1f(t.uniforms.u_camera_to_center_distance,u.cameraToCenterDistance);var c=ml(o,u.zoom,xm.properties[r?"text-size":"icon-size"]);void 0!==c.uSizeT&&s.uniform1f(t.uniforms.u_size_t,c.uSizeT),void 0!==c.uSize&&s.uniform1f(t.uniforms.u_size,c.uSize),s.uniform1f(t.uniforms.u_aspect_ratio,u.width/u.height),s.uniform1i(t.uniforms.u_rotate_symbol,a?1:0);}function Am(t,e,i,r,a,n,o,s,u){var l=i.context,p=l.gl,c=i.transform;if(s){var h=0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),f=u?Math.cos(c._pitch)*c.cameraToCenterDistance:1;p.uniform1f(t.uniforms.u_gamma_scale,f),h&&(p.uniform1f(t.uniforms.u_is_halo,1),Tm(n,r,l,t)),p.uniform1f(t.uniforms.u_is_halo,0);}Tm(n,r,l,t);}function Tm(t,e,i,r){r.draw(i,i.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer);}function Sm(t,e,i,r,a,n){for(var o,s=!0,u=0,l=r;u<l.length;u+=1){var p=l[u],c=e.getTile(p),h=c.getBucket(i);if(h){var f=h.programConfigurations.get(i.id),m=t.context.program.get(),d=t.useProgram(a,f),_=s||d.program!==m,y=o!==c.tileID.overscaledZ;_&&f.setUniforms(t.context,d,i.paint,{zoom:t.transform.zoom}),Em(d,t,c,h,i,p,f,_,y,n),o=c.tileID.overscaledZ,s=!1;}}}function Em(t,e,i,r,a,o,s,u,l,p){var c,h,f,m,d=e.context,_=d.gl,y=a.paint.get("line-dasharray"),g=a.paint.get("line-pattern");if(u||l){var v=1/Cf(i,1,e.transform.tileZoom);if(y){c=e.lineAtlas.getDash(y.from,"round"===a.layout.get("line-cap")),h=e.lineAtlas.getDash(y.to,"round"===a.layout.get("line-cap"));var x=c.width*y.fromScale,b=h.width*y.toScale;_.uniform2f(t.uniforms.u_patternscale_a,v/x,-c.height/2),_.uniform2f(t.uniforms.u_patternscale_b,v/b,-h.height/2),_.uniform1f(t.uniforms.u_sdfgamma,e.lineAtlas.width/(256*Math.min(x,b)*n.devicePixelRatio)/2);}else if(g){if(f=e.imageManager.getPattern(g.from),m=e.imageManager.getPattern(g.to),!f||!m)return;_.uniform2f(t.uniforms.u_pattern_size_a,f.displaySize[0]*g.fromScale/v,f.displaySize[1]),_.uniform2f(t.uniforms.u_pattern_size_b,m.displaySize[0]*g.toScale/v,m.displaySize[1]);var w=e.imageManager.getPixelSize(),A=w.width,T=w.height;_.uniform2fv(t.uniforms.u_texsize,[A,T]);}_.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1]);}u&&(y?(_.uniform1i(t.uniforms.u_image,0),d.activeTexture.set(_.TEXTURE0),e.lineAtlas.bind(d),_.uniform1f(t.uniforms.u_tex_y_a,c.y),_.uniform1f(t.uniforms.u_tex_y_b,h.y),_.uniform1f(t.uniforms.u_mix,y.t)):g&&(_.uniform1i(t.uniforms.u_image,0),d.activeTexture.set(_.TEXTURE0),e.imageManager.bind(d),_.uniform2fv(t.uniforms.u_pattern_tl_a,f.tl),_.uniform2fv(t.uniforms.u_pattern_br_a,f.br),_.uniform2fv(t.uniforms.u_pattern_tl_b,m.tl),_.uniform2fv(t.uniforms.u_pattern_br_b,m.br),_.uniform1f(t.uniforms.u_fade,g.t))),d.setStencilMode(e.stencilModeForClipping(o));var S=e.translatePosMatrix(o.posMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"));if(_.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(S)),_.uniform1f(t.uniforms.u_ratio,1/Cf(i,1,e.transform.zoom)),a.paint.get("line-gradient")){d.activeTexture.set(_.TEXTURE0);var E=a.gradientTexture;if(!a.gradient)return;E||(E=a.gradientTexture=new Pc(d,a.gradient,_.RGBA)),E.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.uniform1i(t.uniforms.u_image,0);}p?(_.uniform1f(t.uniforms.u_hasBorder,1),t.draw(d,_.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,s)):"visible"===a.layout.get("border-visibility")&&e.context.extFragDepth?(_.uniform1f(t.uniforms.u_hasBorder,1),t.draw(d,_.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,s),_.uniform1f(t.uniforms.u_hasBorder,0),t.draw(d,_.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,s)):(_.uniform1f(t.uniforms.u_hasBorder,0),t.draw(d,_.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,s));}var Pm=function(t,e){if(!t)return!1;var i=e.imageManager.getPattern(t.from),r=e.imageManager.getPattern(t.to);return!i||!r},Im=function(t,e,i){var r=e.context,a=r.gl,n=e.imageManager.getPattern(t.from),o=e.imageManager.getPattern(t.to);a.uniform1i(i.uniforms.u_image,0),a.uniform2fv(i.uniforms.u_pattern_tl_a,n.tl),a.uniform2fv(i.uniforms.u_pattern_br_a,n.br),a.uniform2fv(i.uniforms.u_pattern_tl_b,o.tl),a.uniform2fv(i.uniforms.u_pattern_br_b,o.br);var s=e.imageManager.getPixelSize(),u=s.width,l=s.height;a.uniform2fv(i.uniforms.u_texsize,[u,l]),a.uniform1f(i.uniforms.u_mix,t.t),a.uniform2fv(i.uniforms.u_pattern_size_a,n.displaySize),a.uniform2fv(i.uniforms.u_pattern_size_b,o.displaySize),a.uniform1f(i.uniforms.u_scale_a,t.fromScale),a.uniform1f(i.uniforms.u_scale_b,t.toScale),r.activeTexture.set(a.TEXTURE0),e.imageManager.bind(e.context);},Rm=function(t,e,i){var r=e.context.gl;r.uniform1f(i.uniforms.u_tile_units_to_pixels,1/Cf(t,1,e.transform.tileZoom));var a=Math.pow(2,t.tileID.overscaledZ),n=t.tileSize*Math.pow(2,e.transform.tileZoom)/a,o=n*(t.tileID.canonical.x+t.tileID.wrap*a),s=n*t.tileID.canonical.y;r.uniform2f(i.uniforms.u_pixel_coord_upper,o>>16,s>>16),r.uniform2f(i.uniforms.u_pixel_coord_lower,65535&o,65535&s);};function Mm(t,e,i,r,a){if(!Pm(i.paint.get("fill-pattern"),t))for(var n=!0,o=0,s=r;o<s.length;o+=1){var u=s[o],l=e.getTile(u),p=l.getBucket(i);p&&(t.context.setStencilMode(t.stencilModeForClipping(u)),a(t,e,i,l,u,p,n),n=!1);}}function zm(t,e,i,r,a,n,o){var s=t.context.gl,u=n.programConfigurations.get(i.id),l=Om("fill",i.paint.get("fill-pattern"),t,u,i,r,a,o);i.paint.get("render-3d")&&function(t,e){var i=e.context.gl,r=e.style.light,a=r.properties.get("position"),n=[a.x,a.y,a.z],o=os();"viewport"===r.properties.get("anchor")&&ss(o,-e.transform.angle);bs(n,n,o);var s=r.properties.get("color");i.uniform3fv(t.uniforms.u_lightpos,n),i.uniform1f(t.uniforms.u_lightintensity,r.properties.get("intensity")),i.uniform3f(t.uniforms.u_lightcolor,s.r,s.g,s.b);}(l,t),l.draw(t.context,s.TRIANGLES,i.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,u);}function Cm(t,e,i,r,a,n,o){var s=t.context.gl,u=n.programConfigurations.get(i.id),l=Om("fillOutline",i.getPaintProperty("fill-outline-color")?null:i.paint.get("fill-pattern"),t,u,i,r,a,o);s.uniform2f(l.uniforms.u_world,s.drawingBufferWidth,s.drawingBufferHeight),l.draw(t.context,s.LINES,i.id,n.layoutVertexBuffer,n.indexBuffer2,n.segments2,u);}function Om(t,e,i,r,a,n,o,s){var u,l=i.context.program.get();return e?(u=i.useProgram(t+"Pattern",r),(s||u.program!==l)&&(r.setUniforms(i.context,u,a.paint,{zoom:i.transform.zoom}),Im(e,i,u),i.context.gl.uniform1f(u.uniforms.u_zoom_factor,Math.pow(2,20-Math.floor(i.transform.zoom)))),Rm(n,i,u)):(u=i.useProgram(a.paint.get("render-3d")?"fill3d":t,r),(s||u.program!==l)&&r.setUniforms(i.context,u,a.paint,{zoom:i.transform.zoom})),i.context.gl.uniformMatrix4fv(u.uniforms.u_matrix,!1,new Float32Array(i.translatePosMatrix(o.posMatrix,n,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")))),u}function Fm(t,e){var i=t.context,r=i.gl,a=e.viewportFrame;if(t.depthRboNeedsClear&&t.setupOffscreenDepthRenderbuffer(),!a){var n=new Pc(i,{width:t.width,height:t.height,data:null},r.RGBA);n.bind(r.LINEAR,r.CLAMP_TO_EDGE),(a=e.viewportFrame=i.createFramebuffer(t.width,t.height)).colorAttachment.set(n.texture);}i.bindFramebuffer.set(a.framebuffer),a.depthAttachment.set(t.depthRbo),t.depthRboNeedsClear&&(i.clear({depth:1}),t.depthRboNeedsClear=!1),i.clear({color:We.transparent}),i.setStencilMode(dh.disabled),i.setDepthMode(new mh(r.LEQUAL,mh.ReadWrite,[0,1])),i.setColorMode(t.colorModeForRenderPass());}function Lm(t,e){var i=e.viewportFrame;if(i){var r=t.context,a=r.gl,n=t.useProgram("extrusionTexture");r.setStencilMode(dh.disabled),r.setDepthMode(mh.disabled),r.setColorMode(t.colorModeForRenderPass()),r.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,i.colorAttachment.get()),"custom"!==e.type&&"object"==typeof e.paint.get(e.type+"-opacity")?a.uniform1f(n.uniforms.u_opacity,e.paint.get(e.type+"-opacity").value.value):"custom"!==e.type?a.uniform1f(n.uniforms.u_opacity,e.paint.get(e.type+"-opacity")):a.uniform1f(n.uniforms.u_opacity,1),a.uniform1i(n.uniforms.u_image,0);var o=rt();yt(o,0,t.width,t.height,0,0,1),a.uniformMatrix4fv(n.uniforms.u_matrix,!1,o),a.uniform2f(n.uniforms.u_world,a.drawingBufferWidth,a.drawingBufferHeight),t.viewportVAO.bind(r,n,t.viewportBuffer,[]),a.drawArrays(a.TRIANGLE_STRIP,0,4);}}function Dm(t,e,i,r,a,n,o){var s=t.context,u=s.gl,l=i.paint.get("extrusion-pattern"),p=t.context.program.get(),c=n.programConfigurations.get(i.id),h=t.useProgram(l?"fillExtrusionPattern":"fillExtrusion",c);if((o||h.program!==p)&&c.setUniforms(s,h,i.paint,{zoom:t.transform.zoom}),l){if(Pm(l,t))return;Im(l,t,h),Rm(r,t,h),u.uniform1f(h.uniforms.u_height_factor,-Math.pow(2,a.overscaledZ)/r.tileSize/8);}t.context.gl.uniformMatrix4fv(h.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(a.posMatrix,r,i.paint.get("extrusion-translate"),i.paint.get("extrusion-translate-anchor")))),function(t,e){var i=e.context.gl,r=e.style.light,a=r.properties.get("position"),n=[a.x,a.y,a.z],o=os();"viewport"===r.properties.get("anchor")&&ss(o,-e.transform.angle);bs(n,n,o);var s=r.properties.get("color");i.uniform3fv(t.uniforms.u_lightpos,n),i.uniform1f(t.uniforms.u_lightintensity,r.properties.get("intensity")),i.uniform3f(t.uniforms.u_lightcolor,s.r,s.g,s.b);}(h,t),h.draw(s,u.TRIANGLES,i.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,c);}function Nm(t,e,i,r,a){var o=r.paint.get("raster-fade-duration");if(o>0){var s=n.now(),u=(s-t.timeAdded)/o,l=e?(s-e.timeAdded)/o:-1,p=i.getSource(),c=a.coveringZoomLevel({tileSize:p.tileSize,roundZoom:p.roundZoom}),h=!e||Math.abs(e.tileID.overscaledZ-c)>Math.abs(t.tileID.overscaledZ-c),f=h&&t.refreshedUponExpiration?1:_(h?u:1-l,0,1);return t.refreshedUponExpiration&&u>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}function km(t,e,i){var r=t.context,a=r.gl,n=i.posMatrix,o=t.useProgram("debug");r.setDepthMode(mh.disabled),r.setStencilMode(dh.disabled),r.setColorMode(t.colorModeForRenderPass()),a.uniformMatrix4fv(o.uniforms.u_matrix,!1,n),a.uniform4f(o.uniforms.u_color,1,0,0,1),t.debugVAO.bind(r,o,t.debugBuffer,[]),a.drawArrays(a.LINE_STRIP,0,t.debugBuffer.length);for(var s=function(t,e,i,r){r=r||1;var a,n,o,s,u,l,p,c,h=[];for(a=0,n=t.length;a<n;a++)if(u=Bm[t[a]]){for(c=null,o=0,s=u[1].length;o<s;o+=2)-1===u[1][o]&&-1===u[1][o+1]?c=null:(l=e+u[1][o]*r,p=i-u[1][o+1]*r,c&&h.push(c.x,c.y,l,p),c={x:l,y:p});e+=u[0]*r;}return h}(i.toString(),50,200,5),u=new $a,l=0;l<s.length;l+=2)u.emplaceBack(s[l],s[l+1]);var p=r.createVertexBuffer(u,Of.members);(new xh).bind(r,o,p,[]),a.uniform4f(o.uniforms.u_color,1,1,1,1);for(var c=e.getTile(i).tileSize,h=io/(Math.pow(2,t.transform.zoom-i.overscaledZ)*c),f=[[-1,-1],[-1,1],[1,-1],[1,1]],m=0;m<f.length;m++){var d=f[m];a.uniformMatrix4fv(o.uniforms.u_matrix,!1,fs([],n,[h*d[0],h*d[1],0])),a.drawArrays(a.LINES,0,p.length);}a.uniform4f(o.uniforms.u_color,0,0,0,1),a.uniformMatrix4fv(o.uniforms.u_matrix,!1,n),a.drawArrays(a.LINES,0,p.length);}var Bm={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};function Vm(t,e,i,r,a,n,o,s,u,l,p,c,h){var f=e.context,m=f.gl;(s||u)&&m.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1]),f.setStencilMode(e.stencilModeForClipping(n));var d=e.translatePosMatrix(n.posMatrix,i,a.paint.get("tracking-translate"),a.paint.get("tracking-translate-anchor"));m.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(d)),m.uniform1f(t.uniforms.u_ratio,1/Cf(i,1,e.transform.zoom)),m.uniform1f(t.uniforms.u_start,l-h),m.uniform1f(t.uniforms.u_end,l),m.uniform1f(t.uniforms.u_segments,h),m.uniform1f(t.uniforms.u_reverse,p?1:0),m.uniform1f(t.uniforms.u_reserve,c?1:0),t.draw(f,m.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,o);}var Um={speedExt1:2,speedExt2:4,speedExt3:5,speedExt4:6,getCalculatedSpeed:function(t,e){return parseInt(e.speeds["speed"+t]/t/this["speedExt"+t])}};function jm(t,e,i,r,a,n,o,s,u){var l=e.context,p=l.gl;(s||u)&&p.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1]),p.uniform1f(t.uniforms.u_interpolate,Number(a.paint.get("sprite-interpolate"))),p.uniform1f(t.uniforms.u_height_offset,a.paint.get("sprite-height-offset")),l.setStencilMode(e.stencilModeForClipping(n)),p.uniform4f(t.uniforms.u_speed_mat,Um.getCalculatedSpeed(1,a),Um.getCalculatedSpeed(2,a),Um.getCalculatedSpeed(3,a),Um.getCalculatedSpeed(4,a));var c=e.translatePosMatrix(n.posMatrix,i,a.paint.get("sprite-translate"),a.paint.get("sprite-translate-anchor"));p.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(c)),p.uniform1f(t.uniforms.u_ratio,1/Cf(i,1,e.transform.zoom)),t.draw(l,p.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,o);}var qm=new Ua({"symbol-placement":new Na(Te.layout_symtracking["symbol-placement"]),"symbol-spacing":new Na(Te.layout_symtracking["symbol-spacing"]),"symbol-avoid-edges":new Na(Te.layout_symtracking["symbol-avoid-edges"]),"icon-allow-overlap":new Na(Te.layout_symtracking["icon-allow-overlap"]),"icon-ignore-placement":new Na(Te.layout_symtracking["icon-ignore-placement"]),"icon-optional":new Na(Te.layout_symtracking["icon-optional"]),"icon-rotation-alignment":new Na(Te.layout_symtracking["icon-rotation-alignment"]),"icon-size":new ka(Te.layout_symtracking["icon-size"]),"icon-text-fit":new Na(Te.layout_symtracking["icon-text-fit"]),"icon-text-fit-padding":new Na(Te.layout_symtracking["icon-text-fit-padding"]),"icon-image":new ka(Te.layout_symtracking["icon-image"]),"icon-rotate":new ka(Te.layout_symtracking["icon-rotate"]),"icon-padding":new Na(Te.layout_symtracking["icon-padding"]),"icon-keep-upright":new Na(Te.layout_symtracking["icon-keep-upright"]),"icon-offset":new ka(Te.layout_symtracking["icon-offset"]),"icon-anchor":new ka(Te.layout_symtracking["icon-anchor"]),"icon-pitch-alignment":new Na(Te.layout_symtracking["icon-pitch-alignment"]),"text-pitch-alignment":new Na(Te.layout_symtracking["text-pitch-alignment"]),"text-rotation-alignment":new Na(Te.layout_symtracking["text-rotation-alignment"]),"text-field":new ka(Te.layout_symtracking["text-field"]),"text-font":new ka(Te.layout_symtracking["text-font"]),"text-size":new ka(Te.layout_symtracking["text-size"]),"text-max-width":new ka(Te.layout_symtracking["text-max-width"]),"text-line-height":new Na(Te.layout_symtracking["text-line-height"]),"text-letter-spacing":new ka(Te.layout_symtracking["text-letter-spacing"]),"text-justify":new ka(Te.layout_symtracking["text-justify"]),"text-anchor":new ka(Te.layout_symtracking["text-anchor"]),"text-max-angle":new Na(Te.layout_symtracking["text-max-angle"]),"text-rotate":new ka(Te.layout_symtracking["text-rotate"]),"text-padding":new Na(Te.layout_symtracking["text-padding"]),"text-keep-upright":new Na(Te.layout_symtracking["text-keep-upright"]),"text-transform":new ka(Te.layout_symtracking["text-transform"]),"text-offset":new ka(Te.layout_symtracking["text-offset"]),"text-allow-overlap":new Na(Te.layout_symtracking["text-allow-overlap"]),"text-ignore-placement":new Na(Te.layout_symtracking["text-ignore-placement"]),"text-optional":new Na(Te.layout_symtracking["text-optional"]),"symtracking-time-segment":new Na(Te.layout_symtracking["symtracking-time-segment"]),"symtracking-fps":new Na(Te.layout_symtracking["symtracking-fps"]),"compatible-mode":new Na(Te.layout_symtracking["compatible-mode"])}),Xm={paint:new Ua({"icon-opacity":new ka(Te.paint_symtracking["icon-opacity"]),"icon-color":new ka(Te.paint_symtracking["icon-color"]),"icon-halo-color":new ka(Te.paint_symtracking["icon-halo-color"]),"icon-halo-width":new ka(Te.paint_symtracking["icon-halo-width"]),"icon-halo-blur":new ka(Te.paint_symtracking["icon-halo-blur"]),"icon-translate":new Na(Te.paint_symtracking["icon-translate"]),"icon-translate-anchor":new Na(Te.paint_symtracking["icon-translate-anchor"]),"text-opacity":new ka(Te.paint_symtracking["text-opacity"]),"text-color":new ka(Te.paint_symtracking["text-color"]),"text-halo-color":new ka(Te.paint_symtracking["text-halo-color"]),"text-halo-width":new ka(Te.paint_symtracking["text-halo-width"]),"text-halo-blur":new ka(Te.paint_symtracking["text-halo-blur"]),"text-translate":new Na(Te.paint_symtracking["text-translate"]),"text-translate-anchor":new Na(Te.paint_symtracking["text-translate-anchor"]),"symtracking-delay":new Na(Te.paint_symtracking["symtracking-delay"]),"render-3d":new Na(Te.paint_symtracking["render-3d"]),"symtracking-height-offset":new Na(Te.paint_symtracking["symtracking-height-offset"]),"render-road-mark":new Na(Te.paint_symtracking["render-road-mark"])}),layout:qm},Gm=(ls(new Float32Array(16)),Xm.layout),Wm=0,Ym=10;function Hm(t,e,i,r,a,n,o,s,u,l,p){var c,h=t.context,f=h.gl,m=t.transform,d="map"===s,_="map"===u,y=d&&!_&&!0,g=_;h.setDepthMode(g?t.depthModeForSublayer(0,mh.ReadOnly):mh.disabled);for(var v=0,x=r;v<x.length;v+=1){var b=x[v],w=e.getTile(b),A=w.getBucket(i);if(A){var T=a?A.text:A.icon;if(T&&T.segments.get().length){var S=T.programConfigurations.get(i.id),E=a||A.sdfIcons,P=a?A.textSizeData:A.iconSizeData;if(c||(c=t.useProgram(E?"symtrackingSDF":"symtrackingIcon",S),S.setUniforms(t.context,c,i.paint,{zoom:t.transform.zoom}),Qm(c,t,i,a,y,_,P,p)),h.activeTexture.set(f.TEXTURE0),f.uniform1i(c.uniforms.u_texture,0),a)w.glyphAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.uniform2fv(c.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var I=1!==i.layout.get("icon-size").constantOr(0)||A.iconsNeedLinear,R=_||0!==m.pitch;w.iconAtlasTexture.bind(E||t.options.rotating||t.options.zooming||I||R?f.LINEAR:f.NEAREST,f.CLAMP_TO_EDGE),f.uniform2fv(c.uniforms.u_texsize,w.iconAtlasTexture.size);}f.uniformMatrix4fv(c.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(b.posMatrix,w,n,o)));var M=Cf(w,1,t.transform.zoom),z=am(b.posMatrix,_,d,t.transform,M),C=nm(b.posMatrix,_,d,t.transform,M);f.uniformMatrix4fv(c.uniforms.u_gl_coord_matrix,!1,new Float32Array(t.translatePosMatrix(C,w,n,o,!0))),f.uniformMatrix4fv(c.uniforms.u_label_plane_matrix,!1,z),f.uniform1f(c.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),Zm(c,S,t,i,w,T,a,E,_);}}}}function Qm(t,e,i,r,a,n,o,s){var u=e.context.gl,l=e.transform;u.uniform1i(t.uniforms.u_pitch_with_map,n?1:0),u.uniform1f(t.uniforms.u_is_text,r?1:0),u.uniform1f(t.uniforms.u_pitch,l.pitch/360*2*Math.PI);var p="constant"===o.functionType||"source"===o.functionType,c="constant"===o.functionType||"camera"===o.functionType;u.uniform1i(t.uniforms.u_is_size_zoom_constant,p?1:0),u.uniform1i(t.uniforms.u_is_size_feature_constant,c?1:0),u.uniform1f(t.uniforms.u_camera_to_center_distance,l.cameraToCenterDistance);var h=ml(o,l.zoom,Gm.properties[r?"text-size":"icon-size"]);void 0!==h.uSizeT&&u.uniform1f(t.uniforms.u_size_t,h.uSizeT),void 0!==h.uSize&&u.uniform1f(t.uniforms.u_size,h.uSize),u.uniform1f(t.uniforms.u_aspect_ratio,l.width/l.height),u.uniform1i(t.uniforms.u_rotate_symbol,a?1:0),u.uniform1f(t.uniforms.u_seq,s);}function Zm(t,e,i,r,a,n,o,s,u){var l=i.context,p=l.gl,c=i.transform;if(s){var h=0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),f=u?Math.cos(c._pitch)*c.cameraToCenterDistance:1;p.uniform1f(t.uniforms.u_gamma_scale,f),h&&(p.uniform1f(t.uniforms.u_is_halo,1),Jm(n,r,l,t)),p.uniform1f(t.uniforms.u_is_halo,0);}Jm(n,r,l,t);}function Jm(t,e,i,r){r.draw(i,i.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer);}function Km(t,e,i,r,a,n,o){var s=t.context,u=s.gl;if(n){var l=i.paint.get("histogram-dynamic"),p=i.layout.get("histogram-color-render"),c=null,h=t.context.program.get(),f=n.programConfigurations.get(i.id);if(c=l?t.useProgram("histogramDynamic",f):t.useProgram(p?"histogramColor":"histogram",f),u.uniform1f(c.uniforms.u_fluorescent,Number(i.paint.get("histogram-fluorescent"))),(o||c.program!==h)&&f.setUniforms(s,c,i.paint,{zoom:t.transform.zoom}),p){for(var m=i.paint.get("histogram-colors"),d=i.paint.get("histogram-max-height"),_=[],y=0;y<m.length;y++){var g=Xe.parseCSSColor(m[y]);g[0]/=255,g[1]/=255,g[2]/=255,_.push(g);}u.uniform1f(c.uniforms.u_max_height,3*d),u.uniform4fv(c.uniforms.u_color_a,_[0]),u.uniform4fv(c.uniforms.u_color_b,_[1]),u.uniform4fv(c.uniforms.u_color_c,_[2]),u.uniform4fv(c.uniforms.u_color_d,_[3]),u.uniform4fv(c.uniforms.u_color_e,_[4]);}l&&u.uniform1f(c.uniforms.u_dyn_count,i._count),t.context.gl.uniformMatrix4fv(c.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(a.posMatrix,r,i.paint.get("histogram-translate"),i.paint.get("histogram-translate-anchor")))),u.uniform1f(c.uniforms.u_is_max_length,Number(i.layout.get("histogram-max-height-render"))),function(t,e){var i=e.context.gl,r=e.style.light,a=r.properties.get("position"),n=[a.x,a.y,a.z],o=os();"viewport"===r.properties.get("anchor")&&ss(o,-e.transform.angle);bs(n,n,o);var s=r.properties.get("color");i.uniform3fv(t.uniforms.u_lightpos,n),i.uniform1f(t.uniforms.u_lightintensity,r.properties.get("intensity")),i.uniform3f(t.uniforms.u_lightcolor,s.r,s.g,s.b);}(c,t),c.draw(s,u.TRIANGLES,i.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,f);}}function $m(t,e,i,r,a,n,o){!function(t,e,i,r,a,n,o){var s=t.context.gl,u=function(t,e,i,r,a,n,o,s){var u,l=i.context.program.get();e?(u=i.useProgram(t+"Pattern",r),(s||u.program!==l)&&(r.setUniforms(i.context,u,a.paint,{zoom:i.transform.zoom}),Im(e,i,u),i.context.gl.uniform1f(u.uniforms.u_zoom_factor,Math.pow(2,20-Math.floor(i.transform.zoom)))),Rm(n,i,u)):(u=i.useProgram(t,r),(s||u.program!==l)&&r.setUniforms(i.context,u,a.paint,{zoom:i.transform.zoom}));return u}("sphereFill",e.paint.get("fill-pattern"),t,o,e,i,0,n);s.uniform2f(u.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);var l=tt();it(l,l,[1,Math.cos(t.transform._pitch)]),et(l,l,t.transform.angle),s.uniformMatrix2fv(u.uniforms.u_pixel_matrix,!1,l),s.uniform3fv(u.uniforms.u_camPos,t.transform.getCameraPos()),s.uniform1f(u.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle+Math.PI/18),s.uniformMatrix4fv(u.uniforms.u_matrix,!1,new Float32Array(vt([],t.transform.calculateVPMatrix(),a.tilePlane.matrix))),s.uniformMatrix4fv(u.uniforms.u_modelMatrix,!1,new Float32Array(a.tilePlane.matrix)),u.draw(t.context,s.TRIANGLES,e.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,o);}(t,i,r,0,n,o,n.programConfigurations.get(i.id));}function td(t,e,i,r,a,n){for(var o,s=!0,u=0,l=r;u<l.length;u+=1){var p=l[u],c=e.getTile(p),h=c.getBucket(i);if(h){var f=h.programConfigurations.get(i.id),m=t.context.program.get(),d=t.useProgram(a,f);ed(d,t,c,h,i,p,f,s||d.program!==m,o!==c.tileID.overscaledZ,n),o=c.tileID.overscaledZ,s=!1;}}}function ed(t,e,i,r,a,o,s,u,l,p){var c,h,f,m,d=e.context,_=d.gl,y=a.paint.get("line-dasharray"),g=a.paint.get("line-pattern");if(u||l){var v=1/Cf(i,1,e.transform.tileZoom);if(s.setUniforms(e.context,t,a.paint,{zoom:e.transform.zoom}),y){c=e.lineAtlas.getDash(y.from,"round"===a.layout.get("line-cap")),h=e.lineAtlas.getDash(y.to,"round"===a.layout.get("line-cap"));var x=c.width*y.fromScale,b=h.width*y.toScale;_.uniform2f(t.uniforms.u_patternscale_a,v/x,-c.height/2),_.uniform2f(t.uniforms.u_patternscale_b,v/b,-h.height/2),_.uniform1f(t.uniforms.u_sdfgamma,e.lineAtlas.width/(256*Math.min(x,b)*n.devicePixelRatio)/2);}else if(g){if(f=e.imageManager.getPattern(g.from),m=e.imageManager.getPattern(g.to),!f||!m)return;_.uniform2f(t.uniforms.u_pattern_size_a,f.displaySize[0]*g.fromScale/v,f.displaySize[1]),_.uniform2f(t.uniforms.u_pattern_size_b,m.displaySize[0]*g.toScale/v,m.displaySize[1]);var w=e.imageManager.getPixelSize(),A=w.width,T=w.height;_.uniform2fv(t.uniforms.u_texsize,[A,T]);}_.uniform2f(t.uniforms.u_gl_units_to_pixels,e.transform.width/2,-e.transform.height/2);}if(u&&(y?(_.uniform1i(t.uniforms.u_image,0),d.activeTexture.set(_.TEXTURE0),e.lineAtlas.bind(d),_.uniform1f(t.uniforms.u_tex_y_a,c.y),_.uniform1f(t.uniforms.u_tex_y_b,h.y),_.uniform1f(t.uniforms.u_mix,y.t)):g&&(_.uniform1i(t.uniforms.u_image,0),d.activeTexture.set(_.TEXTURE0),e.imageManager.bind(d),_.uniform2fv(t.uniforms.u_pattern_tl_a,f.tl),_.uniform2fv(t.uniforms.u_pattern_br_a,f.br),_.uniform2fv(t.uniforms.u_pattern_tl_b,m.tl),_.uniform2fv(t.uniforms.u_pattern_br_b,m.br),_.uniform1f(t.uniforms.u_fade,g.t))),_.uniform1f(t.uniforms.u_ratio,1/Cf(i,1,e.transform.zoom)),a.paint.get("line-gradient")){d.activeTexture.set(_.TEXTURE0);var S=a.gradientTexture;if(!a.gradient)return;S||(S=a.gradientTexture=new Pc(d,a.gradient,_.RGBA)),S.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.uniform1i(t.uniforms.u_image,0);}var E=is();as(E,E,[1,Math.cos(e.transform._pitch)]),rs(E,E,e.transform.angle),_.uniformMatrix2fv(t.uniforms.u_pixel_matrix,!1,E),_.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(ys([],e.transform.calculateVPMatrix(),r.tilePlane.matrix))),t.draw(d,_.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,s);}var id=Tl.layout;function rd(t,e,i,r,a,n,o,s,u,l){var p,c=t.context,h=c.gl,f=t.transform,m="map"===s,d="map"===u,_=m&&"point"!==i.layout.get("symbol-placement"),y=m&&!d&&!_;c.setDepthMode(mh.disabled),c.setColorMode(_h.alphaBlended);for(var g=!1,v=0,x=r;v<x.length;v+=1){var b=x[v],w=e.getTile(b),A=w.getBucket(i);if(A){var T=a?A.text:A.icon;if(T&&T.segments.get().length){var S=T.programConfigurations.get(i.id),E=a||A.sdfIcons,P=a?A.textSizeData:A.iconSizeData;if(p||(p=t.useProgram(E?"sphereSymbolSDF":"sphereSymbolIcon",S),S.setUniforms(t.context,p,i.paint,{zoom:t.transform.zoom}),h.uniform2f(p.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2),h.uniform1f(p.uniforms.u_zoom_factor,Math.pow(2,t.transform.zoom-18)),ad(p,t,i,a,y,d,P)),c.activeTexture.set(h.TEXTURE5),h.uniform1i(p.uniforms.u_texture,5),a)w.glyphAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.uniform2fv(p.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var I=1!==i.layout.get("icon-size").constantOr(0)||A.iconsNeedLinear,R=d||0!==f.pitch;w.iconAtlasTexture.bind(E||t.options.rotating||t.options.zooming||I||R?h.LINEAR:h.NEAREST,h.CLAMP_TO_EDGE),h.uniform2fv(p.uniforms.u_texsize,w.iconAtlasTexture.size);}var M=Cf(w,1,t.transform.zoom),z=am(b.posMatrix,d,m,t.transform,M),C=nm(b.posMatrix,d,m,t.transform,M);if(h.uniformMatrix4fv(p.uniforms.u_gl_coord_matrix,!1,new Float32Array(t.translatePosMatrix(C,w,n,o,!0))),_?(h.uniform1i(p.uniforms.u_along_line,1),um(A,b.posMatrix,t,a,z,C,d,l)):h.uniform1i(p.uniforms.u_along_line,0),h.uniform1f(p.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),!g){var O=is();as(O,O,[1,Math.cos(t.transform._pitch)]),h.uniformMatrix2fv(p.uniforms.u_pitch_matrix,!1,O),h.uniformMatrix2fv(p.uniforms.u_rot_matrix,!1,rs([],is(),t.transform.angle)),h.uniformMatrix2fv(p.uniforms.u_pitch_rot_matrix,!1,ns([],O,rs([],is(),t.transform.angle))),h.uniform1f(p.uniforms.u_bearing,-t.transform.angle),h.uniform3fv(p.uniforms.u_camPos,t.transform.getCameraPos()),h.uniform1f(p.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle),h.uniformMatrix4fv(p.uniforms.u_symbol_mvp_matrix,!1,t.transform.td_symbolMVPMatrix),g=!0;}h.uniformMatrix4fv(p.uniforms.u_matrix,!1,new Float32Array(ys([],t.transform.calculateVPMatrix(),A.tilePlane.matrix))),h.uniformMatrix4fv(p.uniforms.u_modelMatrix,!1,new Float32Array(A.tilePlane.matrix)),nd(p,S,t,i,w,T,a,E,d);}}}}function ad(t,e,i,r,a,n,o){var s=e.context.gl,u=e.transform;s.uniform1i(t.uniforms.u_pitch_with_map,n?1:0),s.uniform1i(t.uniforms.u_is_text,r),s.uniform1f(t.uniforms.u_pitch,u.pitch/360*2*Math.PI);var l="constant"===o.functionType||"source"===o.functionType,p="constant"===o.functionType||"camera"===o.functionType;s.uniform1i(t.uniforms.u_is_size_zoom_constant,l?1:0),s.uniform1i(t.uniforms.u_is_size_feature_constant,p?1:0),s.uniform1f(t.uniforms.u_camera_to_center_distance,u.alt);var c=ml(o,u.zoom,id.properties[r?"text-size":"icon-size"]);void 0!==c.uSizeT&&s.uniform1f(t.uniforms.u_size_t,c.uSizeT),void 0!==c.uSize&&s.uniform1f(t.uniforms.u_size,c.uSize),s.uniform1f(t.uniforms.u_aspect_ratio,u.width/u.height),s.uniform1i(t.uniforms.u_rotate_symbol,a?1:0);}function nd(t,e,i,r,a,n,o,s,u){var l=i.context,p=l.gl,c=i.transform;if(s){var h=0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),f=u?Math.cos(c._pitch)*c.cameraToCenterDistance:1;p.uniform1f(t.uniforms.u_gamma_scale,f),h&&(p.uniform1i(t.uniforms.u_is_halo,!0),od(n,r,l,t)),p.uniform1i(t.uniforms.u_is_halo,!1);}od(n,r,l,t);}function od(t,e,i,r){r.draw(i,i.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer);}var sd=new Th,ud=["sphereExtrusionPattern","sphereExtrusion","sphereExtrusionPatternShadow","sphereExtrusionShadow","sphereExtrusionPatternCameraView","sphereExtrusionCameraView"];function ld(t,e,i,r,a,n,o,s,u){var l=t.context,p=l.gl,c=t.context.program.get(),h=n.programConfigurations.get(i.id),f=t.useProgram(s,h);(o||f.program!==c)&&h.setUniforms(l,f,i.paint,{zoom:t.transform.zoom});for(var m=i.radiationRegions,d=0;d<20;d++){var _=m[d];_?(p.uniform1i(f.uniforms["u_regions["+d+"].use"],!0),p.uniform4fv(f.uniforms["u_regions["+d+"].pos"],_.geo)):p.uniform1i(f.uniforms["u_regions["+d+"].use"],!1);}if(m.length>0&&p.uniform1f(f.uniforms.u_region_percent,t._map.timer.counter/10%1),u){if(Pm(u,t))return;Im(u,t,f),Rm(r,t,f);var y=i.paint.get("extrusion-top-pattern");y?!function(t,e,i){var r=e.gl,a=sd.getATexture(t.to);if(a){e.activeTexture.set(r.TEXTURE9);var n=a.isSizePowerOfTwoNoneSquare(),o=r.CLAMP_TO_EDGE;return a.bind(r.LINEAR,o,n?r.LINEAR_MIPMAP_NEAREST:r.LINEAR),r.uniform1i(i.uniforms.u_image_top,9),!0}return sd.addATexture(t.to,t.to,e),!1}(y,l,f)?p.uniform1i(f.uniforms.u_top_tex_rend,!1):p.uniform1i(f.uniforms.u_top_tex_rend,!0):p.uniform1i(f.uniforms.u_top_tex_rend,!1);}var g,v=t.transform,x=t.cameraDrawMode,b=t.activeCameras,w=Kn(n.matrix);if(p.uniform1f(f.uniforms.u_viewshed_count,0),x===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||x===le.CAMERA.DRAW_MODE.ONSCREEN_ALL){var A=t.fbManager.shadowFramebuffer;A&&(l.activeTexture.set(p.TEXTURE10),p.bindTexture(p.TEXTURE_2D,A.colorAttachment.get()),p.uniform1i(f.uniforms.u_shadow_sampler,10)),p.uniform1f(f.uniforms.u_shadow_off,t.shadowOff);}if(i.viewshedRender&&(x===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||x===le.CAMERA.DRAW_MODE.ONSCREEN_ALL)){for(var T=0;T<b.viewshed.length&&T<1;T++){var S=b.viewshed[T].fb;S&&(l.activeTexture.set(p.TEXTURE11),p.bindTexture(p.TEXTURE_2D,S.colorAttachment.get()),p.uniform1i(f.uniforms.u_viewshed_samp0,11));}p.uniform1f(f.uniforms.u_shadow_off,t.shadowOff),p.uniform1f(f.uniforms.u_viewshed_count,1);}var E,P,I=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(x!==le.CAMERA.DRAW_MODE.OFFSCREEN&&x!==le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||(E=v._center.toArray(),P=t._map.sunLight._shadowSunPosition({target:E,distance:v.alt*le.TRANSFORM.R_ZOOM})),!t.depthPick)if(x===le.CAMERA.DRAW_MODE.OFFSCREEN)"night"!==t._map.sunLight._shadow&&(g||(ys(w,v.calculateVPMatrix(P),w),g=new Float32Array(Kn(w)),p.uniformMatrix4fv(f.uniforms.u_matrix,!1,g)));else if(x===le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)g||(ys(w,v.calculateVPMatrix(b.viewshed[0]),w),g=new Float32Array(Kn(w)),p.uniformMatrix4fv(f.uniforms.u_matrix,!1,g));else if(x===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW)"night"!==t._map.sunLight._shadow?(p.uniform1i(f.uniforms.u_with_shadow,!0),ys(I,v.calculateVPMatrix(P),w)):p.uniform1i(f.uniforms.u_with_shadow,!1),p.uniformMatrix4fv(f.uniforms.u_sun_matrix,!1,new Float32Array(I));else if(x===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED){var R=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ys(R,v.calculateVPMatrix(b.viewshed[0]),w),p.uniformMatrix4fv(f.uniforms.u_viewshed_mat0,!1,new Float32Array(R)),p.uniform3fv(f.uniforms.u_viewshed_eye0,v._lastSunLightStatus.geographic),p.uniform1f(f.uniforms.u_viewshed_dist0,b.viewshed[0].farDistance),p.uniform1i(f.uniforms.u_viewshed_used0,!0);}else if(x===le.CAMERA.DRAW_MODE.ONSCREEN_ALL){"night"!==t._map.sunLight._shadow?(p.uniform1i(f.uniforms.u_with_shadow,!0),ys(I,v.calculateVPMatrix(P),w)):p.uniform1i(f.uniforms.u_with_shadow,!1),p.uniformMatrix4fv(f.uniforms.u_sun_matrix,!1,new Float32Array(I));var M=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ys(M,v.calculateVPMatrix(b.viewshed[0]),w),p.uniformMatrix4fv(f.uniforms.u_viewshed_mat0,!1,new Float32Array(M)),p.uniform3fv(f.uniforms.u_viewshed_eye0,v._lastSunLightStatus.geographic),p.uniform1f(f.uniforms.u_viewshed_dist0,b.viewshed[0].farDistance),p.uniform1i(f.uniforms.u_viewshed_used0,!0);}g||(ys(w,v.calculateVPMatrix(),w),g=new Float32Array(w),p.uniformMatrix4fv(f.uniforms.u_matrix,!1,g)),x!==le.CAMERA.DRAW_MODE.ONSCREEN_ALL&&x!==le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED&&x!==le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||(n.normalMatrix||(n.normalMatrix=new Float32Array(ps([],cs([],n.matrix)))),p.uniformMatrix4fv(f.uniforms.u_normal,!1,n.normalMatrix),p.uniformMatrix4fv(f.uniforms.u_model,!1,new Float32Array(n.matrix))),p.uniform1f(f.uniforms.u_opacity,i.paint.get("extrusion-opacity")),function(t,e){var i=e.context.gl;i.uniform3fv(t.uniforms.u_light,e._map.sunLight.getSunLightPos()),i.uniform3fv(t.uniforms.u_lightcolor,[1,1,1]);}(f,t),f.draw(l,p.TRIANGLES,i.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,h);}function pd(t,e,i,r,a,n,o,s,u,l,p,c,h){var f=e.context,m=f.gl;(s||u)&&(o.setUniforms(e.context,t,a.paint,{zoom:e.transform.zoom}),m.uniform2f(t.uniforms.u_gl_units_to_pixels,e.transform.width/2,-e.transform.height/2)),m.uniform1f(t.uniforms.u_ratio,1/Cf(i,1,e.transform.zoom));var d=is();as(d,d,[1,Math.cos(e.transform._pitch)]),rs(d,d,e.transform.angle),m.uniformMatrix2fv(t.uniforms.u_pixel_matrix,!1,d),m.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(ys([],e.transform.calculateVPMatrix(),r.tilePlane.matrix))),m.uniform1f(t.uniforms.u_start,l-h),m.uniform1f(t.uniforms.u_end,l),m.uniform1f(t.uniforms.u_segments,h),m.uniform1i(t.uniforms.u_reverse,p),m.uniform1i(t.uniforms.u_reserve,c),t.draw(f,m.TRIANGLES,a.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,o);}var cd={speedExt1:2,speedExt2:4,speedExt3:5,speedExt4:6,getCalculatedSpeed:function(t,e){return parseInt(e.speeds["speed"+t]/t/this["speedExt"+t])}};function hd(t,e,i,r,a,n,o,s){var u=t.context,l=u.gl,p=t.context.program.get(),c=t.useProgram("sphereSprite",o),h=n||c.program!==p,f=s!==e.tileID.overscaledZ;h&&o.setUniforms(t.context,c,r.paint,{zoom:t.transform.zoom}),(h||f)&&l.uniform2f(c.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);var m=is();as(m,m,[1,Math.cos(t.transform._pitch)]),rs(m,m,t.transform.angle),l.uniformMatrix2fv(c.uniforms.u_pixel_matrix,!1,m),l.uniform4f(c.uniforms.u_speed_mat,cd.getCalculatedSpeed(1,r),cd.getCalculatedSpeed(2,r),cd.getCalculatedSpeed(3,r),cd.getCalculatedSpeed(4,r)),l.uniformMatrix4fv(c.uniforms.u_matrix,!1,new Float32Array(ys([],t.transform.calculateVPMatrix(),i.tilePlane.matrix))),l.uniform1f(c.uniforms.u_ratio,1/Cf(e,1,t.transform.zoom)),c.draw(u,l.TRIANGLES,r.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,o);}var fd=!0;var md=We.parse("#ffffff"),dd=We.parse("#333333"),_d=function(){this._cameraContainer={},this._sunLightCamera=this.addCameraView(le.CAMERA.SUNLIGHT_CAMERA_ID,{});};_d.prototype.addCameraView=function(t,e){if(this._cameraContainer[t])throw Error("你已经添加过相同id的相机视图了");var i=e.farDistance||100;i*=le.TRANSFORM.R_SCALE;var r={pitch:e.pitch||30,bearing:e.bearing||0,active:e.active||!1,farDistance:i,hFov:e.hFov||60,wFov:e.wFov||60,location:e.location,distanceToCameraDestination:e.distanceToCameraDestination||0,altitude:e.altitude||0,color:e.color||[md.r,md.g,md.b],shadowColor:e.shadowColor||[dd.r,dd.g,dd.b],id:t,fb:null};return this._cameraContainer[t]=r,r},_d.createACameraView=function(t){var e=t.farDistance||100;return e*=le.TRANSFORM.R_SCALE,{pitch:t.pitch||30,bearing:t.bearing||0,active:t.active||!1,farDistance:e,hFov:t.hFov||60,wFov:t.wFov||60,location:t.location,distanceToCameraDestination:t.distanceToCameraDestination||0,altitude:t.altitude||0,color:t.color||[md.r,md.g,md.b],shadowColor:t.shadowColor||[dd.r,dd.g,dd.b],id:t.id,fb:null}},_d.prototype.deleteCameraView=function(t){this._cameraContainer[t]=null,delete this._cameraContainer[t];},_d.prototype.getCameraView=function(t){return this._cameraContainer[t]},_d.prototype.openCameraView=function(t){return!!this._cameraContainer[t]&&(this._cameraContainer[t].active=!0,!0)},_d.prototype.closeCameraView=function(t){return!!this._cameraContainer[t]&&(this._cameraContainer[t].active=!1,!0)},_d.prototype.getAllCameraViews=function(){return this._cameraContainer},_d.prototype.getAllActiveCameraViews=function(){var t={shadow:null,viewshed:[]};for(var e in this._cameraContainer)this._cameraContainer[e].active&&(e===le.CAMERA.SUNLIGHT_CAMERA_ID?t.shadow=this._cameraContainer[e]:t.viewshed.push(this._cameraContainer[e]));return t},_d.prototype.modifyCameraViewById=function(t,e){if(this._cameraContainer[t])for(var i in e)if(e[i]||0===e[i])if("color"===i||"shadowColor"===i){var r=We.parse(e[i]);this._cameraContainer[t][i]=[r.r,r.g,r.b];}else this._cameraContainer[t][i]="farDistance"===i?e[i]*le.TRANSFORM.R_SCALE:e[i];},_d.prototype.modifyCameraViewGroup=function(t){for(var e in t)this.modifyCameraViewById(e,t[e]);};var yd=["sphere","sphereAtmosphere","bloomBlur","screen"];function gd(t,e,i,r,a,n,o,s){n.bindFramebuffer.set(i||null),n.activeTexture.set(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,e.colorAttachment.get()),o.uniform1i(a.uniforms.u_image,2);var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];yt(u,0,t.width,t.height,0,0,1),o.uniformMatrix4fv(a.uniforms.u_matrix,!1,new Float32Array(u)),o.uniform2fv(a.uniforms.u_dir,r),o.uniform1f(a.uniforms.u_extent,s||2),o.uniform2fv(a.uniforms.u_resolution,[1/t.width,1/t.height]),o.uniform2f(a.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(n,a,t.viewportBuffer,[]),o.drawArrays(o.TRIANGLE_STRIP,0,4);}function vd(t,e){if(t._map.panoramaMode){var i=t.context,r=i.gl,a=e.getSource();if(i.setStencilMode(dh.disabled),a.texture){t.transform;var n=t.useProgram("panorama");r.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(t.transform.td_vpMatrix)),i.setColorMode(_h.unblended),i.setCullFace(yh.disabled),i.setDepthMode(new mh(i.gl.LEQUAL,mh.ReadWrite,[0,1])),i.activeTexture.set(r.TEXTURE0),r.uniform1i(n.uniforms.u_normal_resolution,0),a.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE);var o=a.sphereBuffer;a.sphereVAO.bind(i,n,o,[]),r.drawArrays(a._options.debug?r.LINE_STRIP:r.TRIANGLE_STRIP,0,o.length);}i.setDepthMode(new mh(i.gl.LEQUAL,mh.ReadWrite,[0,1]));}}function xd(t,e,i,r){var a=Math.floor((i+r)/2),n=t[a];return i>r?a:n>e?xd(t,e,i,a-1):n<e?xd(t,e,a+1,r):a}var bd=null;function wd(t,e,i,r,a,n,o,s,u){if(!bd)for(var l in bd=[],e.nodeList)bd.push(e.nodeList[l]);if(-1!==bd.indexOf(i)){var p=parseInt(t%60),c=e.nodeList,h=null,f=null;switch(i){case c.nl:h=Ad(p,e.materialConf,"nl");break;case c.ns:h=Ad(p,e.materialConf,"ns");break;case c.sl:h=Ad(p,e.materialConf,"sl");break;case c.ss:h=Ad(p,e.materialConf,"ss");break;case c.wl:h=Ad(p,e.materialConf,"wl");break;case c.ws:h=Ad(p,e.materialConf,"ws");break;case c.el:h=Ad(p,e.materialConf,"el");break;case c.es:h=Ad(p,e.materialConf,"es");break;case c.nlR:f=Td(p,"nl").r;break;case c.nlG:f=Td(p,"nl").g;break;case c.nlY:f=Td(p,"nl").y;break;case c.nsR:f=Td(p,"ns").r;break;case c.nsG:f=Td(p,"ns").g;break;case c.nsY:f=Td(p,"ns").y;break;case c.slR:f=Td(p,"sl").r;break;case c.slG:f=Td(p,"sl").g;break;case c.slY:f=Td(p,"sl").y;break;case c.ssR:f=Td(p,"ss").r;break;case c.ssG:f=Td(p,"ss").g;break;case c.ssY:f=Td(p,"ss").y;break;case c.wlR:f=Td(p,"wl").r;break;case c.wlG:f=Td(p,"wl").g;break;case c.wlY:f=Td(p,"wl").y;break;case c.wsR:f=Td(p,"ws").r;break;case c.wsG:f=Td(p,"ws").g;break;case c.wsY:f=Td(p,"ws").y;break;case c.elR:f=Td(p,"el").r;break;case c.elG:f=Td(p,"el").g;break;case c.elY:f=Td(p,"el").y;break;case c.esR:f=Td(p,"es").r;break;case c.esG:f=Td(p,"es").g;break;case c.esY:f=Td(p,"es").y;}var m=a[h];if(m)if(n[m&&m.baseColorTexture.index||0]){s.uniform1i(u.uniforms.u_use_text,!0),s.uniform4fv(u.uniforms.u_fill_color,m.baseColorFactor||[1,1,1,1]);var d=n[m.baseColorTexture.index].isSizePowerOfTwoNoneSquare(),_=d&&o[m.sampler].wrapS||s.CLAMP_TO_EDGE;n[m.baseColorTexture.index].bind(s.LINEAR,_,d?s.LINEAR_MIPMAP_NEAREST:s.LINEAR);}else s.uniform1i(u.uniforms.u_use_text,!1),s.uniform4fv(u.uniforms.u_fill_color,m&&m.baseColorFactor||[.6,.6,.6,1]);else s.uniform1i(u.uniforms.u_use_text,!1),s.uniform4fv(u.uniforms.u_fill_color,f);}else if(n[r&&r.baseColorTexture.index||0]){s.uniform1i(u.uniforms.u_use_text,!0),s.uniform4fv(u.uniforms.u_fill_color,r.baseColorFactor||[1,1,1,1]);var y=n[r.baseColorTexture.index].isSizePowerOfTwoNoneSquare(),g=y&&o[r.sampler].wrapS||s.CLAMP_TO_EDGE;n[r.baseColorTexture.index].bind(s.LINEAR,g,y?s.LINEAR_MIPMAP_NEAREST:s.LINEAR);}else s.uniform1i(u.uniforms.u_use_text,!1),s.uniform4fv(u.uniforms.u_fill_color,r&&r.baseColorFactor||[.6,.6,.6,1]);}function Ad(t,e,i){var r=null;switch(i){case"ns":case"ss":r=10-t>=0?e["g"+(10-t)]:14-t>=0?e["y"+(14-t)]:e["r"+(59-t)];break;case"nl":case"sl":r=14-t>=0?e["r"+(14-t)]:25-t>=0?e["g"+(25-t)]:29-t>=0?e["y"+(29-t)]:e["r"+(74-t)];break;case"ws":case"es":r=29-t>=0?e["r"+(29-t)]:40-t>=0?e["g"+(40-t)]:44-t>=0?e["y"+(44-t)]:e["r"+(89-t)];break;case"wl":case"el":r=44-t>=0?e["r"+(44-t)]:55-t>=0?e["g"+(55-t)]:e["y"+(59-t)];}return r}function Td(t,e){var i={};switch(e){case"ns":case"ss":10-t>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):14-t>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"nl":case"sl":14-t>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):25-t>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):29-t>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"ws":case"es":29-t>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):40-t>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):44-t>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"wl":case"el":44-t>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):55-t>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]);}return i}var Sd=["gltfModel","gltfShadowEncode","gltfModelCameraView"];function Ed(t,e,i,r,a,n,o){var s=e.animations[n.ani].channels[n.cha],u=s.path,l=s.count,p=s.input,c=s.output;vt(t,t,e.nodes[i].matrix);for(var h,f,m=a._map.timer.counter%p[l-1],d=0,_=0;_<l-1;_++)if(m>=p[_]&&m<=p[_+1]){h=_,f=_+1,d=(m-p[_])/(p[_+1]-p[_]);break}if("translation"===u)lt(t,t,Ct([],c[h].slice(0),c[f].slice(0),d));else if("rotation"===u)vt(t,t,dt([],ie([],c[h].slice(0),c[f].slice(0),d)));else if("scale"===u)pt(t,t,Ct([],c[h].slice(0),c[f].slice(0),d));else if("weights"===u)for(var y=c.length/p.length,g=[],v=0;v<y;v++)g.push(c[h*y+v]*(1-d)+c[f*y+v]*d),o.uniform1f(r.uniforms["u_weight"+v],c[h*y+v]*(1-d)+c[f*y+v]*d);}function Pd(t,e,i){if(!t.minMaxRect){var r,a,n,o,s=t.aabb[0],u=t.aabb[1],l=Ot([],s,e),p=Ot([],u,e),c=Wn([],l),h=Wn([],p);c[0]<h[0]?(o=c[0],n=h[0]):(o=h[0],n=c[0]),c[1]<h[1]?(r=h[1],a=c[1]):(r=c[1],a=h[1]),t.minMaxRect={north:r,south:a,east:n,west:o};}return!!i.intersectRect(i.td_lastRect,t.minMaxRect)}var Id=["gltfTile","gltfShadowEncode","gltfModelCameraView"];function Rd(t,e,i,r,a,n,o,s,u,l,p,c,h,f){o.uniform1i(r.uniforms.u_use_text,i.textures.length>0);var m=e.gltfModelVAO;n.setDepthMode(new mh(o.LESS,mh.ReadWrite,[0,1])),n.activeTexture.set(o.TEXTURE2),o.uniform1i(r.uniforms.u_BaseColorSampler,2);for(var d=0;d<i.meshes.length;d++){var _=i.materials[i.meshes[d].material];if("OPAQUE"===_.alphaMode?n.setColorMode(_h.unblended):n.setColorMode(_h.alphaBlended),o.uniform1i(r.uniforms.u_hightlight,!!i.meshes[d].highlight),o.uniform1i(r.uniforms.u_morph_weight,!1),void 0!==_&&s.getATexture(i.textures[_.baseColorTexture.index])){o.uniform1i(r.uniforms.u_use_text,!0),o.uniform4fv(r.uniforms.u_fill_color,_.baseColorFactor||[1,1,1,1]);var y=s.getATexture(i.textures[i.materials[i.meshes[d].material].baseColorTexture.index]),g=y.isSizePowerOfTwoNoneSquare(),v=g&&i.samplers[_.sampler].wrapS||o.CLAMP_TO_EDGE;y.bind(o.LINEAR,v,g?o.LINEAR_MIPMAP_NEAREST:o.LINEAR);}else o.uniform1i(r.uniforms.u_use_text,!1),o.uniform4fv(r.uniforms.u_fill_color,_.baseColorFactor||[1,1,1,1]);var x=Kn(p),b=e._clampEnabled?Kn(c):null;if(u||i.meshes[d].identityMatrix||(vt(x,x,i.meshes[d].matrix),b&&vt(b,b,i.meshes[d].matrix)),u||i.identityMatrix||(vt(x,x,i.matrix),b&&vt(b,b,i.matrix)),b&&(u&&ct(b,b,-90*le.TRANSFORM.DEG_TO_RAD),o.uniformMatrix4fv(r.uniforms.u_clamp_model_matrix,!1,new Float32Array(b))),e.videoMatchEnabled&&o.uniformMatrix4fv(r.uniforms.u_model_matrix,!1,new Float32Array(x)),t.depthPick)vt(x,a.calculateVPMatrix(),x);else if(h===le.CAMERA.DRAW_MODE.OFFSCREEN)vt(x,a.calculateVPMatrix(!0,t._currentCameraView,null),x);else if(h===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED){for(var w=0;w<f.viewshed.length&&l.viewshedRender;w++){var A=f.viewshed[w],T=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];vt(T,a.calculateVPMatrix(!0,A),x),o.uniformMatrix4fv(r.uniforms["u_viewshed_mat"+w],!1,new Float32Array(T)),o.uniformMatrix4fv(r.uniforms["u_view_modelmat"+w],!1,new Float32Array(x)),o.uniform3fv(r.uniforms["u_viewshed_eye"+w],a._lastSunLightStatus.geographic),o.uniform1f(r.uniforms["u_viewshed_dist"+w],f.viewshed[w].farDistance),o.uniform1f(r.uniforms["u_viewshed_used"+w],1);}vt(x,a.calculateVPMatrix(),x);}else if(h===le.CAMERA.DRAW_MODE.ONSCREEN_ALL){for(var S=0;S<f.viewshed.length&&l.viewshedRender;S++){var E=f.viewshed[S],P=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];vt(P,a.calculateVPMatrix(!0,E),x),o.uniformMatrix4fv(r.uniforms["u_viewshed_mat"+S],!1,new Float32Array(P)),o.uniformMatrix4fv(r.uniforms["u_view_modelmat"+S],!1,new Float32Array(x)),o.uniform3fv(r.uniforms["u_viewshed_eye"+S],a._lastSunLightStatus.geographic),o.uniform1f(r.uniforms["u_viewshed_dist"+S],f.viewshed[S].farDistance),o.uniform1f(r.uniforms["u_viewshed_used"+S],1);}vt(x,a.calculateVPMatrix(),x);}else vt(x,a.calculateVPMatrix(),x);o.uniformMatrix4fv(r.uniforms.u_matrix,!1,new Float32Array(x)),n.setCullFace(yh.backCCW);var I=i.meshes[d].gltfVertexBuffer,R=i.meshes[d].gltfIndexBuffer;m.bind(n,r,I,[],R),o.drawElements(R.mode,R.count,R.type,R.offset);}}var Md=function(t,e,i){this.order=[],this.orderOfPole=[],this.orderOfVectorPole=[],this.max=t,e&&(this.onRemove=e),this._projection=i||Xa.MERCATOR,this.reset();},zd={projection:{configurable:!0}};Md.prototype.reset=function(){if(this.onRemove)for(var t in this.data)this.onRemove(t);return this.data={},this.poleData={},this.poleVectorData={},this.order=[],this.orderOfPole=[],this.orderOfVectorPole=[],this},zd.projection.get=function(){return this._projection},zd.projection.set=function(t){this._projection!==t&&(this._projection=t,this.reset());},Md.prototype.has=function(t){return t.wrapped().key in this.data},Md.prototype.hasPole=function(t){return!!this.poleData[t]},Md.prototype.hasVectorPole=function(t){return!!this.poleVectorData[t]},Md.prototype._addATerrainTile=function(t,e){var i=new To,r=new en,a=new Rn;i.prepareSegment(0,r,a);var n=le.TILE.EXTENT,o=t.canonical.x,s=t.canonical.y,u=2;(u=256/Math.pow(2,t.overscaledZ))<le.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(u=le.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);for(var l=[],p=n/u,c=t.overscaledZ,h=[],f=0;f<u;f++){var m=i.prepareSegment(4*(u+1),r,a);this._xyToGeographic(l,0,f*p,c,o,s),0===h.length&&(h=l.slice(0),this._xyToLngLat(0,f*p,c,o,s)),r.emplaceBack(l[0]-h[0],l[1]-h[1],l[2]-h[2],0,f*p),this._xyToGeographic(l,0,(f+1)*p,c,o,s),r.emplaceBack(l[0]-h[0],l[1]-h[1],l[2]-h[2],0,(f+1)*p),m.vertexLength+=2;for(var d=1;d<=u;d++){this._xyToGeographic(l,d*p,f*p,c,o,s),r.emplaceBack(l[0]-h[0],l[1]-h[1],l[2]-h[2],d*p,f*p),this._xyToGeographic(l,d*p,(f+1)*p,c,o,s),r.emplaceBack(l[0]-h[0],l[1]-h[1],l[2]-h[2],d*p,(f+1)*p);var _=m.vertexLength;a.emplaceBack(_-2,_-1,_),a.emplaceBack(_,_-1,_+1),m.vertexLength+=2,m.primitiveLength+=2;}}return this.data[t.wrapped().key]={rtc:h,sphereSegments:i,sphereMaskedBoundsBuffer:e.createVertexBuffer(r,pf.members),sphereMaskedIndexBuffer:e.createIndexBuffer(a),matrix:Jn(0,h,!1)},this.data[t.wrapped().key]},Md.prototype._addARasterPoleTerrainTile=function(t,e,i){var r=new To,a=new en,n=new Rn;r.prepareSegment(0,a,n);for(var o=le.TILE.EXTENT,s=i.canonical.x,u=i.canonical.y,l=[85.05112877980659,-85.05112877980659],p=[],c=o/128,h=e?(90-l[0])/1:-(90-l[0])/1,f=i.overscaledZ,m=360/Math.pow(2,f),d=m*(i.canonical.x+1)-180,_=m*i.canonical.x-180,y=Math.abs(d-_)/128,g=[],v=0;v<1;v++){var x=e?l[0]+(v+1)*h:l[1]+v*h,b=e?l[0]+v*h:l[1]+(v+1)*h,w=r.prepareSegment(516,a,n);this._xyToGeographic(p,0,e?0:o,f,s,u),0===g.length&&(g=p.slice(0),this._xyToLngLat(0,e?0:o,f,s,u)),Gn(p,[_,x],le.TRANSFORM.R),a.emplaceBack(p[0]-g[0],p[1]-g[1],p[2]-g[2],0,v*c),Gn(p,[_,b],le.TRANSFORM.R),a.emplaceBack(p[0]-g[0],p[1]-g[1],p[2]-g[2],0,(v+1)*c),w.vertexLength+=2;for(var A=1;A<=128;A++){Gn(p,[_+A*y,x],le.TRANSFORM.R),a.emplaceBack(p[0]-g[0],p[1]-g[1],p[2]-g[2],A*c,v*c),Gn(p,[_+A*y,b],le.TRANSFORM.R),a.emplaceBack(p[0]-g[0],p[1]-g[1],p[2]-g[2],A*c,(v+1)*c);var T=w.vertexLength;n.emplaceBack(T-2,T-1,T),n.emplaceBack(T,T-1,T+1),w.vertexLength+=2,w.primitiveLength+=2;}}return this.poleData[i.wrapped().key]={rtc:g,sphereSegments:r,sphereMaskedBoundsBuffer:t.createVertexBuffer(a,pf.members),sphereMaskedIndexBuffer:t.createIndexBuffer(n),matrix:Jn(0,g,!1)},this.poleData[i.wrapped().key]},Md.prototype._addAPoleTerrainTile=function(t,e,i){var r=String(t.overscaledZ)+(i?"1":"0"),a=t.overscaledZ,n=new To,o=new en,s=new Rn;n.prepareSegment(0,o,s);for(var u=le.TILE.EXTENT,l=[85.04112877980658,-85.04112877980658],p=[],c=u/128,h=i?(90-l[0])/1:-(90-l[0])/1,f=a,m=Math.abs(360)/128,d=[],_=0;_<1;_++){var y=i?l[0]+(_+1)*h:l[1]+_*h,g=i?l[0]+_*h:l[1]+(_+1)*h,v=n.prepareSegment(516,o,s);this._xyToGeographic(p,0,i?0:u,f,1,0),0===d.length&&(d=p.slice(0),this._xyToLngLat(0,i?0:u,f,1,0)),Gn(p,[-180,y],le.TRANSFORM.R),o.emplaceBack(p[0]-d[0],p[1]-d[1],p[2]-d[2],0,_*c),Gn(p,[-180,g],le.TRANSFORM.R),o.emplaceBack(p[0]-d[0],p[1]-d[1],p[2]-d[2],0,(_+1)*c),v.vertexLength+=2;for(var x=1;x<=128;x++){Gn(p,[x*m-180,y],le.TRANSFORM.R),o.emplaceBack(p[0]-d[0],p[1]-d[1],p[2]-d[2],x*c,_*c),Gn(p,[x*m-180,g],le.TRANSFORM.R),o.emplaceBack(p[0]-d[0],p[1]-d[1],p[2]-d[2],x*c,(_+1)*c);var b=v.vertexLength;s.emplaceBack(b-2,b-1,b),s.emplaceBack(b,b-1,b+1),v.vertexLength+=2,v.primitiveLength+=2;}}return this.poleVectorData[r]={rtc:d,sphereSegments:n,sphereMaskedBoundsBuffer:e.createVertexBuffer(o,pf.members),sphereMaskedIndexBuffer:e.createIndexBuffer(s),matrix:Jn(0,d,!1)},this.poleVectorData[r]},Md.prototype._xyToGeographic=function(t,e,i,r,a,n){var o=Yn(e,i,0,a,n,r,this.projection);t[0]=o[0],t[1]=o[1],t[2]=o[2];},Md.prototype._xyToLngLat=function(t,e,i,r,a){return function(t,e,i,r,a,n,o){var s=Math.pow(2,n),u=r+t/8192,l=a+e/8192,p=Ya(o);return[p.xLng(u,s),p.yLat(l,s)]}(t,e,0,r,a,i,this.projection)},Md.prototype.get=function(t,e){return this.has(t)?(this.order.splice(this.order.indexOf(t.wrapped().key),1),this.order.push(t.wrapped().key),this.data[t.wrapped().key]):(this.order.push(t.wrapped().key),this._addATerrainTile(t,e))},Md.prototype.getVectorPole=function(t,e,i){var r=String(t.overscaledZ)+(i?"1":"0");return this.hasVectorPole(r)?(this.orderOfVectorPole.splice(this.orderOfVectorPole.indexOf(r),1),this.orderOfVectorPole.push(r),this.poleVectorData[r]):(this.orderOfVectorPole.push(r),this._addAPoleTerrainTile(t,e,i))},Md.prototype.getPole=function(t,e,i){var r=i.wrapped().key;return this.hasPole(r)?(this.orderOfPole.splice(this.orderOfPole.indexOf(r),1),this.orderOfPole.push(r),this.poleData[r]):(this.orderOfPole.push(r),this._addARasterPoleTerrainTile(t,e,i))},Md.prototype.remove=function(t){return this.data[t]?(this.onRemove&&this.onRemove(this.data[t]),delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this},Md.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;)this.remove(this.order[0]);return this},Md.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/256)+1)*(Math.ceil(t.height/256)+1),i=2*Math.floor(5*e);for(this.max=i;this.order.length>this.max;)this.remove(this.order[0]);return this},Object.defineProperties(Md.prototype,zd);var Cd={color:0,intensity:1,height:2,classification:3};var Od=1;function Fd(t,e,i){var r=e;if(r){t.context.bindFramebuffer.set(i?i.framebuffer:null);var a=t.context,n=a.gl,o=t.useProgram("fxaaFlsify");a.setDepthMode(mh.disabled),a.activeTexture.set(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),n.uniform1i(o.uniforms.u_image,2);var s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];_s(s,0,t.width,t.height,0,0,1),n.uniformMatrix4fv(o.uniforms.u_matrix,!1,new Float32Array(s)),n.uniform2fv(o.uniforms.u_resolution,[t.width,t.height]),n.uniform2f(o.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(a,o,t.viewportBuffer,[]),n.drawArrays(n.TRIANGLE_STRIP,0,4);}}var Ld=["bloomBrightFilter","bloomBlur","bloomBlend","screen"];function Dd(t,e,i,r,a,n){var o=e;if(o){t.context.bindFramebuffer.set(i?i.framebuffer:null);var s=t.context,u=s.gl,l=t.useProgram(r);Ld[2]===r?(s.activeTexture.set(u.TEXTURE6),u.bindTexture(u.TEXTURE_2D,n.colorAttachment.get()),u.uniform1i(l.uniforms.u_base,6),s.activeTexture.set(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,o.colorAttachment.get()),u.uniform1i(l.uniforms.u_over,5)):(s.activeTexture.set(u.TEXTURE6),u.bindTexture(u.TEXTURE_2D,o.colorAttachment.get()),u.uniform1i(l.uniforms.u_image,6));var p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];_s(p,0,t.width,t.height,0,0,1),u.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(p)),u.uniform2fv(l.uniforms.u_dir,a),u.uniform1f(l.uniforms.u_extent,t._map._bloomOptions.extent),u.uniform2fv(l.uniforms.u_resolution,[1/t.width,1/t.height]),u.uniform2f(l.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(s,l,t.viewportBuffer,[]),u.drawArrays(u.TRIANGLE_STRIP,0,4);}}var Nd=function(t,e,i){this.context=t,this.width=e,this.height=i,this.framebufferPool={},this.createFramebuffers(),this.createFramebufferOfPool(),this.poolSize=6;};Nd.prototype.createFramebufferOfPool=function(){for(var t=0;t<this.poolSize;t++)this.framebufferPool["key"+t]={fobj:this.createAFrameBuffer(),inUse:!1};},Nd.prototype.createFramebuffers=function(){this.pickFramebuffer=this.createAFrameBuffer(),this.shadowFramebuffer=this.createAFrameBuffer(),this.fxaaFramebuffer=this.createAFrameBuffer(),this.fxaaExcFramebuffer=this.createAFrameBuffer(),this.bloomBaseColorFramebuffer=this.createAFrameBuffer(),this.bloomFramebuffer=this.createAFrameBuffer(),this.bloomExcFramebuffer=this.createAFrameBuffer(),this.globalAtmosphereFramebuffer=this.createAFrameBuffer(),this.globalExcAtmosphereFramebuffer=this.createAFrameBuffer();},Nd.prototype.createAFrameBuffer=function(t){void 0===t&&(t=1);var e=this.context.createFramebuffer(this.width*t,this.height*t,!1),i=new Pc(this.context,{width:this.width*t,height:this.height*t,data:null},this.context.gl.RGBA);i.bind(this.context.gl.LINEAR,this.context.gl.CLAMP_TO_EDGE),e.colorAttachment.set(i.texture);var r=this.context.createRenderbuffer(this.context.gl.DEPTH_COMPONENT16,this.width*t,this.height*t);return e.depthAttachment.set(r),e},Nd.prototype.destoryAFramebuffer=function(t){t&&(t.destroy(),t=null);},Nd.prototype.resize=function(t,e){for(var i in this.width=t,this.height=e,this.destoryAFramebuffer(this.pickFramebuffer),this.pickFramebuffer=null,this.destoryAFramebuffer(this.shadowFramebuffer),this.shadowFramebuffer=null,this.destoryAFramebuffer(this.fxaaFramebuffer),this.fxaaFramebuffer=null,this.destoryAFramebuffer(this.fxaaExcFramebuffer),this.fxaaExcFramebuffer=null,this.destoryAFramebuffer(this.bloomBaseColorFramebuffer),this.bloomBaseColorFramebuffer=null,this.destoryAFramebuffer(this.bloomFramebuffer),this.bloomFramebuffer=null,this.destoryAFramebuffer(this.bloomExcFramebuffer),this.bloomExcFramebuffer=null,this.destoryAFramebuffer(this.globalAtmosphereFramebuffer),this.globalAtmosphereFramebuffer=null,this.destoryAFramebuffer(this.globalExcAtmosphereFramebuffer),this.globalExcAtmosphereFramebuffer=null,this.framebufferPool){var r=this.framebufferPool[i].fobj;this.destoryAFramebuffer(r),this.framebufferPool[i].fobj=null,this.framebufferPool[i]=null;}this.createFramebufferOfPool(),this.createFramebuffers();},Nd.prototype.getAFramebufferFromPool=function(){var t=null;for(var e in this.framebufferPool)this.framebufferPool[e].inUse||(t=this.framebufferPool[e].fobj,this.framebufferPool[e].inUse=!0);return t||(t=this.createAFrameBuffer(),this.framebufferPool["key"+this.poolSize]={fobj:t,inUse:!0},this.poolSize+=1),t},Nd.prototype.releaseAFramebufferOfPool=function(t){for(var e in this.framebufferPool)this.framebufferPool[e].fobj===t&&(this.framebufferPool[e].inUse=!1);};var kd={symbol:function(t,e,i,r){var a=i.paint.get("render-3d");if("translucent"===t.renderPass||a){var n=t.context;n.setStencilMode(dh.disabled),n.setColorMode(t.colorModeForRenderPass()),a?"offscreen"===t.renderPass?(ym(t,i),0!==i.paint.get("icon-opacity").constantOr(1)&&bm(t,e,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright")),0!==i.paint.get("text-opacity").constantOr(1)&&bm(t,e,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&Yf(t,e,i,r)):"translucent"===t.renderPass&&gm(t,i):(0!==i.paint.get("icon-opacity").constantOr(1)&&bm(t,e,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright")),0!==i.paint.get("text-opacity").constantOr(1)&&bm(t,e,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&Yf(t,e,i,r));}},circle:function(t,e,i,r){if("translucent"===t.renderPass){var a=i.paint.get("circle-opacity"),n=i.paint.get("circle-stroke-width"),o=i.paint.get("circle-stroke-opacity");if(0!==a.constantOr(1)||0!==n.constantOr(1)&&0!==o.constantOr(1)){var s=t.context,u=s.gl;s.setDepthMode(t.depthModeForSublayer(0,mh.ReadOnly)),s.setStencilMode(dh.disabled),s.setColorMode(t.colorModeForRenderPass());for(var l=!0,p=0;p<r.length;p++){var c=r[p],h=e.getTile(c),f=h.getBucket(i);if(f){var m=t.context.program.get(),d=f.programConfigurations.get(i.id),_=t.useProgram("circle",d);if((l||_.program!==m)&&(d.setUniforms(s,_,i.paint,{zoom:t.transform.zoom}),l=!1),u.uniform1f(_.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance),u.uniform1i(_.uniforms.u_scale_with_map,"map"===i.paint.get("circle-pitch-scale")?1:0),"map"===i.paint.get("circle-pitch-alignment")){u.uniform1i(_.uniforms.u_pitch_with_map,1);var y=Cf(h,1,t.transform.zoom);u.uniform2f(_.uniforms.u_extrude_scale,y,y);}else u.uniform1i(_.uniforms.u_pitch_with_map,0),u.uniform2fv(_.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits);u.uniformMatrix4fv(_.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(c.posMatrix,h,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")))),_.draw(s,u.TRIANGLES,i.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,d);}}}}},heatmap:function(t,e,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var a=t.context,n=a.gl;a.setDepthMode(t.depthModeForSublayer(0,mh.ReadOnly)),a.setStencilMode(dh.disabled),function(t,e,i){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var a=i.heatmapFbo;if(a)r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer);else{var n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,i,r,a){var n=e.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,i.width/4,i.height/4,0,n.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:n.UNSIGNED_BYTE,null),a.colorAttachment.set(r),e.extTextureHalfFloat&&n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,a.colorAttachment.setDirty(),t(e,i,r,a));}(t,e,n,a);}}(a,t,i),a.clear({color:We.transparent}),a.setColorMode(new _h([n.ONE,n.ONE],We.transparent,[!0,!0,!0,!0]));for(var o=!0,s=0;s<r.length;s++){var u=r[s];if(!e.hasRenderableParent(u)){var l=e.getTile(u),p=l.getBucket(i);if(p){var c=t.context.program.get(),h=p.programConfigurations.get(i.id),f=t.useProgram("heatmap",h),m=t.transform.zoom;(o||f.program!==c)&&(h.setUniforms(t.context,f,i.paint,{zoom:m}),o=!1),n.uniform1f(f.uniforms.u_extrude_scale,Cf(l,1,m)),n.uniform1f(f.uniforms.u_intensity,i.paint.get("heatmap-intensity")),n.uniformMatrix4fv(f.uniforms.u_matrix,!1,u.posMatrix),f.draw(a,n.TRIANGLES,i.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,h);}}}a.viewport.set([0,0,t.width,t.height]);}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,e){var i=t.context,r=i.gl,a=e.heatmapFbo;if(a){i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);var n=e.colorRampTexture;n||(n=e.colorRampTexture=new Pc(i,e.colorRamp,r.RGBA)),n.bind(r.LINEAR,r.CLAMP_TO_EDGE),i.setDepthMode(mh.disabled),i.setStencilMode(dh.disabled);var o=t.useProgram("heatmapTexture"),s=e.paint.get("heatmap-opacity");r.uniform1f(o.uniforms.u_opacity,s),r.uniform1i(o.uniforms.u_image,0),r.uniform1i(o.uniforms.u_color_ramp,1);var u=us();_s(u,0,t.width,t.height,0,0,1),r.uniformMatrix4fv(o.uniforms.u_matrix,!1,u),r.uniform2f(o.uniforms.u_world,r.drawingBufferWidth,r.drawingBufferHeight),t.viewportVAO.bind(t.context,o,t.viewportBuffer,[]),r.drawArrays(r.TRIANGLE_STRIP,0,4);}}(t,i));},line:function(t,e,i,r){var a=i.paint.get("render-3d");if("translucent"===t.renderPass||a){var n=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0!==n.constantOr(1)&&0!==o.constantOr(1)){var s=t.context;if(s.setDepthMode(t.depthModeForSublayer(0,mh.ReadOnly)),s.setColorMode(t.colorModeForRenderPass()),a)if("offscreen"===t.renderPass){var u=i.paint.get("line-dasharray")?"lineSDF3d":i.paint.get("line-pattern")?"linePattern3d":"line3d";ym(t,i),Sm(t,e,i,r,u,!1);}else"translucent"===t.renderPass&&gm(t,i);else{var l=i.paint.get("line-dasharray")?"lineSDF":i.paint.get("line-pattern")?"linePattern":i.paint.get("line-gradient")?"lineGradient":"line";t.context.extFragDepth||"visible"!==i.layout.get("border-visibility")||Sm(t,e,i,r,l,!0),Sm(t,e,i,r,l,!1);}}}},fill:function(t,e,i,r){var a=i.paint.get("fill-color"),n=i.paint.get("fill-opacity");if(0!==n.constantOr(1)){var o=t.context;if(o.setColorMode(t.colorModeForRenderPass()),i.paint.get("render-3d"))"offscreen"===t.renderPass?(ym(t,i),Mm(t,e,i,r,zm)):"translucent"===t.renderPass&&gm(t,i);else{var s=i.paint.get("fill-pattern")||1!==a.constantOr(We.transparent).a||1!==n.constantOr(0)?"translucent":"opaque";t.renderPass===s&&(o.setDepthMode(t.depthModeForSublayer(1,"opaque"===t.renderPass?mh.ReadWrite:mh.ReadOnly)),Mm(t,e,i,r,zm)),"translucent"===t.renderPass&&i.paint.get("fill-antialias")&&(o.setDepthMode(t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,mh.ReadOnly)),Mm(t,e,i,r,Cm));}}},extrusion:function(t,e,i,r){if(0!==i.paint.get("extrusion-opacity"))if("offscreen"===t.renderPass){Fm(t,i);for(var a=!0,n=0,o=r;n<o.length;n+=1){var s=o[n],u=e.getTile(s),l=u.getBucket(i);l&&(Dm(t,0,i,u,s,l,a),a=!1);}}else"translucent"===t.renderPass&&Lm(t,i,i.paint.get("fill-extrusion-opacity"));},raster:function(t,e,i,r){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")){var a,n,o=t.context,s=o.gl,u=e.getSource(),l=t.useProgram("raster");o.setStencilMode(dh.disabled),o.setColorMode(t.colorModeForRenderPass()),s.uniform1f(l.uniforms.u_brightness_low,i.paint.get("raster-brightness-min")),s.uniform1f(l.uniforms.u_brightness_high,i.paint.get("raster-brightness-max")),s.uniform1f(l.uniforms.u_saturation_factor,(a=i.paint.get("raster-saturation"))>0?1-1/(1.001-a):-a),s.uniform1f(l.uniforms.u_contrast_factor,(n=i.paint.get("raster-contrast"))>0?1/(1-n):1+n),s.uniform3fv(l.uniforms.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}(i.paint.get("raster-hue-rotate"))),s.uniform1f(l.uniforms.u_buffer_scale,1),s.uniform1i(l.uniforms.u_image0,0),s.uniform1i(l.uniforms.u_image1,1);for(var p=r.length&&r[0].overscaledZ,c=0,h=r;c<h.length;c+=1){var f=h[c];o.setDepthMode(t.depthModeForSublayer(f.overscaledZ-p,1===i.paint.get("raster-opacity")?mh.ReadWrite:mh.ReadOnly,s.LESS));var m=e.getTile(f),d=t.transform.calculatePosMatrix(f.toUnwrapped(),!0);m.registerFadeDuration(i.paint.get("raster-fade-duration")),s.uniformMatrix4fv(l.uniforms.u_matrix,!1,d);var _=e.findLoadedParent(f,0,{}),y=Nm(m,_,e,i,t.transform),g=void 0,v=void 0,x="nearest"===i.paint.get("raster-resampling")?s.NEAREST:s.LINEAR;if(o.activeTexture.set(s.TEXTURE0),m.texture.bind(x,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.activeTexture.set(s.TEXTURE1),_?(_.texture.bind(x,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),g=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),v=[m.tileID.canonical.x*g%1,m.tileID.canonical.y*g%1]):m.texture.bind(x,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),s.uniform2fv(l.uniforms.u_tl_parent,v||[0,0]),s.uniform1f(l.uniforms.u_scale_parent,g||1),s.uniform1f(l.uniforms.u_fade_t,y.mix),s.uniform1f(l.uniforms.u_opacity,y.opacity*i.paint.get("raster-opacity")),u instanceof vf)l.draw(o,s.TRIANGLES,i.id,u.boundsBuffer,u.indexBuffer,u.segments);else if(m.maskedBoundsBuffer&&m.maskedIndexBuffer&&m.segments)l.draw(o,s.TRIANGLES,i.id,m.maskedBoundsBuffer,m.maskedIndexBuffer,m.segments);else{var b=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(o,l,b,[]),s.drawArrays(s.TRIANGLE_STRIP,0,b.length);}}}},background:function(t,e,i){var r=i.paint.get("background-color"),a=i.paint.get("background-opacity");if(0!==a){var n=t.context,o=n.gl,s=t.transform,u=s.tileSize,l=i.paint.get("background-pattern"),p=l||1!==r.a||1!==a?"translucent":"opaque";if(t.renderPass===p){var c;if(n.setStencilMode(dh.disabled),n.setDepthMode(t.depthModeForSublayer(0,"opaque"===p?mh.ReadWrite:mh.ReadOnly)),n.setColorMode(t.colorModeForRenderPass()),l){if(Pm(l,t))return;c=t.useProgram("backgroundPattern"),Im(l,t,c),t.tileExtentPatternVAO.bind(n,c,t.tileExtentBuffer,[]);}else c=t.useProgram("background"),o.uniform4fv(c.uniforms.u_color,[r.r,r.g,r.b,r.a]),t.tileExtentVAO.bind(n,c,t.tileExtentBuffer,[]);o.uniform1f(c.uniforms.u_opacity,a);for(var h=0,f=s.coveringTiles({tileSize:u});h<f.length;h+=1){var m=f[h];l&&Rm({tileID:m,tileSize:u},t,c),o.uniformMatrix4fv(c.uniforms.u_matrix,!1,t.transform.calculatePosMatrix(m.toUnwrapped())),o.drawArrays(o.TRIANGLE_STRIP,0,t.tileExtentBuffer.length);}}}},debug:function(t,e,i){for(var r=0;r<i.length;r++)km(t,e,i[r]);},tracking:function(t,e,i,r){if("translucent"===t.renderPass){var a=i.paint.get("tracking-opacity"),n=i.paint.get("tracking-width");if(0!==a.constantOr(1)&&0!==n.constantOr(1)){var o=t.context;o.setDepthMode(t.depthModeForSublayer(0,mh.ReadOnly)),o.setColorMode(t.colorModeForRenderPass());var s=i.paint.get("tracking-seg-group"),u=i.paint.get("tracking-delay");if("history"===i.paint.get("tracking-type"))i.histEnd=Date.now(),i.first||(i.first=!0,i.histStart=0,i.histCount=0,i.isReverse=!1,i.isReserve=!1),i.histEnd-i.histStart>=1e3/i.paint.get("tracking-speed")&&("loop"===i.layout.get("tracking-display-mode")?(i.histCount++,i.histCount%=i.paint.get("tracking-seg-count"),i.histCount=0===i.histCount?1:i.histCount):"reverse"===i.layout.get("tracking-display-mode")?(i.histCount>=i.paint.get("tracking-seg-count")+i.paint.get("tracking-seg-group")?i.isReverse=!0:i.histCount<=1&&(i.isReverse=!1),i.histCount=i.isReverse?i.histCount-1:i.histCount+1):"loop-reserve"===i.layout.get("tracking-display-mode")?(i.isReserve=!0,i.histCount++,i.histCount%=i.paint.get("tracking-seg-count"),i.histCount=0===i.histCount?1:i.histCount):"reverse-reserve"===i.layout.get("tracking-display-mode")&&(i.isReserve=!0,i.histCount>=i.paint.get("tracking-seg-count")+i.paint.get("tracking-seg-group")?i.isReverse=!0:i.histCount<=1&&(i.isReverse=!1),i.histCount=i.isReverse?i.histCount-1:i.histCount+1),O.TRW&&O.TRW.setProgress(i.histCount),i.histStart=i.histEnd);else if(i.count||(i.start=Date.now(),i.count=1),i.end=Date.now(),i.end-i.start>=1e3/i.paint.get("tracking-speed")){var l=O.TRW;i.count+=1;var p=l&&l.hasOwnProperty("replaceOffset")?l.replaceOffset:120+u;i.count%=p;var c=l&&l.hasOwnProperty("requestOffset")?l.requestOffset:90+u;i.count===c&&l&&l.request(),0===i.count&&(l&&l.replace(),i.count=u),l&&(l.currentSeq=i.count),i.start=i.end;}!function(t,e){if(e&&e.TRW&&"null"!==e.TRW){e.TRW.layerForwards||(e.TRW.layerForwards=[]);for(var i=0;i<e.TRW.layerForwards.length;i++){var r=e.TRW.layerForwards[i];if(r.id===t.id){t.count&&(t.count+=r.count),e.TRW.layerForwards.splice(i,1);break}}}}(i,O);for(var h,f=!0,m=0,d=r;m<d.length;m+=1){var _=d[m],y=e.getTile(_),g=y.getBucket(i);if(g){var v=g.programConfigurations.get(i.id),x=t.context.program.get(),b=t.useProgram("tracking",v),w=f||b.program!==x,A=h!==y.tileID.overscaledZ;w&&v.setUniforms(t.context,b,i.paint,{zoom:t.transform.zoom}),Vm(b,t,y,g,i,_,v,w,A,"history"===i.paint.get("tracking-type")?i.histCount:i.count,i.isReverse,i.isReserve,s),h=y.tileID.overscaledZ,f=!1;}}}}},sprite:function(t,e,i,r){if("translucent"===t.renderPass){var a=i.paint.get("sprite-opacity"),n=i.paint.get("sprite-width");if(0!==a.constantOr(1)&&0!==n.constantOr(1)){var o=t.context;o.setDepthMode(t.depthModeForSublayer(0,mh.ReadOnly)),o.setColorMode(t.colorModeForRenderPass());var s,u=!0;i.speeds||(i.speeds={});var l=i.paint.get("sprite-speed-factor");i.speeds.hasOwnProperty("speed"+l)||(i.speeds["speed"+l]=0),i.speeds["speed"+l]+=1,i.speeds["speed"+l]%=1===l?20:2===l?80:3===l?150:240;for(var p=0,c=r;p<c.length;p+=1){var h=c[p],f=e.getTile(h),m=f.getBucket(i);if(m){var d=m.programConfigurations.get(i.id),_=t.context.program.get(),y=t.useProgram("sprite",d),g=u||y.program!==_,v=s!==f.tileID.overscaledZ;g&&d.setUniforms(t.context,y,i.paint,{zoom:t.transform.zoom}),jm(y,t,f,m,i,h,d,g,v),s=f.tileID.overscaledZ,u=!1;}}}}},symtracking:function(t,e,i,r){if("translucent"===t.renderPass){this.start||(this.start=Date.now(),this.count=0),this.end=Date.now();var a=i.layout.get("symtracking-fps"),n=i.layout.get("symtracking-time-segment");Ym=i.paint.get("symtracking-delay");var o=O.TRW;if(o&&o.hasOwnProperty("resetToStartPos")&&o.resetToStartPos&&(this.count=0,o.resetToStartPos=!1),this.end-this.start>=1e3/a){this.count+=1;var s=O.TRW&&O.TRW.hasOwnProperty("replaceOffset")?O.TRW.replaceOffset:a*(n+Ym);this.count%=s;var u=O.TRW&&O.TRW.hasOwnProperty("requestOffset")?O.TRW.requestOffset:n*a;this.count===u&&O.TRW&&O.TRW.hasOwnProperty("request")&&O.TRW.request(),0===this.count&&(O.TRW&&O.TRW.hasOwnProperty("replace")&&O.TRW.replace(),this.count=Ym),O.TRW&&(O.TRW.currentSeq=this.count),Wm=this.count,O.TRW&&O.TRW.hasOwnProperty("setProgress")&&O.TRW.setProgress(Wm),this.start=this.end;}var l=t.context;l.setStencilMode(dh.disabled),l.setColorMode(t.colorModeForRenderPass()),0!==i.paint.get("icon-opacity").constantOr(1)&&Hm(t,e,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),Wm),0!==i.paint.get("text-opacity").constantOr(1)&&Hm(t,e,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),Wm),e.map.showCollisionBoxes&&Yf(t,e,i,r);}},histogram:function(t,e,i,r){if(0!==i.paint.get("histogram-opacity")){if(i.hasOwnProperty("_hasRendered")||(i._hasRendered=!0),i.paint.get("histogram-dynamic"))if(i.hasOwnProperty("_transform")&&i.hasOwnProperty("_count")||(i._transform=Date.now(),i._count=0),O.TRW&&!O.TRW.stayStatic){var a=Date.now()-i._transform;i._count+=a/i.paint.get("histogram-time")*500,i._count>=500*i.paint.get("histogram-count")&&(i._count=0),i._transform=Date.now();}else i._transform=Date.now();if("offscreen"===t.renderPass){ym(t,i);for(var n=!0,o=0,s=r;o<s.length;o+=1){var u=s[o],l=e.getTile(u),p=l.getBucket(i);p&&(Km(t,0,i,l,u,p,n),n=!1);}}else"translucent"===t.renderPass&&gm(t,i);}},custom:function(t,e,i){var r=t.context,a=i.implementation;if("offscreen"===t.renderPass){var n=a.prerender;n&&(t.setCustomLayerDefaults(),n.call(a,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState()),"3d"===a.renderingMode&&(t.setCustomLayerDefaults(),Fm(t,i),a.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState());}else"translucent"===t.renderPass&&("3d"===a.renderingMode?Lm(t,i):(t.setCustomLayerDefaults(),r.setStencilMode(dh.disabled),r.setDepthMode(mh.disabled),a.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)));},panorama:vd},Bd={sphere:function(t,e){var i=t.cameraDrawMode;if(!t.depthPick&&i!==le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED&&i!==le.CAMERA.DRAW_MODE.OFFSCREEN){var r=t.context,a=r.gl,n=e.getSource();if(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(0,4),n instanceof wf&&n.texture){e.id!==le.SOURCE.SKYBOX_SOURCE_ID&&t._map.clipGroundState&&r.setStencilMode(dh.openClipGround);var o,s=t.transform;if(e.id===le.SOURCE.GLOBAL_SOURCE_ID){if(n.renderAtmosphere&&s.zoom<8){o=t.useProgram(yd[1]),r.bindFramebuffer.set(t.fbManager.globalExcAtmosphereFramebuffer.framebuffer),r.clear({color:new We(1,1,1,0),depth:1}),r.bindFramebuffer.set(t.fbManager.globalAtmosphereFramebuffer.framebuffer),r.clear({color:new We(1,1,1,0),depth:1}),r.setColorMode(_h.unblended),r.setDepthMode(mh.disabled),r.setCullFace(yh.disabled),a.uniform2fv(o.uniforms.u_resolution,[t.width,t.height]),a.uniformMatrix4fv(o.uniforms.u_matrix,!1,new Float32Array(s.calculateVPMatrix({id:le.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID,pitch:s.pitch,bearing:s.bearing,altitude:0})));var u=t.sphereBuffer;t.sphereVAO.bind(r,o,u,[]),a.drawArrays(n._options.debug?a.LINE_STRIP:a.TRIANGLE_STRIP,0,u.length),o=t.useProgram(yd[2]);for(var l=0;l<1;l++)gd(t,t.fbManager.globalAtmosphereFramebuffer,t.fbManager.globalExcAtmosphereFramebuffer.framebuffer,[0,1],o,r,a,2),gd(t,t.fbManager.globalExcAtmosphereFramebuffer,t.fbManager.globalAtmosphereFramebuffer.framebuffer,[1,0],o,r,a,2);r.setColorMode(new _h([a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0])),o=t.useProgram(yd[3]),gd(t,t.fbManager.globalAtmosphereFramebuffer,t.getDefaultFrameBuffer(),[1,0],o,r,a);}r.setCullFace(yh.backCCW),o=t.useProgram(yd[0]),a.uniformMatrix4fv(o.uniforms.u_matrix,!1,new Float32Array(s.calculateVPMatrix())),t.style._sunLightFlag?(a.uniform1i(o.uniforms.u_with_light,!0),a.uniform3fv(o.uniforms.u_light,t._map.sunLight.getSunLightPos()),a.uniform3fv(o.uniforms.u_lightcolor,[1,1,1]),a.uniform3fv(o.uniforms.u_cam,s.getCameraPos())):a.uniform1i(o.uniforms.u_with_light,!1);}else if(e.id===le.SOURCE.SKYBOX_SOURCE_ID){o=t.useProgram(yd[0]);var p={id:le.CAMERA.SKYBOX_CAMERA_ID,pitch:s.pitch,bearing:-s.bearing,altitude:0};a.uniformMatrix4fv(o.uniforms.u_matrix,!1,new Float32Array(pt([],s.calculateVPMatrix(_d.createACameraView(p)),[le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE]))),a.uniform1i(o.uniforms.u_with_light,!1);}t.transform.zoom,r.setColorMode(_h.unblended),a.uniform1i(o.uniforms.u_fog_render,!1),e.id!==le.SOURCE.SKYBOX_SOURCE_ID?r.setDepthMode(new mh(r.gl.LEQUAL,mh.ReadWrite,[.1,1])):r.setDepthMode(mh.disabled),n.nightTexture?(r.activeTexture.set(a.TEXTURE13),a.uniform1i(o.uniforms.u_image2,13),n.nightTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.uniform1i(o.uniforms.u_with_nighttexture,!0)):a.uniform1i(o.uniforms.u_with_nighttexture,!1),r.activeTexture.set(a.TEXTURE12),a.uniform1i(o.uniforms.u_image0,12),n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),n.dayTexture?(r.activeTexture.set(a.TEXTURE1),a.uniform1i(o.uniforms.u_image1,1),n.dayTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.uniform1i(o.uniforms.u_with_daytexture,!0),a.uniform1f(o.uniforms.u_daytex_percent,_((s.zoom-3)/10,0,1))):a.uniform1i(o.uniforms.u_with_daytexture,!1);var c=t.sphereBuffer;t.sphereVAO.bind(r,o,c,[]),a.drawArrays(n._options.debug?a.LINE_STRIP:a.TRIANGLE_STRIP,0,c.length),e.id!==le.SOURCE.SKYBOX_SOURCE_ID&&r.setStencilMode(dh.disabled);}r.setDepthMode(new mh(r.gl.LEQUAL,mh.ReadWrite,[0,1])),r.setStencilMode(dh.disabled),r.setCullFace(yh.disabled),a.disable(a.POLYGON_OFFSET_FILL);}},"sphere-raster":function(t,e,i,r){if("translucent"===t.renderPass&&i.paint&&0!==i.paint.get("sphere-raster-opacity")){var a,n,o=t.context,s=o.gl,u=e.getSource(),l=t.useProgram("sphereRaster");t._map.clipGroundState&&o.setStencilMode(dh.openClipGround),o.setColorMode(new _h([s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0])),!e._source.renderWithTerrain||t.transform.zoom<le.TRANSFORM.TERRAIN_FIND_ZOOM_MIN?(t.context.setDepthMode(mh.disabled),t.context.setCullFace(new yh(!0,s.BACK,s.CCW))):t.context.setDepthMode(new mh(s.LESS,mh.ReadWrite,[0,1])),s.uniform1f(l.uniforms.u_brightness_low,i.paint.get("sphere-raster-brightness-min")),s.uniform1f(l.uniforms.u_brightness_high,i.paint.get("sphere-raster-brightness-max")),s.uniform1f(l.uniforms.u_saturation_factor,(a=i.paint.get("sphere-raster-saturation"))>0?1-1/(1.001-a):-a),s.uniform1f(l.uniforms.u_contrast_factor,(n=i.paint.get("sphere-raster-contrast"))>0?1/(1-n):1+n),s.uniform3fv(l.uniforms.u_spin_weights,function(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}(i.paint.get("sphere-raster-hue-rotate"))),s.uniform1f(l.uniforms.u_buffer_scale,1),s.uniform1i(l.uniforms.u_image0,0),s.uniform1i(l.uniforms.u_image1,1),s.uniform1i(l.uniforms.u_isPole,!1),t.style._sunLightFlag?(s.uniform1i(l.uniforms.u_with_light,!0),s.uniform3fv(l.uniforms.u_light,t._map.sunLight.getSunLightPos()),s.uniform3fv(l.uniforms.u_lightcolor,[1,1,1]),s.uniform3fv(l.uniforms.u_cam,t.transform.getCameraPos())):s.uniform1i(l.uniforms.u_with_light,!1),s.uniform1i(l.uniforms.u_fog_render,!1),e._source.renderWithTerrain&&e.clearSTTCInUseStatus();for(var p=r.length>0?r[r.length-1].overscaledZ:1,c={},h=0,f=r;h<f.length;h+=1){var m=f[h];if(!c[m.key]){c[m.key]=!0;var d=e.getTile(m);t.context.setDepthMode(new mh(s.LEQUAL,mh.ReadWrite,[0,1])),d.terrainData&&(s.uniform1i(l.uniforms.u_edgediscard,!0),s.uniform1f(l.uniforms.u_tile_zoom,d.tileID.overscaledZ)),d.registerFadeDuration(i.paint.get("sphere-raster-fade-duration"));var _=e.findLoadedParent(m,0,{}),y=void 0,g=void 0,v="nearest"===i.paint.get("sphere-raster-resampling")?s.NEAREST:s.LINEAR;if(o.activeTexture.set(s.TEXTURE0),d.texture.bind(v,s.CLAMP_TO_EDGE,s.LINEAR),o.activeTexture.set(s.TEXTURE1),_?(_.texture.bind(v,s.CLAMP_TO_EDGE,s.LINEAR),y=Math.pow(2,_.tileID.overscaledZ-d.tileID.overscaledZ),g=[d.tileID.canonical.x*y%1,d.tileID.canonical.y*y%1]):d.texture.bind(v,s.CLAMP_TO_EDGE,s.LINEAR),s.uniform2fv(l.uniforms.u_tl_parent,g||[0,0]),s.uniform1f(l.uniforms.u_scale_parent,y||1),s.uniform1f(l.uniforms.u_opacity,i.paint.get("sphere-raster-opacity")),s.uniform1i(l.uniforms.u_terrain,!!d.terrainData),u instanceof vf)s.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(vt([],t.transform.calculateVPMatrix(),u.matrix))),s.uniformMatrix4fv(l.uniforms.u_model_matrix,!1,new Float32Array(u.matrix)),s.uniform1i(l.uniforms.u_is_image,1),l.draw(o,s.TRIANGLES,i.id,u.sphereBoundsBuffer,u.sphereIndexBuffer,u.sphereSegments);else if(d.terrainData)s.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(vt([],t.transform.calculateVPMatrix(),d.terrainData.matrix))),s.uniformMatrix4fv(l.uniforms.u_model_matrix,!1,new Float32Array(d.terrainData.matrix)),p-m.overscaledZ<=1?o.setDepthMode(new mh(s.LEQUAL,mh.ALWAYS,[0,1])):o.setDepthMode(new mh(s.LEQUAL,mh.ReadWrite,[0,1])),l.draw(o,s.TRIANGLES,i.id,d.terrainData.sphereMaskedBoundsBuffer,d.terrainData.sphereMaskedIndexBuffer,d.terrainData.sphereSegments);else{var x=t.sphereTileVerticeCache.get(d.tileID,o);s.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(vt([],t.transform.calculateVPMatrix(),x.matrix))),s.uniformMatrix4fv(l.uniforms.u_model_matrix,!1,new Float32Array(x.matrix)),i.depthTest?p-m.overscaledZ>0?o.setDepthMode(mh.disabled):o.setDepthMode(new mh(s.LEQUAL,mh.ReadWrite,[0,1])):o.setDepthMode(mh.disabled),l.draw(o,s.TRIANGLES,i.id,x.sphereMaskedBoundsBuffer,x.sphereMaskedIndexBuffer,x.sphereSegments);}}}t.transform.projection===Xa.MERCATOR&&t.transform.td_lastRect.isPole&&function(t,e,i,r){var a=t.context,n=a.gl,o=e.getSource(),s=t.useProgram("sphereRaster");if(!(o instanceof vf)&&r.length>0){a.setStencilMode(dh.openClipGround),t.context.setCullFace(new yh(!0,n.BACK,n.CCW)),t.context.setDepthMode(new mh(n.LESS,mh.ReadWrite,[0,1])),n.uniform1f(s.uniforms.u_buffer_scale,1),n.uniform1i(s.uniforms.u_image0,0);for(var u=r.length>0?r[r.length-1].overscaledZ:1,l=!1,p=0,c=r;p<c.length;p+=1){var h=c[p];if(0===h.canonical.y)l=!0;else{if(h.canonical.y!==Math.pow(2,h.overscaledZ)-1)continue;l=!1;}var f=e.getTile(h);if(f.terrainData)return;n.uniform1f(s.uniforms.u_edgediscard,0),t.context.setDepthMode(new mh(n.LESS,mh.ReadWrite,[0,1]));var m=t.transform;n.uniformMatrix4fv(s.uniforms.u_matrix,!1,new Float32Array(m.calculateVPMatrix())),f.registerFadeDuration(i.paint.get("sphere-raster-fade-duration"));var d="nearest"===i.paint.get("sphere-raster-resampling")?n.NEAREST:n.LINEAR;a.activeTexture.set(n.TEXTURE0),f.texture.bind(d,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST),n.uniform2fv(s.uniforms.u_tl_parent,[0,0]),n.uniform1f(s.uniforms.u_scale_parent,1),n.uniform1i(s.uniforms.u_terrain,!1),n.uniform1i(s.uniforms.u_isNorth,l);var _=t.sphereTileVerticeCache.getPole(a,l,h);n.uniform1i(s.uniforms.u_isPole,!0),n.uniformMatrix4fv(s.uniforms.u_matrix,!1,new Float32Array(vt([],t.transform.calculateVPMatrix(),_.matrix))),i.depthTest?u-h.overscaledZ>0?a.setDepthMode(mh.disabled):a.setDepthMode(new mh(n.LEQUAL,mh.ReadWrite,[0,1])):a.setDepthMode(mh.disabled),s.draw(a,n.TRIANGLES,i.id,_.sphereMaskedBoundsBuffer,_.sphereMaskedIndexBuffer,_.sphereSegments);}a.setCullFace(yh.disabled),a.setStencilMode(dh.disabled);}}(t,e,i,r),o.setCullFace(yh.disabled),o.setStencilMode(dh.disabled),o.setDepthMode(mh.disabled);}},"sphere-fill":function(t,e,i,r){if(0!==i.paint.get("fill-opacity").constantOr(1)){var a=t.context;a.setColorMode(_h.alphaBlended),a.setDepthMode(mh.disabled);var n=a.gl;t._map.clipGroundState&&a.setStencilMode(dh.openClipGround),a.setCullFace(new yh(!0,n.BACK,n.CW)),function(t,e,i,r,a){if(!Pm(i.paint.get("fill-pattern"),t))for(var n=!0,o=0,s=r;o<s.length;o+=1){var u=s[o],l=e.getTile(u),p=l.getBucket(i);p&&(a(t,e,i,l,u,p,n),n=!1);}}(t,e,i,r,$m),a.setCullFace(yh.disabled),a.setStencilMode(dh.disabled);}},"3d-tile":function(t,e,i,r){var a,n=t.cameraDrawMode;a=n===le.CAMERA.DRAW_MODE.OFFSCREEN?t.useProgram(Id[1]):n===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||n===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||n===le.CAMERA.DRAW_MODE.ONSCREEN_ALL?t.useProgram(Id[2]):t.useProgram(Id[0]);var o=e.getSource();t.context.setColorMode(_h.unblended),t.context.setStencilMode(dh.disabled),o instanceof Ah&&o.gltfModelVAO&&e.idealTileIDs&&function(t,e,i,r,a){var n=t.transform,o=t.context,s=o.gl,u=e.getSource(),l=u.tileJson.type===le.MODEL_TYPE.OSGB,p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];p=Zn(u.flipYZ||l,u,p);var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(u.videoMatchEnabled&&u.videoBounds){s.uniform1i(a.uniforms["u_vs.use"],1),s.uniform3fv(a.uniforms["u_vs.planeP1P2"],u.videoBounds.planeP1P2),s.uniform3fv(a.uniforms["u_vs.planeP2P3"],u.videoBounds.planeP2P3),s.uniform3fv(a.uniforms["u_vs.planeP3P4"],u.videoBounds.planeP3P4),s.uniform3fv(a.uniforms["u_vs.planeP4P1"],u.videoBounds.planeP4P1),s.uniform3fv(a.uniforms["u_vs.p1"],u.videoBounds.p1),s.uniform3fv(a.uniforms["u_vs.p2"],u.videoBounds.p2),s.uniform3fv(a.uniforms["u_vs.p3"],u.videoBounds.p3),s.uniform3fv(a.uniforms["u_vs.p4"],u.videoBounds.p4),s.uniform2fv(a.uniforms["u_vs.d1Sqrt"],u.videoBounds.d1Sqrt),s.uniform2fv(a.uniforms["u_vs.d2Sqrt"],u.videoBounds.d2Sqrt),s.uniform2fv(a.uniforms["u_vs.d3Sqrt"],u.videoBounds.d3Sqrt),s.uniform2fv(a.uniforms["u_vs.d4Sqrt"],u.videoBounds.d4Sqrt),s.uniform4fv(a.uniforms["u_vs.offset"],u.videoMatchOption.offset||[0,0,0,0]),o.activeTexture.set(s.TEXTURE11),s.uniform1i(a.uniforms.u_video_sampler,11);var h=u.videoTexture;h&&h.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR);}else s.uniform1i(a.uniforms["u_vs.use"],0);if(s.uniform1i(a.uniforms.u_bgr2rgb,!!i.cvtBGR2RGB),lt(c,c,l?[u.translation[0],u.translation[1],-u.translation[2]]||[0,0,0]:u.translation||[0,0,0]),u._clampEnabled?(s.uniform1f(a.uniforms.u_clamp_ratio,1),s.uniform3fv(a.uniforms.u_min_clamp_bounds,u.minClampBounds||[0,0,0]),s.uniform3fv(a.uniforms.u_max_clamp_bounds,u.maxClampBounds||[0,0,0]),s.uniform4fv(a.uniforms.u_clamp_plane,u.clampPlane),s.uniform2fv(a.uniforms.u_x_clamp_range,u.ratioRange[0]),s.uniform2fv(a.uniforms.u_y_clamp_range,u.ratioRange[1]),s.uniform2fv(a.uniforms.u_z_clamp_range,u.ratioRange[2]),s.uniform3fv(a.uniforms.u_clamp_box,[u.clampBox.x,u.clampBox.y,u.clampBox.z]),s.uniform1f(a.uniforms.u_clamp_box_inner,u.clampBox.inner),s.uniformMatrix4fv(a.uniforms.u_clamp_matrix,!1,new Float32Array(u.clampBoxMatrix))):s.uniform1f(a.uniforms.u_clamp_ratio,0),t.style._sunLightFlag&&!l){var f=ot([],st([],p));s.uniformMatrix4fv(a.uniforms.u_normal,!1,new Float32Array(f)),s.uniform1i(a.uniforms.u_with_light,!0),s.uniform3fv(a.uniforms.u_light,t._map.sunLight.getSunLightPos()),s.uniform3fv(a.uniforms.u_lightcolor,[1,1,1]);}else s.uniform1i(a.uniforms.u_with_light,!1);var m=t.activeCameras,d=t.cameraDrawMode;if(s.uniform1f(a.uniforms.u_viewshed_count,0),d===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||d===le.CAMERA.DRAW_MODE.ONSCREEN_ALL){var _=t.fbManager.shadowFramebuffer;_&&(o.activeTexture.set(s.TEXTURE10),s.bindTexture(s.TEXTURE_2D,_.colorAttachment.get()),s.uniform1i(a.uniforms.u_shadow_sampler,10)),s.uniform1f(a.uniforms.u_shadow_off,t.shadowOff);}if(i.viewshedRender&&(d===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||d===le.CAMERA.DRAW_MODE.ONSCREEN_ALL)){for(var y=0;y<m.viewshed.length;y++){var g=m.viewshed[y].fb;g&&(o.activeTexture.set(s["TEXTURE"+(1+y)]),s.bindTexture(s.TEXTURE_2D,g.colorAttachment.get()),s.uniform1i(a.uniforms["u_viewshed_samp"+y],1+y));}s.uniform1f(a.uniforms.u_shadow_off,t.shadowOff),s.uniform1f(a.uniforms.u_viewshed_count,m.viewshed.length);}for(var v=0,x=e.idealTileIDs;v<x.length;v+=1){var b=x[v],w=e.getTile(b);w&&w.meshes.length>0&&(l?"loaded"===w.state&&Rd(t,u,w,a,n,o,s,e.sharedTexture,l,i,p,c,d,m):Rd(t,u,w,a,n,o,s,e.sharedTexture,l,i,p,c,d,m));}}(t,e,i,0,a),t.context.gl.uniform1i(a.uniforms.u_bgr2rgb,!1);},"sphere-line":function(t,e,i,r){var a=i.paint.get("line-opacity"),n=i.paint.get("line-width");if(0!==a.constantOr(1)&&0!==n.constantOr(1)){var o=t.context;o.setColorMode(_h.alphaBlended),o.setDepthMode(new mh(o.gl.LEQUAL,mh.ReadOnly,[0,1]));var s=o.gl;t._map.clipGroundState&&o.setStencilMode(dh.openClipGround),s.enable(s.POLYGON_OFFSET_FILL);var u=i.paint.get("line-dasharray")?"sphereLineSDF":i.paint.get("line-pattern")?"sphereLinePattern":i.paint.get("line-gradient")?"sphereLineGradient":"sphereLine";t.context.extFragDepth||"visible"!==i.layout.get("border-visibility")||td(t,e,i,r,u,!0),td(t,e,i,r,u,!1),o.setStencilMode(dh.disabled),s.disable(s.POLYGON_OFFSET_FILL);}},"sphere-circle":function(t,e,i,r){var a=i.paint.get("circle-opacity"),n=i.paint.get("circle-stroke-width"),o=i.paint.get("circle-stroke-opacity");if(0!==a.constantOr(1)||0!==n.constantOr(1)&&0!==o.constantOr(1)){var s=t.context,u=s.gl;s.setColorMode(_h.alphaBlended),i.depthTest?s.setDepthMode(new mh(s.gl.LEQUAL,mh.ReadWrite,[0,1])):s.setDepthMode(mh.disabled),s.setStencilMode(dh.disabled);for(var l=!0,p=0;p<r.length;p++){var c=r[p],h=e.getTile(c).getBucket(i);if(h){var f=t.context.program.get(),m=h.programConfigurations.get(i.id),d=t.useProgram("sphereCircle",m);(l||d.program!==f)&&(m.setUniforms(s,d,i.paint,{zoom:t.transform.zoom}),l=!1),u.uniform2f(d.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);var _=tt();it(_,_,[1,"map"===i.paint.get("circle-pitch-alignment")?Math.cos(t.transform._pitch):1]),et(_,_,t.transform.angle),u.uniformMatrix2fv(d.uniforms.u_pixel_matrix,!1,_),u.uniformMatrix4fv(d.uniforms.u_matrix,!1,new Float32Array(vt([],t.transform.calculateVPMatrix(),h.tilePlane.matrix))),u.uniformMatrix4fv(d.uniforms.u_modelMatrix,!1,new Float32Array(h.tilePlane.matrix)),u.uniform3fv(d.uniforms.u_camPos,t.transform.getCameraPos()),u.uniform1f(d.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle),d.draw(s,u.TRIANGLES,i.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,m);}}}},"sphere-heatmap":function(t,e,i,r){if(0!==i.paint.get("heatmap-opacity")){var a=t.context,n=a.gl;if("offscreen"===t.renderPass){a.setCullFace(yh.disabled),function(t,e,i){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width,e.height]);var a=i.heatmapFbo;if(a)r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer);else{var n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=t.createFramebuffer(e.width,e.height),function t(e,i,r,a){var n=e.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,i.width,i.height,0,n.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:n.UNSIGNED_BYTE,null),a.colorAttachment.set(r),e.extTextureHalfFloat&&n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,a.colorAttachment.setDirty(),t(e,i,r,a));}(t,e,n,a);}}(a,t,i),a.clear({color:We.transparent}),a.setColorMode(new _h([n.ONE,n.ONE],We.transparent,[!0,!0,!0,!0]));for(var o=!0,s=0;s<r.length;s++){var u=r[s];if(!e.hasRenderableParent(u)){var l=e.getTile(u).getBucket(i);if(l){var p=t.context.program.get(),c=l.programConfigurations.get(i.id),h=t.useProgram("sphereHeatmap",c),f=t.transform.zoom;(o||h.program!==p)&&(c.setUniforms(t.context,h,i.paint,{zoom:f}),o=!1),n.uniform1f(h.uniforms.u_intensity,i.paint.get("heatmap-intensity")),n.uniform1f(h.uniforms.u_deviceWidth,t.width),n.uniform1f(h.uniforms.u_deviceHeight,t.height);var m=t.transform;n.uniformMatrix4fv(h.uniforms.u_matrix,!1,new Float32Array(m.calculateVPMatrix())),n.uniform3fv(h.uniforms.u_camera_pos,m.getCameraPos()),h.draw(a,n.TRIANGLES,i.id,l.layoutVertexBuffer,l.indexBuffer,l.segments,c);}}}a.viewport.set([0,0,t.width,t.height]),a.bindFramebuffer.set(null);}else if("translucent"===t.renderPass){var d=t.context;d.setColorMode(_h.alphaBlended),t._map.clipGroundState&&d.setStencilMode(dh.openClipGround),function(t,e){var i=t.context,r=i.gl,a=e.heatmapFbo;if(a){i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);var n=e.colorRampTexture;n||(n=e.colorRampTexture=new Pc(i,e.colorRamp,r.RGBA)),n.bind(r.LINEAR,r.CLAMP_TO_EDGE),i.setDepthMode(mh.disabled);var o=t.useProgram("heatmapTexture"),s=e.paint.get("heatmap-opacity");r.uniform1f(o.uniforms.u_opacity,s),r.uniform1i(o.uniforms.u_image,0),r.uniform1i(o.uniforms.u_color_ramp,1);var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];_s(u,0,t.width,t.height,0,0,1),r.uniformMatrix4fv(o.uniforms.u_matrix,!1,new Float32Array(u)),r.uniform2f(o.uniforms.u_world,r.drawingBufferWidth,r.drawingBufferHeight),t.viewportVAO.bind(t.context,o,t.viewportBuffer,[]),r.drawArrays(r.TRIANGLE_STRIP,0,4);}}(t,i),d.setStencilMode(dh.disabled);}}},"3d-model":function(t,e,i){if(!i||!i.visibility||"none"!==i.visibility){var r,a=t.context,n=a.gl,o=t.cameraDrawMode;r=o===le.CAMERA.DRAW_MODE.OFFSCREEN||o===le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?t.useProgram(Sd[1]):o===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||o===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||o===le.CAMERA.DRAW_MODE.ONSCREEN_ALL?t.useProgram(Sd[2]):i.isSpecialLight?t.useProgram("specialLight"):t.useProgram(Sd[0]);var s=e.getSource(),u=s.configuration,l=u.renderType;if("dyn_heatmap2"===l)return function(t,e,i){if(!i||!i.visibility||"none"!==i.visibility){var r=t.context,a=r.gl,n=t.useProgram("tdModelHeatmap"),o=e.getSource(),s=o.configuration;a.uniform1i(n.uniforms.u_r_heatmap,!0),a.uniform1f(n.uniforms.u_h_heatmap,s.dynMaxHeight),a.uniform1f(n.uniforms.u_height_scale,s.heightScale);var u=s.speedFactor||6,l=t._map.timer.counter*u%(60*s.loopCount),p=Math.floor(l/60);if(a.uniform1f(n.uniforms.u_animate_pos,p),a.uniform1f(n.uniforms.u_animate_seg_percent,l/60-p),o instanceof Tf&&o.meshes.length>0){i.clipGround&&(a.enable(a.STENCIL_TEST),a.stencilFunc(a.ALWAYS,1,255),a.stencilOp(a.KEEP,a.KEEP,a.REPLACE),a.stencilMask(255));var c=t.transform;r.setDepthMode(new mh(a.LESS,mh.ReadWrite,[0,1]));var h=[];h=Zn(!1,o,h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var f=le.FRAMEBUFFER.DEPTH_IMAGE_SCALE;a.uniform2fv(n.uniforms.u_resolution,[t.width*f,t.height*f]),r.activeTexture.set(a.TEXTURE0),a.uniform1i(n.uniforms.u_BaseColorSampler,0),r.setColorMode(new _h([a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0]));for(var m=0;m<o.nodes.length;m++){var d=o.nodes[m];if(d.hasOwnProperty("mesh")&&d.primitiveStack)for(var _=0;_<d.primitiveStack.length;_++){var y=d.primitiveStack[_],g=o.primitives[y.primitiveInd],v=o.materials[g.material],x=void 0;if(x=o.textures[v&&v.baseColorTexture.index||0]){a.uniform1i(n.uniforms.u_use_text,!0),a.uniform4fv(n.uniforms.u_fill_color,v.baseColorFactor||[1,1,1,1]);var b=a.CLAMP_TO_EDGE;x.bind(a.LINEAR,b);}else a.uniform1i(n.uniforms.u_use_text,!1),a.uniform4fv(n.uniforms.u_fill_color,v&&v.baseColorFactor||[.6,.6,.6,1]);var w=Kn(h);d.animation||d.identityMatrix||vt(w,w,d.matrix),o.identityMatrix||vt(w,w,o.matrix),a.uniformMatrix4fv(n.uniforms.u_model_matrix,!1,new Float32Array(w)),vt(w,c.calculateVPMatrix(),w),a.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(w)),o.gltfModelVAO.bind(r,n,g.gltfVertexBuffer,[],g.gltfIndexBuffer),a.drawElements(o._options.debug?a.LINES:g.gltfIndexBuffer.mode||0,g.gltfIndexBuffer.count,g.gltfIndexBuffer.type,g.gltfIndexBuffer.offset),r.setCullFace(yh.disabled);}}i.clipGround&&(a.colorMask(!0,!0,!0,!0),a.stencilFunc(a.NOTEQUAL,1,255),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.stencilMask(0),a.disable(a.STENCIL_TEST));}}}(t,e,i);if("dyn_heatmap"===l?(n.uniform1i(r.uniforms.u_r_heatmap,!0),n.uniform1f(r.uniforms.u_h_heatmap,u.dynMaxHeight)):n.uniform1i(r.uniforms.u_r_heatmap,!1),"airline"===l)return function(t,e,i){if(!i||!i.visibility||"none"!==i.visibility){var r,a,n,o,s,u,l=t.context,p=l.gl,c=e.getSource(),h=c.configuration,f=h.lineNodeName,m=h.staticModelName,d=h.lines,_=[],y=[],g=0,v=0,x=0,b=0;if(c instanceof Tf&&c.meshes.length>0){l.setColorMode(new _h([p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0]));var w=t.transform,A=c.gltfModelVAO;l.setDepthMode(new mh(p.LESS,mh.ReadWrite,[0,1]));for(var T=t.useProgram("airLine"),S=0;S<c.nodes.length;S++){var E=c.nodes[S];if(E.properties.name===f&&E.primitiveStack)for(var P=0;P<E.primitiveStack.length;P++){var I=E.primitiveStack[P],R=c.primitives[I.primitiveInd];l.activeTexture.set(p.TEXTURE0),p.uniform1i(T.uniforms.u_BaseColorSampler,0);var M=c.materials[R.material];if(M.materialParams){p.uniform1i(T.uniforms.u_hightlight,!!I.highlight),c.textures&&c.textures[M&&M.baseColorTexture.index||0]?(p.uniform1i(T.uniforms.u_use_text,!0),p.uniform4fv(T.uniforms.u_fill_color,M.baseColorFactor||[1,1,1,1]),c.textures[M.baseColorTexture.index].bind(p.LINEAR,c.meshes[P].wrap||c.samplers[M.sampler].wrapS||p.CLAMP_TO_EDGE,c.textures[M.baseColorTexture.index].isSizePowerOfTwoNoneSquare()?p.LINEAR_MIPMAP_NEAREST:p.LINEAR)):(p.uniform1i(T.uniforms.u_use_text,!1),p.uniform4fv(T.uniforms.u_fill_color,M&&M.baseColorFactor||[.6,.6,.6,1]));var z=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];pt(z,z,[le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE]);var C=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];vt(z,w.calculateVPMatrix(),z),p.uniform1i(T.uniforms.u_with_shadow,!1),p.uniformMatrix4fv(T.uniforms.u_cam_matrix,!1,new Float32Array(C)),p.uniformMatrix4fv(T.uniforms.u_proj_matrix,!1,new Float32Array(w.td_projectionMatrix)),p.uniformMatrix4fv(T.uniforms.u_matrix,!1,new Float32Array(z)),p.uniform2fv(T.uniforms.u_repeat,M.materialParams.repeat),p.uniform2fv(T.uniforms.u_resolution,[t.width,t.height]),p.uniform1f(T.uniforms.u_lineWidth,M.materialParams.lineWidth),p.uniform1f(T.uniforms.u_opacity,M.materialParams.opacity),p.uniform1i(T.uniforms.u_useAlphaMap,!!M.materialParams.useAlphaMap),p.uniform1f(T.uniforms.u_sizeAttenuation,M.materialParams.sizeAttenuation),p.uniform1f(T.uniforms.u_opacity,M.materialParams.opacity),p.uniform1f(T.uniforms.u_alphaTest,M.materialParams.alphaTest),p.uniform1i(T.uniforms.u_useMap,!!M.materialParams.useMap),p.uniform1i(T.uniforms.u_useDash,!!M.materialParams.useDash),p.uniform1f(T.uniforms.u_dashArray,M.materialParams.dashArray),p.uniform1f(T.uniforms.u_dashOffset,M.materialParams.dashOffset),p.uniform1f(T.uniforms.u_dashRatio,M.materialParams.dashRatio),p.uniform1f(T.uniforms.u_alphaTest,M.materialParams.alphaTest),p.uniform1f(T.uniforms.u_visibility,M.materialParams.visibility);var O=M.materialParams.color;p.uniform3fv(T.uniforms.u_color,[O.r,O.g,O.b]),v=M.materialParams.speedFactor,x=M.materialParams.segmentCount,b=M.materialParams.segmentGroup,g=t._map.timer.counter*v%(x+b),p.uniform1f(T.uniforms.u_count,g),p.uniform1f(T.uniforms.u_segments,b);var F=R.gltfVertexBuffer,L=R.gltfIndexBuffer;A.bind(l,T,F,[],L),t.context.setCullFace(yh.disabled),p.drawElements(L.mode||0,L.count,L.type,L.offset),y=R.triangleData;}}}for(var D=!1,N=0;N<d.length;N++){var k=d[N][0],B=d[N][0]+d[N][1];0===N?_.push(0):_.push(_[N-1]+d[N-1][1]),g>k&&g<B&&(D=!0);}if(!D)return;T=t.useProgram("gltfModel"),l.setDepthMode(new mh(p.LESS,mh.ReadWrite,[0,1]));for(var V=0;V<c.nodes.length;V++){var U=c.nodes[V];if(U.primitiveStack)for(var j=0;j<U.primitiveStack.length;j++){var q=U.primitiveStack[j],X=c.primitives[q.primitiveInd];if(U.userNodeData&&U.userNodeData.name===m){l.activeTexture.set(p.TEXTURE0),p.uniform1i(T.uniforms.u_BaseColorSampler,0);var G=c.materials[X.material];if(!G.materialParams||"MeshLineMaterial"!==G.materialParams.type&&"ParticleMaterial"!==G.materialParams.type){if("OPAQUE"!==G.alphaMode&&l.setColorMode(_h.alphaBlended),p.uniform1i(T.uniforms.u_hightlight,!1),c.textures[G&&G.baseColorTexture.index||0]){p.uniform1i(T.uniforms.u_use_text,!0),p.uniform4fv(T.uniforms.u_fill_color,G.baseColorFactor||[1,1,1,1]);var W=c.textures[G.baseColorTexture.index].isSizePowerOfTwoNoneSquare()&&c.samplers[G.sampler].wrapS||p.CLAMP_TO_EDGE;c.textures[G.baseColorTexture.index].bind(p.LINEAR,W);}else p.uniform1i(T.uniforms.u_use_text,!1),p.uniform4fv(T.uniforms.u_fill_color,G&&G.baseColorFactor||[.6,.6,.6,1]);var Y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];p.uniform1i(T.uniforms.u_with_shadow,!1),p.uniformMatrix4fv(T.uniforms.u_cam_matrix,!1,new Float32Array(Y));var H=X.gltfVertexBuffer,Q=X.gltfIndexBuffer;A.bind(l,T,H,[],Q);for(var Z=parseInt(g),J=0;J<d.length;J++){var K=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$=d[J][0],tt=d[J][0]+d[J][1];if(!(Z<=$+5||Z>=tt-5)){var et=Z-$+_[J];if(y[2*et]&&y[2*(et+1)]){var it=y[2*et][0],rt=y[2*(et+1)][0],at=(r=g-Z,a=it,o=((n=rt)[0]-a[0])*r+a[0],s=(n[1]-a[1])*r+a[1],u=(n[2]-a[2])*r+a[2],[o,s,u]),nt=new Float64Array(3);St(nt,rt,it),Rt(nt,nt);var ut=Gt();ae(ut,[0,0,1],nt);var lt=new Float64Array(3);Ft(lt,[1,0,0],ut);var ct=new Float64Array(3);Dt(ct,it,[0,0,0]);var ht=new Float64Array(3);Dt(ht,rt,[0,0,0]);var ft=new Float64Array(3);zt(ft,ct,ht),Rt(ft,ft);var dt=Gt();ae(dt,lt,ft);var _t=[],yt=Wt(_t,dt);if((_t[0]*nt[0]<0||_t[1]*nt[1]<0||_t[2]*nt[2]<0)&&(yt=2*Math.PI-yt),Yt(ut,ut,yt),mt(K,ut,[at[0]*le.TRANSFORM.R_SCALE,at[1]*le.TRANSFORM.R_SCALE,at[2]*le.TRANSFORM.R_SCALE],[le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE]),c.identityMatrix||vt(K,K,c.matrix),t.style._sunLightFlag){var gt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];st(gt,K),ot(gt,gt),p.uniformMatrix4fv(T.uniforms.u_normal,!1,new Float32Array(gt)),p.uniform1i(T.uniforms.u_with_light,!0),p.uniform3fv(T.uniforms.u_light,t._map.sunLight.getSunLightPos()),p.uniform3fv(T.uniforms.u_lightcolor,[1,1,1]);}else p.uniform1i(T.uniforms.u_with_light,!1);vt(K,w.calculateVPMatrix(),K),p.uniformMatrix4fv(T.uniforms.u_matrix,!1,new Float32Array(K)),p.drawElements(Q.mode||0,Q.count,Q.type,Q.offset);}}}}}}}}}}(t,e,i);if("track"===l)return function(t,e,i){if(!i||!i.visibility||"none"!==i.visibility){var r,a,n,o,s,u,l=t.context,p=l.gl,c=e.getSource(),h=c.configuration,f=h.speedFactor,m=h.segmentCount,d=h.modelNames,_=h.trackData;if(c instanceof Tf&&c.meshes.length>0){l.setStencilMode(dh.disabled),l.setColorMode(new _h([p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0]));var y=t.transform,g=c.gltfModelVAO;l.setDepthMode(new mh(p.LESS,mh.ReadWrite,[0,1]));for(var v=t._map.timer.counter*f%m,x=!1,b=0;b<_.length;b++){var w=_[b],A=w.start,T=w.end;if(v>A&&v<T){x=!0;break}}if(!x)return;for(var S=0;S<c.nodes.length;S++){var E=c.nodes[S];if(c.meshes[E.meshInd],E.primitiveStack)for(var P=0;P<E.primitiveStack.length;P++){var I=E.primitiveStack[P],R=c.primitives[I.primitiveInd];if(E.properties&&(-1===d.indexOf(E.properties.name)||-1===d.indexOf(E.properties.fatherName))){var M=t.useProgram("gltfModel");l.setDepthMode(new mh(p.LESS,mh.ReadWrite,[0,1])),l.activeTexture.set(p.TEXTURE0),p.uniform1i(M.uniforms.u_BaseColorSampler,0);var z=c.materials[R.material];if(!z.materialParams||"MeshLineMaterial"!==z.materialParams.type&&"ParticleMaterial"!==z.materialParams.type){if("OPAQUE"===z.alphaMode?l.setColorMode(_h.unblended):l.setColorMode(_h.alphaBlended),p.uniform1i(M.uniforms.u_hightlight,!1),c.textures[z&&z.baseColorTexture.index||0]){p.uniform1i(M.uniforms.u_use_text,!0),p.uniform4fv(M.uniforms.u_fill_color,z.baseColorFactor||[1,1,1,1]);var C=c.textures[z.baseColorTexture.index].isSizePowerOfTwoNoneSquare()&&c.samplers[z.sampler].wrapS||p.CLAMP_TO_EDGE;c.textures[z.baseColorTexture.index].bind(p.LINEAR,C);}else p.uniform1i(M.uniforms.u_use_text,!1),p.uniform4fv(M.uniforms.u_fill_color,z&&z.baseColorFactor||[.6,.6,.6,1]);var O=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];p.uniform1i(M.uniforms.u_with_shadow,!1),p.uniformMatrix4fv(M.uniforms.u_cam_matrix,!1,O);var F=R.gltfVertexBuffer,L=R.gltfIndexBuffer;g.bind(l,M,F,[],L);for(var D=0;D<_.length;D++){var N=_[D],k=N.start,B=N.end,V=N.model;if((V===E.properties.name||V===E.properties.fatherName)&&!(v<k||v>B)){var U=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],j=xd(_[D].seqs,v,0,_[D].seqs.length-1),q=_[D].positions[j],X=_[D].nexts[j],G=null;1===q[3]?G=q:(r=(v-_[D].seqs[j])/(_[D].seqs[j+1]-_[D].seqs[j]),a=q,o=((n=X)[0]-a[0])*r+a[0],s=(n[1]-a[1])*r+a[1],u=(n[2]-a[2])*r+a[2],G=[o,s,u]);var W=new Float64Array(3);St(W,X,q),Rt(W,W);var Y=Gt();ae(Y,[0,0,1],W);var H=new Float64Array(3);Ft(H,[1,0,0],Y);var Q=new Float64Array(3);Dt(Q,q,[0,0,0]);var Z=new Float64Array(3);Dt(Z,X,[0,0,0]);var J=new Float64Array(3);zt(J,Q,Z),Rt(J,J);var K=Gt();ae(K,H,J);var $=[],tt=Wt($,K);if(($[0]*W[0]<0||$[1]*W[1]<0||$[2]*W[2]<0)&&(tt=2*Math.PI-tt),Yt(Y,Y,tt),mt(U,Y,[G[0]*le.TRANSFORM.R_SCALE,G[1]*le.TRANSFORM.R_SCALE,G[2]*le.TRANSFORM.R_SCALE],[le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE]),c.identityMatrix||(vt(U,U,c.matrix),lt(U,U,c.translation||[0,0,0])),t.style._sunLightFlag){var et=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];st(et,U),ot(et,et),p.uniformMatrix4fv(M.uniforms.u_normal,!1,et),p.uniform1i(M.uniforms.u_with_light,!0),p.uniform3fv(M.uniforms.u_light,t._map.sunLight.getSunLightPos()),p.uniform3fv(M.uniforms.u_lightcolor,[1,1,1]);}else p.uniform1i(M.uniforms.u_with_light,!1);vt(U,y.calculateVPMatrix(),U),p.uniformMatrix4fv(M.uniforms.u_matrix,!1,U),p.drawElements(L.mode||0,L.count,L.type,L.offset);}}}}}}}}}(t,e,i);if(s.primitives.length>0){var p=s.materials[s.primitives[0].material];if(p&&p.materialParams){if("MeshLineMaterial"===p.materialParams.type)return function(t,e,i){if(!i||!i.visibility||"none"!==i.visibility){var r=t.context,a=r.gl,n=t.useProgram("gltfLineModel"),o=e.getSource();if(o instanceof Tf&&o.meshes.length>0){var s=t.transform,u=o.gltfModelVAO;r.setDepthMode(new mh(a.LESS,mh.ReadWrite,[0,1]));var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(l=Zn(!1,o,l),t.style._sunLightFlag){var p=ot([],st([],l));a.uniformMatrix4fv(n.uniforms.u_normal,!1,new Float32Array(p)),a.uniform1i(n.uniforms.u_with_light,!0),a.uniform3fv(n.uniforms.u_light,t._map.sunLight.getSunLightPos()),a.uniform3fv(n.uniforms.u_lightcolor,[1,1,1]);}else a.uniform1i(n.uniforms.u_with_light,!1);r.activeTexture.set(a.TEXTURE2),a.uniform1i(n.uniforms.u_BaseColorSampler,2);for(var c=0;c<o.nodes.length;c++){var h=o.nodes[c];if(o.meshes[h.meshInd],h.primitiveStack)for(var f=0;f<h.primitiveStack.length;f++){var m=h.primitiveStack[f],d=o.primitives[m.primitiveInd],_=o.materials[d.material];if(_.materialParams){a.uniform1i(n.uniforms.u_hightlight,!!m.highlight),o.textures&&o.textures[_&&_.baseColorTexture.index||0]?(a.uniform1i(n.uniforms.u_use_text,!0),a.uniform4fv(n.uniforms.u_fill_color,_&&_.baseColorFactor||[.6,.6,.6,1]),o.textures[_.baseColorTexture.index].bind(a.LINEAR,o.meshes[f].wrap||o.samplers[_.sampler].wrapS||a.CLAMP_TO_EDGE)):(a.uniform1i(n.uniforms.u_use_text,!1),a.uniform4fv(n.uniforms.u_fill_color,_&&_.baseColorFactor||[.6,.6,.6,1]));var y=Kn(l);h.identityMatrix||vt(y,y,h.matrix),o.identityMatrix||vt(y,y,o.matrix),vt(y,s.calculateVPMatrix(),y),a.uniformMatrix4fv(n.uniforms.u_proj_matrix,!1,new Float32Array(s.td_projectionMatrix)),a.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(y)),a.uniform2fv(n.uniforms.u_repeat,_.materialParams.repeat),a.uniform2fv(n.uniforms.u_resolution,[t.width,t.height]),a.uniform1f(n.uniforms.u_lineWidth,_.materialParams.lineWidth),a.uniform1f(n.uniforms.u_opacity,_.materialParams.opacity),a.uniform1f(n.uniforms.u_useAlphaMap,_.materialParams.useAlphaMap),a.uniform1f(n.uniforms.u_sizeAttenuation,_.materialParams.sizeAttenuation),a.uniform1f(n.uniforms.u_opacity,_.materialParams.opacity),a.uniform1f(n.uniforms.u_alphaTest,_.materialParams.alphaTest),a.uniform1i(n.uniforms.u_useMap,_.materialParams.useMap),a.uniform1i(n.uniforms.u_useDash,_.materialParams.useDash),a.uniform1f(n.uniforms.u_dashArray,_.materialParams.dashArray),a.uniform1f(n.uniforms.u_dashOffset,_.materialParams.dashOffset),a.uniform1f(n.uniforms.u_dashRatio,_.materialParams.dashRatio),a.uniform1f(n.uniforms.u_alphaTest,_.materialParams.alphaTest),a.uniform1f(n.uniforms.u_visibility,_.materialParams.visibility);var g=_.materialParams.color;a.uniform3fv(n.uniforms.u_color,[g.r,g.g,g.b]);var v=d.gltfVertexBuffer,x=d.gltfIndexBuffer;u.bind(r,n,v,[],x),a.drawElements(x.mode||0,x.count,x.type,x.offset);}}}}}}(t,e,i);if("ParticleMaterial"===p.materialParams.type)return function(t,e,i){if(!i||!i.visibility||"none"!==i.visibility){var r=t.context,a=r.gl,n=t.useProgram("gltfParticleModel"),o=e.getSource(),s=t._map.timer.counter;if(o instanceof Tf&&o.meshes.length>0){var u=t.transform,l=o.gltfModelVAO;r.setDepthMode(mh.disabled);var p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];p=Zn(!1,o,p),a.uniform1i(n.uniforms.u_with_light,!1),r.activeTexture.set(a.TEXTURE2),a.uniform1i(n.uniforms.u_BaseColorSampler,2);for(var c=0;c<o.nodes.length;c++){var h=o.nodes[c];if(o.meshes[h.meshInd],h.primitiveStack)for(var f=0;f<h.primitiveStack.length;f++){var m=h.primitiveStack[f],d=o.primitives[m.primitiveInd],_=o.materials[d.material];if(_.materialParams&&"ParticleMaterial"===_.materialParams.type){a.uniform1i(n.uniforms.u_hightlight,!!m.highlight),o.textures&&o.textures[_&&_.baseColorTexture.index||0]?(a.uniform1i(n.uniforms.u_use_text,!0),a.uniform4fv(n.uniforms.u_fill_color,_.baseColorFactor||[1,1,1,1]),o.textures[_.baseColorTexture.index].bind(a.LINEAR,o.meshes[f].wrap||o.samplers[_.sampler].wrapS||a.CLAMP_TO_EDGE)):(a.uniform1i(n.uniforms.u_use_text,!1),a.uniform4fv(n.uniforms.u_fill_color,_&&_.baseColorFactor||[.6,.6,.6,1]));var y=Kn(p);h.identityMatrix||vt(y,y,h.matrix);var g=[];ht(g,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],-u.bearing*le.TRANSFORM.DEG_TO_RAD),vt(y,y,g);var v=[];ct(v,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],-Math.PI/2+u._pitch),vt(y,y,v),o.identityMatrix||vt(y,y,o.matrix),vt(y,u.calculateVPMatrix(),y),a.uniform1i(n.uniforms.u_with_shadow,!1),a.uniform4fv(n.uniforms.uColor,_.materialParams.particleColor),a.uniform3fv(n.uniforms.uFirePos,_.materialParams.position),a.uniform1f(n.uniforms.uTime,s),a.uniform1i(n.uniforms.uUseBillboarding,!1),a.uniformMatrix4fv(n.uniforms.uViewMatrix,!1,new Float32Array(u.td_viewMatrix)),a.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(y));var x=d.gltfVertexBuffer,b=d.gltfIndexBuffer;l.bind(r,n,x,[],b),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE),a.drawElements(b.mode||0,b.count,b.type,b.offset),a.disable(a.BLEND);}}}}}}(t,e,i)}}if(s instanceof Tf&&s.meshes.length>0){var c=s.respectiveTransformation,h=i.useLayerPosition;c||!h||i.baseMatrixCalculated||i.calcBaseMatrix(s),a.setStencilMode(dh.disabled),i.clipGround&&a.setStencilMode(dh.enableClipGround);var f=t.transform;a.setDepthMode(new mh(n.LESS,mh.ReadWrite,[0,1]));var m=[],d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c||(m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],m=Zn(!1,h?i:s,m));var _=le.FRAMEBUFFER.DEPTH_IMAGE_SCALE;if(n.uniform2fv(r.uniforms.u_resolution,[t.width*_,t.height*_]),t.style._sunLightFlag){if(!c){var y=ot([],st([],m));n.uniformMatrix4fv(r.uniforms.u_normal,!1,new Float32Array(y));}if(n.uniform1i(r.uniforms.u_with_light,!0),i.isSpecialLight){n.uniform3fv(r.uniforms.u_camera_pos,f.getCameraPos());for(var g=0;g<i.specialLights.length;g++)n.uniform1i(r.uniforms["u_light["+g+"].use"],!0),n.uniform3fv(r.uniforms["u_light["+g+"].position"],i.specialLights[g].position),n.uniform3fv(r.uniforms["u_light["+g+"].direction"],i.specialLights[g].direction),n.uniform1f(r.uniforms["u_light["+g+"].cutOff"],i.specialLights[g].cutOff),n.uniform1f(r.uniforms["u_light["+g+"].outerCutOff"],i.specialLights[g].outerCutOff),n.uniform3fv(r.uniforms["u_light["+g+"].ambient"],i.specialLights[g].ambient),n.uniform3fv(r.uniforms["u_light["+g+"].diffuse"],i.specialLights[g].diffuse),n.uniform3fv(r.uniforms["u_light["+g+"].specular"],i.specialLights[g].specular),n.uniform1f(r.uniforms["u_light["+g+"].constant"],i.specialLights[g].constant),n.uniform1f(r.uniforms["u_light["+g+"].linear"],i.specialLights[g].linear),n.uniform1f(r.uniforms["u_light["+g+"].quadratic"],i.specialLights[g].quadratic),n.uniform1f(r.uniforms["u_light["+g+"].shininess"],i.specialLights[g].shininess);}else n.uniform3fv(r.uniforms.u_light,t._map.sunLight.getSunLightPos()),n.uniform3fv(r.uniforms.u_lightcolor,[1,1,1]);}else n.uniform1i(r.uniforms.u_with_light,!1);var v,x,b,w,A=t.activeCameras;if(n.uniform1f(r.uniforms.u_viewshed_count,0),o===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||o===le.CAMERA.DRAW_MODE.ONSCREEN_ALL){var T=t.fbManager.shadowFramebuffer;T&&(a.activeTexture.set(n.TEXTURE10),n.bindTexture(n.TEXTURE_2D,T.colorAttachment.get()),n.uniform1i(r.uniforms.u_shadow_sampler,10)),n.uniform1f(r.uniforms.u_shadow_off,t.shadowOff);}if(i.viewshedRender&&(o===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||o===le.CAMERA.DRAW_MODE.ONSCREEN_ALL)){var S=A.viewshed[0].fb;S&&(a.activeTexture.set(n.TEXTURE11),n.bindTexture(n.TEXTURE_2D,S.colorAttachment.get()),n.uniform1i(r.uniforms.u_viewshed_samp0,11)),n.uniform1f(r.uniforms.u_shadow_off,t.shadowOff),n.uniform1f(r.uniforms.u_viewshed_count,1);}s._clampEnabled&&s.minClampBounds&&s.maxClampBounds?(lt(d,d,(h?i:s).translation||[0,0,0]),n.uniform1f(r.uniforms.u_clamp_ratio,1),n.uniform3fv(r.uniforms.u_min_clamp_bounds,s.minClampBounds),n.uniform3fv(r.uniforms.u_max_clamp_bounds,s.maxClampBounds),n.uniform4fv(r.uniforms.u_clamp_plane,s.clampPlane),n.uniform2fv(r.uniforms.u_x_clamp_range,s.ratioRange[0]),n.uniform2fv(r.uniforms.u_y_clamp_range,s.ratioRange[1]),n.uniform2fv(r.uniforms.u_z_clamp_range,s.ratioRange[2]),n.uniform3fv(r.uniforms.u_clamp_box,[s.clampBox.x,s.clampBox.y,s.clampBox.z]),n.uniform1f(r.uniforms.u_clamp_box_inner,s.clampBox.inner),n.uniformMatrix4fv(r.uniforms.u_clamp_matrix,!1,new Float32Array(s.clampBoxMatrix))):n.uniform1f(r.uniforms.u_clamp_ratio,0),a.activeTexture.set(n.TEXTURE0),n.uniform1i(r.uniforms.u_BaseColorSampler,0),o===le.CAMERA.DRAW_MODE.OFFSCREEN||o===le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?a.setColorMode(_h.unblended):a.setColorMode(new _h([n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0])),o!==le.CAMERA.DRAW_MODE.OFFSCREEN&&o!==le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||((v=i.shadowCenter)||(v=f._center.toArray()),x=t._map.sunLight._shadowSunPosition({target:v,distance:f.alt*le.TRANSFORM.R_ZOOM*3}));for(var E=0;E<s.nodes.length;E++){var P=s.nodes[E];if(P.hasOwnProperty("mesh")&&(P.properties.flowTexture?(n.uniform1i(r.uniforms.u_flow_text,!0),n.uniform1f(r.uniforms.u_flow_text_off,-t._map.timer.counter)):n.uniform1i(r.uniforms.u_flow_text,!1),P.primitiveStack))for(var I=0;I<P.primitiveStack.length;I++){var R=P.primitiveStack[I],M=s.primitives[R.primitiveInd],z=s.materials[M.material];if(c){m=[],m=Zn(!1,P,m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),s._clampEnabled&&lt(d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d,P.translation||[0,0,0]);var C=ot([],st([],m));n.uniformMatrix4fv(r.uniforms.u_normal,!1,new Float32Array(C));}if(h&&!c?(n.uniform1i(r.uniforms.u_hightlight,!!i.nodes[E].primitiveStack[I].highlight),n.uniform1i(r.uniforms.u_morph_weight,!!M.isSkinModel)):(n.uniform1i(r.uniforms.u_hightlight,!!s.nodes[E].primitiveStack[I].highlight),n.uniform1i(r.uniforms.u_morph_weight,!!M.isSkinModel)),n.uniform1i(r.uniforms.u_specialindex,i.highLightColorsIndex),i.highLightColors)for(var O=0;O<i.highLightColors.length;O++){var F=i.highLightColors[O];n.uniform4fv(r.uniforms["u_specialcolor["+O+"].color"],F.toArray());}else n.uniform4fv(r.uniforms["u_specialcolor[0].color"],[1,.2,.1,1]);if(s.sceneConf&&s.sceneConf.trafficLightsConf)wd(t._map.timer.counter,s.sceneConf.trafficLightsConf,P.properties.name,z,s.materials,s.textures,s.samplers,n,r);else{var L=void 0;if(L=s.textures[z&&z.baseColorTexture.index||0]){n.uniform1i(r.uniforms.u_use_text,!0),n.uniform4fv(r.uniforms.u_fill_color,z.baseColorFactor||[1,1,1,1]);var D=L.isSizePowerOfTwoNoneSquare()&&s.samplers[z.sampler].wrapS||n.CLAMP_TO_EDGE;L.bind(n.LINEAR,D);}else n.uniform1i(r.uniforms.u_use_text,!1),n.uniform4fv(r.uniforms.u_fill_color,z&&z.baseColorFactor||[.6,.6,.6,1]);}var N=Kn(m),k=s._clampEnabled?Kn(d):new Float32Array(16),B=P.animation;B&&(Ed(N,s,E,r,t,B,n),s._clampEnabled&&Ed(k,s,E,r,t,B,n),b=null),P.identityMatrix||(vt(N,N,P.matrix),s._clampEnabled&&vt(k,k,P.matrix),b=null),h&&!c?i.identityMatrix||(vt(N,N,i.matrix),s._clampEnabled&&vt(k,k,i.matrix)):s.identityMatrix||(vt(N,N,s.matrix),s._clampEnabled&&vt(k,k,s.matrix));var V=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(n.uniform1i(r.uniforms.u_with_shadow,!1),Pd(M,w||N,f)){if(w||(w=new Float32Array(Kn(N)),n.uniformMatrix4fv(r.uniforms.u_model_matrix,!1,w),n.uniformMatrix4fv(r.uniforms.u_clamp_model_matrix,!1,new Float32Array(k))),!t.depthPick)if(o===le.CAMERA.DRAW_MODE.OFFSCREEN)"night"!==t._map.sunLight._shadow&&(b||(vt(N,f.calculateVPMatrix(x),N),b=new Float32Array(Kn(N)),n.uniformMatrix4fv(r.uniforms.u_matrix,!1,b)));else if(o===le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)b||(vt(N,f.calculateVPMatrix(A.viewshed[0]),N),b=new Float32Array(Kn(N)),n.uniformMatrix4fv(r.uniforms.u_matrix,!1,b));else if(o===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW)"night"!==t._map.sunLight._shadow?(n.uniform1i(r.uniforms.u_with_shadow,!0),vt(V,f.calculateVPMatrix(x),N)):n.uniform1i(r.uniforms.u_with_shadow,!1),n.uniformMatrix4fv(r.uniforms.u_sun_matrix,!1,new Float32Array(V));else if(o===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED){var U=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];vt(U,f.calculateVPMatrix(A.viewshed[0]),N),n.uniformMatrix4fv(r.uniforms.u_viewshed_mat0,!1,new Float32Array(U)),n.uniform3fv(r.uniforms.u_viewshed_eye0,f._lastSunLightStatus.geographic),n.uniform1f(r.uniforms.u_viewshed_dist0,A.viewshed[0].farDistance),n.uniform1i(r.uniforms.u_viewshed_used0,!0);}else if(o===le.CAMERA.DRAW_MODE.ONSCREEN_ALL){"night"!==t._map.sunLight._shadow?(n.uniform1i(r.uniforms.u_with_shadow,!0),vt(V,f.calculateVPMatrix(x),N)):n.uniform1i(r.uniforms.u_with_shadow,!1),n.uniformMatrix4fv(r.uniforms.u_sun_matrix,!1,new Float32Array(V));var j=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];vt(j,f.calculateVPMatrix(A.viewshed[0]),N),n.uniformMatrix4fv(r.uniforms.u_viewshed_mat0,!1,new Float32Array(j)),n.uniform3fv(r.uniforms.u_viewshed_eye0,f._lastSunLightStatus.geographic),n.uniform1f(r.uniforms.u_viewshed_dist0,A.viewshed[0].farDistance),n.uniform1i(r.uniforms.u_viewshed_used0,!0);}b||(vt(N,f.calculateVPMatrix(),N),b=new Float32Array(Kn(N)),n.uniformMatrix4fv(r.uniforms.u_matrix,!1,b)),!1===z.doubleSided&&a.setCullFace(yh.backCCW),s.gltfModelVAO.bind(a,r,M.gltfVertexBuffer,[],M.gltfIndexBuffer),n.drawElements(s._options.debug?n.LINES:M.gltfIndexBuffer.mode||0,M.gltfIndexBuffer.count,M.gltfIndexBuffer.type,M.gltfIndexBuffer.offset),a.setCullFace(yh.disabled);}}}i.clipGround&&a.setStencilMode(dh.disabled);}}},"sphere-symbol":function(t,e,i,r){"translucent"===t.renderPass&&(t.context.setStencilMode(dh.disabled),0!==i.paint.get("icon-opacity").constantOr(1)&&rd(t,e,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright")),0!==i.paint.get("text-opacity").constantOr(1)&&rd(t,e,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&Yf(t,e,i,r));},"sphere-extrusion":function(t,e,i,r){if(i.paint&&0!==i.paint.get("extrusion-opacity")){var a,n=t.context,o=n.gl;n.setDepthMode(new mh(o.LESS,mh.ReadWrite,[0,1]));var s=i.paint.get("extrusion-pattern"),u=t.cameraDrawMode;a=u===le.CAMERA.DRAW_MODE.OFFSCREEN||u===le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?s?ud[2]:ud[3]:u===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||u===le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||u===le.CAMERA.DRAW_MODE.ONSCREEN_ALL?s?ud[4]:ud[5]:s?ud[0]:ud[1],u===le.CAMERA.DRAW_MODE.OFFSCREEN||u===le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?n.setColorMode(_h.unblended):n.setColorMode(new _h([o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0]));for(var l=!0,p=0,c=r;p<c.length;p+=1){var h=c[p],f=e.getTile(h),m=f.getBucket(i);m&&(ld(t,0,i,f,0,m,l,a,s),l=!1);}}},"sphere-sprite":function(t,e,i,r){if("translucent"===t.renderPass){var a=i.paint.get("sprite-opacity"),n=i.paint.get("sprite-width");if(0!==a.constantOr(1)&&0!==n.constantOr(1)){var o,s=t.context,u=s.gl;t._map.clipGroundState&&s.setStencilMode(dh.openClipGround);var l=!0;i.speeds||(i.speeds={});var p=i.paint.get("sprite-speed-factor");i.speeds.hasOwnProperty("speed"+p)||(i.speeds["speed"+p]=0),i.speeds["speed"+p]+=1,i.speeds["speed"+p]%=1===p?20:2===p?80:3===p?150:240,s.setColorMode(new _h([u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA],We.transparent,[!0,!0,!0,!0]));for(var c=0,h=r;c<h.length;c+=1){var f=h[c],m=e.getTile(f),d=m.getBucket(i);d&&(hd(t,m,d,i,0,l,d.programConfigurations.get(i.id),o),o=m.tileID.overscaledZ,l=!1);}s.setStencilMode(dh.disabled),s.setColorMode(_h.unblended);}}},"sphere-tracking":function(t,e,i,r){var a=i.paint.get("tracking-opacity"),n=i.paint.get("tracking-width");if(0!==a.constantOr(1)&&0!==n.constantOr(1)){var o=t.context;o.setColorMode(_h.alphaBlended),i.depthTest?o.setDepthMode(new mh(o.gl.LEQUAL,mh.ReadWrite,[0,1])):o.setDepthMode(mh.disabled),t._map.clipGroundState&&o.setStencilMode(dh.openClipGround);var s=i.paint.get("tracking-seg-group"),u=i.paint.get("tracking-delay");if("history"===i.paint.get("tracking-type"))i.histEnd=Date.now(),i.first||(i.first=!0,i.histStart=0,i.histCount=0,i.isReverse=!1,i.isReserve=!1),i.histEnd-i.histStart>=1e3/i.paint.get("tracking-speed")&&("loop"===i.layout.get("tracking-display-mode")?(i.histCount++,i.histCount%=i.paint.get("tracking-seg-count"),i.histCount=0===i.histCount?1:i.histCount):"reverse"===i.layout.get("tracking-display-mode")?(i.histCount>=i.paint.get("tracking-seg-count")+i.paint.get("tracking-seg-group")?i.isReverse=!0:i.histCount<=1&&(i.isReverse=!1),i.histCount=i.isReverse?i.histCount-1:i.histCount+1):"loop-reserve"===i.layout.get("tracking-display-mode")?(i.isReserve=!0,i.histCount++,i.histCount%=i.paint.get("tracking-seg-count"),i.histCount=0===i.histCount?1:i.histCount):"reverse-reserve"===i.layout.get("tracking-display-mode")&&(i.isReserve=!0,i.histCount>=i.paint.get("tracking-seg-count")+i.paint.get("tracking-seg-group")?i.isReverse=!0:i.histCount<=1&&(i.isReverse=!1),i.histCount=i.isReverse?i.histCount-1:i.histCount+1),O.TRW&&O.TRW.setProgress(i.histCount),i.histStart=i.histEnd);else if(i.count||(i.start=Date.now(),i.count=1),i.end=Date.now(),i.end-i.start>=1e3/i.paint.get("tracking-speed")){var l=O.TRW;i.count+=1;var p=l&&l.hasOwnProperty("replaceOffset")?l.replaceOffset:120+u;i.count%=p;var c=l&&l.hasOwnProperty("requestOffset")?l.requestOffset:90+u;i.count===c&&l&&l.request(),0===i.count&&(l&&l.replace(),i.count=u),l&&(l.currentSeq=i.count),i.start=i.end;}!function(t,e){if(e&&e.TRW&&"null"!==e.TRW){e.TRW.layerForwards||(e.TRW.layerForwards=[]);for(var i=0;i<e.TRW.layerForwards.length;i++){var r=e.TRW.layerForwards[i];if(r.id===t.id){t.count&&(t.count+=r.count),e.TRW.layerForwards.splice(i,1);break}}}}(i,O),!function(t,e,i,r,a,n,o,s,u){for(var l,p=!0,c=0,h=r;c<h.length;c+=1){var f=h[c],m=e.getTile(f),d=m.getBucket(i);if(d){var _=d.programConfigurations.get(i.id),y=t.context.program.get(),g=t.useProgram(a,_),v=p||g.program!==y,x=l!==m.tileID.overscaledZ;pd(g,t,m,d,i,0,_,v,x,n,o,s,u),l=m.tileID.overscaledZ,p=!1;}}}(t,e,i,r,"sphereTracking","history"===i.paint.get("tracking-type")?i.histCount:i.count,i.isReverse,i.isReserve,s),o.setStencilMode(dh.disabled);}},"sphere-background":function(t,e,i){var r=i.paint.get("background-color"),a=i.paint.get("background-opacity");if(0!==a){var n,o=t.context,s=o.gl,u=i.paint.get("background-pattern");if(fd&&(t.transform._calcProjectionsMatrix(),t.transform._calcMatrices(),fd=!1),o.setDepthMode(new mh(o.gl.LEQUAL,mh.ReadWrite,[.1,1])),o.setColorMode(_h.unblended),t._map.clipGroundState&&o.setStencilMode(dh.openClipGround),u){if(Pm(u,t))return;n=t.useProgram("sphereBackgroundPattern"),Im(u,t,n),t.tileExtentPatternVAO.bind(o,n,t.tileExtentBuffer,[]);}else n=t.useProgram("sphereBackground"),s.uniform4fv(n.uniforms.u_color,r?[r.r,r.g,r.b,r.a]:[.35,.35,.35,1]),t.tileExtentVAO.bind(o,n,t.tileExtentBuffer,[]);s.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(t.transform.calculateVPMatrix())),s.uniform1f(n.uniforms.u_opacity,a),t.context.setCullFace(yh.disabled);var l=t.sphereBuffer;t.sphereVAO.bind(o,n,l,[]),s.drawArrays(s.TRIANGLE_STRIP,0,l.length),o.setStencilMode(dh.disabled);}},"3d-point-cloud":function(t,e,i){if(!i||!i.visibility||"none"!==i.visibility){var r=t.context,a=r.gl,n=t.useProgram("pointCloud"),o=e.getSource();if(o instanceof Tf&&o.meshes.length>0){var s=t.transform,u=o.gltfModelVAO;r.setDepthMode(new mh(a.LEQUAL,mh.ReadWrite,[0,1]));var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Zn(!1,o,l);var p=Kn(l);o.identityMatrix||vt(p,p,o.matrix),vt(p,s.calculateVPMatrix(),p),a.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(p)),a.uniform1i(n.uniforms.u_mode,Cd[i.paint.get("3d-point-cloud-mode")]),a.uniform1f(n.uniforms.u_opacity,i.paint.get("3d-point-cloud-opacity")),a.uniform1f(n.uniforms.u_pointSize,i.paint.get("3d-point-cloud-size")),a.uniform2f(n.uniforms.u_class_range,o.range.cMin?o.range.cMin:0,o.range.cMax?o.range.cMax:0),a.uniform2f(n.uniforms.u_z_range,o.range.zMin?o.range.zMin:0,o.range.zMax?o.range.zMax:0),a.uniform2f(n.uniforms.u_intensity_range,o.range.iMin?o.range.iMin:0,o.range.iMax?o.range.iMax:0);for(var c=0;c<o.nodes.length;c++){var h=o.nodes[c];if(h.primitiveStack)for(var f=0;f<h.primitiveStack.length;f++){var m=h.primitiveStack[f],d=o.primitives[m.primitiveInd],_=d.gltfVertexBuffer,y=d.gltfIndexBuffer;u.bind(r,n,_,[],y),a.drawElements(y.mode,y.count,y.type,y.offset);}}}}},fxaa:function(t){for(var e=0;e<Od;e++)Fd(t,t.fbManager.fxaaFramebuffer,t.fbManager.fxaaExcFramebuffer),Fd(t,t.fbManager.fxaaExcFramebuffer,t.fbManager.fxaaFramebuffer);Fd(t,t.fbManager.fxaaFramebuffer,null);},bloom:function(t){var e,i;t.getDefaultFrameBuffer()===t.fbManager.fxaaFramebuffer.framebuffer?(e=t.fbManager.fxaaFramebuffer,i=!0):(e=t.fbManager.bloomBaseColorFramebuffer,i=!1),t.context.setColorMode(_h.unblended),t.context.setDepthMode(mh.disabled),Dd(t,e,t.fbManager.bloomFramebuffer,Ld[0],[0,1],null);for(var r=0;r<t._map._bloomOptions.step;r++)Dd(t,t.fbManager.bloomFramebuffer,t.fbManager.bloomExcFramebuffer,Ld[1],[0,1],null),Dd(t,t.fbManager.bloomExcFramebuffer,t.fbManager.bloomFramebuffer,Ld[1],[1,0],null);i?(Dd(t,t.fbManager.bloomFramebuffer,t.fbManager.bloomBaseColorFramebuffer,Ld[2],[0,1],e),Dd(t,t.fbManager.bloomBaseColorFramebuffer,t.fbManager.fxaaFramebuffer,Ld[3],[0,1],null)):Dd(t,t.fbManager.bloomFramebuffer,null,Ld[2],[0,1],e);},custom:function(t,e,i){var r=t.context,a=i.implementation;t.setCustomLayerDefaults(),r.setStencilMode(dh.disabled),r.setDepthMode(mh.disabled),r.setColorMode(_h.unblended);var n,o,s,u,l,p=(n=a.anchor,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=s||[0,0,0],l=[],n[2]=n[2]||0,Gn(l,n,le.TRANSFORM.R+n[2]),lt(o,o,l),ht(o,o,(90-n[0])*le.TRANSFORM.DEG_TO_RAD),ct(o,o,(90-n[1])*le.TRANSFORM.DEG_TO_RAD),ft(o,o,180*le.TRANSFORM.DEG_TO_RAD),pt(o,o,[le.TRANSFORM.R_SCALE,-le.TRANSFORM.R_SCALE,le.TRANSFORM.R_SCALE]),lt(o,o,u));ut(p,t.transform.customLayerMatrix(),p),a.render(r.gl,p);},panorama:vd},Vd=function(t,e,i){this.context=new gh(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Rf.maxUnderzooming+Rf.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new Mo,this.crossTileSymbolIndex=new kf,this.td_firstRun=!0,this.depthPick=!1,this.shadowOff=le.EFFECTS.SHADOW_OFFSET,this.sphereTileVerticeCache=new Md(0,null,this.transform.projection),this._map=i,this.fbManager=new Nd(this.context,this.width,this.height),this._currentCameraView=null,this.activeCameras=null,this.cameraDrawMode=le.CAMERA.DRAW_MODE.NORMAL,this._currentFrameBuffer=null,this.transform.setPainter(this),this.genSphereVAO();},Ud={projection:{configurable:!0}};Vd.prototype.genSphereVAO=function(){this.sphereArray=new en,qn(le.TRANSFORM.R,8,256,Xa.LATLON,this.sphereArray),this.sphereBuffer||(this.sphereBuffer=this.context.createVertexBuffer(this.sphereArray,wh.members)),this.sphereVAO||(this.sphereVAO=new xh);},Vd.prototype.setShadowOff=function(t,e){this.shadowOff=t,this.shadowDistance=e;},Ud.projection.get=function(){return this._projection},Ud.projection.set=function(t){t!==Xa.MERCATOR&&t!==Xa.LATLON||(this._projection=t,this.sphereTileVerticeCache.projection=t);},Vd.prototype.resize=function(t,e){var i=this.context.gl;if(this.width=t*n.devicePixelRatio,this.height=e*n.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.disableDepthPick(),this.style)for(var r=0,a=this.style._order;r<a.length;r+=1){var o=a[r];this.style._layers[o].resize();}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null),this.fbManager.resize(this.width,this.height);},Vd.prototype.getDefaultFrameBuffer=function(){return this._map.sphereRender?this._currentFrameBuffer:null},Vd.prototype.enableDepthPick=function(){this.depthPick=!0,this.bindPickBuffer();},Vd.prototype.bindPickBuffer=function(){this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),this.context.clear({color:We.transparent,depth:1});},Vd.prototype.disableDepthPick=function(){this.depthPick=!1,this.context.bindFramebuffer.set(this.getDefaultFrameBuffer());},Vd.prototype.getPickRay=function(t){var e=t,i=this.context.gl;if(!this.style)return{z_ndc:.991};if(this._checkStatusChange()){this.enableDepthPick(),this.render(this.style,this.options);var r=new Uint8Array(4);this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),i.readPixels(e.x*self.devicePixelRatio,e.y*self.devicePixelRatio,1,1,i.RGBA,i.UNSIGNED_BYTE,r);var a=2*(this.context.czm_unpackDepth(r)-.5);this.disableDepthPick(),this.ray=new yo(this.transform.getCameraPos(),vo(e.x,e.y,a,this.transform)),this.ray.z_ndc=a;}else{var n=new Uint8Array(4);this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),i.readPixels(e.x*self.devicePixelRatio,e.y*self.devicePixelRatio,1,1,i.RGBA,i.UNSIGNED_BYTE,n);var o=2*(this.context.czm_unpackDepth(n)-.5);this.disableDepthPick(),this.ray=new yo(this.transform.getCameraPos(),vo(e.x,e.y,o,this.transform)),this.ray.z_ndc=o;}return this.ray},Vd.prototype._checkStatusChange=function(){if(!this.ray)return!0;var t=this.transform;return this._rayStatus?(this._rayStatus.zoom!==t.zoom||this._rayStatus.pitch!==t.pitch||this._rayStatus.bearing!==t.bearing||this._rayStatus.center.lng!==t.center.lng||this._rayStatus.center.lat!==t.center.lat)&&(this._rayStatus={zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,center:t.center},!0):(this._rayStatus={zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,center:t.center},!0)},Vd.prototype.setup=function(){var t=this.context,e=new $a;e.emplaceBack(0,0),e.emplaceBack(io,0),e.emplaceBack(0,io),e.emplaceBack(io,io),this.tileExtentBuffer=t.createVertexBuffer(e,Of.members),this.tileExtentVAO=new xh,this.tileExtentPatternVAO=new xh;var i=new $a;i.emplaceBack(0,0),i.emplaceBack(io,0),i.emplaceBack(io,io),i.emplaceBack(0,io),i.emplaceBack(0,0),this.debugBuffer=t.createVertexBuffer(i,Of.members),this.debugVAO=new xh;var r=new tn;r.emplaceBack(0,0,0,0),r.emplaceBack(io,0,io,0),r.emplaceBack(0,io,0,io),r.emplaceBack(io,io,io,io),this.rasterBoundsBuffer=t.createVertexBuffer(r,bh.members),this.rasterBoundsVAO=new xh;var a=new $a;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,Of.members),this.viewportVAO=new xh;},Vd.prototype.clearStencil=function(){var t=this.context,e=t.gl;t.setColorMode(_h.disabled),t.setDepthMode(mh.disabled),t.setStencilMode(new dh({func:e.ALWAYS,mask:0},0,255,e.ZERO,e.ZERO,e.ZERO));var i=us();_s(i,0,this.width,this.height,0,0,1),ms(i,i,[e.drawingBufferWidth,e.drawingBufferHeight,0]);var r=this.useProgram("clippingMask");e.uniformMatrix4fv(r.uniforms.u_matrix,!1,i),this.viewportVAO.bind(t,r,this.viewportBuffer,[]),e.drawArrays(e.TRIANGLE_STRIP,0,4);},Vd.prototype._renderTileClippingMasks=function(t){var e=this.context,i=e.gl;e.setColorMode(_h.disabled),e.setDepthMode(mh.disabled);var r=1;this._tileClippingMaskIDs={};for(var a=0,n=t;a<n.length;a+=1){var o=n[a],s=this._tileClippingMaskIDs[o.key]=r++;e.setStencilMode(new dh({func:i.ALWAYS,mask:0},s,255,i.KEEP,i.KEEP,i.REPLACE));var u=this.useProgram("clippingMask");i.uniformMatrix4fv(u.uniforms.u_matrix,!1,o.posMatrix),this.tileExtentVAO.bind(this.context,u,this.tileExtentBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,this.tileExtentBuffer.length);}},Vd.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new dh({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},Vd.prototype.colorModeForRenderPass=function(){var t=this.context.gl;if(this._showOverdrawInspector){return new _h([t.CONSTANT_COLOR,t.ONE],new We(1/8,1/8,1/8,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?_h.unblended:_h.alphaBlended},Vd.prototype.depthModeForSublayer=function(t,e,i){var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,a=r-1+this.depthRange;return new mh(i||this.context.gl.LEQUAL,e,[a,r])},Vd.prototype._drawSurroundings=function(){this.style.sourceCaches[le.SOURCE.SKYBOX_SOURCE_ID]&&this.renderSphereLayer(this,this.style.sourceCaches[le.SOURCE.SKYBOX_SOURCE_ID]),this.style.sourceCaches[le.SOURCE.GLOBAL_SOURCE_ID]&&this.renderSphereLayer(this,this.style.sourceCaches[le.SOURCE.GLOBAL_SOURCE_ID]);},Vd.prototype.getCurrentCameraView=function(){return this._currentCameraView},Vd.prototype._sphereDrawLoop=function(){var t;this.renderPass="offscreen";var e=[];this.currentLayer=0;var i,r=this.style._order;if(this._map.clipGroundState)for(this.currentLayer;this.currentLayer<r.length;this.currentLayer++){var a=this.style._layers[r[this.currentLayer]];-1!==a.type.indexOf("3d-model")&&!0===a.clipGround&&(t=this.style.sourceCaches[a.source],this.renderSphereLayer(this,t,a,e));}for(this.currentLayer;this.currentLayer<r.length;this.currentLayer++){var n=this.style._layers[r[this.currentLayer]];n&&-1!==n.type.indexOf("sphere-heatmap")&&((n.source===(t&&t.id)||(e=[],(t=this.style.sourceCaches[n.source])&&(e=t.getVisibleCoordinates()),e.length))&&this.renderSphereLayer(this,t,n,e));}this.context.clear({color:We.black,depth:1}),this._drawSurroundings(),this.renderPass="translucent";var o=[];this.currentLayer=0;var s=this.style._order;for(this.currentLayer;this.currentLayer<s.length;this.currentLayer++){var u=this.style._layers[s[this.currentLayer]];-1!==u.type.indexOf("3d-model")&&!0===u.clipGround||(-1===u.type.indexOf("sphere")&&-1===u.type.indexOf("3d")&&"custom"!==u.type||(0!==u.type.indexOf("sphere-heatmap")||o.length)&&(u.source!==(i&&i.id)&&(o=[],(i=this.style.sourceCaches[u.source])&&i.getVisibleCoordinates&&(o=i.getVisibleCoordinates())),this.renderSphereLayer(this,i,u,o)));}},Vd.prototype.sphereModeRender=function(){if(this.sphereTileVerticeCache.updateCacheSize(this.transform),this._map.panoramaMode){var t=this.style._layers[le.LAYER.PANORAMA_LAYER_ID];return this.renderSphereLayer(this,this.style.sourceCaches[le.SOURCE.PANORAMA_SOURCE_ID],t,{})}if(this.depthPick)this.cameraDrawMode=le.CAMERA.DRAW_MODE.OFFSCREEN,this._currentFrameBuffer=this.fbManager.pickFramebuffer.framebuffer,this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=null,this.cameraDrawMode=le.CAMERA.DRAW_MODE.OFFSCREEN,this._sphereDrawLoop();else{var e=le.CAMERA.DRAW_MODE.NORMAL;this.activeCameras.shadow&&(this.cameraDrawMode=le.CAMERA.DRAW_MODE.OFFSCREEN,e=le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW,this._currentFrameBuffer=this.fbManager.shadowFramebuffer.framebuffer,this.context.bindFramebuffer.set(this.fbManager.shadowFramebuffer.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=this.activeCameras.shadow,this.context.clear({color:We.black,depth:1}),this._sphereDrawLoop());var i=[];this.activeCameras.viewshed.length>0&&(e=e===le.CAMERA.DRAW_MODE.ONSCREEN_SHADOW?le.CAMERA.DRAW_MODE.ONSCREEN_ALL:le.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED);for(var r=0;r<this.activeCameras.viewshed.length&&r<1;r++){this.cameraDrawMode=le.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED;var a=this.fbManager.getAFramebufferFromPool();i.push(a);var n=this.activeCameras.viewshed[r];n.fb=a,this._currentCameraView=n,this._currentFrameBuffer=a.framebuffer,this.context.bindFramebuffer.set(a.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:We.black,depth:1}),this._sphereDrawLoop();}this._map.fxaaRender?(this._currentFrameBuffer=this.fbManager.fxaaFramebuffer.framebuffer,this.context.bindFramebuffer.set(this._currentFrameBuffer)):this._map.bloomRender?(this._currentFrameBuffer=this.fbManager.bloomBaseColorFramebuffer.framebuffer,this.context.bindFramebuffer.set(this._currentFrameBuffer)):(this._currentFrameBuffer=null,this.context.bindFramebuffer.set(null)),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=null,this.cameraDrawMode=e,this._sphereDrawLoop();for(var o=0;o<i.length;o++)this.activeCameras.viewshed[o].fb=null,this.fbManager.releaseAFramebufferOfPool(i[o]);this._map.bloomRender&&this.renderSphereLayer(this,{},{type:"bloom",isHidden:function(t){return t<0}},{}),this._map.fxaaRender&&this.renderSphereLayer(this,{},{type:"fxaa",isHidden:function(t){return t<0}},{});}},Vd.prototype.renderSphereLayer=function(t,e,i,r){i&&i.isHidden(this.transform.zoom)||(i||r?i&&r&&Bd[i.type](t,e,i,r):Bd.sphere(t,e));},Vd.prototype.render=function(t,e){var i=this;for(var r in this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.now()),t.sourceCaches){var a=i.style.sourceCaches[r];a.used&&a.prepare(i.context);}var o=this.style._order,s=E(this.style.sourceCaches,function(t){return!i.transform.sphereRender&&"raster"===t.getSource().type}),u=function(t){var e=s[t];!function(t,e){for(var i=t.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),r=0;r<i.length;r++){var a={},n=i[r],o=i.slice(r+1);Gf(n.tileID.wrapped(),n.tileID,o,new uo(0,n.tileID.wrap+1,0,0,0),a),n.setMask(a,e);}}(e.getVisibleCoordinates().map(function(t){return e.getTile(t)}),i.context);};for(var l in s)u(l);if(this.context.bindFramebuffer.set(null),this.transform.sphereRender){var p=this.context.gl;return this.context.setStencilMode(new dh({func:this.context.gl.ALWAYS,mask:0},255,255,p.KEEP,p.KEEP,p.REPLACE)),this.context.setColorMode(_h.unblended),this.context.setDepthMode(new mh(this.context.gl.LEQUAL,mh.ReadWrite,[0,1])),this.context.setCullFace(yh.disabled),this.activeCameras=this._map.getAllActiveCameraViews(),this.context.clear({color:We.black,depth:1}),this.sphereModeRender()}this.renderPass="offscreen";var c,h=[];this.depthRboNeedsClear=!0;for(var f=0;f<o.length;f++){var m=i.style._layers[o[f]];-1===m.type.indexOf("sphere")&&-1===m.type.indexOf("3d")&&(m.hasOffscreenPass()&&!m.isHidden(i.transform.zoom)&&(m.source!==(c&&c.id)&&(h=[],(c=i.style.sourceCaches[m.source])&&(h=c.getVisibleCoordinates()).reverse()),("custom"===m.type||h.length)&&i.renderLayer(i,c,m,h)));}this.context.bindFramebuffer.set(null),this.context.clear({color:e.showOverdrawInspector?We.black:We.transparent,depth:1}),this._showOverdrawInspector=e.showOverdrawInspector,this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.renderPass="opaque";var d,_=[];for(this.currentLayer=o.length-1,this.currentLayer;this.currentLayer>=0;this.currentLayer--){var y=i.style._layers[o[i.currentLayer]];-1===y.type.indexOf("sphere")&&-1===y.type.indexOf("3d")&&(y.source!==(d&&d.id)&&(_=[],(d=i.style.sourceCaches[y.source])&&(i.clearStencil(),_=d.getVisibleCoordinates(),d.getSource().isTileClipped&&i._renderTileClippingMasks(_))),i.renderLayer(i,d,y,_));}this.renderPass="translucent";var g,v=[];for(this.currentLayer=0,this.currentLayer;this.currentLayer<o.length;this.currentLayer++){var x=i.style._layers[o[i.currentLayer]];-1===x.type.indexOf("sphere")&&-1===x.type.indexOf("3d")&&(x.source!==(g&&g.id)&&(v=[],(g=i.style.sourceCaches[x.source])&&(v=g.getVisibleCoordinates(),g.getSource().isTileClipped&&i._renderTileClippingMasks(v)),v.reverse()),i.renderLayer(i,g,x,v));}if(this.options.showTileBoundaries){var b=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];!b||b instanceof Gd||kd.debug(this,b,b.getVisibleCoordinates());}this.setCustomLayerDefaults();},Vd.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height));},Vd.prototype.renderLayer=function(t,e,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||r.length)&&(this.id=i.id,kd[i.type](t,e,i,r));},Vd.prototype.translatePosMatrix=function(t,e,i,r,a){if(!i[0]&&!i[1])return t;var n=a?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(n){var o=Math.sin(n),s=Math.cos(n);i=[i[0]*s-i[1]*o,i[0]*o+i[1]*s];}var u=[a?i[0]:Cf(e,i[0],this.transform.zoom),a?i[1]:Cf(e,i[1],this.transform.zoom),0],l=new Float64Array(16);return fs(l,t,u),l},Vd.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t];},Vd.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},Vd.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var i=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new Xf(this.context,Vf[t],e,this._showOverdrawInspector)),this.cache[i]},Vd.prototype.useProgram=function(t,e){var i=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.context.program.set(i.program),i},Vd.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault();},Vd.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD);},Object.defineProperties(Vd.prototype,Ud);var jd=function(t,e,i,r,a){this.tileID=t,this.uid=w(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.expiredRequestCount=0,this.state="loading",this.projType=i||Xa.MERCATOR,this.isRaster=r||!1,this.sphereRender=a||!1;};jd.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<n.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e);},jd.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},jd.prototype.loadVectorData=function(t,e,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var i={};if(!e)return i;for(var r=0,a=t;r<a.length;r+=1){var n=a[r],o=n.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==o.length){n.layers=o,n.stateDependentLayers=o.filter(function(t){return t.isStateDependent()});for(var s=0,u=o;s<u.length;s+=1)i[u[s].id]=n;}}return i}(t.buckets,e.style),i)for(var r in this.buckets){var a=this.buckets[r];(a instanceof bl||a instanceof lf||a instanceof Cp)&&(a.justReloaded=!0);}for(var n in this.queryPadding=0,this.buckets){var o=this.buckets[n];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(o.layerIds[0]).queryRadius(o));}t.iconAtlasImage&&(this.iconAtlasImage=t.iconAtlasImage),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage);}else this.collisionBoxArray=new Fn;},jd.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.iconAtlasTexture&&this.iconAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded";},jd.prototype.loadImgAOTerrainData=function(t,e,i,r,a,n,o){var s=this,u=e.context;if(t.img){var l=new self.Image,p=self.URL||self.webkitURL;l.onload=function(){p.revokeObjectURL(l.src);var t=u.gl;s.texture=e.getTileTexture(l.width),s.texture?s.texture.update(l,{useMipmap:!0}):(s.texture=new Pc(u,l,t.RGBA,{useMipmap:!0}),s.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&t.texParameterf(t.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax)),s.state="loaded",o(null);};var c=new self.Blob([new Uint8Array(t.img.data)],{type:"image/png"});l.src=t.img.data.byteLength?p.createObjectURL(c):le.SOURCE.TRANSPARENT_PNG_URL;}r&&this._renderTerrain(t,u,a,n);},jd.prototype._renderTerrain=function(t,e,i,r){this.terrainData=r.addATerrainTile(this.tileID,t,e,i);},jd.prototype.getBucket=function(t){return this.buckets[t.id]},jd.prototype.upload=function(t){for(var e in this.buckets){var i=this.buckets[e];i.uploadPending()&&i.upload(t);}var r=t.gl;this.iconAtlasImage&&(this.iconAtlasTexture=new Pc(t,this.iconAtlasImage,r.RGBA),this.iconAtlasImage=null),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pc(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null);},jd.prototype.queryRenderedFeatures=function(t,e,i,r,a,n,o,s,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:a,tileSize:this.tileSize,posMatrix:u,transform:o,params:n,queryPadding:this.queryPadding*s},t,e):{}},jd.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var i=this.latestFeatureIndex.loadVTLayers(),r=e?e.sourceLayer:"",a=i._geojsonTileLayer||i[r];if(a)for(var n=Cr(e&&e.filter),o={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y},s=0;s<a.length;s++){var u=a.feature(s);if(n(new Ia(this.tileID.overscaledZ),u)){var l=new Wh(u,o.z,o.x,o.y);l.tile=o,t.push(l);}}}},jd.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer),this.sphereSegments&&(this.sphereSegments.destroy(),delete this.sphereSegments),this.sphereMaskedBoundsBuffer&&(this.sphereMaskedBoundsBuffer.destroy(),delete this.sphereMaskedBoundsBuffer),this.sphereMaskedIndexBuffer&&(this.sphereMaskedIndexBuffer.destroy(),delete this.sphereMaskedIndexBuffer);},jd.prototype.setMask=function(t,e){if(!this.terrainData&&!h(this.mask,t)&&(this.mask=t,this.clearMask(),!h(t,{0:!0}))){var i=new tn,r=new Rn;this.segments=new To,this.segments.prepareSegment(0,i,r);var a=new en,n=new Rn;this.sphereSegments=new To,this.sphereSegments.prepareSegment(0,a,n);for(var o=Object.keys(t),s=Ya(this.projType),u=[],l=0;l<o.length;l++){var c=t[o[l]],f=io>>c.z,m=new p(c.x*f,c.y*f),d=new p(m.x+f,m.y+f),_=Math.pow(2,this.tileID.canonical.z);if(this.sphereRender){var y=2;(y=this.tileID.canonical.z<le.TILE_GRIDSAMPLES_SPLIT.SMALL?le.TILE_GRIDSAMPLES_SPLIT.SMALL_Z_SAMPLES>>c.z:this.tileID.canonical.z<le.TILE_GRIDSAMPLES_SPLIT.MIDDLE?le.TILE_GRIDSAMPLES_SPLIT.MIDDLE_Z_SAMPLES>>c.z:this.tileID.canonical.z<le.TILE_GRIDSAMPLES_SPLIT.LARGE?le.TILE_GRIDSAMPLES_SPLIT.LARGE_Z_SAMPLES>>c.z:le.TILE_GRIDSAMPLES_SPLIT.LARGE_S_Z_SAMPLES>>c.z)<le.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(y=le.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);for(var g=0;g<y;g++){var v=y*(d.y-m.y),x=this.sphereSegments.prepareSegment(2*(y+1),a,n);this._xyToECEF(u,m.x,m.y+g/v,s,_),a.emplaceBack(u[0],u[1],u[2],m.x,m.y+g/v),this._xyToECEF(u,m.x,m.y+(g+1)/v,s,_),a.emplaceBack(u[0],u[1],u[2],m.x,m.y+(g+1)/v),x.vertexLength+=2;for(var b=1;b<=y;b++){this._xyToECEF(u,m.x+b/v,m.y+g/v,s,_),a.emplaceBack(u[0],u[1],u[2],m.x+b/v,m.y+g/v),this._xyToECEF(u,m.x+b/v,m.y+(g+1)/v,s,_),a.emplaceBack(u[0],u[1],u[2],m.x+b/v,m.y+(g+1)/v);var w=x.vertexLength;n.emplaceBack(w-2,w-1,w),n.emplaceBack(w,w-1,w+1),x.vertexLength+=2,x.primitiveLength+=2;}}}else{var A=this.segments.prepareSegment(4,i,r);i.emplaceBack(m.x,m.y,m.x,m.y),i.emplaceBack(d.x,m.y,d.x,m.y),i.emplaceBack(m.x,d.y,m.x,d.y),i.emplaceBack(d.x,d.y,d.x,d.y);var T=A.vertexLength;r.emplaceBack(T,T+1,T+2),r.emplaceBack(T+1,T+2,T+3),A.vertexLength+=4,A.primitiveLength+=2;}}this.maskedBoundsBuffer=e.createVertexBuffer(i,bh.members),this.maskedIndexBuffer=e.createIndexBuffer(r),this.sphereMaskedBoundsBuffer=e.createVertexBuffer(a,pf.members),this.sphereMaskedIndexBuffer=e.createIndexBuffer(n);}},jd.prototype._xyToECEF=function(t,e,i,r,a){Gn(t,[this._xToLng(r,e,a),this._yToLat(r,i,a)],le.TRANSFORM.R);},jd.prototype._xToLng=function(t,e,i){return t.xLng(this.tileID.canonical.x+e/io,i)},jd.prototype._yToLat=function(t,e,i){return t.yLat(this.tileID.canonical.y+e/io,i)},jd.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},jd.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var i=C(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),a=!1;if(this.expirationTime>r)a=!1;else if(e)if(this.expirationTime<e)a=!0;else{var n=this.expirationTime-e;n?this.expirationTime=r+Math.max(n,le.SOURCE.CLOCK_SKEW_RETRY_TIMEOUT):a=!0;}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}},jd.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},jd.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var i=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets){var a=this.buckets[r],n=a.layers[0].sourceLayer||"_geojsonTileLayer",o=i[n],s=t[n];o&&s&&0!==Object.keys(s).length&&(a.update(s,o),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(a.layerIds[0]).queryRadius(a))));}}};var qd=function(){this.state={},this.stateChanges={};};qd.prototype.updateState=function(t,e,i){e=String(e),this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][e]=this.stateChanges[t][e]||{},v(this.stateChanges[t][e],i);},qd.prototype.getState=function(t,e){e=String(e);var i=this.state[t]||{},r=this.stateChanges[t]||{};return v({},i[e],r[e])},qd.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e);},qd.prototype.coalesceChanges=function(t,e){var i={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var a={};for(var n in this.stateChanges[r])this.state[r][n]||(this.state[r][n]={}),v(this.state[r][n],this.stateChanges[r][n]),a[n]=this.state[r][n];i[r]=a;}if(this.stateChanges={},0!==Object.keys(i).length)for(var o in t){t[o].setFeatureState(i,e);}};var Xd=function(t,e){this.max=t,this.onRemove=e,this.minLevel=0,this.reset();};Xd.prototype.setTileMinLevel=function(t){t&&(this.minLevel=t);},Xd.prototype.reset=function(){for(var t in this.data)for(var e=0,i=this.data[t];e<i.length;e+=1){var r=i[e];r.timeout&&clearTimeout(r.timeout),this.remove(t,!0);}return this.data={},this.order=[],this},Xd.prototype.add=function(t,e,i){var r=t;void 0===this.data[r]&&(this.data[r]={});var a={value:e,timeout:void 0};if(this.data[r]=a,this.order.push(r),this.order.length>this.max){var n=this.data[this.order[0]];n&&n.value.uses>0?this.max++:this.remove(this.order[0]);}return this.max++,this},Xd.prototype.has=function(t){return t in this.data},Xd.prototype.get=function(t){if(!this.has(t))return null;var e=this.order.indexOf(t);this.order.splice(e,e+1),this.order.push(t);var i=this.data[t];return i?i.value:i},Xd.prototype.remove=function(t,e){if(!this.has(t))return null;var i=t,r=this.data[i];return r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value),this.data[i]=null,delete this.data[i],e||this.order.splice(0,1),this},Xd.prototype.setMaxSize=function(t){for(t>this.max?this.max=t:this.max=Math.ceil((this.max+t)/2);this.order.length>this.max;){var e=this.data[this.order[0]];e&&e.value.uses>0?(this.max++,this.order.push(this.order[0]),this.order.splice(0,1)):this.remove(this.order[0]);}return this};var Gd=function(t){function e(e,i,r){var a=this;t.call(this),this.id=e,this.dispatcher=r,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform));}),this.on("data-remove-pk",function(t){a.removeOSGBPK(t.pk);}),this.osgbRefreshCount=0,this.on("error",function(){a._sourceErrored=!0;});var n=Pf(e,i,r,this);if(!(n instanceof Ah))throw new Error;this._source=n,this._tiles={},this._cache=new Xd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={},this._state=new qd,this.sharedTexture=new Th(this._source),this.savedTileForQueryFeatures={},this.idealTileIDs=[];}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.removeOSGBPK=function(t){for(var e=0;e<this.idealTileIDs.length;e++)if(t===this.idealTileIDs[e])return void this.idealTileIDs.splice(e,1)},e.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t);},e.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t);},e.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._cache.data){var e=this._cache.get(t);if(e&&"loaded"!==e.state&&"errored"!==e.state)return!1}return!0},e.prototype.getSource=function(){return this._source},e.prototype.pause=function(){this._paused=!0;},e.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform);}},e.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},e.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},e.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},e.prototype.serialize=function(){return this._source.serialize()},e.prototype.prepare=function(t){this._source.prepare&&this._source.prepare();for(var e=0,i=this.idealTileIDs;e<i.length;e+=1){var r=i[e],a=this._cache.get(r);a&&"data-down-finished"===a.state&&a.upload(t,this._source);}},e.prototype.getIds=function(){return[]},e.prototype.getGltfIds=function(){return Object.keys(this._cache.data)},e.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},e.prototype.hasRenderableParent=function(t){return!1},e.prototype._isIdRenderable=function(t){return this._cache.has(t)&&this._cache.get(t).hasData()&&!this._coveredTiles[t]},e.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._cache.data)this._cache.has(t)&&"errored"!==this._cache.get(t)&&this._reloadTile(t,"reloading");},e.prototype._reloadTile=function(t,e){var i=this._cache.get(t);i&&("loading"!==i.state&&(i.state=e),i.unloadVectorData());},e.prototype._tileLoaded=function(t,e,i,r){if(r)return t.state="errored",void(404!==r.status?this._source.fire(new we(r,{tile:t})):this.update(this.transform));t.timeAdded=n.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),this._source.fire(new be("data",{dataType:"source",tile:t,coord:t.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null);},e.prototype.getTile=function(t){return this.getTileByID(t)},e.prototype.getTileByID=function(t){return this._cache.get(t)},e.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},e.prototype._findLoadedChildren=function(t,e,i){return!1},e.prototype.findLoadedParentByKey=function(t,e){for(var i=e.l-this._source.tileJson.minzoom,r=i-1;r>=0;){var a=t.substr(0,t.length-2*(i-r)),n=this._cache.get(a);if(n&&"loaded"===n.state)return{pk:a,pt:n};r--;}return null},e.prototype.updateCacheSize=function(t){this._cache.setMaxSize(2*t);},e.prototype.handleWrapJump=function(t){},e.prototype._calTileBoundsMatrix=function(){this._matrix=this._modelMatrixHelpFunc(),this._cache.setTileMinLevel(this._source.tileJson.zoomRange[0]),this.boundsMatrixCalculated=!0;},e.prototype._modelMatrixHelpFunc=function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return Zn(this._source.flipYZ||this._source.tileJson.type===le.MODEL_TYPE.OSGB,this._source,t),t},e.prototype.update=function(t){if(this.transform=t,this.updateCacheSize(le.SOURCE.MAX_GLTF_TILE_COUNT),this._sourceLoaded&&!this._paused){this.boundsMatrixCalculated||this._calTileBoundsMatrix(),this._coveredTiles={};var e={children:[],middle:[],far:[],index:0};if(this.used&&this.checkCamStatusChanged(t)){e=t.covering3DTiles({zoom:this._source.tileJson.minzoom,zoomRange:this._source.tileJson.zoomRange,data:this._source.tileJson,modelType:this._source.tileJson.type,matrix:this._matrix});var i=this._updateRetainedTiles(e);this.savedTileForQueryFeatures=i;}}},e.prototype.checkCamStatusChanged=function(t){return this._source.tileJson.chdkyLen||(this._source.tileJson.chdkyLen=Object.keys(this._source.tileJson.chd).length),this.osgbRefreshCount<this._source.tileJson.chdkyLen?(this.osgbRefreshCount++,!0):this.lastCamStatus?(this.lastCamStatus.center[0]!==t.center.lng||this.lastCamStatus.center[1]!==t.center.lat||this.lastCamStatus.zoom!==t.zoom||this.lastCamStatus.pitch!==t.pitch||this.lastCamStatus.bearing!==t.bearing)&&(this.lastCamStatus={center:t.center.toArray(),zoom:t.zoom,pitch:t.pitch,bearing:t.bearing},!0):(this.lastCamStatus={center:t.center.toArray(),zoom:t.zoom,pitch:t.pitch,bearing:t.bearing},!0)},e.prototype._updateRetainedTiles=function(t){var e={};if(this.idealTileIDs=[],this._source.tileJson.type===le.MODEL_TYPE.E3DCM||this._source.tileJson.type===le.MODEL_TYPE.TDMODEL){t.children=t.children.slice(0,this._source.maxTiles);for(var i=0,r=t.children;i<r.length;i+=1){var a=r[i],n=a.key,o=this._cache.get(n);o&&"loaded"===o.state?(this.idealTileIDs.push(n),o.uses++,e[n]=o):(this.idealTileIDs.push(n),e[n]=this._addTile(n,a));}}else if(this._source.tileJson.type===le.MODEL_TYPE.OSGB)for(var s=0,u=t.children;s<u.length;s+=1){var l=u[s],p=l.key,c=this._cache.get(p);if(c&&"loaded"===c.state)this.idealTileIDs.push(p),c.uses++,e[p]=c;else{var h=this.findLoadedParentByKey(p,l),f=void 0;h&&(h.pt.uses++,this.idealTileIDs.push(h.pk),f=h.pk,e[h.pk]=h.pt),c?c&&"data-down-finished"===c.state&&this.idealTileIDs.push(p):(this.idealTileIDs.push(p),l.PK=f,e[p]=this._addTile(p,l));}}return e},e.prototype.getTileJsonChildById=function(t){var e=t.split("~")[1].length-2,i=this._source.tileJson.chd[t.substr(0,t.length-e)];for(e-=2;e>0;)i=i.chd[t.substr(0,t.length-e)],e-=2;return i},e.prototype._addTile=function(t,e){var i=this._cache.get(t);if(i)return i;var r=Boolean(i);return r||(i=new Wd(t,e,this._source.tileSize,this.map.projection,this._source.tileJson.type,this._source.modelFolder,this._source.tileJson.type,this.sharedTexture,this._source.noHighlighting),this._loadTile(i,this._tileLoaded.bind(this,i,t,i.state)),this._cache.add(t,i)),i?(i.uses++,r||this._source.fire(new be("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null},e.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout(function(){i._reloadTile(t,"expired"),delete i._timers[t];},r));},e.prototype._removeTile=function(t){var e=this._cache.get(t);e&&(e.uses--,e.uses<=0&&this._cache.remove(t,!1),this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||e.hasData()||(e.aborted=!0,this._abortTile(e),this._unloadTile(e)));},e.prototype.clearTiles=function(){this._shouldReloadOnResume=!1,this._paused=!1,this._cache.reset();},e.prototype.tilesIn=function(t,e,i){var r=[];for(var a in this.savedTileForQueryFeatures){var n=this.savedTileForQueryFeatures[a];r.push(n);}return r},e.prototype.getVisibleCoordinates=function(){var t=this;return this.getRenderableIds().map(function(e){return t._cache.data[e].value.tileID})},e.prototype.hasTransition=function(){return!1},e.prototype.setFeatureState=function(t,e,i){t=t||"_geojsonTileLayer",this._state.updateState(t,e,i);},e.prototype.getFeatureState=function(t,e){return t=t||"_geojsonTileLayer",this._state.getState(t,e)},e}(Ae);Gd.maxOverzooming=10,Gd.maxUnderzooming=3;var Wd=function(t,e,i,r,a,n,o,s,u){this.tileID=t,this.uid=w(),this.uses=0,this.tileSize=i,this.expirationTime=null,this.queryPadding=0,this.childJson=e,this.expiredRequestCount=0,this.state="loading",this.projType=r||Xa.MERCATOR,this.isRaster=a||!1,this.meshes=[],this.textures=[],this.materials=[],this.result={},this.modelFolder=n,this.modelType=o||le.MODEL_TYPE.OSGB,this.sharedTexture=s,this.identityMatrix=!0,this.noHighlighting=u||!1;};Wd.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<n.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e);},Wd.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Wd.prototype.loadVectorData=function(t,e,i){this.hasData()&&this.unloadVectorData(),this.result=t,this.state="data-down-finished";},Wd.prototype.unloadVectorData=function(){if(this.meshes){for(var t=0;t<this.meshes.length;t++){var e=this.meshes[t];e.gltfIndexBuffer.destroy(),e.gltfVertexBuffer.destroy(),e.gltfIndexBuffer=null,e.gltfVertexBuffer=null;}for(var i=0;i<this.textures.length;i++)this.sharedTexture.removeATexture(this.textures[i]);this.meshes=[];}this.result=null,this.state="unloaded";},Wd.prototype.upload=function(t,e){this._processGLBuffers(this.result,t,e);},Wd.prototype._processGLBuffers=function(t,e,i){if(t&&t.gltf){var r=t.gltf;!this.matrix&&r.nodes[r.scenes[r.scene].nodes[0]].matrix?(this.matrix=r.nodes[0].matrix,this.identityMatrix=!1):this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.samplers=r.samplers||[{magFilter:9729,minFilter:9986,wrapS:10497,wrapT:10497}],function(t,e,i,r,a){var n=[],o=[];t.animations&&t.animations.length>0&&(r.animations=[],r._hasModelAnimation=!0);for(var s=0;t.animations&&s<t.animations.length;s++){for(var u=t.animations[s],l={channels:[]},p=0;p<u.channels.length;p++){var c=u.samplers[u.channels[p].sampler],h=Object.assign({},t.bufferViews[t.accessors[c.input].bufferView]);h.count=t.accessors[c.input].count,h.type=t.accessors[c.input].type,h.componentType=t.accessors[c.input].componentType,h.byteOffset+=t.accessors[c.input].byteOffset||0;var f=Object.assign({},t.bufferViews[t.accessors[c.output].bufferView]);f.count=t.accessors[c.output].count,f.type=t.accessors[c.output].type,f.componentType=t.accessors[c.output].componentType,f.byteOffset+=t.accessors[c.output].byteOffset||0;var m=f.buffer,d=Kd(i[m],h,f);l.channels.push({count:d.input.length,node:u.channels[p].target.node,path:u.channels[p].target.path,input:d.input,output:d.output,interpolation:c.interpolation});}r.animations.push(l);}for(var _=t.scenes[0].name,y=function(s){var u=t.nodes[s],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p="",c=(u.extras,u.mesh||0),h=[],f=!0;if(u.hasOwnProperty("mesh")){if(p=u.name||"",a&&!a(new Ia(17),{properties:{name:p}}))return;u.translation&&(u.translation[0]||u.translation[1]||u.translation[2])&&(lt(l,l,u.translation),f=!1),u.rotation&&(f=!1,3===u.rotation.length?(u.rotation[0]&&(f=!1,ct(l,l,u.rotation[0]*le.TRANSFORM.DEG_TO_RAD)),u.rotation[1]&&(f=!1,ht(l,l,u.rotation[1]*le.TRANSFORM.DEG_TO_RAD)),u.rotation[2]&&(f=!1,ft(l,l,u.rotation[2]*le.TRANSFORM.DEG_TO_RAD))):4===u.rotation.length&&vt(l,l,dt([],u.rotation))),!u.scale||1===u.scale[0]&&1===u.scale[1]&&1===u.scale[2]||(pt(l,l,u.scale),f=!1),u.location&&(h=u.location);}for(var m=void 0,d=function(a){var d={},y=!!(t.meshes[c].primitives[a].targets&&t.meshes[c].primitives[a].targets.length>0),g=wc(t,c,a,d,y),v=t.meshes[c].primitives[a].indices,x=t.accessors[v],b=t.bufferViews[x.bufferView];n[b.buffer]?m=new Rc(e,i[b.buffer],g.members,!1,n[b.buffer]):(m=new Rc(e,i[b.buffer],g.members,!1),n[b.buffer]=m.getBuffer());var w=t.meshes[c].primitives[a].attributes.POSITION,A=t.accessors[w],T=A?[A.min.concat(1),A.max.concat(1)]:[],S=t.meshes[c].primitives[a].mode,E=t.meshes[c].primitives[a].material||0,P=void 0,I=(x.byteOffset?x.byteOffset:0)+(b.byteOffset?b.byteOffset:0),R=x.componentType,M=x.count;d.IB={offset:I,byteStride:2,count:M,type:R},o[b.buffer]?P=new Ic(e,i[b.buffer],void 0===S?e.gl.TRIANGLES:S,M,R,I,!1,o[b.buffer]):(P=new Ic(e,i[b.buffer],void 0===S?e.gl.TRIANGLES:S,M,R,I,!1),o[b.buffer]=P.getBuffer());var z=null;t.animations&&t.animations.length>0&&r.animations.map(function(t,e){return t.channels.map(function(t,i){return s===t.node&&(z={ani:e,cha:i}),null})}),r.meshes.push({gltfVertexBuffer:m,gltfIndexBuffer:P,matrix:l,material:E,aabb:T,location:h,identityMatrix:f,intersectOptions:{bufViewBufferIndex:b.buffer,bufferDataConfig:d,triangleData:[],placedTriangleData:[]},animation:z,isSkinModel:y,properties:{name:p,sceneName:_},userNodeData:u.extras}),t.asset.range&&(r.range=t.asset.range);},y=0;y<t.meshes[c].primitives.length;y++)d(y);},g=0;g<t.nodes.length;g++)y(g);}(r,e,t.bufferData,this,i._featureFilter),function(t,e,i){var r=t.textures,a=e.gl;if(!t.materials)return;for(var o=t.materials,s=0;s<o.length;s++){var u=o[s],l={baseColorFactor:u.pbrMetallicRoughness.baseColorFactor?u.pbrMetallicRoughness.baseColorFactor:null,baseColorTexture:{index:u.pbrMetallicRoughness.baseColorTexture?u.pbrMetallicRoughness.baseColorTexture.index:le.SOURCE.ERROR_IMG_INDEX},alphaMode:u.alphaMode||"OPAQUE",doubleSided:u.doubleSided||!1,materialParams:null,sampler:0};t.textures&&t.textures.length>0&&(l.sampler=t.textures[u.pbrMetallicRoughness.baseColorTexture?u.pbrMetallicRoughness.baseColorTexture.index:0].sampler),u.materialParams&&(l.materialParams=u.materialParams),i.materials.push(l);}if(!t.images)return;if(i instanceof Wd)for(var p=0;p<r.length;p++){var c=t.images[r[p].source].uri,h=i.modelType===le.MODEL_TYPE.OSGB?i.modelFolder+"/"+Hd(c)+"/"+c:i.modelFolder+"/"+c;c=n.resolveURL(h),i.textures[p]=t.images[r[p].source].uri,i.sharedTexture.addATexture(t.images[r[p].source].uri,c,e,i);}else for(var f=function(n){var o,s,u=t.images[r[n].source].uri;if(u.startsWith("data:image")){var l=new Image;l.onload=function(){var t=new Pc(e,l,a.RGBA,{useMipmap:!0});t.bind(a.LINEAR,a.CLAMP_TO_EDGE),i.textures[n]=t;},l.src=u;}else s=n,ye((o=i).map._transformRequest(i.modelFolder+"\\"+u,he.Image),function(t,i){if(t)o.fire(new we(t));else if(i){var r=new Pc(e,i,a.RGBA,{useMipmap:!0});r.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.textures[s]=r;}});},m=0;m<r.length;m++)f(m);}(r,e,this),i.fire(new be("data",{data:"dataContext.state = 'loaded';"}));}},Wd.prototype.queryRenderedFeatures=function(t,e,i,r,a,n){for(var o=[],s=[],u=1/0,l=0;l<this.meshes.length;l++)for(var p=this.meshes[l],c=Zd(n._source,n._source,this,p.aabb),h=0;h<c.length;h++){var f=a.intersectTriangle.apply(a,c[h].concat([!1],[[]]));if(f){for(var m=$d(this.result.bufferData[p.intersectOptions.bufViewBufferIndex],p.intersectOptions.bufferDataConfig),d=Qd(n._source,n._source,this,m),_=0;_<d.length;_++){var y=a.intersectTriangle.apply(a,d[_].concat([!1],[[]]));if(y){var g=Nt(a.origin,y);g<u&&(s=y,u=g,o[0]=this.meshes[l]);}}d=null;}f=null;}return o[0]?[{_parent:this,properties:Object.assign({},o[0].properties),intersectionPoint:s,intersectionZ:u}]:o},Wd.prototype.highlightMesh=function(t){if(this.clearPick(),!this.noHighlighting)for(var e=0;e<this.meshes.length;e++)this.meshes[e].properties.name===t.properties.name&&(this.meshes[e].highlight=!0);},Wd.prototype.clearPick=function(){for(var t=0;t<this.meshes.length;t++)this.meshes[t].highlight=!1;},Wd.prototype.querySourceFeatures=function(){},Wd.prototype.clearMask=function(){},Wd.prototype.setMask=function(t,e){},Wd.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Wd.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var i=C(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),a=!1;if(this.expirationTime>r)a=!1;else if(e)if(this.expirationTime<e)a=!0;else{var n=this.expirationTime-e;n?this.expirationTime=r+Math.max(n,le.SOURCE.CLOCK_SKEW_RETRY_TIMEOUT):a=!0;}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}},Wd.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Wd.prototype.setFeatureState=function(t,e){};var Yd=[[1,3,2],[1,4,3],[1,2,5],[2,6,5],[2,3,6],[3,7,6],[5,6,8],[8,6,7],[1,5,4],[4,5,8],[3,4,8],[3,8,7]];function Hd(t){var e=t.split("_");return e[0]+"_"+e[1]+"_"+e[2]}function Qd(t,e,i,r){var a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t.respectiveTransformation||Zn(t.tileJson&&"osgb"===t.tileJson.type,e,a),t.respectiveTransformation&&Zn(t.tileJson&&"osgb"===t.tileJson.type,i,a);var n=[],o=Kn(a);i.identityMatrix||vt(o,o,i.matrix),e.identityMatrix||vt(o,o,e.matrix);for(var s=0;s<r.length;s++)n.push([qt([],r[s][0].concat([1]),o),qt([],r[s][1].concat([1]),o),qt([],r[s][2].concat([1]),o)]);return n}function Zd(t,e,i,r){var a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t.respectiveTransformation||Zn(t.tileJson&&"osgb"===t.tileJson.type,e,a),t.respectiveTransformation&&Zn(t.tileJson&&"osgb"===t.tileJson.type,i,a);var n=Kn(a);i.identityMatrix||vt(n,n,i.matrix),e.identityMatrix||vt(n,n,e.matrix);for(var o=[[r[0][0],r[0][1],r[0][2],1],[r[0][0],r[0][1],r[1][2],1],[r[1][0],r[0][1],r[1][2],1],[r[1][0],r[0][1],r[0][2],1],[r[0][0],r[1][1],r[0][2],1],[r[0][0],r[1][1],r[1][2],1],[r[1][0],r[1][1],r[1][2],1],[r[1][0],r[1][1],r[0][2],1]],s=[],u=0;u<8;u++)s.push(qt([],o[u],n));for(var l=[],p=0;p<Yd.length;p++){var c=Yd[p];l.push([s[c[0]-1],s[c[1]-1],s[c[2]-1]]);}return l}function Jd(t,e){if(t.result&&t.result.gltf){var i=t.result.gltf;e.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.respectiveTransformation||(e.rotation&&e.rotation[0]&&(e.identityMatrix=!1,ct(e.matrix,e.matrix,e.rotation[0]*le.TRANSFORM.DEG_TO_RAD)),e.rotation&&e.rotation[1]&&(e.identityMatrix=!1,ht(e.matrix,e.matrix,e.rotation[1]*le.TRANSFORM.DEG_TO_RAD)),e.rotation&&e.rotation[2]&&(e.identityMatrix=!1,ft(e.matrix,e.matrix,e.rotation[2]*le.TRANSFORM.DEG_TO_RAD)),!e.scale||3!==e.scale.length||1===e.scale[0]&&1===e.scale[1]&&1===e.scale[2]||(e.identityMatrix=!1,pt(e.matrix,e.matrix,e.scale)),i.nodes[i.scenes[i.scene||0].nodes[0]].matrix&&(e.identityMatrix=!1,vt(e.matrix,i.nodes[0].matrix,e.matrix)));}}function Kd(t,e,i){var r,a=[];r=(r=new Float32Array(t.buffer,e.byteOffset,e.count)).slice(0);for(var n=0;n<i.count;n++)if("SCALAR"===i.type){var o=new Float32Array(t.buffer,i.byteOffset+1*n*4,1);a.push(o[0]);}else if("VEC2"===i.type){var s=new Float32Array(t.buffer,i.byteOffset+2*n*4,2);a.push(s.slice(0));}else if("VEC3"===i.type){var u=new Float32Array(t.buffer,i.byteOffset+3*n*4,3);a.push(u.slice(0));}else if("VEC4"===i.type){var l=new Float32Array(t.buffer,i.byteOffset+4*n*4,4);a.push(l.slice(0));}return{input:r,output:a}}function $d(t,e){try{var i=new DataView(t.buffer),r=e.IB,a=e.VB;if(void 0===a)return[[[0,0,0],[0,0,0],[0,0,0]]];for(var n=[],o=0;o<r.count;o+=3){var s=void 0,u=void 0,l=void 0;5121===r.type?(s=i.getUint8(r.offset+o),u=i.getUint8(r.offset+o+1),l=i.getUint8(r.offset+o+2)):5123===r.type?(s=i.getUint16(r.offset+2*o,!0),u=i.getUint16(r.offset+2*(o+1),!0),l=i.getUint16(r.offset+2*(o+2),!0)):(s=i.getUint32(r.offset+4*o,!0),u=i.getUint32(r.offset+4*(o+1),!0),l=i.getUint32(r.offset+4*(o+2),!0));var p=i.getFloat32(a.offset+s*a.byteStride,!0),c=i.getFloat32(a.offset+s*a.byteStride+4,!0),h=i.getFloat32(a.offset+s*a.byteStride+8,!0),f=i.getFloat32(a.offset+u*a.byteStride,!0),m=i.getFloat32(a.offset+u*a.byteStride+4,!0),d=i.getFloat32(a.offset+u*a.byteStride+8,!0),_=i.getFloat32(a.offset+l*a.byteStride,!0),y=i.getFloat32(a.offset+l*a.byteStride+4,!0),g=i.getFloat32(a.offset+l*a.byteStride+8,!0);n.push([[p,c,h],[f,m,d],[_,y,g]]);}return i=null,n}catch(t){return[[[0,0,0],[0,0,0],[0,0,0]]]}}var t_=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8},e_=e(function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t;};}),i_=e(function(t,e){var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},r=0;r<e.length;r++)i[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return i},r=/%[sdj%]/g;e.format=function(t){var e=arguments;if(!_(t)){for(var i=[],a=0;a<arguments.length;a++)i.push(o(e[a]));return i.join(" ")}a=1;for(var n=arguments,s=n.length,u=String(t).replace(r,function(t){if("%%"===t)return"%";if(a>=s)return t;switch(t){case"%s":return String(n[a++]);case"%d":return Number(n[a++]);case"%j":try{return JSON.stringify(n[a++])}catch(t){return"[Circular]"}default:return t}}),l=n[a];a<s;l=n[++a])m(l)||!v(l)?u+=" "+l:u+=" "+o(l);return u},e.deprecate=function(t,i){if("undefined"!=typeof process&&!0===process.noDeprecation)return t;if("undefined"==typeof process)return function(){return e.deprecate(t,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(i);process.traceDeprecation?console.trace(i):console.error(i),r=!0;}return t.apply(this,arguments)}};var a,n={};function o(t,i){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(i)?r.showHidden=i:i&&e._extend(r,i),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,t,r.depth)}function s(t,e){var i=o.styles[e];return i?"["+o.colors[i][0]+"m"+t+"["+o.colors[i][1]+"m":t}function u(t,e){return t}function l(t,i,r){if(t.customInspect&&i&&w(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var a=i.inspect(r,t);return _(a)||(a=l(t,a,r)),a}var n=function(t,e){if(y(e))return t.stylize("undefined","undefined");if(_(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(d(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,i);if(n)return n;var o=Object.keys(i),s=function(t){var e={};return t.forEach(function(t,i){e[t]=!0;}),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(i)),b(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return p(i);if(0===o.length){if(w(i)){var u=i.name?": "+i.name:"";return t.stylize("[Function"+u+"]","special")}if(g(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return t.stylize(Date.prototype.toString.call(i),"date");if(b(i))return p(i)}var v,A="",T=!1,S=["{","}"];(h(i)&&(T=!0,S=["[","]"]),w(i))&&(A=" [Function"+(i.name?": "+i.name:"")+"]");return g(i)&&(A=" "+RegExp.prototype.toString.call(i)),x(i)&&(A=" "+Date.prototype.toUTCString.call(i)),b(i)&&(A=" "+p(i)),0!==o.length||T&&0!=i.length?r<0?g(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),v=T?function(t,e,i,r,a){for(var n=[],o=0,s=e.length;o<s;++o)E(e,String(o))?n.push(c(t,e,i,r,String(o),!0)):n.push("");return a.forEach(function(a){a.match(/^\d+$/)||n.push(c(t,e,i,r,a,!0));}),n}(t,i,r,s,o):o.map(function(e){return c(t,i,r,s,e,T)}),t.seen.pop(),function(t,e,i){if(t.reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(v,A,S)):S[0]+A+S[1]}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function c(t,e,i,r,a,n){var o,s,u;if((u=Object.getOwnPropertyDescriptor(e,a)||{value:e[a]}).get?s=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(s=t.stylize("[Setter]","special")),E(r,a)||(o="["+a+"]"),s||(t.seen.indexOf(u.value)<0?(s=m(i)?l(t,u.value,null):l(t,u.value,i-1)).indexOf("\n")>-1&&(s=n?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),y(o)){if(n&&a.match(/^\d+$/))return s;(o=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"));}return o+": "+s}function h(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function d(t){return"number"==typeof t}function _(t){return"string"==typeof t}function y(t){return void 0===t}function g(t){return v(t)&&"[object RegExp]"===A(t)}function v(t){return"object"==typeof t&&null!==t}function x(t){return v(t)&&"[object Date]"===A(t)}function b(t){return v(t)&&("[object Error]"===A(t)||t instanceof Error)}function w(t){return"function"==typeof t}function A(t){return Object.prototype.toString.call(t)}function T(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(y(a)&&(a=process.env.NODE_DEBUG||""),t=t.toUpperCase(),!n[t])if(new RegExp("\\b"+t+"\\b","i").test(a)){var i=process.pid;n[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,r);};}else n[t]=function(){};return n[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=h,e.isBoolean=f,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=d,e.isString=_,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=y,e.isRegExp=g,e.isObject=v,e.isDate=x,e.isError=b,e.isFunction=w,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t_;var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,i;console.log("%s - %s",(t=new Date,i=[T(t.getHours()),T(t.getMinutes()),T(t.getSeconds())].join(":"),[t.getDate(),S[t.getMonth()],i].join(" ")),e.format.apply(e,arguments));},e.inherits=e_,e._extend=function(t,e){if(!e||!v(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function I(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i;}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(P&&t[P]){var e;if("function"!=typeof(e=t[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,r=arguments,a=new Promise(function(t,r){e=t,i=r;}),n=[],o=0;o<arguments.length;o++)n.push(r[o]);n.push(function(t,r){t?i(t):e(r);});try{t.apply(this,n);}catch(t){i(t);}return a}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),P&&Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=P,e.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=arguments,i=[],r=0;r<arguments.length;r++)i.push(e[r]);var a=i.pop();if("function"!=typeof a)throw new TypeError("The last argument must be of type Function");var n=this,o=function(){return a.apply(n,arguments)};t.apply(this,i).then(function(t){process.nextTick(o,null,t);},function(t){process.nextTick(I,t,o);});}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),Object.defineProperties(e,i(t)),e};}),r_=(i_.format,i_.deprecate,i_.debuglog,i_.inspect,i_.isArray),a_=(i_.isBoolean,i_.isNull,i_.isNullOrUndefined,i_.isNumber,i_.isString,i_.isSymbol,i_.isUndefined,i_.isRegExp,i_.isObject,i_.isDate,i_.isError,i_.isFunction,i_.isPrimitive,i_.isBuffer,i_.log,i_.inherits,i_._extend,i_.promisify,i_.callbackify,function(t){function e(e){if(t.call(this,e,pc),this.baseMatrixCalculated=!1,this.useLayerPosition=!1,this.respectiveTransformation=!1,this.boolAABBCalculated=!1,this.identityMatrix=!0,this.highLightColorsIndex=0,this.matrix=[],e.translation&&(this.translation=e.translation,this.useLayerPosition=!0),e.rotation&&(this.rotation=e.rotation,this.useLayerPosition=!0),e.scale&&(this.scale=e.scale,this.useLayerPosition=!0),e.location)this.location=e.location,this.useLayerPosition=!0;else if(this.useLayerPosition)throw new Error("3d_model_style_layer,constructor(): 不允许图层在未设置经纬度参考点的情况下，设置其他的空间变换参数，即一旦想要进行按照layer图层进行空间变化，那么position是必须的");if(r_(e.highLightColors)){this.highLightColors=[];for(var i=0,r=e.highLightColors;i<r.length;i+=1){var a=r[i];this.highLightColors.push(We.parse(a));}}"number"!=typeof e.highLightColorsIndex||isNaN(e.highLightColorsIndex)||(this.highLightColorsIndex=e.highLightColorsIndex),this.nodes=[],this.meshes=[],this.primitives=[],this.isSpecialLight=e.isSpecialLight,this.specialLights=null,this.isSpecialLight&&this.setSpecialLights(e.specialLights),e.hasOwnProperty("viewshed-render")?this.viewshedRender=!!e["viewshed-render"]:this.viewshedRender=!0;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.calcBaseMatrix=function(t,e){if(!this.baseMatrixCalculated||e){Jd(t,this);for(var i=0;i<t.nodes.length;i++)this.nodes.push(t.nodes[i]);this.baseMatrixCalculated=!0;}},e.prototype.queryLayerRenderedFeatures=function(t,e,i,r,a,n){var o=n.getSource();this.clearPick();for(var s=[],u=1/0,l=[],p=0;p<this.nodes.length;p++){var c=this.nodes[p],h=o.meshes[this.nodes[p].mesh];if(c.primitiveStack)for(var f=0;f<h.primitivesInd.length;f++){for(var m=o.primitives[h.primitivesInd[f]],d=Zd(o,this,c,m.aabb),_=0;_<d.length;_++){if(a.intersectTriangle.apply(a,d[_].concat([!1],[[]]))){for(var y=Qd(o,this,c,$d(o.gltfParser.bufferData[m.intersectOptions.bufViewBufferIndex],m.intersectOptions.bufferDataConfig)),g=0;g<y.length;g++){var v=a.intersectTriangle.apply(a,y[g].concat([!1],[[]]));if(v){var x=Nt(a.origin,v);x<u&&(l=v,u=x,s[0]=c.primitiveStack[f]);}}y=null;}}d=null;}}return s[0]?[{_parent:this,primitiveData:s[0],intersectionZ:u,intersectionPoint:l,layer:this.id}]:s},e.prototype.clearPick=function(t){for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e];if(i.primitiveStack)for(var r=0;r<i.primitiveStack.length;r++){i.primitiveStack[r].highlight=!1;}}t&&t.fire(new be("data",{}));},e.prototype.highlightMesh=function(t){this.clearPick();for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e];if(i.primitiveStack)for(var r=0;r<i.primitiveStack.length;r++){var a=i.primitiveStack[r];a.primitiveDataInd===t.primitiveData.primitiveDataInd&&(a.highlight=!0);}}},e.prototype.setSpecialLights=function(t){this.specialLights=[];for(var e=0;e<t.length;e++){var i=t[e],r=Gn([],i.position,le.TRANSFORM.R+(i.position[2]||0)*le.TRANSFORM.R_SCALE),a=Gn([],i.direction,le.TRANSFORM.R+(i.direction[2]||0)*le.TRANSFORM.R_SCALE),n=[r[0]-a[0],r[1]-a[1],r[2]-a[2]];i.position=r,i.direction=n,this.specialLights.push(i);}},e.prototype.setHighlightIndex=function(t){"number"!=typeof t||isNaN(t)||(this.highLightColorsIndex=t);},e}(wo)),n_={paint:new Ua({"3d-tile-opacity":new Na(Te["paint_3d-tile"]["3d-tile-opacity"])})},o_=function(t){function e(e){t.call(this,e,n_),e.hasOwnProperty("viewshed-render")?this.viewshedRender=!!e["viewshed-render"]:this.viewshedRender=!0,e.hasOwnProperty("cvtBGR2RGB")?this.cvtBGR2RGB=!!e.cvtBGR2RGB:this.cvtBGR2RGB=!1;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wo),s_=Ja([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"},{name:"a_i_p_e",components:2,type:"Uint16"}],4).members,u_=Uu.VectorTileFeature.types,l_=63,p_=Math.cos(Math.PI/180*37.5),c_=.5,h_=Math.pow(2,14)/c_,f_=0,m_=0,d_=1,__=0;function y_(t,e,i,r,a,n,o){t.emplaceBack(e.x,e.y,r?1:0,a?1:-1,Math.round(l_*i.x)+128,Math.round(l_*i.y)+128,1+(0===n?0:n<0?-1:1)|(o*c_&63)<<2,o*c_>>6,255&f_,parseInt(m_),parseInt(d_),parseInt(0===e.z?0:e.z-500<6?6:e.z-500+6),parseInt(__));}var g_=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new un,this.indexArray=new Rn,this.programConfigurations=new zo(s_,t.layers,t.zoom),this.segments=new To;};g_.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},g_.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},g_.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},g_.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},g_.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,s_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},g_.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},g_.prototype.addFeature=function(t,e,i){var r=this.layers[0].layout,a=r.get("sprite-join").evaluate(t,{}),n=r.get("sprite-cap"),o=r.get("sprite-miter-limit"),s=r.get("sprite-round-limit");m_=t.properties.link_seq?Number(t.properties.link_seq):m_,m_%=10,d_=Number(t.properties.status)||1,__=100*Number(t.properties.link_seq)/Number(t.properties.total)||1;for(var u=0,l=e;u<l.length;u+=1){var p=l[u];this.addLine(p,t,a,n,o,s,i);}},g_.prototype.addLine=function(t,e,i,r,a,n,o){for(var s="Polygon"===u_[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===i&&(a=1.05);var p=io/(512*this.overscaling)*15,c=t[l],h=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);this.distance=0;var f,m,d,_=r,y=s?"butt":r,g=!0,v=void 0,x=void 0,b=void 0,w=void 0;this.e1=this.e2=this.e3=-1,s&&(f=t[u-2],w=c.sub(f)._unit()._perp());for(var A=l;A<u;A++)if(f_=Math.round(255/u*A),!(x=s&&A===u-1?t[l+1]:t[A+1])||!t[A].equals(x)){w&&(b=w),f&&(v=f),f=t[A],w=x?x.sub(f)._unit()._perp():b;var T=(b=b||w).add(w);0===T.x&&0===T.y||T._unit();var S=T.x*w.x+T.y*w.y,E=0!==S?1/S:1/0,P=S<p_&&v&&x;if(P&&A>l){var I=f.dist(v);if(I>2*p){var R=f.sub(f.sub(v)._mult(p/I)._round());this.distance+=R.dist(v),this.addCurrentVertex(R,this.distance,b.mult(1),0,0,!1,h),v=R;}}var M=v&&x,z=M?i:x?_:y;if(M&&"round"===z&&(E<n?z="miter":E<=2&&(z="fakeround")),"miter"===z&&E>a&&(z="bevel"),"bevel"===z&&(E>2&&(z="flipbevel"),E<a&&(z="miter")),v&&(this.distance+=f.dist(v)),"miter"===z)T._mult(E),this.addCurrentVertex(f,this.distance,T,0,0,!1,h);else if("flipbevel"===z){if(E>100)T=w.clone().mult(-1);else{var C=b.x*w.y-b.y*w.x>0?-1:1,O=E*b.add(w).mag()/b.sub(w).mag();T._perp()._mult(O*C);}this.addCurrentVertex(f,this.distance,T,0,0,!1,h),this.addCurrentVertex(f,this.distance,T.mult(-1),0,0,!1,h);}else if("bevel"===z||"fakeround"===z){var F=b.x*w.y-b.y*w.x>0,L=-Math.sqrt(E*E-1);if(F?(d=0,m=L):(m=0,d=L),g||this.addCurrentVertex(f,this.distance,b,m,d,!1,h),"fakeround"===z){for(var D=Math.floor(8*(.5-(S-.5))),N=void 0,k=0;k<D;k++)N=w.mult((k+1)/(D+1))._add(b)._unit(),this.addPieSliceVertex(f,this.distance,N,F,h);this.addPieSliceVertex(f,this.distance,T,F,h);for(var B=D-1;B>=0;B--)N=b.mult((B+1)/(D+1))._add(w)._unit(),this.addPieSliceVertex(f,this.distance,N,F,h);}x&&this.addCurrentVertex(f,this.distance,w,-m,-d,!1,h);}else"butt"===z?(g||this.addCurrentVertex(f,this.distance,b,0,0,!1,h),x&&this.addCurrentVertex(f,this.distance,w,0,0,!1,h)):"square"===z?(g||(this.addCurrentVertex(f,this.distance,b,1,1,!1,h),this.e1=this.e2=-1),x&&this.addCurrentVertex(f,this.distance,w,-1,-1,!1,h)):"round"===z&&(g||(this.addCurrentVertex(f,this.distance,b,0,0,!1,h),this.addCurrentVertex(f,this.distance,b,1,1,!0,h),this.e1=this.e2=-1),x&&(this.addCurrentVertex(f,this.distance,w,-1,-1,!0,h),this.addCurrentVertex(f,this.distance,w,0,0,!1,h)));if(P&&A<u-1){var V=f.dist(x);if(V>2*p){var U=f.add(x.sub(f)._mult(p/V)._round());this.distance+=U.dist(f),this.addCurrentVertex(U,this.distance,w.mult(1),0,0,!1,h),f=U;}}g=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},g_.prototype.addCurrentVertex=function(t,e,i,r,a,n,o){var s,u=this.layoutVertexArray,l=this.indexArray;s=i.clone(),r&&s._sub(i.perp()._mult(r)),y_(u,t,s,n,!1,r,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=i.mult(-1),a&&s._sub(i.perp()._mult(a)),y_(u,t,s,n,!0,-a,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>h_/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,a,n,o));},g_.prototype.addPieSliceVertex=function(t,e,i,r,a){i=i.mult(r?-1:1);var n=this.layoutVertexArray,o=this.indexArray;y_(n,t,i,!1,r,0,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;},ca("SpriteBucket",g_,{omit:["layers"]});var v_=new Ua({"sprite-cap":new Na(Te.layout_sprite["sprite-cap"]),"sprite-join":new ka(Te.layout_sprite["sprite-join"]),"sprite-miter-limit":new Na(Te.layout_sprite["sprite-miter-limit"]),"sprite-round-limit":new Na(Te.layout_sprite["sprite-round-limit"])}),x_={paint:new Ua({"sprite-opacity":new ka(Te.paint_sprite["sprite-opacity"]),"sprite-color":new ka(Te.paint_sprite["sprite-color"]),"sprite-translate":new Na(Te.paint_sprite["sprite-translate"]),"sprite-translate-anchor":new Na(Te.paint_sprite["sprite-translate-anchor"]),"sprite-width":new ka(Te.paint_sprite["sprite-width"]),"sprite-gap-width":new ka(Te.paint_sprite["sprite-gap-width"]),"sprite-offset":new ka(Te.paint_sprite["sprite-offset"]),"sprite-blur":new ka(Te.paint_sprite["sprite-blur"]),"sprite-speed-factor":new Na(Te.paint_sprite["sprite-speed-factor"]),"render-3d":new Na(Te.paint_sprite["render-3d"]),"sprite-interpolate":new Na(Te.paint_sprite["sprite-interpolate"]),"sprite-status":new ka(Te.paint_sprite["sprite-status"]),"sprite-instatus":new ka(Te.paint_sprite["sprite-instatus"]),"sprite-height-offset":new Na(Te.paint_sprite["sprite-height-offset"])}),layout:v_},b_=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new Ia(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r,a){return i=v({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r,a)},e}(ka))(x_.paint.properties["sprite-width"].specification);b_.useIntegerZoom=!0;var w_=function(t){function e(e){t.call(this,e,x_);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["sprite-floorwidth"]=b_.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,e);},e.prototype.createBucket=function(t){return new g_(t)},e.prototype.queryRadius=function(t){var e=t,i=A_(Zo("sprite-width",this,e),Zo("sprite-gap-width",this,e)),r=Zo("sprite-offset",this,e);return i/2+Math.abs(r)+Jo(this.paint.get("sprite-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){var s=Ko(t,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),n.angle,o),u=o/2*A_(this.paint.get("sprite-width").evaluate(e,i),this.paint.get("sprite-gap-width").evaluate(e,i)),l=this.paint.get("sprite-offset").evaluate(e,i);return l&&(r=function(t,e){for(var i=[],r=new p(0,0),a=0;a<t.length;a++){for(var n=t[a],o=[],s=0;s<n.length;s++){var u=n[s-1],l=n[s],c=n[s+1],h=0===s?r:l.sub(u)._unit()._perp(),f=s===n.length-1?r:c.sub(l)._unit()._perp(),m=h._add(f)._unit(),d=m.x*f.x+m.y*f.y;m._mult(1/d),o.push(m._mult(e)._add(l));}i.push(o);}return i}(r,l*o)),Uo(s,r,u)},e}(wo);function A_(t,e){return e>0?e+2*t:t}var T_=Ja([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"}],4).members,S_=Uu.VectorTileFeature.types,E_=63,P_=Math.cos(Math.PI/180*37.5),I_=.5,R_=Math.pow(2,14)/I_,M_=0,z_=0,C_=1;function O_(t,e,i,r,a,n,o){t.emplaceBack(e.x,e.y,e.z,r?1:0,a?1:-1,Math.round(E_*i.x)+128,Math.round(E_*i.y)+128,1+(0===n?0:n<0?-1:1)|(o*I_&63)<<2,o*I_>>6,255&M_,parseInt(z_),parseInt(C_));}var F_=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new hn,this.indexArray=new Rn,this.programConfigurations=new zo(T_,t.layers,t.zoom),this.segments=new To;};F_.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.projType=e.projType,this.tilePlane=Qn(this.x,this.y,this.z,e.projType||Xa.MERCATOR));for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index);}}},F_.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},F_.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},F_.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},F_.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,T_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},F_.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},F_.prototype.addFeature=function(t,e,i){var r=this.layers[0].layout,a=r.get("sprite-join").evaluate(t,{}),n=r.get("sprite-cap"),o=r.get("sprite-miter-limit"),s=r.get("sprite-round-limit");z_=t.properties.link_seq?Number(t.properties.link_seq):z_,z_%=10,C_=Number(t.properties.status)||1,100*Number(t.properties.link_seq)/Number(t.properties.total)||1;for(var u=0,l=e;u<l.length;u+=1){var p=l[u];this.addLine(p,t,a,n,o,s,i);}},F_.prototype.addLine=function(t,e,i,r,a,n,o){for(var s="Polygon"===S_[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===i&&(a=1.05);var p=io/(512*this.overscaling)*15,c=t[l],h=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);this.distance=0;var f,m,d,_=r,y=s?"butt":r,g=!0,v=void 0,x=void 0,b=void 0,w=void 0;this.e1=this.e2=this.e3=-1,s&&(f=t[u-2],w=c.sub(f)._unit()._perp());for(var A=l;A<u;A++)if(M_=Math.round(255/u*A),!(x=s&&A===u-1?t[l+1]:t[A+1])||!t[A].equals(x)){w&&(b=w),f&&(v=f),f=t[A],w=x?x.sub(f)._unit()._perp():b;var T=(b=b||w).add(w);0===T.x&&0===T.y||T._unit();var S=T.x*w.x+T.y*w.y,E=0!==S?1/S:1/0,P=S<P_&&v&&x;if(P&&A>l){var I=f.dist(v);if(I>2*p){var R=f.sub(f.sub(v)._mult(p/I)._round());this.distance+=R.dist(v),this.addCurrentVertex(R,this.distance,b.mult(1),0,0,!1,h),v=R;}}var M=v&&x,z=M?i:x?_:y;if(M&&"round"===z&&(E<n?z="miter":E<=2&&(z="fakeround")),"miter"===z&&E>a&&(z="bevel"),"bevel"===z&&(E>2&&(z="flipbevel"),E<a&&(z="miter")),v&&(this.distance+=f.dist(v)),"miter"===z)T._mult(E),this.addCurrentVertex(f,this.distance,T,0,0,!1,h);else if("flipbevel"===z){if(E>100)T=w.clone().mult(-1);else{var C=b.x*w.y-b.y*w.x>0?-1:1,O=E*b.add(w).mag()/b.sub(w).mag();T._perp()._mult(O*C);}this.addCurrentVertex(f,this.distance,T,0,0,!1,h),this.addCurrentVertex(f,this.distance,T.mult(-1),0,0,!1,h);}else if("bevel"===z||"fakeround"===z){var F=b.x*w.y-b.y*w.x>0,L=-Math.sqrt(E*E-1);if(F?(d=0,m=L):(m=0,d=L),g||this.addCurrentVertex(f,this.distance,b,m,d,!1,h),"fakeround"===z){for(var D=Math.floor(8*(.5-(S-.5))),N=void 0,k=0;k<D;k++)N=w.mult((k+1)/(D+1))._add(b)._unit(),this.addPieSliceVertex(f,this.distance,N,F,h);this.addPieSliceVertex(f,this.distance,T,F,h);for(var B=D-1;B>=0;B--)N=b.mult((B+1)/(D+1))._add(w)._unit(),this.addPieSliceVertex(f,this.distance,N,F,h);}x&&this.addCurrentVertex(f,this.distance,w,-m,-d,!1,h);}else"butt"===z?(g||this.addCurrentVertex(f,this.distance,b,0,0,!1,h),x&&this.addCurrentVertex(f,this.distance,w,0,0,!1,h)):"square"===z?(g||(this.addCurrentVertex(f,this.distance,b,1,1,!1,h),this.e1=this.e2=-1),x&&this.addCurrentVertex(f,this.distance,w,-1,-1,!1,h)):"round"===z&&(g||(this.addCurrentVertex(f,this.distance,b,0,0,!1,h),this.addCurrentVertex(f,this.distance,b,1,1,!0,h),this.e1=this.e2=-1),x&&(this.addCurrentVertex(f,this.distance,w,-1,-1,!0,h),this.addCurrentVertex(f,this.distance,w,0,0,!1,h)));if(P&&A<u-1){var V=f.dist(x);if(V>2*p){var U=f.add(x.sub(f)._mult(p/V)._round());this.distance+=U.dist(f),this.addCurrentVertex(U,this.distance,w.mult(1),0,0,!1,h),f=U;}}g=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},F_.prototype.calcTDSpacePoint=function(t){var e=Gn([],Hn(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projType),le.TRANSFORM.R);return new p(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])},F_.prototype.addCurrentVertex=function(t,e,i,r,a,n,o){var s,u=this.layoutVertexArray,l=this.indexArray;s=i.clone(),r&&s._sub(i.perp()._mult(r));var p=this.calcTDSpacePoint(t);O_(u,p,s,n,!1,r,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=i.mult(-1),a&&s._sub(i.perp()._mult(a)),O_(u,p,s,n,!0,-a,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>R_/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,a,n,o));},F_.prototype.addPieSliceVertex=function(t,e,i,r,a){i=i.mult(r?-1:1);var n=this.layoutVertexArray,o=this.indexArray;O_(n,this.calcTDSpacePoint(t),i,!1,r,0,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;},ca("SphereSpriteBucket",F_,{omit:["layers"]});var L_=new Ua({"sprite-cap":new Na(Te["layout_sphere-sprite"]["sprite-cap"]),"sprite-join":new ka(Te["layout_sphere-sprite"]["sprite-join"]),"sprite-miter-limit":new Na(Te["layout_sphere-sprite"]["sprite-miter-limit"]),"sprite-round-limit":new Na(Te["layout_sphere-sprite"]["sprite-round-limit"])}),D_={paint:new Ua({"sprite-opacity":new ka(Te["paint_sphere-sprite"]["sprite-opacity"]),"sprite-color":new ka(Te["paint_sphere-sprite"]["sprite-color"]),"sprite-translate":new Na(Te["paint_sphere-sprite"]["sprite-translate"]),"sprite-translate-anchor":new Na(Te["paint_sphere-sprite"]["sprite-translate-anchor"]),"sprite-width":new ka(Te["paint_sphere-sprite"]["sprite-width"]),"sprite-gap-width":new ka(Te["paint_sphere-sprite"]["sprite-gap-width"]),"sprite-offset":new ka(Te["paint_sphere-sprite"]["sprite-offset"]),"sprite-blur":new ka(Te["paint_sphere-sprite"]["sprite-blur"]),"sprite-speed-factor":new Na(Te["paint_sphere-sprite"]["sprite-speed-factor"]),"sprite-interpolate":new Na(Te["paint_sphere-sprite"]["sprite-interpolate"]),"sprite-status":new ka(Te["paint_sphere-sprite"]["sprite-status"]),"sprite-instatus":new ka(Te["paint_sphere-sprite"]["sprite-instatus"]),"sprite-height-offset":new Na(Te["paint_sphere-sprite"]["sprite-height-offset"])}),layout:L_},N_=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new Ia(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r,a){return i=v({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r,a)},e}(ka))(D_.paint.properties["sprite-width"].specification);N_.useIntegerZoom=!0;var k_=function(t){function e(e){t.call(this,e,D_);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["sprite-floorwidth"]=N_.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,e);},e.prototype.createBucket=function(t){return new F_(t)},e.prototype.queryRadius=function(t){var e=t,i=B_(Zo("sprite-width",this,e),Zo("sprite-gap-width",this,e)),r=Zo("sprite-offset",this,e);return i/2+Math.abs(r)+Jo(this.paint.get("sprite-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o){var s=Ko(t,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),n.angle,o),u=o/2*B_(this.paint.get("sprite-width").evaluate(e,i),this.paint.get("sprite-gap-width").evaluate(e,i)),l=this.paint.get("sprite-offset").evaluate(e,i);return l&&(r=function(t,e){for(var i=[],r=new p(0,0),a=0;a<t.length;a++){for(var n=t[a],o=[],s=0;s<n.length;s++){var u=n[s-1],l=n[s],c=n[s+1],h=0===s?r:l.sub(u)._unit()._perp(),f=s===n.length-1?r:c.sub(l)._unit()._perp(),m=h._add(f)._unit(),d=m.x*f.x+m.y*f.y;m._mult(1/d),o.push(m._mult(e)._add(l));}i.push(o);}return i}(r,l*o)),Uo(s,r,u)},e}(wo);function B_(t,e){return e>0?e+2*t:t}var V_=function(t){function e(e){t.call(this,e,Xm);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));},e.prototype.getValueAndResolveTokens=function(t,e){var i=this.layout.get(t).evaluate(e,{}),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||yr(r.value)?i:wl(e.properties,i)},e.prototype.createBucket=function(t){return new lf(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(wo),U_=Ja([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,j_=Math.pow(2,13);function q_(t,e,i,r,a,n,o,s){t.emplaceBack(e,i,2*Math.floor(r*j_)+o,a*j_*2,n*j_*2,Math.round(s));}var X_=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new ln,this.indexArray=new Rn,this.programConfigurations=new zo(U_,t.layers,t.zoom),this.segments=new To;};function G_(t,e){return t.x===e.x&&(t.x<0||t.x>io)||t.y===e.y&&(t.y<0||t.y>io)}function W_(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>io})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>io})}X_.prototype.populate=function(t,e){for(var i=0,r=t;i<r.length;i+=1){var a=r[i],n=a.feature,o=a.index,s=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ia(this.zoom),n)){var u=Lo(n);this.addFeature(n,u,o),e.featureIndex.insert(n,u,o,s,this.index,!0);}}},X_.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},X_.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},X_.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},X_.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,U_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},X_.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},X_.prototype.addFeature=function(t,e,i){for(var r=0,a=yu(e,500);r<a.length;r+=1){for(var n=a[r],o=0,s=0,u=n;s<u.length;s+=1){o+=u[s].length;}for(var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,c=n;p<c.length;p+=1){var h=c[p];if(0!==h.length&&!W_(h))for(var f=0,m=0;m<h.length;m++){var d=h[m];if(m>=1){var _=h[m-1];if(!G_(d,_)){l.vertexLength+4>To.MAX_VERTEX_ARRAY_LENGTH&&(l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=d.sub(_)._perp()._unit(),g=_.dist(d);f+g>32768&&(f=0),q_(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,f),q_(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,f),f+=g,q_(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,0,f),q_(this.layoutVertexArray,_.x,_.y,y.x,y.y,0,1,f);var v=l.vertexLength;this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v+1,v+2,v+3),l.vertexLength+=4,l.primitiveLength+=2;}}}}l.vertexLength+o>To.MAX_VERTEX_ARRAY_LENGTH&&(l=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray));for(var x=[],b=[],w=l.vertexLength,A=0,T=n;A<T.length;A+=1){var S=T[A];if(0!==S.length){S!==n[0]&&b.push(x.length/2);for(var E=0;E<S.length;E++){var P=S[E];q_(this.layoutVertexArray,P.x,P.y,0,0,1,1,0),x.push(P.x),x.push(P.y);}}}for(var I=js(x,b),R=0;R<I.length;R+=3)this.indexArray.emplaceBack(w+I[R],w+I[R+1],w+I[R+2]);l.primitiveLength+=I.length/3,l.vertexLength+=o;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i);},ca("HistogramBucket",X_,{omit:["layers"]});var Y_=new Ua({"histogram-color-render":new Na(Te.layout_histogram["histogram-color-render"]),"histogram-max-height-render":new Na(Te.layout_histogram["histogram-max-height-render"])}),H_={paint:new Ua({"histogram-opacity":new Na(Te.paint_histogram["histogram-opacity"]),"histogram-color":new ka(Te.paint_histogram["histogram-color"]),"histogram-translate":new Na(Te.paint_histogram["histogram-translate"]),"histogram-translate-anchor":new Na(Te.paint_histogram["histogram-translate-anchor"]),"histogram-pattern":new Ba(Te.paint_histogram["histogram-pattern"]),"histogram-height":new ka(Te.paint_histogram["histogram-height"]),"histogram-base":new ka(Te.paint_histogram["histogram-base"]),"histogram-dynamic":new Na(Te.paint_histogram["histogram-dynamic"]),"histogram-heightArr1":new ka(Te.paint_histogram["histogram-heightArr1"]),"histogram-heightArr2":new ka(Te.paint_histogram["histogram-heightArr2"]),"histogram-heightArr3":new ka(Te.paint_histogram["histogram-heightArr3"]),"histogram-time":new Na(Te.paint_histogram["histogram-time"]),"histogram-count":new Na(Te.paint_histogram["histogram-count"]),"histogram-colors":new Na(Te.paint_histogram["histogram-colors"]),"histogram-max-height":new Na(Te.paint_histogram["histogram-max-height"]),"histogram-fluorescent":new Na(Te.paint_histogram["histogram-fluorescent"])}),layout:Y_},Q_=function(t){function e(e){t.call(this,e,H_);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new X_(t)},e.prototype.queryRadius=function(){return Jo(this.paint.get("histogram-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,a,n,o,s){var u=Ko(t,this.paint.get("histogram-translate"),this.paint.get("histogram-translate-anchor"),n.angle,o),l=this.paint.get("histogram-height").evaluate(e,i),c=this.paint.get("histogram-base").evaluate(e,i),h=function(t,e,i,r){for(var a=[],n=0,o=t;n<o.length;n+=1){var s=o[n],u=[s.x,s.y,r,1];qt(u,u,e),a.push(new p(u[0]/u[3],u[1]/u[3]));}return a}(u,s,0,0),f=function(t,e,i,r){for(var a=[],n=[],o=r[8]*e,s=r[9]*e,u=r[10]*e,l=r[11]*e,c=r[8]*i,h=r[9]*i,f=r[10]*i,m=r[11]*i,d=0,_=t;d<_.length;d+=1){for(var y=_[d],g=[],v=[],x=0,b=y;x<b.length;x+=1){var w=b[x],A=w.x,T=w.y,S=r[0]*A+r[4]*T+r[12],E=r[1]*A+r[5]*T+r[13],P=r[2]*A+r[6]*T+r[14],I=r[3]*A+r[7]*T+r[15],R=S+o,M=E+s,z=P+u,C=I+l,O=S+c,F=E+h,L=P+f,D=I+m,N=new p(R/C,M/C);N.z=z/C,g.push(N);var k=new p(O/D,F/D);k.z=L/D,v.push(k);}a.push(g),n.push(v);}return[a,n]}(r,c,l,s);return function(t,e,i){var r=1/0;Vo(i,e)&&(r=J_(i,e[0]));for(var a=0;a<e.length;a++)for(var n=e[a],o=t[a],s=0;s<n.length-1;s++){var u=n[s],l=n[s+1],p=o[s],c=o[s+1],h=[u,l,c,p,u];ko(i,h)&&(r=Math.min(r,J_(i,h)));}return r!==1/0&&r}(f[0],f[1],h)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("histogram-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){var t;(t=this)&&t.viewportFrame&&(t.viewportFrame.destroy(),t.viewportFrame=null);},e}(wo);function Z_(t,e){return t.x*e.x+t.y*e.y}function J_(t,e){if(1===t.length){var i=e[0],r=e[1],a=e[3],n=t[0],o=r.sub(i),s=a.sub(i),u=n.sub(i),l=Z_(o,o),p=Z_(o,s),c=Z_(s,s),h=Z_(u,o),f=Z_(u,s),m=l*c-p*p,d=(c*h-p*f)/m,_=(l*f-p*h)/m,y=1-d-_;return i.z*y+r.z*d+a.z*_}for(var g=1/0,v=0,x=e;v<x.length;v+=1){var b=x[v];g=Math.min(g,b.z);}return g}var K_={paint:new Ua({"3d-point-cloud-mode":new Na(Te["paint_3d-point-cloud"]["3d-point-cloud-mode"]),"3d-point-cloud-size":new Na(Te["paint_3d-point-cloud"]["3d-point-cloud-size"]),"3d-point-cloud-opacity":new Na(Te["paint_3d-point-cloud"]["3d-point-cloud-opacity"])})},$_=function(t){function e(e){t.call(this,e,K_);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wo),ty=function(t){function e(e){t.call(this,e,{}),this.id=e.id,this.type=e.type,this.anchor=e.anchor,this.renderingMode=e.renderingMode,this.implementation=e;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender||"3d"===this.implementation.renderingMode},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl);},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t);},e}(wo),ey={paint:new Ua({"panorama-opacity":new Na(Te.paint_panorama["panorama-opacity"])})},iy={circle:Ps,heatmap:ks,hillshade:Vs,fill:bu,extrusion:Ru,line:el,symbol:Sl,background:Pl,raster:zl,tracking:ql,"sphere-raster":Wl,"sphere-fill":Zl,"sphere-line":lp,"sphere-circle":mp,"sphere-heatmap":xp,"sphere-symbol":Lp,"sphere-extrusion":Zp,"sphere-sprite":k_,"sphere-background":Rl,"sphere-tracking":uc,sprite:w_,symtracking:V_,histogram:Q_,"3d-model":a_,"3d-tile":o_,"3d-point-cloud":$_,panorama:function(t){function e(e){t.call(this,e,ey);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wo)};function ry(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;}function ay(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i;}ry.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,r,a,n,o=[],s=0;s<t.length;s++)if(i=t[s].w||t[s].width,r=t[s].h||t[s].height,a=t[s].id,i&&r){if(!(n=this.packOne(i,r,a)))continue;e.inPlace&&(t[s].x=n.x,t[s].y=n.y,t[s].id=n.id),o.push(n);}return this.shrink(),o},ry.prototype.packOne=function(t,e,i){var r,a,n,o,s,u,l,p,c={freebin:-1,shelf:-1,waste:1/0},h=0;if("string"==typeof i||"number"==typeof i){if(r=this.getBin(i))return this.ref(r),r;"number"==typeof i&&(this.maxId=Math.max(i,this.maxId));}else i=++this.maxId;for(o=0;o<this.freebins.length;o++){if(e===(r=this.freebins[o]).maxh&&t===r.maxw)return this.allocFreebin(o,t,e,i);e>r.maxh||t>r.maxw||e<=r.maxh&&t<=r.maxw&&(n=r.maxw*r.maxh-t*e)<c.waste&&(c.waste=n,c.freebin=o);}for(o=0;o<this.shelves.length;o++)if(h+=(a=this.shelves[o]).h,!(t>a.free)){if(e===a.h)return this.allocShelf(o,t,e,i);e>a.h||e<a.h&&(n=(a.h-e)*t)<c.waste&&(c.freebin=-1,c.waste=n,c.shelf=o);}return-1!==c.freebin?this.allocFreebin(c.freebin,t,e,i):-1!==c.shelf?this.allocShelf(c.shelf,t,e,i):e<=this.h-h&&t<=this.w?(a=new ay(h,this.w,e),this.allocShelf(this.shelves.push(a)-1,t,e,i)):this.autoResize?(s=u=this.h,((l=p=this.w)<=s||t>l)&&(p=2*Math.max(t,l)),(s<l||e>s)&&(u=2*Math.max(e,s)),this.resize(p,u),this.packOne(t,e,i)):null},ry.prototype.allocFreebin=function(t,e,i,r){var a=this.freebins.splice(t,1)[0];return a.id=r,a.w=e,a.h=i,a.refcount=0,this.bins[r]=a,this.ref(a),a},ry.prototype.allocShelf=function(t,e,i,r){var a=this.shelves[t].alloc(e,i,r);return this.bins[r]=a,this.ref(a),a},ry.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,i=0;i<this.shelves.length;i++){var r=this.shelves[i];e+=r.h,t=Math.max(r.w-r.free,t);}this.resize(t,e);}},ry.prototype.getBin=function(t){return this.bins[t]},ry.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e]);}return t.refcount},ry.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},ry.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;},ry.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},ay.prototype.alloc=function(t,e,i){if(t>this.free||e>this.h)return null;var r=this.x;return this.x+=t,this.free-=t,new function(t,e,i,r,a,n,o){this.id=t,this.x=e,this.y=i,this.w=r,this.h=a,this.maxw=n||r,this.maxh=o||a,this.refcount=0;}(i,r,this.y,t,e,t,this.h)},ay.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};var ny=function(t,e){var i=e.pixelRatio;this.paddedRect=t,this.pixelRatio=i;},oy={tl:{configurable:!0},br:{configurable:!0},displaySize:{configurable:!0}};oy.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},oy.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},oy.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ny.prototype,oy);var sy=function(t){var e=new Ls({width:0,height:0}),i={},r=new ry(0,0,{autoResize:!0});for(var a in t){var n=t[a],o=r.packOne(n.data.width+2,n.data.height+2);e.resize({width:r.w,height:r.h}),Ls.copy(n.data,e,{x:0,y:0},{x:o.x+1,y:o.y+1},n.data),i[a]=new ny(o,n);}r.shrink(),e.resize({width:r.w,height:r.h}),this.image=e,this.positions=i;};ca("ImagePosition",ny),ca("ImageAtlas",sy);var uy=3;function ly(t,e,i){1===t&&i.readMessage(py,e);}function py(t,e,i){if(3===t){var r=i.readMessage(cy,{}),a=r.id,n=r.bitmap,o=r.width,s=r.height,u=r.left,l=r.top,p=r.advance;e.push({id:a,bitmap:new Fs({width:o+2*uy,height:s+2*uy},n),metrics:{width:o,height:s,left:u,top:l,advance:p}});}}function cy(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint());}var hy=uy;t.createCommonjsModule=e,t.getJSON=de,t.getImage=ye,t.ResourceType=he,t.default=n,t.normalizeSpriteURL=function(t,e,i){if(!D(t)&&!O.spriteUrl)return""+t+e+i;var r=U(t);return r.path=O.SRC_URL+"sprite/sprite"+e+i,O.spriteUrl&&""+O.spriteUrl+e+i||r.path},t.RGBAImage=Ls,t.default$1=ry,t.ImagePosition=ny,t.default$2=Pc,t.normalizeGlyphsURL=function(t){if(!D(t)&&!O.fontsUrl)return t;var e=U(t);return O.fontsUrl&&O.fontsUrl+"/{fontstack}"+e.path.substr(e.path.lastIndexOf("/"))+".pbf"||O.SRC_URL+"fonts/{fontstack}/"+e.path.substr(e.path.lastIndexOf("/"))+".pbf"},t.getArrayBuffer=_e,t.default$3=function(t){return new Ih(t).readFields(ly,[])},t.default$4=_a,t.asyncAll=g,t.AlphaImage=Fs,t.default$5=Te,t.endsWith=T,t.extend=v,t.sphericalToCartesian=function(t){var e=t[0],i=t[1],r=t[2];return i+=90,i*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(i)*Math.sin(r),y:e*Math.sin(i)*Math.sin(r),z:e*Math.cos(r)}},t.Evented=Ae,t.validateStyle=ea,t.validateLight=ia,t.emitValidationErrors=na,t.default$6=We,t.number=di,t.Properties=Ua,t.Transitionable=za,t.Transitioning=Oa,t.PossiblyEvaluated=Da,t.DataConstantProperty=Na,t.warnOnce=R,t.default$7=bo,t.default$8=Gd,t.default$9=Wd,t.default$10=yo,t.create=rt,t.clone=at,t.identity=nt,t.transpose=ot,t.invert=st,t.multiply=ut,t.translate=lt,t.scale=pt,t.rotateX=ct,t.rotateY=ht,t.rotateZ=ft,t.fromRotation=function(t,e,i){var r,a,n,o=i[0],s=i[1],u=i[2],l=Math.sqrt(o*o+s*s+u*u);return l<K?null:(o*=l=1/l,s*=l,u*=l,r=Math.sin(e),n=1-(a=Math.cos(e)),t[0]=o*o*n+a,t[1]=s*o*n+u*r,t[2]=u*o*n-s*r,t[3]=0,t[4]=o*s*n-u*r,t[5]=s*s*n+a,t[6]=u*s*n+o*r,t[7]=0,t[8]=o*u*n+s*r,t[9]=s*u*n-o*r,t[10]=u*u*n+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},t.fromRotationTranslationScale=mt,t.fromQuat=dt,t.perspective=_t,t.ortho=yt,t.lookAt=gt,t.mul=vt,t.create$1=xt,t.length=bt,t.fromValues=wt,t.copy=At,t.add=Tt,t.subtract=St,t.scale$1=Et,t.distance=Pt,t.squaredDistance=It,t.normalize=Rt,t.dot=Mt,t.cross=zt,t.lerp=Ct,t.transformMat4=Ot,t.transformQuat=Ft,t.sub=Dt,t.dist=Nt,t.len=kt,t.forEach=Bt,t.default$11=self,t.default$12=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.default$13=h,t.default$14=p,t.polygonIntersectsPolygon=ko,t.create$2=us,t.identity$1=ls,t.transpose$1=ps,t.invert$1=cs,t.multiply$1=hs,t.translate$1=fs,t.scale$2=ms,t.rotateZ$1=ds,t.ortho$1=_s,t.mul$1=ys,t.updateLineLabels=um,t.getLabelPlaneMatrix=am,t.getGlCoordMatrix=nm,t.project=om,t.placeFirstAndLastGlyph=lm,t.xyTransformMat4=_m,t.default$15=io,t.getSizeData=hl,t.evaluateSizeForFeature=fl,t.evaluateSizeForZoom=ml,t.default$16=Tl,t.default$17=Cf,t.default$18=Rf,t.default$19=df,t.Event=be,t.ErrorEvent=we,t.default$20=wo,t.default$21=function(t){return"custom"===t.type?new ty(t):new iy[t.type](t)},t.pick=x,t.clone$1=P,t.filterObject=E,t.mapObject=S,t.isMinemapURL=D,t.normalizeStyleURL=function(t,e){if(!D(t))return t;var i=U(t);return i.path="/styles/v1"+i.path,L(i,e)},t.default$22=mf,t.getType=function(t){return Ef[t]},t.setType=function(t,e){Ef[t]=e;},t.default$23=yf,t.registerForPluginAvailability=function(t){return Ta?t({pluginURL:Ta,completionCallback:wa}):Ea.once("pluginAvailable",t),t},t.evented=Ea,t.default$24=da,t.default$25=kf,t.default$26=_f,t.default$27=le,t.ProjectionType=Xa,t.bindAll=A,t.default$28=q,t.ease=m,t.bezier=f,t.default$29=qa,t.default$30=ja,t.create$3=Vt,t.normalize$1=Ut,t.lerp$1=jt,t.transformMat4$1=qt,t.forEach$1=Xt,t.transformECEFToGeographic=Gn,t.transformGeographicToECEF=Wn,t.default$31=gf,t.clamp=_,t.wrap=y,t.easeForSphere=d,t.default$32=O,t.default$33=_d,t.default$34=Vd,t.default$35=Ia,t.calcLocalCoords=$n,t.getTranslatedLngLatPoint=to,t.version="3.0.0",t.setRTLTextPlugin=function(t,e){if(Aa)throw new Error("setRTLTextPlugin cannot be called multiple times.");Aa=!0,Ta=n.resolveURL(t),wa=function(t){t?(Aa=!1,Ta=null,e&&e(t)):Sa=!0;},Ea.fire(new be("pluginAvailable",{pluginURL:Ta,completionCallback:wa}));},t.values=function(t){var e=[];for(var i in t)e.push(t[i]);return e},t.default$36=Cr,t.default$37=cl,t.register=ca,t.GLYPH_PBF_BORDER=hy,t.default$38=V_,t.distToSegmentSquared=Wo,t.shapeText=function(t,e,i,r,a,n,o,s,u,l){var p=t.trim();l===Hf.vertical&&(p=function(t){for(var e="",i=0;i<t.length;i++){var r=t.charCodeAt(i+1)||null,a=t.charCodeAt(i-1)||null;r&&xa(r)&&!pl[t[i+1]]||a&&xa(a)&&!pl[t[i-1]]||!pl[t[i]]?e+=t[i]:e+=pl[t[i]];}return e}(p));var c=[],h={positionedGlyphs:c,text:p,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:l},f=Pa.processBidirectionalText;return function(t,e,i,r,a,n,o,s,u){for(var l=0,p=-17,c=0,h=t.positionedGlyphs,f="right"===n?1:"left"===n?0:.5,m=0,d=i;m<d.length;m+=1){var _=d[m];if((_=_.trim()).length){for(var y=h.length,g=0;g<_.length;g++){var v=_.charCodeAt(g),x=e[v];x&&(va(v)&&o!==Hf.horizontal?(h.push({glyph:v,x:l,y:0,vertical:!0}),l+=u+s):(h.push({glyph:v,x:l,y:p,vertical:!1}),l+=x.metrics.advance+s));}if(h.length!==y){var b=l-s;c=Math.max(b,c),im(h,e,y,h.length-1,f);}l=0,p+=r;}else p+=r;}var w=em(a),A=w.horizontalAlign,T=w.verticalAlign;!function(t,e,i,r,a,n,o){for(var s=(e-i)*a,u=(-r*o+.5)*n,l=0;l<t.length;l++)t[l].x+=s,t[l].y+=u;}(h,f,A,T,c,r,i.length);var S=i.length*r;t.top+=-T*S,t.bottom=t.top+S,t.left+=-A*c,t.right=t.left+c;}(h,e,f?f(p,tm(p,o,i,e)):function(t,e){for(var i=[],r=0,a=0,n=e;a<n.length;a+=1){var o=n[a];i.push(t.substring(r,o)),r=o;}return r<t.length&&i.push(t.substring(r,t.length)),i}(p,tm(p,o,i,e)),r,a,n,l,o,u),!!c.length&&h},t.shapeIcon=function(t,e,i){var r=em(i),a=r.horizontalAlign,n=r.verticalAlign,o=e[0],s=e[1],u=o-t.displaySize[0]*a,l=u+t.displaySize[0],p=s-t.displaySize[1]*n;return{image:t,top:p,bottom:p+t.displaySize[1],left:u,right:l}},t.WritingMode=Hf,t.allowsVerticalWritingMode=ya,t.allowsLetterSpacing=function(t){for(var e=0,i=t;e<i.length;e+=1)if(!ga(i[e].charCodeAt(0)))return!1;return!0},t.default$39=yu,t.default$40=bl,t.default$41=lf,t.default$42=Hh,t.CollisionBoxArray=Fn,t.default$43=Sh,t.default$44=Cp,t.default$45=sy,t.OverscaledTileID=uo,t.default$46=Uu,t.default$47=Ih,t.default$48=Ya,t.__moduleExports=Ih,t.GLTFReader=bc,t.default$49=dc,t.default$50=ff,t.plugin=Pa;});

define(["./chunk1.js"],function(t){"use strict";function e(t){var r=typeof t;if("number"===r||"boolean"===r||"string"===r||void 0===t||null===t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",n=0,o=t;n<o.length;n+=1){i+=e(o[n])+",";}return i+"]"}for(var a=Object.keys(t).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+e(t[a[l]])+",";return s+"}"}function r(r){for(var i="",n=0,o=t.default$12;n<o.length;n+=1){i+="/"+e(r[o[n]]);}return i}var i=function(t){t&&this.replace(t);};function n(t,e,r,i,n){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-r/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a];}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<r/2;){var h=t[a-1],c=t[a],f=t[a+1];if(!f)return!1;var d=h.angleTo(c)-c.angleTo(f);for(d=Math.abs((d+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:d}),u+=d;s-l[0].distance>i;)u-=l.shift().angleDelta;if(u>n)return!1;a++,s+=c.dist(f);}return!0}function o(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function a(t,e,r){return t?.6*e*r:0}function s(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function l(e,r,i,l,u,h){for(var c=a(i,u,h),f=s(i,l),d=0,p=o(e)/2,g=0;g<e.length-1;g++){var y=e[g],m=e[g+1],v=y.dist(m);if(d+v>p){var x=(p-d)/v,w=t.number(y.x,m.x,x),_=t.number(y.y,m.y,x),b=new t.default$37(w,_,m.angleTo(y),g);if(b._round(),c&&!n(e,b,f,c,r))return;return b}d+=v;}}function u(e,r,i,l,u,h,c,f,d){var p=a(l,h,c),g=s(l,u),y=0===e[0].x||e[0].x===d||0===e[0].y||e[0].y===d;return r-g*c<r/4&&(r=g*c+r/4),function e(r,i,a,s,l,u,h,c,f){var d=u/2;var p=o(r);var g=0,y=i-a;var m=[];for(var v=0;v<r.length-1;v++){for(var x=r[v],w=r[v+1],_=x.dist(w),b=w.angleTo(x);y+a<g+_;){var S=((y+=a)-g)/_,M=t.number(x.x,w.x,S),T=t.number(x.y,w.y,S);if(M>=0&&M<f&&T>=0&&T<f&&y-d>=0&&y+d<=p){var I=new t.default$37(M,T,b,v);I._round(),s&&!n(r,I,u,s,l)||m.push(I);}}g+=_;}c||m.length||h||(m=e(r,g/2,a,s,l,u,h,!0,f));return m}(e,y?r/2*f%r:(g/2+2*h)*c*f%r,r,p,i,g*c,y,!1,d)}i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[]);},i.prototype.update=function(e,i){for(var n=this,o=0,a=e;o<a.length;o+=1){var s=a[o];n._layerConfigs[s.id]=s;var l=n._layers[s.id]=t.default$21(s);l._featureFilter=t.default$36(l.filter);}for(var u=0,h=i;u<h.length;u+=1){var c=h[u];delete n._layerConfigs[c],delete n._layers[c];}this.familiesBySource={};for(var f=0,d=function(t){for(var e={},i=0;i<t.length;i++){var n=r(t[i]),o=e[n];o||(o=e[n]=[]),o.push(t[i]);}var a=[];for(var s in e)a.push(e[s]);return a}(t.values(this._layerConfigs));f<d.length;f+=1){var p=d[f].map(function(t){return n._layers[t.id]}),g=p[0];if("none"!==g.visibility){var y=g.source||"",m=n.familiesBySource[y];m||(m=n.familiesBySource[y]={});var v=g.sourceLayer||"_geojsonTileLayer",x=m[v];x||(x=m[v]=[]),x.push(p);}}};var h=function(){this.opacity=0,this.targetOpacity=0,this.time=0;};function c(t,e){var r=t.geometry[0];return r.length>2&&(!t.properties.hasOwnProperty("name")||-1===t.properties.name.indexOf("箭头"))?0:1===r.length?0:r[1].angleTo(r[0])+(e||0)}h.prototype.clone=function(){var t=new h;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t},t.register("OpacityState",h);var f=function(e,r,i,n,o,a,s,l,u,h,c,f){var d=s.top*l-u,p=s.bottom*l+u,g=s.left*l-u,y=s.right*l+u;if(this.boxStartIndex=e.length,h){var m=p-d,v=y-g;m>0&&(m=Math.max(10*l,m),this._addLineCollisionCircles(e,r,i,i.segment,v,m,n,o,a,c));}else{if(f){var x=new t.default$14(g,d),w=new t.default$14(y,d),_=new t.default$14(g,p),b=new t.default$14(y,p),S=f*Math.PI/180;x._rotate(S),w._rotate(S),_._rotate(S),b._rotate(S),g=Math.min(x.x,w.x,_.x,b.x),y=Math.max(x.x,w.x,_.x,b.x),d=Math.min(x.y,w.y,_.y,b.y),p=Math.max(x.y,w.y,_.y,b.y);}e.emplaceBack(i.x,i.y,g,d,y,p,n,o,a,0,0);}this.boxEndIndex=e.length;};f.prototype._addLineCollisionCircles=function(t,e,r,i,n,o,a,s,l,u){var h=o/2,c=Math.floor(n/h)||1,f=1+.4*Math.log(u)/Math.LN2,d=Math.floor(c*f/2),p=-o/2,g=r,y=i+1,m=p,v=-n/2,x=v-n/4;do{if(--y<0){if(m>v)return;y=0;break}m-=e[y].dist(g),g=e[y];}while(m>x);for(var w=e[y].dist(e[y+1]),_=-d;_<c+d;_++){var b=_*h,S=v+b;if(b<0&&(S+=b),b>n&&(S+=b-n),!(S<m)){for(;m+w<S;){if(m+=w,++y+1>=e.length)return;w=e[y].dist(e[y+1]);}var M=S-m,T=e[y],I=e[y+1].sub(T)._unit()._mult(M)._add(T)._round(),k=Math.abs(S-p)<h?0:.8*(S-p);t.emplaceBack(I.x,I.y,-o/2,-o/2,o/2,o/2,a,s,l,o/2,k);}}};var d=g,p=g;function g(t,e){if(!(this instanceof g))return new g(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||y,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r);}function y(t,e){return t<e?-1:t>e?1:0}function m(e,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);for(var n=1/0,o=1/0,a=-1/0,s=-1/0,l=e[0],u=0;u<l.length;u++){var h=l[u];(!u||h.x<n)&&(n=h.x),(!u||h.y<o)&&(o=h.y),(!u||h.x>a)&&(a=h.x),(!u||h.y>s)&&(s=h.y);}var c=a-n,f=s-o,p=Math.min(c,f),g=p/2,y=new d(null,v);if(0===p)return new t.default$14(n,o);for(var m=n;m<a;m+=p)for(var w=o;w<s;w+=p)y.push(new x(m+g,w+g,g,e));for(var _=function(t){for(var e=0,r=0,i=0,n=t[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],u=n[s],h=l.x*u.y-u.x*l.y;r+=(l.x+u.x)*h,i+=(l.y+u.y)*h,e+=3*h;}return new x(r/e,i/e,0,t)}(e),b=y.length;y.length;){var S=y.pop();(S.d>_.d||!_.d)&&(_=S,i&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,b)),S.max-_.d<=r||(g=S.h/2,y.push(new x(S.p.x-g,S.p.y-g,g,e)),y.push(new x(S.p.x+g,S.p.y-g,g,e)),y.push(new x(S.p.x-g,S.p.y+g,g,e)),y.push(new x(S.p.x+g,S.p.y+g,g,e)),b+=4);}return i&&(console.log("num probes: "+b),console.log("best distance: "+_.d)),_.p}function v(t,e){return e.max-t.max}function x(e,r,i,n){this.p=new t.default$14(e,r),this.h=i,this.d=function(e,r){for(var i=!1,n=1/0,o=0;o<r.length;o++)for(var a=r[o],s=0,l=a.length,u=l-1;s<l;u=s++){var h=a[s],c=a[u];h.y>e.y!=c.y>e.y&&e.x<(c.x-h.x)*(e.y-h.y)/(c.y-h.y)+h.x&&(i=!i),n=Math.min(n,t.distToSegmentSquared(e,h,c));}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2;}function w(e,r,i,n,o,a){e.createArrays(),e.symbolInstances=[];var s=512*e.overscaling;e.tilePixelRatio=t.default$15/s,e.compareText={},e.iconsNeedLinear=!1;var l=e.layers[0].layout,u=e.layers[0]._unevaluatedLayout._values,h={};if("composite"===e.textSizeData.functionType){var c=e.textSizeData.zoomRange,f=c.min,d=c.max;h.compositeTextSizes=[u["text-size"].possiblyEvaluate(new t.default$35(f)),u["text-size"].possiblyEvaluate(new t.default$35(d))];}if("composite"===e.iconSizeData.functionType){var p=e.iconSizeData.zoomRange,g=p.min,y=p.max;h.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new t.default$35(g)),u["icon-size"].possiblyEvaluate(new t.default$35(y))];}h.layoutTextSize=u["text-size"].possiblyEvaluate(new t.default$35(e.zoom+1)),h.layoutIconSize=u["icon-size"].possiblyEvaluate(new t.default$35(e.zoom+1)),h.textMaxSize=u["text-size"].possiblyEvaluate(new t.default$35(18));for(var m=24*l.get("text-line-height"),v="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),x=l.get("text-keep-upright"),w=0,b=e.features;w<b.length;w+=1){var S=b[w],M=l.get("text-font").evaluate(S,{}).join(","),T=r[M]||{},I=i[M]||{},k={},z=S.text;if(z){var P=l.get("text-offset").evaluate(S,{}).map(function(t){return 24*t}),D=24*l.get("text-letter-spacing").evaluate(S,{}),O=t.allowsLetterSpacing(z)?D:0,$=l.get("text-anchor").evaluate(S,{}),C=l.get("text-justify").evaluate(S,{}),L="point"===l.get("symbol-placement")?24*l.get("text-max-width").evaluate(S,{}):0;k.horizontal=t.shapeText(z,T,L,m,$,C,O,P,24,t.WritingMode.horizontal),t.allowsVerticalWritingMode(z)&&v&&x&&(k.vertical=t.shapeText(z,T,L,m,$,C,O,P,24,t.WritingMode.vertical));}var V=void 0;if(S.icon){var R=n[S.icon];R&&(V=t.shapeIcon(o[S.icon],l.get("icon-offset").evaluate(S,{}),l.get("icon-anchor").evaluate(S,{})),void 0===e.sdfIcons?e.sdfIcons=R.sdf:e.sdfIcons!==R.sdf&&t.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),R.pixelRatio!==e.pixelRatio?e.iconsNeedLinear=!0:0!==l.get("icon-rotate").constantOr(1)&&(e.iconsNeedLinear=!0));}(k.horizontal||V)&&_(e,S,k,V,I,h);}a&&e.generateCollisionDebugBuffers();}function _(e,r,i,n,o,a){var s=a.layoutTextSize.evaluate(r,{}),d=a.layoutIconSize.evaluate(r,{}),p=a.textMaxSize.evaluate(r,{});void 0===p&&(p=s);var g=e.layers[0].layout,y=g.get("text-offset").evaluate(r,{}),v=g.get("icon-offset").evaluate(r,{}),x=s/24,w=e.tilePixelRatio*x,_=e.tilePixelRatio*p/24,M=e.tilePixelRatio*d,T=e.tilePixelRatio*g.get("symbol-spacing"),I=g.get("text-padding")*e.tilePixelRatio,k=g.get("icon-padding")*e.tilePixelRatio,z=g.get("text-max-angle")/180*Math.PI,P="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),D="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),O=g.get("symbol-placement"),$=T/2,C=function(s,l){l.x<0||l.x>=t.default$15||l.y<0||l.y>=t.default$15||e.symbolInstances.push(function(e,r,i,n,o,a,s,l,u,d,p,g,y,m,v,x,w,_,S,M,T){var I,k,z=e.addToLineVertexArray(r,i),P=0,D=0,O=0,$=n.horizontal?n.horizontal.text:"",C=[];if(n.horizontal){var L=a.layout.get("text-rotate").evaluate(S,{});I=new f(s,i,r,l,u,d,n.horizontal,p,g,y,e.overscaling,L),D+=b(e,r,n.horizontal,a,y,S,m,z,n.vertical?t.WritingMode.horizontal:t.WritingMode.horizontalOnly,C,M,T),n.vertical&&(O+=b(e,r,n.vertical,a,y,S,m,z,t.WritingMode.vertical,C,M,T));}var V=I?I.boxStartIndex:e.collisionBoxArray.length,R=I?I.boxEndIndex:e.collisionBoxArray.length;if(o){var F=function(e,r,i,n,o,a){var s,l,u,h,f,d=r.image,p=i.layout,g=r.top-1/d.pixelRatio,y=r.left-1/d.pixelRatio,m=r.bottom+1/d.pixelRatio,v=r.right+1/d.pixelRatio;if("none"!==p.get("icon-text-fit")&&o){var x=v-y,w=m-g,_=p.get("text-size").evaluate(a,{})/24,b=o.left*_,S=o.right*_,M=o.top*_,T=S-b,I=o.bottom*_-M,k=p.get("icon-text-fit-padding")[0],z=p.get("icon-text-fit-padding")[1],P=p.get("icon-text-fit-padding")[2],D=p.get("icon-text-fit-padding")[3],O="width"===p.get("icon-text-fit")?.5*(I-w):0,$="height"===p.get("icon-text-fit")?.5*(T-x):0,C="width"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?T:x,L="height"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?I:w;s=new t.default$14(b+$-D,M+O-k),l=new t.default$14(b+$+z+C,M+O-k),u=new t.default$14(b+$+z+C,M+O+P+L),h=new t.default$14(b+$-D,M+O+P+L);}else s=new t.default$14(y,g),l=new t.default$14(v,g),u=new t.default$14(v,m),h=new t.default$14(y,m);if(f="symtracking"===i.type&&i instanceof t.default$38&&!i.layout.get("compatible-mode")?a.properties.car_rotate*Math.PI/180:"symtracking"===i.type?c(a,0):"symbol"===i.type&&i.paint.get("render-road-mark")?c(a,Math.PI/2):i.layout.get("icon-rotate").evaluate(a,{})*Math.PI/180){var V=Math.sin(f),R=Math.cos(f),F=[R,-V,V,R];s._matMult(F),l._matMult(F),h._matMult(F),u._matMult(F);}return[{tl:s,tr:l,bl:h,br:u,tex:d.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,o,a,0,n.horizontal,S),j=a.layout.get("icon-rotate").evaluate(S,{});k=new f(s,i,r,l,u,d,o,v,x,!1,e.overscaling,j),P=4*F.length;var A=e.iconSizeData,N=null;"source"===A.functionType?N=[10*a.layout.get("icon-size").evaluate(S,{})]:"composite"===A.functionType&&(N=[10*T.compositeIconSizes[0].evaluate(S,{}),10*T.compositeIconSizes[1].evaluate(S,{})]),e instanceof t.default$40?e.addSymbols(e.icon,F,N,_,w,S,!1,r,z.lineStartIndex,z.lineLength):(t.default$41,e.addSymbols(e.icon,F,N,_,w,S,!1,r,z.lineStartIndex,z.lineLength));}var E=k?k.boxStartIndex:e.collisionBoxArray.length,G=k?k.boxEndIndex:e.collisionBoxArray.length;e.glyphOffsetArray.length>=t.default$40.MAX_GLYPHS&&t.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/minemap/minemap-gl-js/issues/2907");var B=new h,q=new h;return{key:$,textBoxStartIndex:V,textBoxEndIndex:R,iconBoxStartIndex:E,iconBoxEndIndex:G,textOffset:m,iconOffset:_,anchor:r,line:i,featureIndex:l,feature:S,numGlyphVertices:D,numVerticalGlyphVertices:O,numIconVertices:P,textOpacityState:B,iconOpacityState:q,isDuplicate:!1,placedTextSymbolIndices:C,crossTileID:0}}(e,l,s,i,n,e.layers[0],e.collisionBoxArray,r.index,r.sourceLayerIndex,e.index,w,I,P,y,M,k,D,v,r,o,a));};if("line"===O)for(var L=0,V=function(e,r,i,n,o){for(var a=[],s=0;s<e.length;s++)for(var l=e[s],u=void 0,h=0;h<l.length-1;h++){var c=l[h],f=l[h+1];c.x<r&&f.x<r||(c.x<r?c=new t.default$14(r,c.y+(f.y-c.y)*((r-c.x)/(f.x-c.x)))._round():f.x<r&&(f=new t.default$14(r,c.y+(f.y-c.y)*((r-c.x)/(f.x-c.x)))._round()),c.y<i&&f.y<i||(c.y<i?c=new t.default$14(c.x+(f.x-c.x)*((i-c.y)/(f.y-c.y)),i)._round():f.y<i&&(f=new t.default$14(c.x+(f.x-c.x)*((i-c.y)/(f.y-c.y)),i)._round()),c.x>=n&&f.x>=n||(c.x>=n?c=new t.default$14(n,c.y+(f.y-c.y)*((n-c.x)/(f.x-c.x)))._round():f.x>=n&&(f=new t.default$14(n,c.y+(f.y-c.y)*((n-c.x)/(f.x-c.x)))._round()),c.y>=o&&f.y>=o||(c.y>=o?c=new t.default$14(c.x+(f.x-c.x)*((o-c.y)/(f.y-c.y)),o)._round():f.y>=o&&(f=new t.default$14(c.x+(f.x-c.x)*((o-c.y)/(f.y-c.y)),o)._round()),u&&c.equals(u[u.length-1])||(u=[c],a.push(u)),u.push(f)))));}return a}(r.geometry,0,0,t.default$15,t.default$15);L<V.length;L+=1)for(var R=V[L],F=0,j=u(R,T,z,i.vertical||i.horizontal,n,24,_,e.overscaling,t.default$15);F<j.length;F+=1){var A=j[F],N=i.horizontal;N&&S(e,N.text,$,A)||C(R,A);}else if("line-center"===O)for(var E=0,G=r.geometry;E<G.length;E+=1){var B=G[E];if(B.length>1){var q=l(B,z,i.vertical||i.horizontal,n,24,_);q&&C(B,q);}}else if("Polygon"===r.type)for(var J=0,Z=t.default$39(r.geometry,0);J<Z.length;J+=1){var W=Z[J],Y=m(W,16);C(W[0],new t.default$37(Y.x,Y.y,0));}else if("LineString"===r.type)for(var X=0,U=r.geometry;X<U.length;X+=1){var H=U[X];C(H,new t.default$37(H[0].x,H[0].y,0));}else if("Point"===r.type)for(var Q=0,K=r.geometry;Q<K.length;Q+=1)for(var tt=0,et=K[Q];tt<et.length;tt+=1){var rt=et[tt];C([rt],new t.default$37(rt.x,rt.y,0));}}function b(e,r,i,n,o,a,s,l,u,h,c,f){var d=function(e,r,i,n,o,a){for(var s=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,l=i.layout.get("text-offset").evaluate(o,{}).map(function(t){return 24*t}),u=r.positionedGlyphs,h=[],c=0;c<u.length;c++){var f=u[c],d=a[f.glyph];if(d){var p=d.rect;if(p){var g=t.GLYPH_PBF_BORDER+1,y=d.metrics.advance/2,m=n?[f.x+y,f.y]:[0,0],v=n?[0,0]:[f.x+y+l[0],f.y+l[1]],x=d.metrics.left-g-y+v[0],w=-d.metrics.top-g+v[1],_=x+p.w,b=w+p.h,S=new t.default$14(x,w),M=new t.default$14(_,w),T=new t.default$14(x,b),I=new t.default$14(_,b);if(n&&f.vertical){var k=new t.default$14(-y,y),z=-Math.PI/2,P=new t.default$14(5,0);S._rotateAround(z,k)._add(P),M._rotateAround(z,k)._add(P),T._rotateAround(z,k)._add(P),I._rotateAround(z,k)._add(P);}if(s){var D=Math.sin(s),O=Math.cos(s),$=[O,-D,D,O];S._matMult($),M._matMult($),T._matMult($),I._matMult($);}h.push({tl:S,tr:M,bl:T,br:I,tex:p,writingMode:r.writingMode,glyphOffset:m});}}}return h}(0,i,n,o,a,c),p=e.textSizeData,g=null;return"source"===p.functionType?g=[10*n.layout.get("text-size").evaluate(a,{})]:"composite"===p.functionType&&(g=[10*f.compositeTextSizes[0].evaluate(a,{}),10*f.compositeTextSizes[1].evaluate(a,{})]),e instanceof t.default$40?e.addSymbols(e.text,d,g,s,o,a,u,r,l.lineStartIndex,l.lineLength):(t.default$41,e.addSymbols(e.text,d,g,s,o,a,u,r,l.lineStartIndex,l.lineLength)),h.push(e.text.placedSymbolArray.length-1),4*d.length}function S(t,e,r,i){var n=t.compareText;if(e in n){for(var o=n[e],a=o.length-1;a>=0;a--)if(i.dist(o[a])<r)return!0}else n[e]=[];return n[e].push(i),!1}g.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1);},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,i=e[t];t>0;){var n=t-1>>1,o=e[n];if(r(i,o)>=0)break;e[t]=o,t=n;}e[t]=i;},_down:function(t){for(var e=this.data,r=this.compare,i=this.length>>1,n=e[t];t<i;){var o=1+(t<<1),a=o+1,s=e[o];if(a<this.length&&r(e[a],s)<0&&(o=a,s=e[a]),r(s,n)>=0)break;e[t]=s,t=o;}e[t]=n;}},d.default=p;var M=function(e){var r=new t.AlphaImage({width:0,height:0}),i={},n=new t.default$1(0,0,{autoResize:!0});for(var o in e){var a=e[o],s=i[o]={};for(var l in a){var u=a[+l];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var h=n.packOne(u.bitmap.width+2,u.bitmap.height+2);r.resize({width:n.w,height:n.h}),t.AlphaImage.copy(u.bitmap,r,{x:0,y:0},{x:h.x+1,y:h.y+1},u.bitmap),s[l]={rect:h,metrics:u.metrics};}}}n.shrink(),r.resize({width:n.w,height:n.h}),this.image=r,this.positions=i;};t.register("GlyphAtlas",M);var T=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.projection=e.projection||t.ProjectionType.MERCATOR;};function I(e,r){for(var i=new t.default$35(r),n=0,o=e;n<o.length;n+=1){o[n].recalculate(i);}}T.prototype.parse=function(e,r,i,n){var o=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var a=new t.default$43(Object.keys(e.layers).sort()),s=new t.default$42(this.tileID);s.bucketLayerIDs=[];var l,u,h,c={},f={featureIndex:s,iconDependencies:{},glyphDependencies:{},x:this.tileID.canonical.x,y:this.tileID.canonical.y,z:this.tileID.canonical.z},d=r.familiesBySource[this.source];for(var p in d){var g=e.layers[p];if(g){1===g.version&&t.warnOnce('Vector tile source "'+o.source+'" layer "'+p+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var y=a.encode(p),m=[],v=0;v<g.length;v++){var x=g.feature(v);m.push({feature:x,index:v,sourceLayerIndex:y});}for(var _=0,b=d[p];_<b.length;_+=1){var S=b[_],T=S[0];if(!(T.minzoom&&o.zoom<Math.floor(T.minzoom)))if(!(T.maxzoom&&o.zoom>=T.maxzoom))if("none"!==T.visibility)I(S,o.zoom),(c[T.id]=T.createBucket({index:s.bucketLayerIDs.length,layers:S,zoom:o.zoom,pixelRatio:o.pixelRatio,overscaling:o.overscaling,collisionBoxArray:o.collisionBoxArray,sourceLayerIndex:y,sourceID:o.source,projection:o.projection})).populate(m,f),s.bucketLayerIDs.push(S.map(function(t){return t.id}));}}}var k=t.mapObject(f.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(k).length?i.send("getGlyphs",{uid:this.uid,stacks:k},function(t,e){l||(l=t,u=e,P.call(o));}):u={};var z=Object.keys(f.iconDependencies);function P(){if(l)return n(l);if(u&&h){var e=new M(u),r=new t.default$45(h);for(var i in c){var o=c[i];(o instanceof t.default$40||o instanceof t.default$41||o instanceof t.default$44)&&(I(o.layers,this.zoom),w(o,u,e.positions,h,r.positions,this.showCollisionBoxes));}this.status="done",n(null,{buckets:t.values(c).filter(function(t){return!t.isEmpty()}),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,iconAtlasImage:r.image});}}z.length?i.send("getImages",{icons:z},function(t,e){l||(l=t,h=e,P.call(o));}):h={},P.call(this);};var k="undefined"!=typeof performance,z={getEntriesByName:function(t){return!!(k&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(k&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,r){return!!(k&&performance&&performance.measure)&&performance.measure(t,e,r)},clearMarks:function(t){return!!(k&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(k&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},P=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},z.mark(this._marks.start);};function D(e,r){var i=t.getArrayBuffer(e.request,function(i,n){i?r(i):n&&r(null,{vectorTile:new t.default$46.VectorTile(new t.default$47(n.data),null,e&&e.projection),rawData:n.data,cacheControl:n.cacheControl,expires:n.expires});});return function(){i.cancel(),r();}}P.prototype.finish=function(){z.mark(this._marks.end);var t=z.getEntriesByName(this._marks.measure);return 0===t.length&&(z.measure(this._marks.measure,this._marks.start,this._marks.end),t=z.getEntriesByName(this._marks.measure),z.clearMarks(this._marks.start),z.clearMarks(this._marks.end),z.clearMeasures(this._marks.measure)),t},z.Performance=P;var O=function(t,e,r){this.actor=t,this.layerIndex=e,this.loadVectorData=r||D,this.loading={},this.loaded={};};O.prototype.loadTile=function(e,r){var i=this,n=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new z.Performance(e.request),a=this.loading[n]=new T(e);a.abort=this.loadVectorData(e,function(e,s){if(delete i.loading[n],e||!s)return r(e);var l=s.rawData,u={};s.expires&&(u.expires=s.expires),s.cacheControl&&(u.cacheControl=s.cacheControl);var h={};if(o){var c=o.finish();c&&(h.resourceTiming=JSON.parse(JSON.stringify(c)));}a.vectorTile=s.vectorTile,a.parse(s.vectorTile,i.layerIndex,i.actor,function(e,i){if(e||!i)return r(e);r(null,t.extend({rawTileData:l.slice(0)},i,u,h));}),i.loaded=i.loaded||{},i.loaded[n]=a;},this.projection);},O.prototype.reloadTile=function(t,e){var r=this.loaded,i=t.uid,n=this;if(r&&r[i]){var o=r[i];o.showCollisionBoxes=t.showCollisionBoxes;var a=function(t,r){var i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,n.layerIndex,n.actor,i)),e(t,r);};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,a);}},O.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),e();},O.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e();};var $={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function C(t){var e=0;if(t&&t.length>0){e+=Math.abs(L(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(L(t[r]));}return e}function L(t){var e,r,i,n,o,a,s=0,l=t.length;if(l>2){for(a=0;a<l;a++)a===l-2?(i=l-2,n=l-1,o=0):a===l-1?(i=l-1,n=0,o=1):(i=a,n=a+1,o=a+2),e=t[i],r=t[n],s+=(V(t[o][0])-V(e[0]))*Math.sin(V(r[1]));s=s*$.RADIUS*$.RADIUS/2;}return s}function V(t){return t*Math.PI/180}var R={geometry:function t(e){var r,i=0;switch(e.type){case"Polygon":return C(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)i+=C(e.coordinates[r]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)i+=t(e.geometries[r]);return i}},ring:L},F=function t(e,r){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(j(t,r)),e;case"Feature":return e.geometry=t(e.geometry,r),e;case"Polygon":case"MultiPolygon":return function(t,e){"Polygon"===t.type?t.coordinates=A(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(j(A,e)));return t}(e,r);default:return e}};function j(t,e){return function(r){return t(r,e)}}function A(t,e){e=!!e,t[0]=N(t[0],e);for(var r=1;r<t.length;r++)t[r]=N(t[r],!e);return t}function N(t,e){return function(t){return R.ring(t)>=0}(t)===e?t:t.reverse()}var E=t.default$46.VectorTileFeature.prototype.toGeoJSON,G=function(e,r){this._feature=e,this.extent=t.default$15,this.type=e.type,this.properties=e.tags,this.projObj=t.default$48(r),"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10));};G.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,i=this._feature.geometry;r<i.length;r+=1){var n=i[r];e.push([new(Function.prototype.bind.apply(t.default$14,[null].concat(n)))]);}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],u=0,h=s[a];u<h.length;u+=1){var c=h[u];l.push(new(Function.prototype.bind.apply(t.default$14,[null].concat(c))));}o.push(l);}return o},G.prototype.toGeoJSON=function(t,e,r){return E.call(this,t,e,r)};var B=function(e,r){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.default$15,this.length=e.length,this._features=e,this.projection=r;};B.prototype.feature=function(t){return new G(this._features[t],this.projection)};var q=J;function J(t,e){this.x=t,this.y=e;}J.prototype={clone:function(){return new J(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},J.convert=function(t){return t instanceof J?t:Array.isArray(t)?new J(t[0],t[1]):t};var Z=W;function W(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(Y,this,e);}function Y(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n;}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos);}function X(t){for(var e,r,i=0,n=0,o=t.length,a=o-1;n<o;a=n++)e=t[n],i+=((r=t[a]).x-e.x)*(e.y+r.y);return i}W.types=["Unknown","Point","LineString","Polygon"],W.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,n=0,o=0,a=0,s=[];t.pos<r;){if(n<=0){var l=t.readVarint();i=7&l,n=l>>3;}if(n--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&s.push(e),e=[]),e.push(new q(o,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone());}}return e&&s.push(e),s},W.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(i<=0){var h=t.readVarint();r=7&h,i=h>>3;}if(i--,1===r||2===r)n+=t.readSVarint(),o+=t.readSVarint(),n<a&&(a=n),n>s&&(s=n),o<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},W.prototype.toGeoJSON=function(t,e,r){var i,n,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=W.types[this.type];function h(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+s)/o;t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90];}}switch(this.type){case 1:var c=[];for(i=0;i<l.length;i++)c[i]=l[i][0];h(l=c);break;case 2:for(i=0;i<l.length;i++)h(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var a=X(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]));}r&&n.push(r);return n}(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)h(l[i][n]);}1===l.length?l=l[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var U=H;function H(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Q,this,e),this.length=this._features.length;}function Q(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null;}return e}(r));}function K(t,e,r){if(3===t){var i=new U(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i);}}H.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Z(this._pbf,e,this.extent,this._keys,this._values)};var tt={VectorTile:function(t,e){this.layers=t.readFields(K,{},e);},VectorTileFeature:Z,VectorTileLayer:U}.VectorTileFeature,et=rt;function rt(t,e){this.options=e||{},this.features=t,this.length=t.length;}function it(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096;}rt.prototype.feature=function(t){return new it(this.features[t],this.options.extent)},it.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var r=t[e],i=[],n=0;n<r.length;n++)i.push(new q(r[n][0],r[n][1]));this.geometry.push(i);}return this.geometry},it.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,i=1/0,n=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y);}return[e,i,r,n]},it.prototype.toGeoJSON=tt.prototype.toGeoJSON;var nt=lt,ot=lt,at=function(t,e){e=e||{};var r={};for(var i in t)r[i]=new et(t[i].features,e),r[i].name=i,r[i].version=e.version,r[i].extent=e.extent;return lt({layers:r})},st=et;function lt(e){var r=new t.__moduleExports;return function(t,e){for(var r in t.layers)e.writeMessage(3,ut,t.layers[r]);}(e,r),r.finish()}function ut(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)i.feature=t.feature(r),e.writeMessage(2,ht,i);var n=i.keys;for(r=0;r<n.length;r++)e.writeStringField(3,n[r]);var o=i.values;for(r=0;r<o.length;r++)e.writeMessage(4,gt,o[r]);}function ht(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,ct,t),e.writeVarintField(3,r.type),e.writeMessage(4,pt,r);}function ct(t,e){var r=t.feature,i=t.keys,n=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var l=o[s];void 0===l&&(i.push(s),l=i.length-1,o[s]=l),e.writeVarint(l);var u=r.properties[s],h=typeof u;"string"!==h&&"boolean"!==h&&"number"!==h&&(u=JSON.stringify(u));var c=h+":"+u,f=a[c];void 0===f&&(n.push(u),f=n.length-1,a[c]=f),e.writeVarint(f);}}function ft(t,e){return(e<<3)+(7&t)}function dt(t){return t<<1^t>>31}function pt(t,e){for(var r=t.loadGeometry(),i=t.type,n=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],u=1;1===i&&(u=l.length),e.writeVarint(ft(1,u));for(var h=3===i?l.length-1:l.length,c=0;c<h;c++){1===c&&1!==i&&e.writeVarint(ft(2,h-1));var f=l[c].x-n,d=l[c].y-o;e.writeVarint(dt(f)),e.writeVarint(dt(d)),n+=f,o+=d;}3===i&&e.writeVarint(ft(7,1));}}function gt(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t));}function yt(t,e,r,i,n,o){if(!(n-i<=r)){var a=Math.floor((i+n)/2);!function t(e,r,i,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,l=i-n+1,u=Math.log(s),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(s-h)/s)*(l-s/2<0?-1:1),f=Math.max(n,Math.floor(i-l*h/s+c)),d=Math.min(o,Math.floor(i+(s-l)*h/s+c));t(e,r,i,f,d,a);}var p=r[2*i+a],g=n,y=o;for(mt(e,r,n,i),r[2*o+a]>p&&mt(e,r,n,o);g<y;){for(mt(e,r,g,y),g++,y--;r[2*g+a]<p;)g++;for(;r[2*y+a]>p;)y--;}r[2*n+a]===p?mt(e,r,n,y):mt(e,r,++y,o),y<=i&&(n=y+1),i<=y&&(o=y-1);}}(t,e,a,i,n,o%2),yt(t,e,r,i,a-1,o+1),yt(t,e,r,a+1,n,o+1);}}function mt(t,e,r,i){vt(t,r,i),vt(e,2*r,2*i),vt(e,2*r+1,2*i+1);}function vt(t,e,r){var i=t[e];t[e]=t[r],t[r]=i;}function xt(t,e,r,i){var n=t-r,o=e-i;return n*n+o*o}function wt(t,e,r,i,n){return new _t(t,e,r,i,n)}function _t(t,e,r,i,n){e=e||bt,r=r||St,n=n||Array,this.nodeSize=i||64,this.points=t,this.ids=new n(t.length),this.coords=new n(2*t.length);for(var o=0;o<t.length;o++)this.ids[o]=o,this.coords[2*o]=e(t[o]),this.coords[2*o+1]=r(t[o]);yt(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0);}function bt(t){return t[0]}function St(t){return t[1]}function Mt(e){this.options=kt(Object.create(this.options),e),this.trees=new Array(this.options.maxZoom+1),this.projection=e&&e.projection?e.projection:"MERCATOR",this.projObj=t.default$48(this.projection);}function Tt(t,e,r,i,n){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:i,properties:n}}function It(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return kt(kt({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function kt(t,e){for(var r in e)t[r]=e[r];return t}function zt(t){return t.x}function Pt(t){return t.y}nt.fromVectorTileJs=ot,nt.fromGeojsonVt=at,nt.GeoJSONWrapper=st,_t.prototype={range:function(t,e,r,i){return function(t,e,r,i,n,o,a){for(var s,l,u=[0,t.length-1,0],h=[];u.length;){var c=u.pop(),f=u.pop(),d=u.pop();if(f-d<=a)for(var p=d;p<=f;p++)s=e[2*p],l=e[2*p+1],s>=r&&s<=n&&l>=i&&l<=o&&h.push(t[p]);else{var g=Math.floor((d+f)/2);s=e[2*g],l=e[2*g+1],s>=r&&s<=n&&l>=i&&l<=o&&h.push(t[g]);var y=(c+1)%2;(0===c?r<=s:i<=l)&&(u.push(d),u.push(g-1),u.push(y)),(0===c?n>=s:o>=l)&&(u.push(g+1),u.push(f),u.push(y));}}return h}(this.ids,this.coords,t,e,r,i,this.nodeSize)},within:function(t,e,r){return function(t,e,r,i,n,o){for(var a=[0,t.length-1,0],s=[],l=n*n;a.length;){var u=a.pop(),h=a.pop(),c=a.pop();if(h-c<=o)for(var f=c;f<=h;f++)xt(e[2*f],e[2*f+1],r,i)<=l&&s.push(t[f]);else{var d=Math.floor((c+h)/2),p=e[2*d],g=e[2*d+1];xt(p,g,r,i)<=l&&s.push(t[d]);var y=(u+1)%2;(0===u?r-n<=p:i-n<=g)&&(a.push(c),a.push(d-1),a.push(y)),(0===u?r+n>=p:i+n>=g)&&(a.push(d+1),a.push(h),a.push(y));}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)}},Mt.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},latY:function(t){return this.projObj.latY(t,1)},lngX:function(t){return this.projObj.lngX(t,1)},xLng:function(t){return this.projObj.xLng(t,1)},yLat:function(t){return this.projObj.yLat(t,1)},load:function(t){var e=this.options.log;e&&console.time("total time");var r="prepare "+t.length+" points";e&&console.time(r),this.points=t;for(var i=[],n=0;n<t.length;n++)t[n].geometry&&i.push(this.createPointCluster(t[n],n));this.trees[this.options.maxZoom+1]=wt(i,zt,Pt,this.options.nodeSize,Float32Array),e&&console.timeEnd(r);for(var o=this.options.maxZoom;o>=this.options.minZoom;o--){var a=+Date.now();i=this._cluster(i,o),this.trees[o]=wt(i,zt,Pt,this.options.nodeSize,Float32Array),e&&console.log("z%d: %d clusters in %dms",o,i.length,+Date.now()-a);}return e&&console.timeEnd("total time"),this},getClusters:function(t,e){var r=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),n=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,n=180;else if(r>n){var a=this.getClusters([r,i,180,o],e),s=this.getClusters([-180,i,n,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],u=l.range(this.lngX(r),this.latY(o),this.lngX(n),this.latY(i)),h=[],c=0;c<u.length;c++){var f=l.points[u[c]];h.push(f.numPoints?getClusterJSON(f):this.points[f.id]);}return h},getChildren:function(t){var e=t>>5,r=t%32,i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);var o=n.points[e];if(!o)throw new Error(i);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=n.within(o.x,o.y,a),l=[],u=0;u<s.length;u++){var h=n.points[s[u]];h.parentId===t&&l.push(h.numPoints?getClusterJSON(h):this.points[h.id]);}if(0===l.length)throw new Error(i);return l},getLeaves:function(t,e,r){e=e||10,r=r||0;var i=[];return this._appendLeaves(i,t,e,r,0),i},getTile:function(t,e,r){var i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),o=this.options.extent,a=this.options.radius/o,s=(r-a)/n,l=(r+1+a)/n,u={features:[]};return this._addTileFeatures(i.range((e-a)/n,s,(e+1+a)/n,l),i.points,e,r,n,u),0===e&&this._addTileFeatures(i.range(1-a/n,s,1,l),i.points,n,r,n,u),e===n-1&&this._addTileFeatures(i.range(0,s,a/n,l),i.points,-1,r,n,u),u.features.length?u:null},getClusterExpansionZoom:function(t){for(var e=t%32-1;e<this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id;}return e},_appendLeaves:function(t,e,r,i,n){for(var o=this.getChildren(e),a=0;a<o.length;a++){var s=o[a].properties;if(s&&s.cluster?n+s.point_count<=i?n+=s.point_count:n=this._appendLeaves(t,s.cluster_id,r,i,n):n<i?n++:t.push(o[a]),t.length===r)break}return n},_addTileFeatures:function(t,e,r,i,n,o){for(var a=0;a<t.length;a++){var s=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*n-r)),Math.round(this.options.extent*(s.y*n-i))]],tags:s.numPoints?It(s):this.points[s.id].properties});}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var r=[],i=this.options.radius/(this.options.extent*Math.pow(2,e)),n=0;n<t.length;n++){var o=t[n];if(!(o.zoom<=e)){o.zoom=e;var a=this.trees[e+1],s=a.within(o.x,o.y,i),l=o.numPoints||1,u=o.x*l,h=o.y*l,c=null;this.options.reduce&&(c=this.options.initial(),this._accumulate(c,o));for(var f=(n<<5)+(e+1),d=0;d<s.length;d++){var p=a.points[s[d]];if(!(p.zoom<=e)){p.zoom=e;var g=p.numPoints||1;u+=p.x*g,h+=p.y*g,l+=g,p.parentId=f,this.options.reduce&&this._accumulate(c,p);}}1===l?r.push(o):(o.parentId=f,r.push(Tt(u/l,h/l,f,l,c)));}}return r},_accumulate:function(t,e){var r=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,r);},createPointCluster:function(t,e){var r=t.geometry.coordinates;return{x:this.lngX(r[0]),y:this.latY(r[1]),zoom:1/0,id:e,parentId:-1}},getClusterJSON:function(t){return{type:"Feature",properties:It(t),geometry:{type:"Point",coordinates:[this.xLng(t.x),this.yLat(t.y)]}}}};var Dt=function(t,e){var r,i,n,o,a=e*e,s=0,l=t.length-1,u=[];t[s][3]=1,t[l][3]=1;for(;l;){for(i=0,r=s+1;r<l;r++)(n=Ot(t[r],t[s],t[l]))>i&&(o=r,i=n);i>a?(t[o][3]=i,u.push(s),u.push(o),s=o):(l=u.pop(),s=u.pop());}};function Ot(t,e,r){var i=e[0],n=e[1],o=r[0],a=r[1],s=t[0],l=t[1],u=o-i,h=a-n;if(0!==u||0!==h){var c=((s-i)*u+(l-n)*h)/(u*u+h*h);c>1?(i=o,n=a):c>0&&(i+=u*c,n+=h*c);}return(u=s-i)*u+(h=l-n)*h}var $t=function(t,e,r,i){var n={id:i||null,type:e,geometry:r,tags:t||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(t){var e=t.geometry,r=t.min,i=t.max;if(1===t.type)Ct(r,i,e);else for(var n=0;n<e.length;n++)Ct(r,i,e[n]);}(n),n};function Ct(t,e,r){for(var i,n=0;n<r.length;n++)i=r[n],t[0]=Math.min(i[0],t[0]),e[0]=Math.max(i[0],e[0]),t[1]=Math.min(i[1],t[1]),e[1]=Math.max(i[1],e[1]);}var Lt=function(t,e,r){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)Vt(i,t.features[n],e,r);else"Feature"===t.type?Vt(i,t,e,r):Vt(i,{geometry:t},e,r);return i};function Vt(t,e,r,i){if(null!==e.geometry){var n,o,a,s,l=e.geometry,u=l.type,h=l.coordinates,c=e.properties,f=e.id;if("Point"===u)t.push($t(c,1,[Ft(h,i)],f));else if("MultiPoint"===u)t.push($t(c,1,Rt(h,null,i),f));else if("LineString"===u)t.push($t(c,2,[Rt(h,r,i)],f));else if("MultiLineString"===u||"Polygon"===u){for(a=[],n=0;n<h.length;n++)s=Rt(h[n],r,i),"Polygon"===u&&(s.outer=0===n),a.push(s);t.push($t(c,"Polygon"===u?3:2,a,f));}else if("MultiPolygon"===u){for(a=[],n=0;n<h.length;n++)for(o=0;o<h[n].length;o++)(s=Rt(h[n][o],r,i)).outer=0===o,a.push(s);t.push($t(c,3,a,f));}else{if("GeometryCollection"!==u)throw new Error("Input data is not a valid GeoJSON object.");for(n=0;n<l.geometries.length;n++)Vt(t,{geometry:l.geometries[n],properties:c},r);}}}function Rt(t,e,r){for(var i=[],n=0;n<t.length;n++)i.push(Ft(t[n],r));return e&&(Dt(i,e),function(t){for(var e,r,i=0,n=0,o=0;o<t.length-1;o++)e=r||t[o],r=t[o+1],i+=e[0]*r[1]-r[0]*e[1],n+=Math.abs(r[0]-e[0])+Math.abs(r[1]-e[1]);t.area=Math.abs(i/2),t.dist=n;}(i)),i}function Ft(e,r){var i=t.default$48(r),n=i.lngX(e[0],1),o=i.latY(e[1],1);return[n,o=o<0?0:o>1?1:o,e[2],0]}function jt(t,e,r,i,n){return[Math.round(e*(t[0]*r-i)),Math.round(e*(t[1]*r-n))].concat(t.slice(2))}var At={tile:function(t,e){if(t.transformed)return t;var r,i,n,o=t.z2,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,h=l.type;if(1===h)for(i=0;i<u.length;i++)u[i]=jt(u[i],e,o,a,s);else for(i=0;i<u.length;i++){var c=u[i];for(n=0;n<c.length;n++)c[n]=jt(c[n],e,o,a,s);}}return t.transformed=!0,t},point:jt},Nt=function(t,e,r,i,n,o,a,s){if(i/=e,a>=(r/=e)&&s<=i)return t;if(a>i||s<r)return null;for(var l=[],u=0;u<t.length;u++){var h,c,f=t[u],d=f.geometry,p=f.type;if(h=f.min[n],c=f.max[n],h>=r&&c<=i)l.push(f);else if(!(h>i||c<r)){var g=1===p?Et(d,r,i,n):Gt(d,r,i,n,o,3===p);g.length&&l.push($t(f.tags,p,g,f.id));}}return l.length?l:null};function Et(t,e,r,i){for(var n=[],o=0;o<t.length;o++){var a=t[o],s=a[i];s>=e&&s<=r&&n.push(a);}return n}function Gt(t,e,r,i,n,o){for(var a=[],s=0;s<t.length;s++){var l,u,h,c=0,f=0,d=null,p=t[s],g=p.area,y=p.dist,m=p.outer,v=p.length,x=[];for(u=0;u<v-1;u++)l=d||p[u],d=p[u+1],c=f||l[i],f=d[i],c<e?f>r?(x.push(n(l,d,e),n(l,d,r)),o||(x=Bt(a,x,g,y,m))):f>=e&&x.push(n(l,d,e)):c>r?f<e?(x.push(n(l,d,r),n(l,d,e)),o||(x=Bt(a,x,g,y,m))):f<=r&&x.push(n(l,d,r)):(x.push(l),f<e?(x.push(n(l,d,e)),o||(x=Bt(a,x,g,y,m))):f>r&&(x.push(n(l,d,r)),o||(x=Bt(a,x,g,y,m))));(c=(l=p[v-1])[i])>=e&&c<=r&&x.push(l),h=x[x.length-1],o&&h&&(x[0][0]!==h[0]||x[0][1]!==h[1])&&x.push(x[0]),Bt(a,x,g,y,m);}return a}function Bt(t,e,r,i,n){return e.length&&(e.area=r,e.dist=i,void 0!==n&&(e.outer=n),t.push(e)),[]}var qt=function(t,e,r){var i=t,n=Nt(t,1,-1-e,e,0,r,-1,2),o=Nt(t,1,1-e,2+e,0,r,-1,2);(n||o)&&(i=Nt(t,1,-e,1+e,0,r,-1,2)||[],n&&(i=Jt(n,1).concat(i)),o&&(i=i.concat(Jt(o,-1))));return i};function Jt(t,e){for(var r=[],i=0;i<t.length;i++){var n,o=t[i],a=o.type;if(1===a)n=Zt(o.geometry,e);else{n=[];for(var s=0;s<o.geometry.length;s++)n.push(Zt(o.geometry[s],e));}r.push($t(o.tags,a,n,o.id));}return r}function Zt(t,e){var r=[];r.area=t.area,r.dist=t.dist;for(var i=0;i<t.length;i++)r.push([t[i][0]+e,t[i][1],t[i][2],t[i][3]]);return r}var Wt=function(t,e,r,i,n,o){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z2:e,transformed:!1,min:[2,1],max:[-1,0]},s=0;s<t.length;s++){a.numFeatures++,Yt(a,t[s],n,o);var l=t[s].min,u=t[s].max;l[0]<a.min[0]&&(a.min[0]=l[0]),l[1]<a.min[1]&&(a.min[1]=l[1]),u[0]>a.max[0]&&(a.max[0]=u[0]),u[1]>a.max[1]&&(a.max[1]=u[1]);}return a};function Yt(t,e,r,i){var n,o,a,s,l=e.geometry,u=e.type,h=[],c=r*r;if(1===u)for(n=0;n<l.length;n++)h.push(l[n]),t.numPoints++,t.numSimplified++;else for(n=0;n<l.length;n++)if(a=l[n],i||!(2===u&&a.dist<r||3===u&&a.area<c)){var f=[];for(o=0;o<a.length;o++)s=a[o],(i||s[3]>c)&&(f.push(s),t.numSimplified++),t.numPoints++;3===u&&Xt(f,a.outer),h.push(f);}else t.numPoints+=a.length;if(h.length){var d={geometry:h,type:u,tags:e.tags||null};null!==e.id&&(d.id=e.id),t.features.push(d);}}function Xt(t,e){(function(t){for(var e,r,i=0,n=0,o=t.length,a=o-1;n<o;a=n++)e=t[n],r=t[a],i+=(r[0]-e[0])*(e[1]+r[1]);return i})(t)<0===e&&t.reverse();}var Ut=function(t,e,r){return new Ht(t,e,r)};function Ht(t,e,r){var i=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;i&&console.time("preprocess data");var n=1<<e.maxZoom,o=Lt(t,e.tolerance/(n*e.extent),r);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(o=qt(o,e.buffer/e.extent,Kt)).length&&this.splitTile(o,0,0,0),i&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)));}function Qt(t,e,r){return 32*((1<<t)*r+e)+t}function Kt(t,e,r){return[r,(r-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1],(r-t[0])*(e[2]-t[2])/(e[0]-t[0])+t[2],1]}function te(t,e,r){return[(r-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],r,(r-t[1])*(e[2]-t[2])/(e[1]-t[1])+t[2],1]}function ee(t,e,r){var i=t.source;if(1!==i.length)return!1;var n=i[0];if(3!==n.type||n.geometry.length>1)return!1;var o=n.geometry[0].length;if(5!==o)return!1;for(var a=0;a<o;a++){var s=At.point(n.geometry[0][a],e,t.z2,t.x,t.y);if(s[0]!==-r&&s[0]!==e+r||s[1]!==-r&&s[1]!==e+r)return!1}return!0}function re(t,e,r){var i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);var o=new B(n.features,r),a=nt(o);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:o,rawData:a.buffer});}Ht.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},Ht.prototype.splitTile=function(t,e,r,i,n,o,a){for(var s=[t,e,r,i],l=this.options,u=l.debug,h=null;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,f=Qt(e,r,i),d=this.tiles[f],p=e===l.maxZoom?0:l.tolerance/(c*l.extent);if(!d&&(u>1&&console.time("creation"),d=this.tiles[f]=Wt(t,c,r,i,p,e===l.maxZoom),this.tileCoords.push({z:e,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var g="z"+e;this.stats[g]=(this.stats[g]||0)+1,this.total++;}if(d.source=t,n){if(e===l.maxZoom||e===n)continue;var y=1<<n-e;if(r!==Math.floor(o/y)||i!==Math.floor(a/y))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(l.solidChildren||!ee(d,l.extent,l.buffer)){d.source=null,u>1&&console.time("clipping");var m,v,x,w,_,b,S=.5*l.buffer/l.extent,M=.5-S,T=.5+S,I=1+S;m=v=x=w=null,_=Nt(t,c,r-S,r+T,0,Kt,d.min[0],d.max[0]),b=Nt(t,c,r+M,r+I,0,Kt,d.min[0],d.max[0]),_&&(m=Nt(_,c,i-S,i+T,1,te,d.min[1],d.max[1]),v=Nt(_,c,i+M,i+I,1,te,d.min[1],d.max[1])),b&&(x=Nt(b,c,i-S,i+T,1,te,d.min[1],d.max[1]),w=Nt(b,c,i+M,i+I,1,te,d.min[1],d.max[1])),u>1&&console.timeEnd("clipping"),t.length&&(s.push(m||[],e+1,2*r,2*i),s.push(v||[],e+1,2*r,2*i+1),s.push(x||[],e+1,2*r+1,2*i),s.push(w||[],e+1,2*r+1,2*i+1));}else n&&(h=e);}return h},Ht.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,o=i.debug,a=1<<t,s=Qt(t,e=(e%a+a)%a,r);if(this.tiles[s])return At.tile(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,h=e,c=r;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[Qt(u,h,c)];if(!l||!l.source)return null;if(o>1&&console.log("found parent tile z%d-%d-%d",u,h,c),ee(l,n,i.buffer))return At.tile(l,n);o>1&&console.time("drilling down");var f=this.splitTile(l.source,u,h,c,t,e,r);if(o>1&&console.timeEnd("drilling down"),null!==f){var d=1<<t-f;s=Qt(f,Math.floor(e/d),Math.floor(r/d));}return this.tiles[s]?At.tile(this.tiles[s],n):null};var ie=function(e){function r(r,i,n,o){e.call(this,r,i,re),n&&(this.loadGeoJSON=n),this.projection=o||t.ProjectionType.MERCATOR;}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var n=!!(i&&i.request&&i.request.collectResourceTiming)&&new z.Performance(i.request);this.loadGeoJSON(i,function(o,a){if(o||!a)return r(o);if("object"!=typeof a)return r(new Error("Input data is not a valid GeoJSON object."));F(a,!0);try{i.superclusterOptions&&(i.superclusterOptions.projection=e.projection||t.ProjectionType.MERCATOR),e._geoJSONIndex=i.cluster?(s=i.superclusterOptions,new Mt(s)).load(a.features):Ut(a,i.geojsonVtOptions,e.projection);}catch(o){return r(o)}e.loaded={};var s,l={};if(n){var u=n.finish();u&&(l.resourceTiming={},l.resourceTiming[i.source]=JSON.parse(JSON.stringify(u)));}r(null,l);});}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());},r.prototype.reloadTile=function(t,r){var i=this.loaded,n=t.uid;return i&&i[n]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e();},r.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId));},r.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId));},r.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset));},r}(O),ne=function(e,r,i){this.loadGltf=i||new t.GLTFReader;};ne.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());},ne.prototype._loadData=function(){if(this._pendingCallback&&this._pendingLoadDataParams){var t=this._pendingCallback,e=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;!!(e&&e.request&&e.request.collectResourceTiming)&&new z.Performance(e.request);this.loaded={},this.loadGltf.load(e.request,function(e,r){e&&t(e,null),t(null,{gltf:r.gltf,bufferData:r.bufferData,resourceTiming:{}});});}},ne.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());},ne.prototype.reloadTile=function(t,e){},ne.prototype.loadTile=function(t,e){},ne.prototype.abortTile=function(t,e){},ne.prototype.removeTile=function(t,e){};var oe=function(t,e,r){this.actor=t,this.loading={},this.loaded={};};oe.prototype.loadTile=function(t,e){this.loaded[t.uid]?e(null,this.loaded[t.uid]):this._loadData(t,e);},oe.prototype._loadData=function(e,r){var i=this,n=!!(e&&e.request&&e.request.collectResourceTiming)&&new z.Performance(e.request);this.loading[e.uid]=new t.GLTFReader,this.loading[e.uid].load(e.request,function(t,o){!t&&o||r(t,null),delete i.loading[e.uid];var a={gltf:o.gltf,bufferData:o.bufferData,resourceTiming:{}};if(n){var s=n.finish();s&&(a.resourceTiming[e.source]=JSON.parse(JSON.stringify(s)));}r(null,a);});},oe.prototype.reloadTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&e(null,this.loaded[t.uid]);},oe.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),e();},oe.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e();};var ae={read:function(t,e){return t.readFields(ae._readField,{Geometrys:[],row:0,col:0,col_dpi:0,row_dpi:0,minlon:0,minlat:0,maxlon:0,maxlat:0},e)},_readField:function(t,e,r){1===t?e.Geometrys.push(ae.Geometry.read(r,r.readVarint()+r.pos)):2===t?e.row=r.readVarint():3===t?e.col=r.readVarint():4===t?e.col_dpi=r.readVarint():5===t?e.row_dpi=r.readVarint():6===t?e.minlon=r.readVarint():7===t?e.minlat=r.readVarint():8===t?e.maxlon=r.readVarint():9===t&&(e.maxlat=r.readVarint());},write:function(t,e){if(t.Geometrys)for(var r=0;r<t.Geometrys.length;r++)e.writeMessage(1,ae.Geometry.write,t.Geometrys[r]);t.row&&e.writeVarintField(2,t.row),t.col&&e.writeVarintField(3,t.col),t.col_dpi&&e.writeVarintField(4,t.col_dpi),t.row_dpi&&e.writeVarintField(5,t.row_dpi),t.minlon&&e.writeVarintField(6,t.minlon),t.minlat&&e.writeVarintField(7,t.minlat),t.maxlon&&e.writeVarintField(8,t.maxlon),t.maxlat&&e.writeVarintField(9,t.maxlat);},Geometry:{}};ae.Geometry.read=function(t,e){return t.readFields(ae.Geometry._readField,{x:0,y:0,z:0},e)},ae.Geometry._readField=function(t,e,r){1===t?e.x=r.readVarint():2===t?e.y=r.readVarint():3===t&&(e.z=r.readVarint(!0));},ae.Geometry.write=function(t,e){t.x&&e.writeVarintField(1,t.x),t.y&&e.writeVarintField(2,t.y),t.z&&e.writeVarintField(3,t.z);};var se=function(t){this.originData=t;};se.prototype.parse=function(){this.data=ae.read(new t.default$47(this.originData));},se.prototype.setData=function(t){this.originData=t;},se.prototype.getResult=function(){return this.data};var le=function(t,e,r){this.actor=t,this.loading={},this.loaded={};};le.prototype.loadTile=function(t,e){this._loadData(t,e);},le.prototype._loadData=function(e,r){var i=this;this.loading[e.uid]={imgRequest:null,binRequest:null};var n=[],o=new t.default$49(function(r,n){i.loading[e.uid].imgRequest=t.getArrayBuffer(e.request,function(t,e){t?n(t):r({img:e||null});});});if(n.push(o),e.renderWithTerrain){var a=new t.default$49(function(r,n){e.terrainRequest&&(i.loading[e.uid].binRequest=t.getArrayBuffer(e.terrainRequest,function(t,e){t?n(t):r({terrain:e||null});}));});n.push(a);}t.default$49.all(n).then(function(t){for(var n={},o=0;o<t.length;o++)t[o].img&&(n.img=t[o].img),t[o].terrain&&(i.parseTerrainData(t[o].terrain),n.terrainData=i.demTileData.getResult());delete i.loading[e.uid],i.loaded[e.uid]=n,r(null,n);});},le.prototype.reloadTile=function(t,e){this._loadData(t,e);},le.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&(r[i].imgRequest&&r[i].imgRequest.cancel(),r[i].binRequest&&r[i].binRequest.cancel(),delete r[i]),e();},le.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e();},le.prototype.parseTerrainData=function(t){this.demTileData?this.demTileData.setData(t.data):this.demTileData=new se(t.data),this.demTileData.parse();},le.prototype.trianglesIntersact=function(e,r){var i,n=1/0,o=[],a=new t.default$10(e.ray.origin,e.ray.direction),s={};for(var l in e.tiles){var u=e.tiles[l],h=u.placedAabb;if(h){var c=a.intersectBox(h,[]);if(c){if(t.dot(a.direction,t.sub([],c,a.origin))<0)continue;s[l]=u;}}}for(var f in s)for(var d=s[f],p=0;p<d.data.length;p++){var g=a.intersectTriangle.apply(a,d.data[p].concat([!1],[[]]));if(g){var y=t.dist(e.ray.origin,g);y<n&&(n=y,i=f,o=g);}}if(n!==1/0){var m=[];t.transformGeographicToECEF(m,o),r(null,{dist:n*t.default$27.TRANSFORM.R_ZOOM,savedPoint:o,savedTile:i,lng:m[0],lat:m[1],alt:m[2]*t.default$27.TRANSFORM.R_ZOOM-t.default$27.TRANSFORM.REAL_R});}else r(null,{});},le.prototype._calcAabb=function(t){for(var e=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0,s=0;s<t.length;s++)for(var l=t[s],u=0;u<3;u++){var h=l[u];e>h[0]&&(e=h[0]),n<h[0]&&(n=h[0]),r>h[1]&&(r=h[1]),o<h[1]&&(o=h[1]),i>h[2]&&(i=h[2]),a<h[2]&&(a=h[2]);}return[[e,r,i],[n,o,a]]};var ue=function(e){var r=this;this.self=e,this.actor=new t.default$50(e,this),this.layerIndexes={},this.workerSourceTypes={vector:O,geojson:ie,"3d-model":ne,"3d-tile":oe,raster:le},this.workerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e;},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isLoaded())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText;};};return ue.prototype.setProjection=function(t,e,r){this.projection=e.projection,r();},ue.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r();},ue.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r();},ue.prototype.loadTile=function(t,e,r){e.projection=this.projection,this.getWorkerSource(t,e.type,e.source).loadTile(e,r);},ue.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r);},ue.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r);},ue.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r);},ue.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,r):r();}},ue.prototype.trianglesIntersact=function(t,e,r){"raster"===e.type&&this.getWorkerSource(t,e.type,e.source).trianglesIntersact(e,r);},ue.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r();}catch(t){r(t.toString());}},ue.prototype.loadRTLTextPlugin=function(e,r,i){try{t.plugin.isLoaded()||(this.self.importScripts(r),i(t.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+r)));}catch(t){i(t.toString());}},ue.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},ue.prototype.getWorkerSource=function(e,r,i){var n=this;if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),!this.workerSources[e][r][i]){var o={send:function(t,r,i){n.actor.send(t,r,i,e);}},a=this.projection||t.ProjectionType.MERCATOR;this.workerSources[e][r][i]=new this.workerSourceTypes[r](o,this.getLayerIndex(e),null,a);}return this.workerSources[e][r][i]},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&new ue(self),ue});

define(["./chunk1.js"],function(t){"use strict";var e=t.createCommonjsModule(function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),o=URL.createObjectURL(i);try{e=new Worker(o),t=!0;}catch(e){t=!1;}e&&e.terminate();return URL.revokeObjectURL(o),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(t){void 0===i[t]&&(i[t]=function(t){var i=document.createElement("canvas"),o=Object.create(e.webGLContextAttributes);return o.failIfMajorPerformanceCaveat=t,i.probablySupportsContext?i.probablySupportsContext("webgl",o)||i.probablySupportsContext("experimental-webgl",o):i.supportsContext?i.supportsContext("webgl",o)||i.supportsContext("experimental-webgl",o):i.getContext("webgl",o)||i.getContext("experimental-webgl",o)}(t));return i[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.minemap=window.minemap||{},window.minemap.supported=e);var i={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};});var i=function(){this.images={},this.loaded=!1,this.requestors=[],this.shelfPack=new t.default$1(64,64,{autoResize:!0}),this.patterns={},this.atlasImage=new t.RGBAImage({width:64,height:64}),this.dirty=!0;};i.prototype.isLoaded=function(){return this.loaded},i.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,i=this.requestors;e<i.length;e+=1){var o=i[e],r=o.ids,n=o.callback;this._notify(r,n);}this.requestors=[];}},i.prototype.getImage=function(t){return this.images[t]},i.prototype.addImage=function(t,e){this.images[t]=e;},i.prototype.removeImage=function(t){delete this.images[t];var e=this.patterns[t];e&&(this.shelfPack.unref(e.bin),delete this.patterns[t]);},i.prototype.listImages=function(){return Object.keys(this.images)},i.prototype.getImages=function(t,e){var i=!0;if(!this.isLoaded())for(var o=0,r=t;o<r.length;o+=1){var n=r[o];this.images[n]||(i=!1);}this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e});},i.prototype._notify=function(t,e){for(var i={},o=0,r=t;o<r.length;o+=1){var n=r[o],a=this.images[n];a&&(i[n]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf});}e(null,i);},i.prototype.getPixelSize=function(){return{width:this.shelfPack.w,height:this.shelfPack.h}},i.prototype.getPattern=function(e){var i=this.patterns[e];if(i)return i.position;var o=this.getImage(e);if(!o)return null;var r=o.data.width+2,n=o.data.height+2,a=this.shelfPack.packOne(r,n);if(!a)return null;this.atlasImage.resize(this.getPixelSize());var s=o.data,h=this.atlasImage,l=a.x+1,c=a.y+1,u=s.width,p=s.height;t.RGBAImage.copy(s,h,{x:0,y:0},{x:l,y:c},{width:u,height:p}),t.RGBAImage.copy(s,h,{x:0,y:p-1},{x:l,y:c-1},{width:u,height:1}),t.RGBAImage.copy(s,h,{x:0,y:0},{x:l,y:c+p},{width:u,height:1}),t.RGBAImage.copy(s,h,{x:u-1,y:0},{x:l-1,y:c},{width:1,height:p}),t.RGBAImage.copy(s,h,{x:0,y:0},{x:l+u,y:c},{width:1,height:p}),this.dirty=!0;var d=new t.ImagePosition(a,o);return this.patterns[e]={bin:a,position:d},d},i.prototype.bind=function(e){var i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.default$2(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE);};var o=n,r=1e20;function n(t,e,i,o,r,n){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=o||.25,this.fontFamily=r||"sans-serif",this.fontWeight=n||"normal",this.radius=i||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1));}function a(t,e,i,o,r,n,a){for(var h=0;h<e;h++){for(var l=0;l<i;l++)o[l]=t[l*e+h];for(s(o,r,n,a,i),l=0;l<i;l++)t[l*e+h]=r[l];}for(l=0;l<i;l++){for(h=0;h<e;h++)o[h]=t[l*e+h];for(s(o,r,n,a,e),h=0;h<e;h++)t[l*e+h]=Math.sqrt(r[h]);}}function s(t,e,i,o,n){i[0]=0,o[0]=-r,o[1]=+r;for(var a=1,s=0;a<n;a++){for(var h=(t[a]+a*a-(t[i[s]]+i[s]*i[s]))/(2*a-2*i[s]);h<=o[s];)s--,h=(t[a]+a*a-(t[i[s]]+i[s]*i[s]))/(2*a-2*i[s]);i[++s]=a,o[s]=h,o[s+1]=+r;}for(a=0,s=0;a<n;a++){for(;o[s+1]<a;)s++;e[a]=(a-i[s])*(a-i[s])+t[i[s]];}}n.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),o=0;o<this.size*this.size;o++){var n=e.data[4*o+3]/255;this.gridOuter[o]=1===n?0:0===n?r:Math.pow(Math.max(0,.5-n),2),this.gridInner[o]=1===n?r:0===n?0:Math.pow(Math.max(0,n-.5),2);}for(a(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),a(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),o=0;o<this.size*this.size;o++){var s=this.gridOuter[o]-this.gridInner[o];i[o]=Math.max(0,Math.min(255,Math.round(255-255*(s/this.radius+this.cutoff))));}return i};var h=function(t,e){this.requestTransform=t,this.localIdeographFontFamily=e,this.entries={};};h.prototype.setURL=function(t){this.url=t;},h.prototype.getGlyphs=function(e,i){var o=this,r=[];for(var n in e)for(var a=0,s=e[n];a<s.length;a+=1){var l=s[a];r.push({stack:n,id:l});}t.asyncAll(r,function(t,e){var i=t.stack,r=t.id,n=o.entries[i];n||(n=o.entries[i]={glyphs:{},requests:{}});var a=n.glyphs[r];if(void 0===a)if(a=o._tinySDF(n,i,r))e(null,{stack:i,id:r,glyph:a});else{var s=Math.floor(r/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var l=n.requests[s];l||(l=n.requests[s]=[],h.loadGlyphRange(i,s,o.url,o.requestTransform,function(t,e){if(e)for(var i in e)n.glyphs[+i]=e[+i];for(var o=0,r=l;o<r.length;o+=1){(0,r[o])(t,e);}delete n.requests[s];})),l.push(function(t,o){t?e(t):o&&e(null,{stack:i,id:r,glyph:o[r]||null});});}}else e(null,{stack:i,id:r,glyph:a});},function(t,e){if(t)i(t);else if(e){for(var o={},r=0,n=e;r<n.length;r+=1){var a=n[r],s=a.stack,h=a.id,l=a.glyph;(o[s]||(o[s]={}))[h]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics};}i(null,o);}});},h.prototype._tinySDF=function(e,i,o){var r=this.localIdeographFontFamily;if(r&&(t.default$4["CJK Unified Ideographs"](o)||t.default$4["Hangul Syllables"](o))){var n=e.tinySDF;if(!n){n=e.tinySDF=new h.TinySDF(24,3,10,.25,r,"600");}return{id:o,bitmap:new t.AlphaImage({width:30,height:30},n.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},h.loadGlyphRange=function(e,i,o,r,n){var a=256*i,s=a+255,h=r(t.normalizeGlyphsURL(o).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(h,function(e,i){if(e)n(e);else if(i){for(var o={},r=0,a=t.default$3(i.data);r<a.length;r+=1){var s=a[r];o[s.id]=s;}n(null,o);}});},h.TinySDF=o;var l=function(){this.specification=t.default$5.light.position;};l.prototype.possiblyEvaluate=function(e,i){return t.sphericalToCartesian(e.expression.evaluate(i))},l.prototype.interpolate=function(e,i,o){return{x:t.number(e.x,i.x,o),y:t.number(e.y,i.y,o),z:t.number(e.z,i.z,o)}};var c=new t.Properties({anchor:new t.DataConstantProperty(t.default$5.light.anchor),position:new l,color:new t.DataConstantProperty(t.default$5.light.color),intensity:new t.DataConstantProperty(t.default$5.light.intensity)}),u=function(e){function i(i){e.call(this),this._transitionable=new t.Transitionable(c),this.setLight(i),this._transitioning=this._transitionable.untransitioned();}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(e){if(!this._validate(t.validateLight,e))for(var i in e){var o=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),o):this._transitionable.setValue(i,o);}},i.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning);},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t);},i.prototype._validate=function(e,i){return t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.default$5})))},i}(t.Evented),p=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={};};function d(e,i){var o=t.identity([]);return t.translate(o,o,[1,1,0]),t.scale(o,o,[.5*e.width,.5*e.height,1]),t.multiply(o,o,e.calculatePosMatrix(i.toUnwrapped()))}function f(t,e,i,o,r){var n=function(t,e,i){if(t)for(var o=0,r=t;o<r.length;o+=1){var n=e[r[o]];if(n&&n.source===i&&("extrusion"===n.type||"histogram"===n.type))return!0}else for(var a in e){var s=e[a];if(s.source===i&&("extrusion"===s.type||"histogram"===s.type))return!0}return!1}(o&&o.layers,e,t.id),a=r.maxPitchScaleFactor(),s=t.tilesIn(i,a,n);s.sort(g);for(var h=[],l=0,c=s;l<c.length;l+=1){var u=c[l];h.push({wrappedTileID:u.tileID.wrapped().key,queryResults:u.tile.queryRenderedFeatures(e,t._state,u.queryGeometry,u.cameraQueryGeometry,u.scale,o,r,a,d(t.transform,u.tileID))});}var p=function(t){for(var e={},i={},o=0,r=t;o<r.length;o+=1){var n=r[o],a=n.queryResults,s=n.wrappedTileID,h=i[s]=i[s]||{};for(var l in a)for(var c=a[l],u=h[l]=h[l]||{},p=e[l]=e[l]||[],d=0,f=c;d<f.length;d+=1){var m=f[d];u[m.featureIndex]||(u[m.featureIndex]=!0,m.feature.intersectionZ=m.intersectionZ,p.push(m.feature));}}return e}(h);for(var f in p)p[f].forEach(function(e){var i=t.getFeatureState(e.layer["source-layer"],e.id);e.source=e.layer.source,e.layer["source-layer"]&&(e.sourceLayer=e.layer["source-layer"]),e.state=i;});return p}function m(e,i,o,r,n,a){var s={};if(!r.layers)return{};for(var h=0;h<r.layers.length;h++){var l=r.layers[h];if("sphere-extrusion"===i[l].type){var c=[],u=1/0,p=void 0;e.tilesInOfSphereExtrusion(o,n,i[l]).map(function(e){return(e?e.featureTrangles:[]).map(function(e){for(var i=e.triangles,o=0;o<i.length;o++){var r=a.intersectTriangle.apply(a,i[o].concat([!1],[[]]));if(r){var n=t.dist(a.origin,r);n<u&&(u=n,p=e.feature);}}return null}),null}),p&&c.push({feature:p,intersectionZ:u}),s[""+l]=c;}}return s}function _(t,e,i,o,r,n,a){var s=[],h=t.getSource(),l=!1,c="";for(var u in e){var p=e[u];p.source===t.id&&(c=u,p.useLayerPosition&&(l=!0,p.clearPick(),s=s.concat(p.queryLayerRenderedFeatures(e,i,o,r,n,t))));}if(l||(s=h.queryRenderedFeatures(e,i,o,r,n,t)),0===s.length)return null;l&&(s.sort(function(t,e){return t.intersectionZ-e.intersectionZ}),c=s[0].layer);var d={};return a&&s[0]._parent.highlightMesh(s[0]),d[c]=s,d}function y(t,e,i,o,r,n,a){for(var s=[],h=0,l=t.tilesIn(i,0,!0);h<l.length;h+=1){var c=l[h].queryRenderedFeatures(e,i,o,r,n,t);s=s.concat(c);}for(var u=1/0,p=0,d=0;d<s.length;d++)s[d].intersectionZ<u&&(p=d,u=s[d].intersectionZ);var f="";for(var m in e)e[m].source===t.id&&(f=m);if(0===s.length)return null;var _={},y=s[p];return a?y._parent.highlightMesh(y):y._parent=null,_[f]=[y],_}function v(t,e,i,o,r,n,a,s,h){var l={},c=[];if(a)for(var u=0;u<i.length;u++){var p=i[u],d=s.pointLocation(p,h.z_ndc),f=s.coordinatePoint(s.locationCoordinate(d));c.push(f);}else c=i;for(var m=r.queryRenderedSymbols(c),_=[],y=0,v=Object.keys(m).map(Number);y<v.length;y+=1){var b=v[y];_.push(n[b]);}_.sort(g);for(var w=function(){var e=x[E],i=e.featureIndex.lookupSymbolFeatures(m[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,o.filter,o.layers,t);for(var r in i){var n=l[r]=l[r]||[],a=i[r];a.sort(function(t,i){var o=e.featureSortOrder;if(o){var r=o.indexOf(t.featureIndex);return o.indexOf(i.featureIndex)-r}return i.featureIndex-t.featureIndex});for(var s=0,h=a;s<h.length;s+=1){var c=h[s];n.push(c.feature);}}},E=0,x=_;E<x.length;E+=1)w();var C=function(i){l[i].forEach(function(o){var r=t[i],n=e[r.source].getFeatureState(o.layer["source-layer"],o.id);o.source=o.layer.source,o.layer["source-layer"]&&(o.sourceLayer=o.layer["source-layer"]),o.state=n;});};for(var L in l)C(L);return l}function g(t,e){var i=t.tileID,o=e.tileID;return i.overscaledZ-o.overscaledZ||i.canonical.y-o.canonical.y||i.wrap-o.wrap||i.canonical.x-o.canonical.x}function b(){return new t.default$11.Worker(ee.workerUrl)}p.prototype.getDash=function(t,e){var i=t.join(",")+String(e);return this.positions[i]||(this.positions[i]=this.addDash(t,e)),this.positions[i]},p.prototype.addDash=function(e,i){var o=i?7:0,r=2*o+1;if(this.nextRow+r>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var n=0,a=0;a<e.length;a++)n+=e[a];for(var s=this.width/n,h=s/2,l=e.length%2==1,c=-o;c<=o;c++)for(var u=this.nextRow+o+c,p=this.width*u,d=l?-e[e.length-1]:0,f=e[0],m=1,_=0;_<this.width;_++){for(;f<_/s;)d=f,f+=e[m],l&&m===e.length-1&&(f+=e[0]),m++;var y=Math.abs(_-d*s),v=Math.abs(_-f*s),g=Math.min(y,v),b=m%2==1,w=void 0;if(i){var E=o?c/o*(h+1):0;if(b){var x=h-Math.abs(E);w=Math.sqrt(g*g+x*x);}else w=h-Math.sqrt(g*g+E*E);}else w=(b?1:-1)*g;this.data[3+4*(p+_)]=Math.max(0,Math.min(255,w+128));}var C={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:n};return this.nextRow+=r,this.dirty=!0,C},p.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data));};var w,E=function(){this.active={};};function x(e,i){var o={};for(var r in e)"ref"!==r&&(o[r]=e[r]);return t.default$12.forEach(function(t){t in i&&(o[t]=i[t]);}),o}function C(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var o=0;o<t.length;o++)"ref"in t[o]&&(t[o]=x(t[o],e[t[o].ref]));return t}E.prototype.acquire=function(t){if(!this.workers){var e=ee.workerCount;for(this.workers=[];this.workers.length<e;)this.workers.push(new b);}return this.active[t]=!0,this.workers.slice()},E.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate();}),this.workers=null);};var L={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function M(t,e,i,o){i.push({command:L.addSource,args:[t,e[t],{isOriginal:o}]});}function S(t,e,i){e.push({command:L.removeSource,args:[t]}),i[t]=!0;}function I(t,e,i,o,r){S(t,i,o),M(t,e,i,r);}function T(e,i,o){var r;for(r in e[o])if(e[o].hasOwnProperty(r)&&"data"!==r&&!t.default$13(e[o][r],i[o][r]))return!1;for(r in i[o])if(i[o].hasOwnProperty(r)&&"data"!==r&&!t.default$13(e[o][r],i[o][r]))return!1;return!0}function R(e,i,o,r,n,a){var s;for(s in e=e||{},i=i||{},e)e.hasOwnProperty(s)&&(t.default$13(e[s],i[s])||o.push({command:a,args:[r,s,i[s],n]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.default$13(e[s],i[s])||o.push({command:a,args:[r,s,i[s],n]}));}function $(t){return t.id}function P(t,e){return t[e.id]=e,t}function A(e,i,o){if(!e)return[{command:L.setStyle,args:[i]}];var r=[];try{if(!t.default$13(e.version,i.version))return[{command:L.setStyle,args:[i]}];t.default$13(e.center,i.center)||r.push({command:L.setCenter,args:[i.center]}),t.default$13(e.zoom,i.zoom)||r.push({command:L.setZoom,args:[i.zoom]}),t.default$13(e.bearing,i.bearing)||r.push({command:L.setBearing,args:[i.bearing]}),t.default$13(e.pitch,i.pitch)||r.push({command:L.setPitch,args:[i.pitch]}),t.default$13(e.sprite,i.sprite)||r.push({command:L.setSprite,args:[i.sprite]}),t.default$13(e.glyphs,i.glyphs)||r.push({command:L.setGlyphs,args:[i.glyphs]}),t.default$13(e.transition,i.transition)||r.push({command:L.setTransition,args:[i.transition]}),t.default$13(e.light,i.light)||r.push({command:L.setLight,args:[i.light]});var n={};for(var a in i.layers.forEach(function(t){t._original_style=!0;}),i.sources)i.sources[a]._original_style=!0;var s=[];!function(e,i,o,r,n){var a;for(a in e=e||{},i=i||{},e)e.hasOwnProperty(a)&&(n&&!e[a]._original_style||i.hasOwnProperty(a)||S(a,o,r));for(a in i)i.hasOwnProperty(a)&&(e.hasOwnProperty(a)?t.default$13(e[a],i[a])||("geojson"===e[a].type&&"geojson"===i[a].type&&T(e,i,a)?o.push({command:L.setGeoJSONSourceData,args:[a,i[a].data]}):I(a,i,o,r,i[a]._original_style)):i[a]._original_style?M(a,i,o,!0):M(a,i,o,!1));}(e.sources,i.sources,s,n,o);var h=[];e.layers&&e.layers.forEach(function(t){n[t.source]?r.push({command:L.removeLayer,args:[t.id]}):h.push(t);}),r=r.concat(s),o&&h.forEach(function(t){t._original_style||i.layers.push(t);}),function(e,i,o,r){e=e||[],i=i||[];var n,a,s,h,l,c,u,p=e.map($),d=i.map($),f=e.reduce(P,{}),m=i.reduce(P,{}),_=p.slice(),y=Object.create(null);for(n=0,a=0;n<p.length;n++)s=p[n],r&&f.hasOwnProperty(s)&&!f[s]._original_style?a++:m.hasOwnProperty(s)?a++:(o.push({command:L.removeLayer,args:[s]}),_.splice(_.indexOf(s,a),1));for(n=0,a=0;n<d.length;n++)s=d[d.length-1-n],_[_.length-1-n]!==s&&(f.hasOwnProperty(s)?(o.push({command:L.removeLayer,args:[s]}),_.splice(_.lastIndexOf(s,_.length-a),1)):a++,c=_[_.length-n],o.push({command:L.addLayer,args:[m[s],c,{isOriginal:m[s]._original_style}]}),_.splice(_.length-n,0,s),y[s]=!0);for(n=0;n<d.length;n++)if(h=f[s=d[n]],l=m[s],!y[s]&&!t.default$13(h,l))if(t.default$13(h.source,l.source)&&t.default$13(h["source-layer"],l["source-layer"])&&t.default$13(h.type,l.type)){for(u in R(h.layout,l.layout,o,s,null,L.setLayoutProperty),R(h.paint,l.paint,o,s,null,L.setPaintProperty),t.default$13(h.filter,l.filter)||o.push({command:L.setFilter,args:[s,l.filter]}),t.default$13(h.minzoom,l.minzoom)&&t.default$13(h.maxzoom,l.maxzoom)||o.push({command:L.setLayerZoomRange,args:[s,l.minzoom,l.maxzoom]}),h)h.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?R(h[u],l[u],o,s,u.slice(6),L.setPaintProperty):t.default$13(h[u],l[u])||o.push({command:L.setLayerProperty,args:[s,u,l[u]]}));for(u in l)l.hasOwnProperty(u)&&!h.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?R(h[u],l[u],o,s,u.slice(6),L.setPaintProperty):t.default$13(h[u],l[u])||o.push({command:L.setLayerProperty,args:[s,u,l[u]]}));}else o.push({command:L.removeLayer,args:[s]}),c=_[_.lastIndexOf(s)+1],o.push({command:L.addLayer,args:[l,c,{isOriginal:m[s]._original_style}]});}(h,i.layers,r,o);}catch(t){r=[{command:L.setStyle,args:[i]}];}return r}var D=function(t,e,i){var o=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(var n=0;n<this.xCellCount*this.yCellCount;n++)o.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0;};D.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},D.prototype.insert=function(t,e,i,o,r){this._forEachCell(e,i,o,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(r);},D.prototype.insertCircle=function(t,e,i,o){this._forEachCell(e-o,i-o,e+o,i+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(o);},D.prototype._insertBoxCell=function(t,e,i,o,r,n){this.boxCells[r].push(n);},D.prototype._insertCircleCell=function(t,e,i,o,r,n){this.circleCells[r].push(n);},D.prototype._query=function(t,e,i,o,r,n){if(i<0||t>this.width||o<0||e>this.height)return!r&&[];var a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=o){if(r)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var h=0;h<this.circleKeys.length;h++){var l=this.circles[3*h],c=this.circles[3*h+1],u=this.circles[3*h+2];a.push({key:this.circleKeys[h],x1:l-u,y1:c-u,x2:l+u,y2:c+u});}return n?a.filter(n):a}var p={hitTest:r,seenUids:{box:{},circle:{}}};return this._forEachCell(t,e,i,o,this._queryCell,a,p,n),r?a.length>0:a},D.prototype._queryCircle=function(t,e,i,o,r){var n=t-i,a=t+i,s=e-i,h=e+i;if(a<0||n>this.width||h<0||s>this.height)return!o&&[];var l=[],c={hitTest:o,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(n,s,a,h,this._queryCellCircle,l,c,r),o?l.length>0:l},D.prototype.query=function(t,e,i,o,r){return this._query(t,e,i,o,!1,r)},D.prototype.hitTest=function(t,e,i,o,r){return this._query(t,e,i,o,!0,r)},D.prototype.hitTestCircle=function(t,e,i,o){return this._queryCircle(t,e,i,!0,o)},D.prototype._queryCell=function(t,e,i,o,r,n,a,s){var h=a.seenUids,l=this.boxCells[r];if(null!==l)for(var c=this.bboxes,u=0,p=l;u<p.length;u+=1){var d=p[u];if(!h.box[d]){h.box[d]=!0;var f=4*d;if(t<=c[f+2]&&e<=c[f+3]&&i>=c[f+0]&&o>=c[f+1]&&(!s||s(this.boxKeys[d]))){if(a.hitTest)return n.push(!0),!0;n.push({key:this.boxKeys[d],x1:c[f],y1:c[f+1],x2:c[f+2],y2:c[f+3]});}}}var m=this.circleCells[r];if(null!==m)for(var _=this.circles,y=0,v=m;y<v.length;y+=1){var g=v[y];if(!h.circle[g]){h.circle[g]=!0;var b=3*g;if(this._circleAndRectCollide(_[b],_[b+1],_[b+2],t,e,i,o)&&(!s||s(this.circleKeys[g]))){if(a.hitTest)return n.push(!0),!0;var w=_[b],E=_[b+1],x=_[b+2];n.push({key:this.circleKeys[g],x1:w-x,y1:E-x,x2:w+x,y2:E+x});}}}},D.prototype._queryCellCircle=function(t,e,i,o,r,n,a,s){var h=a.circle,l=a.seenUids,c=this.boxCells[r];if(null!==c)for(var u=this.bboxes,p=0,d=c;p<d.length;p+=1){var f=d[p];if(!l.box[f]){l.box[f]=!0;var m=4*f;if(this._circleAndRectCollide(h.x,h.y,h.radius,u[m+0],u[m+1],u[m+2],u[m+3])&&(!s||s(this.boxKeys[f])))return n.push(!0),!0}}var _=this.circleCells[r];if(null!==_)for(var y=this.circles,v=0,g=_;v<g.length;v+=1){var b=g[v];if(!l.circle[b]){l.circle[b]=!0;var w=3*b;if(this._circlesCollide(y[w],y[w+1],y[w+2],h.x,h.y,h.radius)&&(!s||s(this.circleKeys[b])))return n.push(!0),!0}}},D.prototype._forEachCell=function(t,e,i,o,r,n,a,s){for(var h=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(i),u=this._convertToYCellCoord(o),p=h;p<=c;p++)for(var d=l;d<=u;d++){var f=this.xCellCount*d+p;if(r.call(this,t,e,i,o,f,n,a,s))return}},D.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},D.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},D.prototype._circlesCollide=function(t,e,i,o,r,n){var a=o-t,s=r-e,h=i+n;return h*h>a*a+s*s},D.prototype._circleAndRectCollide=function(t,e,i,o,r,n,a){var s=(n-o)/2,h=Math.abs(t-(o+s));if(h>s+i)return!1;var l=(a-r)/2,c=Math.abs(e-(r+l));if(c>l+i)return!1;if(h<=s||c<=l)return!0;var u=h-s,p=c-l;return u*u+p*p<=i*i};var k=function(t,e,i){void 0===e&&(e=new D(t.width+200,t.height+200,25)),void 0===i&&(i=new D(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200;};function B(t,e,i){t[e+4]=i?1:0;}k.prototype.placeCollisionBox=function(t,e,i,o,r){var n=this.projectAndGetPerspectiveRatio(o,t.anchorPointX,t.anchorPointY),a=i*n.perspectiveRatio,s=t.x1*a+n.point.x,h=t.y1*a+n.point.y,l=t.x2*a+n.point.x,c=t.y2*a+n.point.y;return!this.isInsideGrid(s,h,l,c)||!e&&this.grid.hitTest(s,h,l,c,r)?{box:[],offscreen:!1}:{box:[s,h,l,c],offscreen:this.isOffscreen(s,h,l,c)}},k.prototype.approximateTileDistance=function(t,e,i,o,r){var n=r?1:o/this.pitchfactor,a=t.lastSegmentViewportDistance*i;return t.prevTileDistance+a+(n-1)*a*Math.abs(Math.sin(e))},k.prototype.placeCollisionCircles=function(e,i,o,r,n,a,s,h,l,c,u,p,d,f){var m=[],_=this.projectAnchor(c,a.anchorX,a.anchorY),y=l/24,v=a.lineOffsetX*l,g=a.lineOffsetY*l,b=new t.default$14(a.anchorX,a.anchorY),w=t.project(b,u).point,E=t.placeFirstAndLastGlyph(y,h,v,g,!1,w,b,a,s,u,{},!0),x=!1,C=!1,L=!0,M=_.perspectiveRatio*r,S=1/(r*o),I=0,T=0;E&&(I=this.approximateTileDistance(E.first.tileDistance,E.first.angle,S,_.cameraDistance,d),T=this.approximateTileDistance(E.last.tileDistance,E.last.angle,S,_.cameraDistance,d));for(var R=0;R<e.length;R+=5){var $=e[R],P=e[R+1],A=e[R+2],D=e[R+3];if(!E||D<-I||D>T)B(e,R,!1);else{var k=this.projectPoint(c,$,P),O=A*M;if(m.length>0){var F=k.x-m[m.length-4],z=k.y-m[m.length-3];if(O*O*2>F*F+z*z)if(R+8<e.length){var j=e[R+8];if(j>-I&&j<T){B(e,R,!1);continue}}}var N=R/5;m.push(k.x,k.y,O,N),B(e,R,!0);var U=k.x-O,Z=k.y-O,q=k.x+O,G=k.y+O;if(L=L&&this.isOffscreen(U,Z,q,G),C=C||this.isInsideGrid(U,Z,q,G),!i&&this.grid.hitTestCircle(k.x,k.y,O,f)){if(!p)return{circles:[],offscreen:!1};x=!0;}}}return{circles:x||!C?[]:m,offscreen:L}},k.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var i=[],o=1/0,r=1/0,n=-1/0,a=-1/0,s=0,h=e;s<h.length;s+=1){var l=h[s],c=new t.default$14(l.x+100,l.y+100);o=Math.min(o,c.x),r=Math.min(r,c.y),n=Math.max(n,c.x),a=Math.max(a,c.y),i.push(c);}for(var u={},p={},d=0,f=this.grid.query(o,r,n,a).concat(this.ignoredGrid.query(o,r,n,a));d<f.length;d+=1){var m=f[d],_=m.key;if(void 0===u[_.bucketInstanceId]&&(u[_.bucketInstanceId]={}),!u[_.bucketInstanceId][_.featureIndex]){var y=[new t.default$14(m.x1,m.y1),new t.default$14(m.x2,m.y1),new t.default$14(m.x2,m.y2),new t.default$14(m.x1,m.y2)];t.polygonIntersectsPolygon(i,y)&&(u[_.bucketInstanceId][_.featureIndex]=!0,void 0===p[_.bucketInstanceId]&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex));}}return p},k.prototype.insertCollisionBox=function(t,e,i,o,r){var n={bucketInstanceId:i,featureIndex:o,collisionGroupID:r};(e?this.ignoredGrid:this.grid).insert(n,t[0],t[1],t[2],t[3]);},k.prototype.insertCollisionCircles=function(t,e,i,o,r){for(var n=e?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:o,collisionGroupID:r},s=0;s<t.length;s+=4)n.insertCircle(a,t[s],t[s+1],t[s+2]);},k.prototype.projectAnchor=function(e,i,o){var r=[i,o,0,1];return t.xyTransformMat4(r,r,e),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5,cameraDistance:r[3]}},k.prototype.projectPoint=function(e,i,o){var r=[i,o,0,1];return t.xyTransformMat4(r,r,e),new t.default$14((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100)},k.prototype.projectAndGetPerspectiveRatio=function(e,i,o){var r=[i,o,0,1];return t.xyTransformMat4(r,r,e),{point:new t.default$14((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5}},k.prototype.isOffscreen=function(t,e,i,o){return i<100||t>=this.screenRightBoundary||o<100||e>this.screenBottomBoundary},k.prototype.isInsideGrid=function(t,e,i,o){return i>=0&&t<this.gridRightBoundary&&o>=0&&e<this.gridBottomBoundary};var O=t.default$16.layout,F=function(t,e,i,o){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):o&&i?1:0,this.placed=i;};F.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var z=function(t,e,i,o,r){this.text=new F(t?t.text:null,e,i,r),this.icon=new F(t?t.icon:null,e,o,r);};z.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var j=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i;},N=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={};};N.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}};}return this.collisionGroups[t]};var U=function(t,e,i){this.transform=t,this.collisionIndex=new k(this.transform),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new N(i);};function Z(t,e,i){t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0);}U.prototype.placeLayerTile=function(e,i,o,r){var n=i.getBucket(e),a=i.latestFeatureIndex;if(n&&a&&e.id===n.layerIds[0]){var s=i.collisionBoxArray,h=n.layers[0].layout,l=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),c=i.tileSize/t.default$15,u=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),p=t.getLabelPlaneMatrix(u,"map"===h.get("text-pitch-alignment"),"map"===h.get("text-rotation-alignment"),this.transform,t.default$17(i,1,this.transform.zoom)),d=t.getLabelPlaneMatrix(u,"map"===h.get("icon-pitch-alignment"),"map"===h.get("icon-rotation-alignment"),this.transform,t.default$17(i,1,this.transform.zoom));this.retainedQueryData[n.bucketInstanceId]=new function(t,e,i,o,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=o,this.tileID=r;}(n.bucketInstanceId,a,n.sourceLayerIndex,n.index,i.tileID),this.placeLayerBucket(n,u,p,d,l,c,o,r,s);}},U.prototype.placeLayerBucket=function(e,i,o,r,n,a,s,h,l){for(var c=e.layers[0].layout,u=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom,O.properties["text-size"]),p=c.get("text-optional"),d=c.get("icon-optional"),f=this.collisionGroups.get(e.sourceID),m=0,_=e.symbolInstances;m<_.length;m+=1){var y=_[m];if(!h[y.crossTileID]){var v=!1,g=!1,b=!0,w=null,E=null,x=null,C=0,L=0;y.collisionArrays||(y.collisionArrays=e.deserializeCollisionBoxes(l,y.textBoxStartIndex,y.textBoxEndIndex,y.iconBoxStartIndex,y.iconBoxEndIndex)),y.collisionArrays.textFeatureIndex&&(C=y.collisionArrays.textFeatureIndex),y.collisionArrays.textBox&&(v=(w=this.collisionIndex.placeCollisionBox(y.collisionArrays.textBox,c.get("text-allow-overlap"),a,i,f.predicate)).box.length>0,b=b&&w.offscreen);var M=y.collisionArrays.textCircles;if(M){var S=e.text.placedSymbolArray.get(y.placedTextSymbolIndices[0]),I=t.evaluateSizeForFeature(e.textSizeData,u,S);E=this.collisionIndex.placeCollisionCircles(M,c.get("text-allow-overlap"),n,a,y.key,S,e.lineVertexArray,e.glyphOffsetArray,I,i,o,s,"map"===c.get("text-pitch-alignment"),f.predicate),v=c.get("text-allow-overlap")||E.circles.length>0,b=b&&E.offscreen;}y.collisionArrays.iconFeatureIndex&&(L=y.collisionArrays.iconFeatureIndex),y.collisionArrays.iconBox&&(g=(x=this.collisionIndex.placeCollisionBox(y.collisionArrays.iconBox,c.get("icon-allow-overlap"),a,i,f.predicate)).box.length>0,b=b&&x.offscreen);var T=p||0===y.numGlyphVertices&&0===y.numVerticalGlyphVertices,R=d||0===y.numIconVertices;T||R?R?T||(g=g&&v):v=g&&v:g=v=g&&v,v&&w&&this.collisionIndex.insertCollisionBox(w.box,c.get("text-ignore-placement"),e.bucketInstanceId,C,f.ID),g&&x&&this.collisionIndex.insertCollisionBox(x.box,c.get("icon-ignore-placement"),e.bucketInstanceId,L,f.ID),v&&E&&this.collisionIndex.insertCollisionCircles(E.circles,c.get("text-ignore-placement"),e.bucketInstanceId,C,f.ID),this.placements[y.crossTileID]=new j(v,g,b||e.justReloaded),h[y.crossTileID]=!0;}}e.justReloaded=!1;},U.prototype.commit=function(t,e){this.commitTime=e;var i=!1,o=t&&0!==this.fadeDuration?(this.commitTime-t.commitTime)/this.fadeDuration:1,r=t?t.opacities:{};for(var n in this.placements){var a=this.placements[n],s=r[n];s?(this.opacities[n]=new z(s,o,a.text,a.icon),i=i||a.text!==s.text.placed||a.icon!==s.icon.placed):(this.opacities[n]=new z(null,o,a.text,a.icon,a.skipFade),i=i||a.text||a.icon);}for(var h in r){var l=r[h];if(!this.opacities[h]){var c=new z(l,o,!1,!1);c.isHidden()||(this.opacities[h]=c,i=i||l.text.placed||l.icon.placed);}}i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e);},U.prototype.updateLayerOpacities=function(t,e){for(var i={},o=0,r=e;o<r.length;o+=1){var n=r[o],a=n.getBucket(t);a&&n.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,i,n.collisionBoxArray);}},U.prototype.updateBucketOpacities=function(t,e,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();for(var o=t.layers[0].layout,r=new z(null,0,!1,!1,!0),n=new z(null,0,o.get("text-allow-overlap"),o.get("icon-allow-overlap"),!0),a=0;a<t.symbolInstances.length;a++){var s=t.symbolInstances[a],h=e[s.crossTileID],l=this.opacities[s.crossTileID];h?l=r:l||(l=n,this.opacities[s.crossTileID]=l),e[s.crossTileID]=!0;var c=s.numGlyphVertices>0||s.numVerticalGlyphVertices>0,u=s.numIconVertices>0;if(c){for(var p=Y(l.text),d=(s.numGlyphVertices+s.numVerticalGlyphVertices)/4,f=0;f<d;f++)t.text.opacityVertexArray.emplaceBack(p);for(var m=0,_=s.placedTextSymbolIndices;m<_.length;m+=1){var y=_[m];t.text.placedSymbolArray.get(y).hidden=l.text.isHidden();}}if(u){for(var v=Y(l.icon),g=0;g<s.numIconVertices/4;g++)t.icon.opacityVertexArray.emplaceBack(v);t.icon.placedSymbolArray.get(a).hidden=l.icon.isHidden();}s.collisionArrays||(s.collisionArrays=t.deserializeCollisionBoxes(i,s.textBoxStartIndex,s.textBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex));var b=s.collisionArrays;if(b){b.textBox&&t.hasCollisionBoxData()&&Z(t.collisionBox.collisionVertexArray,l.text.placed,!1),b.iconBox&&t.hasCollisionBoxData()&&Z(t.collisionBox.collisionVertexArray,l.icon.placed,!1);var w=b.textCircles;if(w&&t.hasCollisionCircleData())for(var E=0;E<w.length;E+=5){var x=h||0===w[E+4];Z(t.collisionCircle.collisionVertexArray,l.text.placed,x);}}}t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray);},U.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},U.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},U.prototype.stillRecent=function(t){return"undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>t},U.prototype.setStale=function(){this.stale=!0;};var q=Math.pow(2,25),G=Math.pow(2,24),W=Math.pow(2,17),V=Math.pow(2,16),K=Math.pow(2,9),H=Math.pow(2,8),X=Math.pow(2,1);function Y(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*q+e*G+i*W+e*V+i*K+e*H+i*X+e}var J=function(){this._currentTileIndex=0,this._seenCrossTileIDs={};};J.prototype.continuePlacement=function(t,e,i,o,r){for(;this._currentTileIndex<t.length;){var n=t[this._currentTileIndex];if(e.placeLayerTile(o,n,i,this._seenCrossTileIDs),this._currentTileIndex++,r())return!0}};var Q=function(t,e,i,o,r,n){this.placement=new U(t,r,n),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=o,this._done=!1;};Q.prototype.isDone=function(){return this._done},Q.prototype.continuePlacement=function(e,i,o){for(var r=this,n=t.default.now(),a=function(){var e=t.default.now()-n;return!r._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=i[e[r._currentPlacementIndex]],h=r.placement.collisionIndex.transform.zoom;if(("symbol"===s.type||"symtracking"===s.type||"sphere-symbol"===s.type)&&(!s.minzoom||s.minzoom<=h)&&(!s.maxzoom||s.maxzoom>h)){if(r._inProgressLayer||(r._inProgressLayer=new J),r._inProgressLayer.continuePlacement(o[s.source],r.placement,r._showCollisionBoxes,s,a))return;delete r._inProgressLayer;}r._currentPlacementIndex--;}this._done=!0;},Q.prototype.commit=function(t,e){return this.placement.commit(t,e),this.placement};var tt=function(e,i){return t.emitValidationErrors(e,i&&i.filter(function(t){return"source.canvas"!==t.identifier}))},et=t.pick(L,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),it=t.pick(L,["setCenter","setZoom","setBearing","setPitch"]),ot=function(e){function o(r,n){var a=this;void 0===n&&(n={}),e.call(this),this.map=r,this.dispatcher=new t.default$22((w||(w=new E),w),this),this.imageManager=new i,this.glyphManager=new h(r._transformRequest,n.localIdeographFontFamily),this.lineAtlas=new p(256,512),this.crossTileSymbolIndex=new t.default$25,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.default$24,this._loaded=!1,this.sttc=new t.default$19(this.dispatcher,1e3),this.shouldUpdateSource=!0,this._resetUpdates();var s=this;this._rtlTextPluginCallback=o.registerForPluginAvailability(function(t){for(var e in s.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.completionCallback),s.sourceCaches)s.sourceCaches[e].reload();}),this.changWorkerProjection(n.projection||t.ProjectionType.MERCATOR),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=a.sourceCaches[t.sourceId];if(e){var i=e.getSource();if(i&&i.vectorLayerIds)for(var o in a._layers){var r=a._layers[o];r.source===i.id&&a._validateLayer(r);}}}});}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype.changWorkerProjection=function(t){this.dispatcher.broadcast("setProjection",{projection:t},function(t){});},o.prototype.loadURL=function(e,i){var o=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var r="boolean"==typeof i.validate?i.validate:!t.isMinemapURL(e);e=t.normalizeStyleURL(e,i.appKey);var n=this.map._transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(n,function(e,i){o._request=null,e?o.fire(new t.ErrorEvent(e)):i&&o._load(i,r);});},o.prototype.loadJSON=function(e,i){var o=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.default.frame(function(){o._request=null,o._load(e,!1!==i.validate);});},o.prototype.markOriginalStyle=function(t){for(var e in t.sourceCaches)t.sourceCaches[e]._original_style=!0;for(var i in t._layers)t._layers[i]._original_style=!0;},o.prototype._load=function(e,i){var o=this;if(!i||!tt(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)o.addSource(r,e.sources[r],{validate:!1});e.sprite?this._spriteRequest=function(e,i,o){var r,n,a,s=t.default.devicePixelRatio>1?"@2x":"",h=t.getJSON(i(t.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),function(t,e){h=null,a||(a=t,r=e,c());}),l=t.getImage(i(t.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),function(t,e){l=null,a||(a=t,n=e,c());});function c(){if(a)o(a);else if(r&&n){var e=t.default.getImageData(n),i={};for(var s in r){var h=r[s],l=h.width,c=h.height,u=h.x,p=h.y,d=h.sdf,f=h.pixelRatio,m=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,m,{x:u,y:p},{x:0,y:0},{width:l,height:c}),i[s]={data:m,pixelRatio:f,sdf:d};}o(null,i);}}return{cancel:function(){h&&(h.cancel(),h=null),l&&(l.cancel(),l=null);}}}(e.sprite,this.map._transformRequest,function(e,i){if(o._spriteRequest=null,e)o.fire(new t.ErrorEvent(e));else if(i)for(var r in i)o.imageManager.addImage(r,i[r]);o.imageManager.setLoaded(!0),o.fire(new t.Event("data",{dataType:"style"}));}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var n,a,s=C(this.stylesheet.layers);this._order=s.map(function(t){return t.id}),this._layers={};for(var h=0,l=s;h<l.length;h+=1){var c=l[h];(c=t.default$21(c)).setEventedParent(o,{layer:{id:c.id}}),o._layers[c.id]=c;}for(var p in this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.markOriginalStyle(this),this.light=new u(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load")),o._layers){var d=o._layers[p];"Worldwaterface"===d.source&&"Worldwaterface"===d.sourceLayer&&(a=d.getPaintProperty("fill-color")),"Worldcountries"===d.source&&"Worldcountries"===d.sourceLayer&&(n=d.getPaintProperty("fill-color"));}for(var f in o._layers){var m=o._layers[f];"sphere-background"===m.type&&(m.northVectorColor=a,m.sourthVectorColor=n);}}},o.prototype._validateLayer=function(e){var i=this.sourceCaches[e.source];if(i){var o=e.sourceLayer;if(o){var r=i.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(o))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+o+'" does not exist on source "'+r.id+'" as specified by style layer "'+e.id+'"')));}}},o.prototype.enableSunLight=function(){this._sunLightFlag=!0;},o.prototype.disableSunLight=function(){this._sunLightFlag=!1;},o.prototype.getSharedTerrainTileCache=function(){return this.sttc},o.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},o.prototype._serializeLayers=function(t){for(var e=[],i=0,o=t;i<o.length;i+=1){var r=o[i],n=this._layers[r];"custom"!==n.type&&e.push(n.serialize());}return e},o.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},o.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},o.prototype.update=function(e){if(this._loaded){if(this._changed){var i=Object.keys(this._updatedLayers),o=Object.keys(this._removedLayers);for(var r in(i.length||o.length)&&this._updateWorkerLayers(i,o),this._updatedSources){var n=this._updatedSources[r];"reload"===n?this._reloadSource(r):"clear"===n&&this._clearSource(r);}for(var a in this._updatedPaintProps)this._layers[a].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates(),this.fire(new t.Event("data",{dataType:"style"}));}for(var s in this.sourceCaches)this.sourceCaches[s].used=!1;for(var h=0,l=this._order;h<l.length;h+=1){var c=l[h],u=this._layers[c];u.recalculate(e),!u.isHidden(e.zoom)&&u.source&&(this.sourceCaches[u.source].used=!0);}this.light.recalculate(e),this.z=e.zoom;}},o.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e});},o.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={};},o.prototype.setState=function(e,i){var o=this;if(this._checkLoaded(),tt(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=C(e.layers);var r=A(this.roughSerialize(),e,i).filter(function(t){return!(t.command in it)});if(0===r.length)return!1;var n,a,s=r.filter(function(t){return!(t.command in et)});if(s.length>0)throw new Error("Unimplemented: "+s.map(function(t){return t.command}).join(", ")+".");for(var h in r.forEach(function(t){"setTransition"!==t.command&&o[t.command].apply(o,t.args);}),this.stylesheet=e,o._layers){var l=o._layers[h];"Worldwaterface"===l.source&&"Worldwaterface"===l.sourceLayer&&(a=l.getPaintProperty("fill-color")),"Worldcountries"===l.source&&"Worldcountries"===l.sourceLayer&&(n=l.getPaintProperty("fill-color"));}for(var c in o._layers){var u=o._layers[c];"sphere-background"===u.type&&(u.northVectorColor=a,u.sourthVectorColor=n);}return!0},o.prototype.addImage=function(e,i){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,i),this.fire(new t.Event("data",{dataType:"style"}));},o.prototype.getImage=function(t){return this.imageManager.getImage(t)},o.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new t.Event("data",{dataType:"style"}));},o.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},o.prototype.addSource=function(e,i,o){var r=this;if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!i.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(i).join(", ")+".");this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);var n=this.sourceCaches[e]=function(e,i,o,r){return"3d-tile"===i.type?new t.default$8(e,i,o):new t.default$18(e,i,o,r)}(e,i,this.dispatcher,this.sttc);o&&o.isOriginal&&(this.sourceCaches[e]._original_style=!0),n.style=this,n.setEventedParent(this,function(){return{isSourceLoaded:r.loaded(),source:n.serialize(),sourceId:e}}),n.onAdd(this.map),this._changed=!0;},o.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+i+'" is using it.')));var o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.clearTiles(),o.onRemove&&o.onRemove(this.map),this._changed=!0;},o.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0;},o.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},o.prototype.addLayer=function(e,i,o){this._checkLoaded();var r=e.id;if(this.getLayer(r))this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" already exists on this map')));else{var n;if("custom"===e.type)n=t.default$21(e);else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,"layers."+r,e,{arrayIndex:-1},o))return;n=t.default$21(e),this._validateLayer(n),n.setEventedParent(this,{layer:{id:r}});}var a=i?this._order.indexOf(i):this._order.length;if(i&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.')));else{if(this._order.splice(a,0,r),this._layerOrderChanged=!0,this._layers[r]=n,o&&o.isOriginal&&(this._layers[r]._original_style=!0),this._removedLayers[r]&&n.source&&"custom"!==n.type){var s=this._removedLayers[r];delete this._removedLayers[r],s.type!==n.type?this._updatedSources[n.source]="clear":(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause());}this._updateLayer(n),n.onAdd&&n.onAdd(this.map);}}},o.prototype.moveLayer=function(e,i){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==i){var o=this._order.indexOf(e);this._order.splice(o,1);var r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.'))):(this._order.splice(r,0,e),this._layerOrderChanged=!0);}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")));},o.prototype.removeLayer=function(e){this._checkLoaded();var i=this._layers[e];if(i){i.setEventedParent(null);var o=this._order.indexOf(e);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map);}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")));},o.prototype.getLayer=function(t){return this._layers[t]},o.prototype.setLayerZoomRange=function(e,i,o){this._checkLoaded();var r=this.getLayer(e);r?r.minzoom===i&&r.maxzoom===o||(null!=i&&(r.minzoom=i),null!=o&&(r.maxzoom=o),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")));},o.prototype.setSourceFilter=function(t,e){var i=this.getSource(t);i&&(i.setFilter(e),this._reloadSource(t));},o.prototype.setFilter=function(e,i){this._checkLoaded();var o=this.getLayer(e);if(o){if(!t.default$13(o.filter,i))return null===i||void 0===i?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(t.validateStyle.filter,"layers."+o.id+".filter",i)||(o.filter=t.clone$1(i),this._updateLayer(o)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")));},o.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},o.prototype.setLayoutProperty=function(e,i,o){this._checkLoaded();var r=this.getLayer(e);r?t.default$13(r.getLayoutProperty(i),o)||(r.setLayoutProperty(i,o),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")));},o.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},o.prototype.setPaintProperty=function(e,i,o){this._checkLoaded();var r=this.getLayer(e);r?t.default$13(r.getPaintProperty(i),o)||(r.setPaintProperty(i,o)&&this._updateLayer(r),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")));},o.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},o.prototype.setFeatureState=function(e,i){this._checkLoaded();var o=e.source,r=e.sourceLayer,n=this.sourceCaches[o];void 0!==n?"vector"!==n.getSource().type||r?n.setFeatureState(r,e.id,i):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types."))):this.fire(new t.ErrorEvent(new Error("The source '"+o+"' does not exist in the map's style.")));},o.prototype.getFeatureState=function(e){this._checkLoaded();var i=e.source,o=e.sourceLayer,r=this.sourceCaches[i];if(void 0!==r){if("vector"!==r.getSource().type||o)return r.getFeatureState(o,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")));},o.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},o.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._serializeLayers(this._order)},function(t){return void 0!==t})},o.prototype.roughSerialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:this.sourceCaches,layers:this._serializeLayers(this._order)},function(t){return void 0!==t})},o.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0;},o.prototype._flattenRenderedFeatures=function(t){for(var e=[],i=[],o=this._order.length-1;o>=0;o--)for(var r=this._order[o],n=0,a=t;n<a.length;n+=1){var s=a[n][r];if(s)if("extrusion"===this._layers[r].type||"histogram"===this._layers[r].type||"3d-tile"===this._layers[r].type||"3d-model"===this._layers[r].type)for(var h=0,l=s;h<l.length;h+=1){var c=l[h];i.push(c);}else for(var u=0,p=s;u<p.length;u+=1){var d=p[u];e.push(d);}}i.sort(function(t,e){return t.intersectionZ-e.intersectionZ});for(var f=0,m=i;f<m.length;f+=1){var _=m[f];e.push(_);}return e},o.prototype.queryRenderedFeatures=function(e,i,o){i&&i.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",i.filter);var r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var n=0,a=i.layers;n<a.length;n+=1){var s=a[n],h=this._layers[s];if(!h)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];r[h.source]=!0;}}var l=[];if(this.map.sphereRender){for(var c in this.ray=this.map.painter.getPickRay(e[0]),this.fire(new t.Event("data",{})),this.sourceCaches)if(!i.layers||r[c]){var u=this.sourceCaches[c].getSource().type;if("3d-tile"===u){var p=y(this.sourceCaches[c],this._layers,e,i,o,this.ray,!!i.modelHighlight);p&&l.push(p);}else if("3d-model"===u){var d=_(this.sourceCaches[c],this._layers,e,i,o,this.ray,!!i.modelHighlight);d&&l.push(d);}else l.push(m(this.sourceCaches[c],this._layers,e,i,o,this.ray)),i.modelHighlight||(l.push(f(this.sourceCaches[c],this._layers,e,i,o)),this.placement&&l.push(v(this._layers,this.sourceCaches,e,i,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.sphereRender,o,this.ray)));}}else{for(var g in this.sourceCaches)i.layers&&!r[g]||l.push(f(this.sourceCaches[g],this._layers,e,i,o));this.placement&&l.push(v(this._layers,this.sourceCaches,e,i,this.placement.collisionIndex,this.placement.retainedQueryData));}return this._flattenRenderedFeatures(l)},o.prototype.querySourceFeatures=function(e,i){i&&i.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",i.filter);var o=this.sourceCaches[e];return o?function(t,e){for(var i=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),o=[],r={},n=0;n<i.length;n++){var a=i[n],s=a.tileID.canonical.key;r[s]||(r[s]=!0,a.querySourceFeatures(o,e));}return o}(o,i):[]},o.prototype.querySpherePosition=function(t,e){return this.ray=this.map.painter.getPickRay(t.point),this.sttc.queryTileIntersectPoint(this.map.transform,e,t,this.ray)},o.prototype.addSourceType=function(t,e,i){return o.getSourceType(t)?i(new Error('A source type called "'+t+'" already exists.')):(o.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},o.prototype.getTerrainAltitude=function(){if(!this.map.sphereRender)return!1;for(var e in this.sourceCaches){var i=this.sourceCaches[e]._source;if(i instanceof t.default$26&&i.renderWithTerrain&&i.terrainTiles&&i.terrainTiles.length>0)return this.sttc.queryOneTileIntersectPoint(this.map.transform)}return t.default$27.TRANSFORM.ERR_TERRAIN_ALT},o.prototype.getLight=function(){return this.light.getLight()},o.prototype.setLight=function(e){this._checkLoaded();var i=this.light.getLight(),o=!1;for(var r in e)if(!t.default$13(e[r],i[r])){o=!0;break}if(o){var n={now:t.default.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e),this.light.updateTransitions(n);}},o.prototype._validate=function(e,i,o,r,n){return(!n||!1!==n.validate)&&tt(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:o,styleSpec:t.default$5},r)))},o.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[e].clearTiles();this.dispatcher.remove();},o.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles();},o.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload();},o.prototype._updateSources=function(t){for(var e in this.sourceCaches)(this.map.sphereRender&&this.sourceCaches[e]._source.isEarthSource()||!this.map.sphereRender&&(!this.sourceCaches[e]._source.isEarthSource()||"all"===this.sourceCaches[e]._source.tileUsage))&&(this.shouldUpdateSource||Math.round(t.zoom)%2==0)&&(this.map.panoramaMode||this.sourceCaches[e].update(t));},o.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t);},o.prototype._updatePlacement=function(e,i,o,r){for(var n=!1,a=!1,s={},h=0,l=this._order;h<l.length;h+=1){var c=l[h],u=this._layers[c];if("symbol"===u.type||"symtracking"===u.type||"sphere-symbol"===u.type){if(!s[u.source]){var p=this.sourceCaches[u.source];s[u.source]=p.getRenderableIds().map(function(t){return p.getTileByID(t)}).sort(function(t,e){return("string"!=typeof t.tileID&&"string"!=typeof e.tileID?e.tileID.overscaledZ-t.tileID.overscaledZ:0)||("string"!=typeof t.tileID&&"string"!=typeof e.tileID&&t.tileID.isLessThan(e.tileID)?-1:1)});}var d=this.crossTileSymbolIndex.addLayer(u,s[u.source],e.center.lng);n=n||d;}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var f=this._layerOrderChanged;if((f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.default.now()))&&(this.pauseablePlacement=new Q(e,this._order,f,i,o,r),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,t.default.now()),a=!0),n&&this.pauseablePlacement.placement.setStale()),a||n)for(var m=0,_=this._order;m<_.length;m+=1){var y=_[m],v=this._layers[y];"symbol"!==v.type&&"symtracking"!==v.type&&"sphere-symbol"!==v.type||this.placement.updateLayerOpacities(v,s[v.source]);}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.default.now())},o.prototype.getImages=function(t,e,i){this.imageManager.getImages(e.icons,i);},o.prototype.getGlyphs=function(t,e,i){this.glyphManager.getGlyphs(e.stacks,i);},o}(t.Evented);ot.getSourceType=t.getType,ot.setSourceType=t.setType,ot.registerForPluginAvailability=t.registerForPluginAvailability;var rt=function(){var e,i,o,r,n;t.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),i=300,o=!1,r=0,n=function(){r=0,o&&(e(),r=setTimeout(n,i),o=!1);},function(){return o=!0,r||n(),r});};rt.prototype.addTo=function(e){return this._map=e,t.default$11.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},rt.prototype.remove=function(){return t.default$11.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},rt.prototype.getHashString=function(t){var e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,o=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,o),n=Math.round(e.lng*r)/r,a=Math.round(e.lat*r)/r,s=this._map.getBearing(),h=this._map.getPitch(),l="";return l+=t?"#/"+n+"/"+a+"/"+i:"#"+i+"/"+a+"/"+n,(s||h)&&(l+="/"+Math.round(10*s)/10),h&&(l+="/"+Math.round(h)),l},rt.prototype._onHashChange=function(){var e=t.default$11.location.hash.replace("#","").split("/");return e.length>=3&&(this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:+(e[3]||0),pitch:+(e[4]||0)}),!0)},rt.prototype._updateHashUnthrottled=function(){var e=this.getHashString();t.default$11.history.replaceState(t.default$11.history.state,"",e);};var nt=function(e){function i(i,o,r,n){void 0===n&&(n={});var a=t.default$28.mousePos(o.getCanvasContainer(),r),s=o.unproject(a);e.call(this,i,t.extend({point:a,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=o;}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var o={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0;},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,o),i}(t.Event),at=function(e){function i(i,o,r){var n=t.default$28.touchPos(o.getCanvasContainer(),r),a=n.map(function(t){return o.unproject(t)}),s=n.reduce(function(t,e,i,o){return t.add(e.div(o.length))},new t.default$14(0,0)),h=o.unproject(s);e.call(this,i,{points:n,point:s,lngLats:a,lngLat:h,originalEvent:r}),this._defaultPrevented=!1;}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var o={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0;},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,o),i}(t.Event),st=function(t){function e(e,i,o){t.call(this,e,{originalEvent:o}),this._defaultPrevented=!1;}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0;},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,i),e}(t.Event),ht=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this);};ht.prototype.isEnabled=function(){return!!this._enabled},ht.prototype.isActive=function(){return!!this._active},ht.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around);},ht.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},ht.prototype.onWheel=function(e){if(this.isEnabled()){var i=e.deltaMode===t.default$11.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,o=t.default.now(),r=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this.isActive()||this._start(e)),e.preventDefault();}},ht.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t);},ht.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e})),this._finishTimeout&&clearTimeout(this._finishTimeout);var i=t.default$28.mousePos(this._el,e);this._around=t.default$29.convert(!this._map.unproject(i)||this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame));}},ht.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var i=this._map.transform;if(0!==this._delta){var o="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?1/450:.01,r=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&0!==r&&(r=1/r);var n="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(n*r))),"wheel"===this._type&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0;}var a="number"==typeof this._targetZoom?this._targetZoom:i.zoom,s=this._startZoom,h=this._easing,l=!1;if("wheel"===this._type&&s&&h){var c=Math.min((t.default.now()-this._lastWheelEventTime)/200,1),u=h(c);i.zoom=t.number(s,a,u),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):l=!0;}else i.zoom=a,l=!0;i.panoramaMode||i.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),l&&(this._active=!1,this._finishTimeout=setTimeout(function(){e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom;},200));}},ht.prototype._smoothOutEasing=function(e){var i=t.ease;if(this._prevEase){var o=this._prevEase,r=(t.default.now()-o.start)/o.duration,n=o.easing(r+.01)-o.easing(r),a=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-a*a);i=t.bezier(a,s,.25,1);}return this._prevEase={start:t.default.now(),duration:e,easing:i},i};var lt=function(e,i){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this);};lt.prototype.isEnabled=function(){return!!this._enabled},lt.prototype.isActive=function(){return!!this._active},lt.prototype.enable=function(){this.isEnabled()||(this._enabled=!0);},lt.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},lt.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.default$11.document.addEventListener("mousemove",this._onMouseMove,!1),t.default$11.document.addEventListener("keydown",this._onKeyDown,!1),t.default$11.document.addEventListener("mouseup",this._onMouseUp,!1),t.default$28.disableDrag(),this._startPos=this._lastPos=t.default$28.mousePos(this._el,e),this._active=!0);},lt.prototype._onMouseMove=function(e){var i=t.default$28.mousePos(this._el,e);if(!(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)){var o=this._startPos;this._lastPos=i,this._box||(this._box=t.default$28.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",e));var r=Math.min(o.x,i.x),n=Math.max(o.x,i.x),a=Math.min(o.y,i.y),s=Math.max(o.y,i.y);t.default$28.setTransform(this._box,"translate("+r+"px,"+a+"px)"),this._box.style.width=n-r+"px",this._box.style.height=s-a+"px";}},lt.prototype._onMouseUp=function(e){if(0===e.button){var i=this._startPos,o=t.default$28.mousePos(this._el,e),r=(new t.default$30).extend(this._map.unproject(i)).extend(this._map.unproject(o));this._finish(),t.default$28.suppressClick(),i.x===o.x&&i.y===o.y?this._fireEvent("boxzoomcancel",e):this._map.fitBounds(r,{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e,boxZoomBounds:r}));}},lt.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t));},lt.prototype._finish=function(){this._active=!1,t.default$11.document.removeEventListener("mousemove",this._onMouseMove,!1),t.default$11.document.removeEventListener("keydown",this._onKeyDown,!1),t.default$11.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("minemap-crosshair"),this._box&&(t.default$28.remove(this._box),this._box=null),t.default$28.enableDrag(),delete this._startPos,delete this._lastPos;},lt.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))};var ct=t.bezier(0,0,.25,1),ut=function(e,i){this._map=e,this._el=i.element||e.getCanvasContainer(),this._state="disabled",this._button=i.button||"right",this._bearingSnap=i.bearingSnap||0,this._pitchWithRotate=!1!==i.pitchWithRotate,this._enabledFocusMode=!1,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this);};ut.prototype.isEnabled=function(){return"disabled"!==this._state},ut.prototype.isActive=function(){return"active"===this._state},ut.prototype.enable=function(){this.isEnabled()||(this._state="enabled");},ut.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled";}},ut.prototype.onMouseDown=function(e){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=t.default$28.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==t.default$28.mouseButton(e))return;this._eventButton=0;}t.default$28.disableDrag(),e.altKey&&!this._map.fPMode&&(this._enabledFocusMode=!0),t.default$11.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.default$11.document.addEventListener("mouseup",this._onMouseUp),t.default$11.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.default.now(),this._map.getBearing()]],this._startPos=this._lastPos=t.default$28.mousePos(this._el,e),this._focusPos=this._startPos;var i=this._map.unproject(this._focusPos);this._focusCenter=t.transformECEFToGeographic([],i?i.toArray():this._map.getCenter().toArray(),t.default$27.TRANSFORM.R),e.preventDefault();}},ut.prototype._onMouseMove=function(e){var i=t.default$28.mousePos(this._el,e);this._lastPos.equals(i)||(this._lastMoveEvent=e,this._lastPos=i,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",e),this._fireEvent("movestart",e),this._pitchWithRotate&&this._fireEvent("pitchstart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)));},ut.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var i=this._map.transform,o=this._startPos,r=this._lastPos,n=.8*(o.x-r.x),a=-.5*(o.y-r.y),s=i.bearing-n,h=i.pitch-a,l=this._inertia,c=l[l.length-1];if(this._drainInertiaBuffer(),l.push([t.default.now(),this._map._normalizeBearing(s,c[1])]),this._enabledFocusMode){var u=this._map,p=n*t.default$27.TRANSFORM.DEG_TO_RAD,d=t.transformECEFToGeographic([],u.transform.center.toArray(),t.default$27.TRANSFORM.R),f=t.fromRotation([],-p,this._focusCenter),m=t.transformMat4$1([],d.concat([1]),f);u.transform.center=t.default$29.convert(t.transformGeographicToECEF([],m).slice(0,2));}i.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",e),i.pitch=h),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._startPos=this._lastPos;}},ut.prototype._onMouseUp=function(e){if(t.default$28.mouseButton(e)===this._eventButton)switch(this._enabledFocusMode&&(this._enabledFocusMode=!1),this._state){case"active":this._state="enabled",t.default$28.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(e);break;case"pending":this._state="enabled",this._unbind();}},ut.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind();}},ut.prototype._unbind=function(){t.default$11.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.default$11.document.removeEventListener("mouseup",this._onMouseUp),t.default$11.removeEventListener("blur",this._onBlur),t.default$28.enableDrag();},ut.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._lastPos;},ut.prototype._inertialRotate=function(e){var i=this;this._fireEvent("rotateend",e),this._drainInertiaBuffer();var o=this._map,r=o.getBearing(),n=this._inertia,a=function(){Math.abs(r)<i._bearingSnap?o.resetNorth({noMoveStart:!0},{originalEvent:e}):i._fireEvent("moveend",e),i._pitchWithRotate&&i._fireEvent("pitchend",e);};if(n.length<2)a();else{var s=n[0],h=n[n.length-1],l=n[n.length-2],c=o._normalizeBearing(r,l[1]),u=h[1]-s[1],p=u<0?-1:1,d=(h[0]-s[0])/1e3;if(0!==u&&0!==d){var f=Math.abs(u*(.25/d));f>180&&(f=180);var m=f/180;if(c+=p*f*(m/2),Math.abs(o._normalizeBearing(c,0))<this._bearingSnap&&(c=o._normalizeBearing(0,c)),this._enabledFocusMode&&!o.fPMode){var _=c-o.transform.angle,y=t.transformECEFToGeographic([],o.transform.center.toArray(),t.default$27.TRANSFORM.R),v=t.fromRotation([],-_,this._focusCenter),g=t.transformMat4$1([],y.concat([1]),v);o.transform.center=t.default$29.convert(t.transformGeographicToECEF([],g).slice(0,2)),o.rotateTo(c,{duration:1e3*m,easing:ct,noMoveStart:!0},{originalEvent:e});}else o.rotateTo(c,{duration:1e3*m,easing:ct,noMoveStart:!0},{originalEvent:e});}else a();}},ut.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},ut.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,i=t.default.now();e.length>0&&i-e[0][0]>160;)e.shift();};var pt=t.bezier(0,0,.3,1),dt=function(e,i){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=i.clickTolerance||0,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this),t.default$31(this);};dt.prototype.isEnabled=function(){return"disabled"!==this._state},dt.prototype.isActive=function(){return"active"===this._state},dt.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("minemap-touch-drag-pan"),this._state="enabled");},dt.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("minemap-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled";}},dt.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==t.default$28.mouseButton(e)||(t.default$28.addEventListener(t.default$11.document,"mousemove",this._onMove,{capture:!0}),t.default$28.addEventListener(t.default$11.document,"mouseup",this._onMouseUp),this._start(e)));},dt.prototype.onTouchStart=function(e){"enabled"===this._state&&(e.touches.length>1||(t.default$28.addEventListener(t.default$11.document,"touchmove",this._onMove,{capture:!0,passive:!1}),t.default$28.addEventListener(t.default$11.document,"touchend",this._onTouchEnd),this._start(e)));},dt.prototype._start=function(e){t.default$11.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._lastPos=t.default$28.mousePos(this._el,e),this._inertia=[[t.default.now(),this._startPos]],this._panoFrame&&this._map._cancelRenderFrame(this._panoFrame);},dt.prototype._onMove=function(e){e.preventDefault();var i=t.default$28.mousePos(this._el,e);this._lastPos.equals(i)||"pending"===this._state&&i.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=i,this._drainInertiaBuffer(),this._inertia.push([t.default.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",e),this._fireEvent("movestart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)));},dt.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._startPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._startPos=this._lastPos,delete this._lastMoveEvent;}},dt.prototype._onMouseUp=function(e){if(0===t.default$28.mouseButton(e))switch(this._state){case"active":this._state="enabled",t.default$28.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(e);break;case"pending":this._state="enabled",this._unbind();}},dt.prototype._onTouchEnd=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();}},dt.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind();}},dt.prototype._unbind=function(){t.default$28.removeEventListener(t.default$11.document,"touchmove",this._onMove,{capture:!0,passive:!1}),t.default$28.removeEventListener(t.default$11.document,"touchend",this._onTouchEnd),t.default$28.removeEventListener(t.default$11.document,"mousemove",this._onMove,{capture:!0}),t.default$28.removeEventListener(t.default$11.document,"mouseup",this._onMouseUp),t.default$28.removeEventListener(t.default$11,"blur",this._onBlur);},dt.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._map._cancelRenderFrame(this._panoFrame),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._mouseDownPos,delete this._lastPos;},dt.prototype._inertialPan=function(e){this._fireEvent("dragend",e),this._drainInertiaBuffer();var i=this._inertia;if(i.length<2)this._fireEvent("moveend",e);else{var o=i[i.length-1],r=i[0],n=o[1].sub(r[1]),a=(o[0]-r[0])/1e3;if(0===a||o[1].equals(r[1]))this._fireEvent("moveend",e);else{var s=n.mult(.3/a),h=s.mag();h>1400&&(h=1400,s._unit()._mult(h));var l=h/750,c=s.mult(-l/2);if(this._map.transform.sphereRender||this._map.transform.panoramaMode){this._panoFrame&&this._map._cancelRenderFrame(this._panoFrame);var u=this._map.transform,p=0,d=0,f=0;if(0!==c.x&&0!==c.y)Math.abs(c.x)>Math.abs(c.y)?(p=10,d=10*c.y/c.x,f=c.x/10):(p=10*c.x/c.y,d=10,f=c.y/10);else if(0!==c.x&&0===c.y)p=10,f=c.x/10;else{if(0!==c.x||0===c.y)return;d=10,f=c.y/10;}var m=u.pointLocation(new t.default$14(u.width/2+p,u.height/2+10+d)),_=u.pointLocation(new t.default$14(u.width/2,u.height/2+10));this._panoTimeElapseStart=Date.now(),this._panoActivDuration=l,this.difLng=-(_.lng-m.lng)*f,this.difLat=-(_.lat-m.lat)*f,this._panoStartMapCenter=this._map.getCenter(),this._lastZoomNumber=u.zoom,this._panoFrame=this._map._requestRenderFrame(this._panoPanRender);}else this._map.panBy(c,{duration:1e3*l,easing:pt,noMoveStart:!0},{originalEvent:e,dragPanEmmit:!0});}}},dt.prototype._panoPanRender=function(){if(this._map.transform.panoramaMode||this._map.transform.zoom===this._lastZoomNumber){var t=pt((Date.now()-this._panoTimeElapseStart)/this._panoActivDuration/1e3),e=this._panoStartMapCenter.lat+this.difLat*t,i=this._panoStartMapCenter.lng+this.difLng*t;e<-90?e=-90:e>90&&(e=90),i<-180?i+=360:i>180&&(i-=360),this._map.setCenter([i,e]),Date.now()-this._panoTimeElapseStart<1e3*this._panoActivDuration?(this._panoFrame=this._map._requestRenderFrame(this._panoPanRender),this._fireEvent("moving",{})):this._fireEvent("moveend",{});}},dt.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},dt.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,i=t.default.now();e.length>0&&i-e[0][0]>160;)e.shift();};var ft=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this);};function mt(t){return t*(2-t)}ft.prototype.isEnabled=function(){return!!this._enabled},ft.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0);},ft.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1);},ft.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,i=0,o=0,r=0,n=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?o=1:(t.preventDefault(),n=-1);break;case 40:t.shiftKey?o=-1:(n=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),h={duration:300,delayEndEvents:500,easing:mt,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*i,pitch:a.getPitch()+10*o,offset:[100*-r,100*-n],center:a.getCenter()};a.easeTo(h,{originalEvent:t});}};var _t=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this);};_t.prototype.isEnabled=function(){return!!this._enabled},_t.prototype.isActive=function(){return!!this._active},_t.prototype.enable=function(){this.isEnabled()||(this._enabled=!0);},_t.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},_t.prototype.onTouchStart=function(t){var e=this;this.isEnabled()&&(t.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(t)):this._tapped=setTimeout(function(){e._tapped=null;},300)));},_t.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t));},_t.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t);},_t.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd);};var yt=t.bezier(0,0,.15,1),vt=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this);};vt.prototype.isEnabled=function(){return!!this._enabled},vt.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("minemap-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around);},vt.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("minemap-touch-zoom-rotate"),this._enabled=!1);},vt.prototype.disableRotation=function(){this._rotationDisabled=!0;},vt.prototype.enableRotation=function(){this._rotationDisabled=!1;},vt.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var i=t.default$28.mousePos(this._el,e.touches[0]),o=t.default$28.mousePos(this._el,e.touches[1]);this._startVec=i.sub(o),this._gestureIntent=void 0,this._inertia=[],t.default$28.addEventListener(t.default$11.document,"touchmove",this._onMove,{passive:!1}),t.default$28.addEventListener(t.default$11.document,"touchend",this._onEnd);}},vt.prototype._getTouchEventData=function(e){var i=t.default$28.mousePos(this._el,e.touches[0]),o=t.default$28.mousePos(this._el,e.touches[1]),r=i.sub(o);return{vec:r,center:i.add(o).div(2),scale:r.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*r.angleWith(this._startVec)/Math.PI}},vt.prototype._onMove=function(e){if(2===e.touches.length){var i=this._getTouchEventData(e),o=i.vec,r=i.scale,n=i.bearing;if(!this._gestureIntent){var a=Math.abs(1-r)>.15;Math.abs(n)>10?this._gestureIntent="rotate":a&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=o);}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault();}},vt.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var i=this._map.transform;this._startScale||(this._startScale=i.scale,this._startBearing=i.bearing);var o=this._getTouchEventData(this._lastTouchEvent),r=o.center,n=o.bearing,a=o.scale,s=i.pointLocation(r),h=i.locationPoint(s);"rotate"===e&&(i.bearing=this._startBearing+n),i.zoom=i.scaleZoom(this._startScale*a),i.setLocationAtPoint(s,h),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.default.now(),a,r]);}},vt.prototype._onEnd=function(e){t.default$28.removeEventListener(t.default$11.document,"touchmove",this._onMove,{passive:!1}),t.default$28.removeEventListener(t.default$11.document,"touchend",this._onEnd);var i=this._gestureIntent,o=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,i){this._map.fire(new t.Event(i+"end",{originalEvent:e})),this._drainInertiaBuffer();var r=this._inertia,n=this._map;if(r.length<2)n.snapToNorth({},{originalEvent:e});else{var a=r[r.length-1],s=r[0],h=n.transform.scaleZoom(o*a[1]),l=n.transform.scaleZoom(o*s[1]),c=h-l,u=(a[0]-s[0])/1e3,p=a[2];if(0!==u&&h!==l){var d=.15*c/u;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var f=1e3*Math.abs(d/(12*.15)),m=h+d*f/2e3;m<0&&(m=0),n.easeTo({zoom:m,duration:f,easing:yt,around:this._aroundCenter?n.getCenter():n.unproject(p),noMoveStart:!0},{originalEvent:e});}else n.snapToNorth({},{originalEvent:e});}}},vt.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,i=t.default.now();e.length>2&&i-e[0][0]>160;)e.shift();};var gt={scrollZoom:ht,boxZoom:lt,dragRotate:ut,dragPan:dt,keyboard:ft,doubleClickZoom:_t,touchZoomRotate:vt};var bt=function(e){function i(i,o){e.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,t.bindAll(["_renderFrameCallback"],this);}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getCenter=function(){return this.transform.center},i.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},i.prototype.panBy=function(e,i,o){return e=t.default$14.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),o)},i.prototype.panTo=function(e,i,o){return this.easeTo(t.extend({center:e},i),o)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},i.prototype.zoomTo=function(e,i,o){return this.easeTo(t.extend({zoom:e},i),o)},i.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},i.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},i.prototype.rotateTo=function(e,i,o){return this.easeTo(t.extend({bearing:e},i),o)},i.prototype.resetNorth=function(e,i){return this.transform.panoramaMode?(this.easeTo({center:[0,0],duration:2e3,bearing:0,pitch:0,zoom:1}),this.fire("panorama-resetangle")):this.rotateTo(0,t.extend({duration:1e3},e),i),this},i.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},i.prototype.cameraForBounds=function(e,i){if("number"==typeof(i=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o};}if(t.default$13(Object.keys(i.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"])){e=t.default$30.convert(e);var r=[(i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2],n=Math.min(i.padding.right,i.padding.left),a=Math.min(i.padding.top,i.padding.bottom);i.offset=[i.offset[0]+r[0],i.offset[1]+r[1]];var s=t.default$14.convert(i.offset),h=this.transform,l=h.project(e.getNorthWest()),c=h.project(e.getSouthEast()),u=c.sub(l),p=(h.width-2*n-2*Math.abs(s.x))/u.x,d=(h.height-2*a-2*Math.abs(s.y))/u.y;if(!(d<0||p<0))return i.center=h.unproject(l.add(c).div(2)),i.zoom=Math.min(h.scaleZoom(h.scale*Math.min(p,d)),i.maxZoom),i.bearing=0,i;t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");}else t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'");},i.prototype.fitBounds=function(e,i,o){var r=this.cameraForBounds(e,i);return r?(i=t.extend(r,i)).linear?this.easeTo(i,o):this.flyTo(i,o):this},i.prototype.jumpTo=function(e,i){this.stop();var o=this.transform,r=!1,n=!1,a=!1;return"zoom"in e&&o.zoom!==+e.zoom&&(r=!0,o.zoom=+e.zoom),void 0!==e.center&&(o.center=t.default$29.convert(e.center)),"bearing"in e&&o.bearing!==+e.bearing&&(n=!0,o.bearing=+e.bearing),"pitch"in e&&o.pitch!==+e.pitch&&(a=!0,o.pitch=+e.pitch),this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),r&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),n&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),a&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i))},i.prototype.easeTo=function(e,i){var o=this;this.stop(),!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate&&(e.duration=0);var r=this.transform,n=this.getZoom(),a=this.getBearing(),s=this.getPitch(),h="zoom"in e?+e.zoom:n,l="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,u=r.centerPoint.add(t.default$14.convert(e.offset)),p=r.pointLocation(u),d=t.default$29.convert(e.center||p);this._normalizeCenter(d);var f,m,_=r.project(p),y=r.project(d).sub(_),v=r.zoomScale(h-n);return e.around&&(f=t.default$29.convert(e.around),m=r.locationPoint(f)),this._zooming=h!==n,this._rotating=a!==l,this._pitching=c!==s,this._prepareEase(i,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(e){if(o._zooming&&(r.zoom=t.number(n,h,e)),o._rotating&&(r.bearing=t.number(a,l,e)),o._pitching&&(r.pitch=t.number(s,c,e)),f)r.setLocationAtPoint(f,m);else{var p=r.zoomScale(r.zoom-n),d=h>n?Math.min(2,v):Math.max(.5,v),g=Math.pow(d,1-e),b=r.unproject(_.add(y.mult(e*g)).mult(p));r.setLocationAtPoint(r.renderWorldCopies?b.wrap():b,u);}o._fireMoveEvents(i);},function(){e.delayEndEvents?o._easeEndTimeoutID=setTimeout(function(){return o._afterEase(i)},e.delayEndEvents):o._afterEase(i);},e),this},i.prototype._prepareEase=function(e,i){this._moving=!0,i||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e));},i.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e));},i.prototype._afterEase=function(e){var i=this._zooming,o=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,i&&this.fire(new t.Event("zoomend",e)),o&&this.fire(new t.Event("rotateend",e)),r&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e));},i.prototype.flyTo=function(e,i){var o=this;this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.sphereFly?t.easeForSphere:t.ease},e);var r=this.transform,n=this.getZoom(),a=this.getBearing(),s=this.getPitch(),h="zoom"in e?t.clamp(+e.zoom,r.minZoom,r.maxZoom):n,l="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,u=r.zoomScale(h-n),p=r.centerPoint.add(t.default$14.convert(e.offset)),d=r.pointLocation(p),f=t.default$29.convert(e.center||d);this._normalizeCenter(f);var m=r.project(d),_=r.project(f).sub(m),y=e.curve,v=Math.max(r.width,r.height),g=v/u,b=_.mag();if("minZoom"in e){var w=t.clamp(Math.min(e.minZoom,n,h),r.minZoom,r.maxZoom),E=v/r.zoomScale(w-n);y=Math.sqrt(E/b*2);}var x=y*y;function C(t){var e=(g*g-v*v+(t?-1:1)*x*x*b*b)/(2*(t?g:v)*x*b);return Math.log(Math.sqrt(e*e+1)-e)}function L(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}var S=C(0),I=function(t){return M(S)/M(S+y*t)},T=function(t){return v*((M(S)*(L(e=S+y*t)/M(e))-L(S))/x)/b;var e;},R=(C(1)-S)/y;if(Math.abs(b)<1e-6||!isFinite(R)){if(Math.abs(v-g)<1e-6)return this.easeTo(e,i);var $=g<v?-1:1;R=Math.abs(Math.log(g/v))/y,T=function(){return 0},I=function(t){return Math.exp($*y*t)};}if("duration"in e)e.duration=+e.duration;else{var P="screenSpeed"in e?+e.screenSpeed/y:+e.speed;e.duration=1e3*R/P;}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=a!==l,this._pitching=c!==s,this._prepareEase(i,!1),this._ease(function(u){var d=u*R,f=1/I(d);r.zoom=1===u?h:n+r.scaleZoom(f),o._rotating&&(r.bearing=t.number(a,l,u)),o._pitching&&(r.pitch=t.number(s,c,u));var y=r.unproject(m.add(_.mult(T(d))).mult(f));r.setLocationAtPoint(r.renderWorldCopies?y.wrap():y,p),o._fireMoveEvents(i),e.sphereFly&&(o.style.shouldUpdateSource=!1);},function(){return e.sphereFly&&(o.style.shouldUpdateSource=!0),o._afterEase(i)},e),this},i.prototype.isEasing=function(){return!!this._easeFrameId},i.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this);}return this},i.prototype._ease=function(e,i,o){!1===o.animate||0===o.duration?(e(1),i()):(this._easeStart=t.default.now(),this._easeOptions=o,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback));},i.prototype._renderFrameCallback=function(){var e=Math.min((t.default.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop();},i.prototype._normalizeBearing=function(e,i){e=t.wrap(e,-180,180);var o=Math.abs(e-i);return Math.abs(e-360-i)<o&&(e-=360),Math.abs(e+360-i)<o&&(e+=360),e},i.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0;}},i}(t.Evented),wt=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this);};wt.prototype.getDefaultPosition=function(){return"bottom-right"},wt.prototype.onAdd=function(e){var i=this.options&&this.options.compact;return this._map=e,this._container=t.default$28.create("div","minemap-ctrl minemap-ctrl-attrib"),i&&this._container.classList.add("minemap-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===i&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},wt.prototype.onRemove=function(){t.default$28.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0;},wt.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".minemap-improve-map"));var i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:t.default$32.ACCESS_TOKEN}];if(e){var o=i.reduce(function(t,e,o){return e.value&&(t+=e.key+"="+e.value+(o<i.length-1?"&":"")),t},"?");e.href="https://www.minemap.com/feedback/"+o+(this._map._hash?this._map._hash.getHashString(!0):"");}},wt.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink());},wt.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id;}var i=this._map.style.sourceCaches;for(var o in i){var r=i[o].getSource();r.attribution&&t.indexOf(r.attribution)<0&&t.push(r.attribution);}t.sort(function(t,e){return t.length-e.length}),(t=t.filter(function(e,i){for(var o=i+1;o<t.length;o++)if(t[o].indexOf(e)>=0)return!1;return!0})).length?(this._container.innerHTML=t.join(" | "),this._container.classList.remove("minemap-attrib-empty")):this._container.classList.add("minemap-attrib-empty"),this._editLink=null;}},wt.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("minemap-compact"):this._container.classList.remove("minemap-compact");};var Et=function(){t.bindAll(["_updateLogo"],this);};Et.prototype.onAdd=function(e){this._map=e,this._container=t.default$28.create("div","minemap-ctrl");var i=t.default$28.create("a","minemap-ctrl-logo");return i.target="_blank",i.href="https://www.minedata.cn/",i.setAttribute("aria-label","minedata logo"),i.setAttribute("rel","noopener"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},Et.prototype.onRemove=function(){t.default$28.remove(this._container),this._map.off("sourcedata",this._updateLogo);},Et.prototype.getDefaultPosition=function(){return"bottom-left"},Et.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none");},Et.prototype._logoRequired=function(){if(this._map.style)return!0};var xt=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1;};xt.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},xt.prototype.remove=function(t){for(var e=this._currentlyRunning,i=0,o=e?this._queue.concat(e):this._queue;i<o.length;i+=1){var r=o[i];if(r.id===t)return void(r.cancelled=!0)}},xt.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,i=t;e<i.length;e+=1){var o=i[e];if(!o.cancelled&&(o.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1;},xt.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[];};var Ct=function(e,i){this.map=i,this._sphereRender=e.sphereRender||!1,this._projection=e.projection||t.ProjectionType.MERCATOR,this.options=e;},Lt={sphereRender:{configurable:!0},projection:{configurable:!0}};Lt.sphereRender.set=function(t){this._sphereRender=t,this.map.transform.sphereRender=t;},Lt.sphereRender.get=function(){return this._sphereRender},Lt.projection.get=function(){return this._projection},Lt.projection.set=function(e){this._projection=e||t.ProjectionType.MERCATOR,this.map.transform.projection=this._projection,this.map.style.changWorkerProjection(this._projection),this.map.painter.projection=this._projection;},Object.defineProperties(Ct.prototype,Lt);var Mt=null,St=0,It=0,Tt={obj:null,init:function(t){Mt=t.cb,St=t.restrictX,It=t.restrictY,t.handler.onmousedown=this.start,t.handler.root=t.root||t.handler;var e=t.handler.root;e.onDragStart=t.dragStart||new Function,e.onDrag=t.onDrag||new Function,e.onDragEnd=t.onDragEnd||new Function;},start:function(e){var i=Tt.obj=this;i.style.cursor="move";var o=(e=e||Tt.fixEvent(t.default$11.event)).pageX,r=e.pageY;i.lastMouseX=o,i.lastMouseY=r;var n=i.root.offsetLeft,a=i.root.offsetTop;i.root.style.left=n+"px",i.root.style.top=a+"px",t.default$11.document.onmouseup=Tt.end,t.default$11.document.onmousemove=Tt.drag,i.root.onDragStart(n,a);},drag:function(e){var i=(e=e||Tt.fixEvent(t.default$11.event)).pageX,o=e.pageY,r=Tt.obj.root,n=r.style.left?parseInt(r.style.left):0,a=r.style.top?parseInt(r.style.top):0;n<=-1&&(n=-1),a<=-1&&(a=-1),n>=St&&(n=St),a>=It&&(a=It);var s=i-Tt.obj.lastMouseX+n,h=o-Tt.obj.lastMouseY+a;r.style.left=s+"px",r.style.top=h+"px",Tt.obj.root.onDrag(s,h),Tt.obj.lastMouseX=i,Tt.obj.lastMouseY=o;},end:function(){var e=Tt.obj.root.style.left?parseInt(Tt.obj.root.style.left):0,i=Tt.obj.root.style.top?parseInt(Tt.obj.root.style.top):0;Tt.obj.root.onDragEnd(e,i),t.default$11.setTimeout(function(){Mt(e,i);},100),t.default$11.document.onmousemove=null,t.default$11.document.onmouseup=null,Tt.obj=null;},fixEvent:function(e){return e.pageX=e.clientX+t.default$11.document.documentElement.scrollLeft,e.pageY=e.clientY+t.default$11.document.documentElement.scrollTop,e}};function Rt(e,i,o){if(e=new t.default$29(e.lng,e.lat),i){var r=new t.default$29(e.lng-360,e.lat),n=new t.default$29(e.lng+360,e.lat),a=o.locationPoint(e).distSqr(i);o.locationPoint(r).distSqr(i)<a?e=r:o.locationPoint(n).distSqr(i)<a&&(e=n);}for(;Math.abs(e.lng-o.center.lng)>180;){var s=o.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=o.width&&s.y<=o.height)break;e.lng>o.center.lng?e.lng-=360:e.lng+=360;}return e}var $t={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pt(t,e,i){var o=t.classList;for(var r in $t)o.remove("minemap-"+i+"-anchor-"+r);o.add("minemap-"+i+"-anchor-"+e);}var At=function(e){function i(i){if(e.call(this),(arguments[0]instanceof t.default$11.HTMLElement||2===arguments.length)&&(i=t.extend({element:i},arguments[1])),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._draggable=i&&i.draggable||!1,this._state="inactive",this._alt=0,i&&i.element)this._element=i.element,this._offset=t.default$14.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=t.default$28.create("div");var o=t.default$28.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var r=t.default$28.createNS("http://www.w3.org/2000/svg","g");r.setAttributeNS(null,"stroke","none"),r.setAttributeNS(null,"stroke-width","1"),r.setAttributeNS(null,"fill","none"),r.setAttributeNS(null,"fill-rule","evenodd");var n=t.default$28.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"fill-rule","nonzero");var a=t.default$28.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000");for(var s=0,h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];s<h.length;s+=1){var l=h[s],c=t.default$28.createNS("http://www.w3.org/2000/svg","ellipse");c.setAttributeNS(null,"opacity","0.04"),c.setAttributeNS(null,"cx","10.5"),c.setAttributeNS(null,"cy","5.80029008"),c.setAttributeNS(null,"rx",l.rx),c.setAttributeNS(null,"ry",l.ry),a.appendChild(c);}var u=t.default$28.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);var p=t.default$28.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(p);var d=t.default$28.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");var f=t.default$28.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(f);var m=t.default$28.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(6.0, 7.0)"),m.setAttributeNS(null,"fill","#FFFFFF");var _=t.default$28.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(8.0, 8.0)");var y=t.default$28.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#000000"),y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962");var v=t.default$28.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),_.appendChild(y),_.appendChild(v),n.appendChild(a),n.appendChild(u),n.appendChild(d),n.appendChild(m),n.appendChild(_),o.appendChild(n),this._element.appendChild(o),this._offset=t.default$14.convert(i&&i.offset||[0,-14]);}this._element.classList.add("minemap-marker"),this._popup=null;}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},i.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),delete this._map),t.default$28.remove(this._element),this._popup&&this._popup.remove(),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.default$29.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},i.prototype.getAltitude=function(){return this._alt},i.prototype.setAltitude=function(t){return this._alt=t,this._pos=null,this._popup&&this._popup.setAltitude(this._alt),this._update(),this},i.prototype.getElement=function(){return this._element},i.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset;}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat);}return this},i.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup();},i.prototype.getPopup=function(){return this._popup},i.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},i.prototype._update=function(e){if(this._map){if(this._map.transform.renderWorldCopies&&(this._lngLat=Rt(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat,this._alt)._add(this._offset),this._map.sphereRender){var i=this._map.transform.locationPointOfScreen(this._lngLat,this._alt);this._map.panoramaMode?i.w>0?this._element.style.visibility="hidden":this._element.style.visibility="visible":!this._map.transform.checkPositionForeground(this._lngLat)||i.w<0?this._element.style.visibility="hidden":this._element.style.visibility="visible";}e&&"moveend"!==e.type||(this._pos=this._pos.round()),t.default$28.setTransform(this._element,$t[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"),Pt(this._element,this._anchor,"marker");}},i.prototype.getOffset=function(){return this._offset},i.prototype.setOffset=function(e){return this._offset=t.default$14.convert(e),this._update(),this},i.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos,this._alt),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"));},i.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive";},i.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp));},i.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},i.prototype.isDraggable=function(){return this._draggable},i}(t.Evented),Dt=function(){this.counter=0,this.timeSave=Date.now(),this._state=!1,this.needClearTime=!0;},kt={state:{configurable:!0}};Dt.prototype.update=function(){if(this._state){var t=Date.now();this.needClearTime?this.needClearTime=!1:this.counter+=(t-this.timeSave)/1e3,this.timeSave=t;}},kt.state.get=function(){return this._state},kt.state.set=function(t){this._state=t,t||(this.needClearTime=!0);},Object.defineProperties(Dt.prototype,kt);var Bt=function(){};Bt.prototype._sunLightPosition=function(e,i){1===e.month?e.month=0:2===e.month?e.month=31:3===e.month?e.month=59:4===e.month?e.month=90:5===e.month?e.month=120:6===e.month?e.month=151:7===e.month?e.month=181:8===e.month?e.month=212:9===e.month?e.month=243:10===e.month?e.month=273:11===e.month?e.month=304:12===e.month&&(e.month=334),this._meanSolarTime=e.hour+e.minute/60-8,this._sunLatLng=[180-15*this._meanSolarTime,23.45*Math.sin(360*(e.month+e.date-80)/370*Math.PI/180)];var o=t.transformECEFToGeographic([],this._sunLatLng,t.default$27.TRANSFORM.R);this._sunLightCenter=[o[0],o[1],o[2]];},Bt.prototype._shadowSunPosition=function(t){var e=Math.round(t.target[0]/15),i=(this._meanSolarTime+e+24)%24+(t.target[0]-15*e)/15,o=t.target[1]*Math.PI/180,r=this._sunLatLng[1]*Math.PI/180,n=15*(i-12)*Math.PI/180,a=(Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos(n)).toPrecision(8),s=180*Math.asin(a)/Math.PI,h=((a*Math.sin(o)-Math.sin(r))/(Math.cos(s*Math.PI/180)*Math.cos(o))).toPrecision(8),l=180*Math.acos(h)/Math.PI;return s>=0?(i>=12&&(l=-l),this._shadow={active:!0,altitude:t.distance,bearing:l,color:[1,1,1],distanceToCameraDestination:0,farDistance:.783927971443699,hFov:60,id:"SUNLIGHT_CAMERA_ID",pitch:90-s,shadowColor:[.2,.2,.2],wFov:0,location:t.target},this._shadow):(this._shadow="night",this._shadow)},Bt.prototype.getSunLightPos=function(){return this._sunLightCenter};var Ot=t.default$11.HTMLImageElement,Ft=t.default$11.HTMLElement,zt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,logoControl:!0,attributionControl:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300,crossSourceCollisions:!0,sphereRender:!1,projection:t.ProjectionType.MERCATOR,localIdeographFontFamily:"PingFang SC,Microsoft YaHei,微软雅黑,Arial,sans-serif,黑体",defaultCursor:null},jt=function(i){function o(e){if(null!=(e=t.extend({},zt,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var o=new t.default$7(e.minZoom,e.maxZoom,e.renderWorldCopies,e.sphereRender||!1,e.projection);i.call(this,o,e),this.td_cameraManager=new t.default$33,this.sunLight=new Bt,this._shadowFlag=!1,this._viewShedFlag=!1,o.setMap(this),this.mapControl=new Ct(e,this),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new xt,this._fxaaRender=e.fxaaRender||!1,this._bloomRender=e.bloomRender||!1,this._bloomOptions={step:9,extent:6};var r=e.transformRequest;if(this._transformRequest=r?function(t,e){return r(t,e)||{url:t}}:function(t){return{url:t}},"string"==typeof e.container){var n=t.default$11.document.getElementById(e.container);if(!n)throw new Error("Container '"+e.container+"' not found.");this._container=n;}else{if(!(e.container instanceof Ft))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container;}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),void 0!==t.default$11&&(t.default$11.addEventListener("online",this._onWindowOnline,!1),t.default$11.addEventListener("resize",this._onWindowResize,!1)),function(e,i){var o=e.getCanvasContainer(),r=null,n=!1,a=null;for(var s in gt)e[s]=new gt[s](e,i),i.interactive&&i[s]&&e[s].enable(i[s]);t.default$28.addEventListener(o,"mouseout",function(t){e.fire(new nt("mouseout",e,t));}),t.default$28.addEventListener(o,"mousedown",function(r){n=!0,a=t.default$28.mousePos(o,r);var s=new nt("mousedown",e,r);e.fire(s),s.defaultPrevented||(i.interactive&&!e.doubleClickZoom.isActive()&&e.stop(),e.boxZoom.onMouseDown(r),e.boxZoom.isActive()||e.dragPan.isActive()||e.dragRotate.onMouseDown(r),e.boxZoom.isActive()||e.dragRotate.isActive()||e.dragPan.onMouseDown(r));}),t.default$28.addEventListener(o,"mouseup",function(t){var i=e.dragRotate.isActive();r&&!i&&e.fire(new nt("contextmenu",e,r)),r=null,n=!1,e.fire(new nt("mouseup",e,t));}),t.default$28.addEventListener(o,"mousemove",function(t){if(!e.dragPan.isActive()&&!e.dragRotate.isActive()){for(var i=t.target;i&&i!==o;)i=i.parentNode;i===o&&e.fire(new nt("mousemove",e,t));}}),t.default$28.addEventListener(o,"mouseover",function(t){for(var i=t.target;i&&i!==o;)i=i.parentNode;i===o&&e.fire(new nt("mouseover",e,t));}),t.default$28.addEventListener(o,"touchstart",function(t){var o=new at("touchstart",e,t);e.fire(o),o.defaultPrevented||(i.interactive&&e.stop(),e.boxZoom.isActive()||e.dragRotate.isActive()||e.dragPan.onTouchStart(t),e.touchZoomRotate.onStart(t),e.doubleClickZoom.onTouchStart(o));},{passive:!1}),t.default$28.addEventListener(o,"touchmove",function(t){e.fire(new at("touchmove",e,t));},{passive:!1}),t.default$28.addEventListener(o,"touchend",function(t){e.fire(new at("touchend",e,t));}),t.default$28.addEventListener(o,"touchcancel",function(t){e.fire(new at("touchcancel",e,t));}),t.default$28.addEventListener(o,"click",function(r){var n=t.default$28.mousePos(o,r);(n.equals(a)||n.dist(a)<i.clickTolerance)&&e.fire(new nt("click",e,r));}),t.default$28.addEventListener(o,"dblclick",function(t){var i=new nt("dblclick",e,t);e.fire(i),i.defaultPrevented||e.doubleClickZoom.onDblClick(i);}),t.default$28.addEventListener(o,"contextmenu",function(t){var i=e.dragRotate.isActive();n||i?n&&(r=t):e.fire(new nt("contextmenu",e,t)),t.preventDefault();}),t.default$28.addEventListener(o,"wheel",function(t){i.interactive&&e.stop();var o=new st("wheel",e,t);e.fire(o),o.defaultPrevented||e.scrollZoom.onWheel(t);},{passive:!1});}(this,e),this._hash=e.hash&&(new rt).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this.resize(),e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily,projection:e.projection}),e.attributionControl&&this.addControl(new wt),e.logoControl&&this.addControl(new Et,e.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet);}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this._overviewMapOptions=e,e.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1,this.setDefaultCursor(e.defaultCursor),this.timer=new Dt;var a=new Date,s=a.getMonth()+1,h=a.getDate(),l=a.getMinutes();this.setSunLight({month:s,date:h,hour:12,minute:l});}i&&(o.__proto__=i),o.prototype=Object.create(i&&i.prototype),o.prototype.constructor=o;var r={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},sphereRender:{configurable:!0},fxaaRender:{configurable:!0},bloomRender:{configurable:!0},projection:{configurable:!0},vertices:{configurable:!0},panoramaMode:{configurable:!0},fPMode:{configurable:!0},cameraHeightOffset:{configurable:!0}};return o.prototype.__onMove=function(){this.overviewMapInstance.setCenter(this.getCenter()),this.overviewMapInstance.setBearing(this.getBearing()),this.overviewMapInstance.setZoom(this.getZoom()<6?3:this.getZoom()-4);},o.prototype.disableDrag=function(){this.dragPan.disable();},o.prototype.enableDrag=function(){this.dragPan.enable();},o.prototype.setDefaultCursor=function(t){this._canvas.style.cursor=t||"";},o.prototype.setCursor=function(t){this.setDefaultCursor(t);},o.prototype.setZoomAndCenter=function(t,e){this.setZoom(t),this.setCenter(e);},o.prototype.getAllMarkers=function(){return this.__markerList},o.prototype.addMarker=function(t){!function(t,e){var i=t.length;for(;i--;)if(t[i]===e)return!0;return!1}(this.__markerList,t)&&t instanceof At&&(this.__markerList.push(t),t.addTo(this));},o.prototype.addMarkers=function(t){for(var e=0;e<t.length;e++)this.addMarker(t[e]);},o.prototype.removeMarker=function(t){t instanceof At&&t.remove();},o.prototype.removeMarkers=function(t){if(t)for(var e=0;e<t.length;e++){this.removeMarker(t[e]);for(var i=0;i<this.__markerList.length;i++)t[e]===this.__markerList[i]&&this.__markerList.splice(i,1);}else{for(var o=0;o<this.__markerList.length;o++)this.removeMarker(this.__markerList[o]);this.__markerList=[];}},o.prototype.addOverviewMap=function(){var e=this;this._overviewMapElement=t.default$11.document.createElement("div"),this._overviewMapElement.id="overviewMap_"+Math.random(),this._overviewMapElement.style.position="absolute",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.bottom="0px",this._overviewMapElement.style.right="0px",this._overviewMapElement.style.zIndex=200,this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px",this.getContainer().parentNode.parentNode.appendChild(this._overviewMapElement),this.overviewMapInstance=new o({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,maxZoom:17,minZoom:3,logoControl:!1,preserveDrawingBuffer:!0}),this.on("moveend",this.__onMove),setTimeout(function(){var i=t.default$11.document.createElement("div");e.overviewMapInstance.getCanvas().style.cursor="";var o=e.getBounds(),r=e.overviewMapInstance.project(o.getSouthWest()),n=e.overviewMapInstance.project(o.getNorthEast());n.y<=45&&(n=new t.default$14(n.x,45)),r.x<=45&&(r=new t.default$14(45,r.y)),i.style.top=Math.round(n.y)+"px",i.style.left=Math.round(r.x)+"px",i.style.width=Math.round(160-2*r.x)+"px",i.style.height=Math.round(160-2*n.y)+"px",i.style.border="2px solid red",i.style.position="absolute",e._overviewMapElement.appendChild(i),Tt.init({handler:e._overviewMapElement,root:i,restrictX:2*Math.round(r.x),restrictY:2*Math.round(n.y),cb:function(t,o){if(t-Math.round(r.x)!=0||o-Math.round(n.y)!=0){var a=e.overviewMapInstance.unproject([t-Math.round(r.x)+80,o-Math.round(n.y)+80]);e.flyTo({center:a,bearing:e.overviewMapInstance.getBearing()}),i.style.top=Math.round(n.y)+"px",i.style.left=Math.round(r.x)+"px";}}});},1e3);},o.prototype.openOverviewMap=function(t){this._overviewMap=t,this.overviewMapInstance?this._overviewMapElement.style.display="block":this.addOverviewMap();},o.prototype.closeOverviewMap=function(){this.overviewMapInstance&&(this._overviewMapElement.style.display="none");},o.prototype.getOverviewMap=function(){return this._overviewMap},o.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var i=t.onAdd(this),o=this._controlPositions[e];return-1!==e.indexOf("bottom")?o.insertBefore(i,o.firstChild):o.appendChild(i),this},o.prototype.removeControl=function(t){return t.onRemove(this),this},o.prototype.resize=function(e){var i=this._containerDimensions(),o=i[0],r=i[1];return this._resizeCanvas(o,r),this.transform.resize(o,r),this.painter.resize(o,r),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},o.prototype.getBounds=function(){return(new t.default$30).extend(this.transform.pointLocation(new t.default$14(0,0))).extend(this.transform.pointLocation(new t.default$14(this.transform.width,0))).extend(this.transform.pointLocation(new t.default$14(this.transform.width,this.transform.height))).extend(this.transform.pointLocation(new t.default$14(0,this.transform.height)))},o.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new t.default$30([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},o.prototype.setMaxBounds=function(e){if(e){var i=t.default$30.convert(e);this.transform.lngRange=[i.getWest(),i.getEast()],this.transform.latRange=[i.getSouth(),i.getNorth()],this.transform._constrain(),this._update();}else null!==e&&void 0!==e||(this.transform.lngRange=null,this.transform.latRange=null,this._update());return this},o.prototype.setMinZoom=function(t){if((t=null===t||void 0===t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},o.prototype.getMinZoom=function(){return this.transform.minZoom},o.prototype.setMaxZoom=function(t){if((t=null===t||void 0===t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},o.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},o.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update(),this},o.prototype.getMaxZoom=function(){return this.transform.maxZoom},o.prototype.project=function(e,i){return this.transform.locationPoint(t.default$29.convert(e),i)},o.prototype.unproject=function(e,i){return this.transform.pointLocation(t.default$14.convert(e),i)},o.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},o.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isActive()},o.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},o.prototype.on=function(t,e){return i.prototype.on.call(this,t,e)},o.prototype.off=function(t,e){return i.prototype.off.call(this,t,e)},o.prototype.queryRenderedFeatures=function(e,i){if(!this.style)return[];var o;if(void 0!==i||void 0===e||e instanceof t.default$14||Array.isArray(e)||(i=e,e=void 0),i=i||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.default$14||"number"==typeof e[0])o=[t.default$14.convert(e)];else{var r=t.default$14.convert(e[0]),n=t.default$14.convert(e[1]);o=[r,new t.default$14(n.x,r.y),n,new t.default$14(r.x,n.y),r];}return this.style.queryRenderedFeatures(o,i,this.transform)},o.prototype.querySpherePosition=function(e,i){var o;o=e.point instanceof t.default$14?e.point:t.default$14.convert(e.point);var r=this.style.querySpherePosition({point:o},i);return this.triggerRepaint(),r},o.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},o.prototype.setStyle=function(e,i){return((i=t.extend({},{localIdeographFontFamily:zt.localIdeographFontFamily},i)).keepUserInfo||i.diff)&&this.style&&e?(this._diffStyle(e,i),this):this._updateStyle(e,i)},o.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new ot(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},o.prototype._diffStyle=function(e,i){var o=this;if("string"==typeof e){var r=t.normalizeStyleURL(e),n=this._transformRequest(r,t.ResourceType.Style);t.getJSON(n,function(e,r){e?o.fire(new t.ErrorEvent(e)):r&&o._updateDiff(r,i);});}else"object"==typeof e&&this._updateDiff(e,i);},o.prototype._updateDiff=function(e,i){try{this.style.setState(e,i.keepUserInfo)&&this._update(!0);}catch(o){t.warnOnce("Unable to perform style diff: "+(o.message||o.error||o)+".  Rebuilding the style from scratch."),this._updateStyle(e,i);}},o.prototype.getStyle=function(){if(this.style)return this.style.serialize()},o.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},o.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},o.prototype.isSourceLoaded=function(e){var i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")));},o.prototype.clipGround=function(t){this.clipGroundState=!0,t.addTo(this,!0);},o.prototype.removeClipGround=function(t){this.clipGroundState=!1,t.removeFrom(this);},o.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var i=t[e]._tiles;for(var o in i){var r=i[o];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},o.prototype.addSourceType=function(t,e,i){return this.style.addSourceType(t,e,i)},o.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},o.prototype.getSource=function(t){return this.style.getSource(t)},o.prototype.addImage=function(e,i,o){void 0===o&&(o={});var r=o.pixelRatio;void 0===r&&(r=1);var n=o.sdf;if(void 0===n&&(n=!1),i instanceof Ot){var a=t.default.getImageData(i),s=a.width,h=a.height,l=a.data;this.style.addImage(e,{data:new t.RGBAImage({width:s,height:h},l),pixelRatio:r,sdf:n});}else{if(void 0===i.width||void 0===i.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=i.width,u=i.height,p=i.data;this.style.addImage(e,{data:new t.RGBAImage({width:c,height:u},new Uint8Array(p)),pixelRatio:r,sdf:n});}},o.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},o.prototype.removeImage=function(t){this.style.removeImage(t);},o.prototype.loadImage=function(e,i){t.getImage(this._transformRequest(e,t.ResourceType.Image),i);},o.prototype.listImages=function(){return this.style.listImages()},o.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},o.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},o.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},o.prototype.getLayer=function(t){return this.style.getLayer(t)},o.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},o.prototype.setSourceFilter=function(t,e){return this.style.setSourceFilter(t,e),this._update(!0),this},o.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0),this},o.prototype.getFilter=function(t){return this.style.getFilter(t)},o.prototype.setPaintProperty=function(t,e,i){return this.style.setPaintProperty(t,e,i),this._update(!0),this},o.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},o.prototype.setLayoutProperty=function(t,e,i){return this.style.setLayoutProperty(t,e,i),this._update(!0),this},o.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},o.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},o.prototype.getLight=function(){return this.style.getLight()},o.prototype.setSunLight=function(t){this.sunLight._sunLightPosition(t,this.painter),this._update(!0);},o.prototype.enableSunLight=function(){this.style.enableSunLight(),this._update(!0);},o.prototype.disableSunLight=function(){this.style.disableSunLight(),this._update(!0);},o.prototype.enableShadow=function(){this.openCameraView(t.default$27.CAMERA.SUNLIGHT_CAMERA_ID),this._shadowFlag=!0,this._update(!0);},o.prototype.disableShadow=function(){this.closeCameraView(t.default$27.CAMERA.SUNLIGHT_CAMERA_ID),this._shadowFlag=!1,this._update(!0);},o.prototype.setFeatureState=function(t,e){this.style.setFeatureState(t,e),this._update();},o.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},o.prototype.getContainer=function(){return this._container},o.prototype.getCanvasContainer=function(){return this._canvasContainer},o.prototype.getCanvas=function(){return this._canvas},o.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},o.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.default$11.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("minemap.css加载失败或者版本不正确");},o.prototype._setupContainer=function(){var e=this._container;e.classList.add("minemap-map"),(this._missingCSSCanary=t.default$28.create("div","minemap-canary",e)).style.visibility="hidden",this._detectMissingCSS();var i=this._canvasContainer=t.default$28.create("div","minemap-canvas-container",e);this._interactive&&i.classList.add("minemap-interactive"),this._canvas=t.default$28.create("canvas","minemap-canvas",i),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var o=this._containerDimensions();this._resizeCanvas(o[0],o[1]);var r=this._controlContainer=t.default$28.create("div","minemap-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(e){n[e]=t.default$28.create("div","minemap-ctrl-"+e,r);});},o.prototype._resizeCanvas=function(e,i){var o=t.default$11.devicePixelRatio||1;this._canvas.width=o*e,this._canvas.height=o*i,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px";},o.prototype._setupPainter=function(){var i=t.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},e.webGLContextAttributes),o=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);o?this.painter=new t.default$34(o,this.transform,this):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")));},o.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}));},o.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}));},o.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},o.prototype._update=function(t){this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint());},o.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},o.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t);},o.prototype._render=function(){this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var i=this.transform.zoom,o=t.default.now();this.style.zoomHistory.update(i,o);var r=new t.default$35(i,{now:o,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),n=r.crossFadingFactor();1===n&&n===this._crossFadingFactor||(e=!0,this._crossFadingFactor=n),this.style.update(r);}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty)&&this.triggerRepaint(),this},o.prototype.remove=function(){this._hash&&this._hash.remove(),this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==t.default$11&&(t.default$11.removeEventListener("resize",this._onWindowResize,!1),t.default$11.removeEventListener("online",this._onWindowOnline,!1));var e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),Nt(this._canvasContainer),Nt(this._controlContainer),Nt(this._missingCSSCanary),this._container.classList.remove("minemap-map"),this.fire(new t.Event("remove"));},o.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.default.frame(function(){e._frame=null,e._render(),e.timer.update();}));},o.prototype._rerender=function(){var e=this;this.style&&!this._frame&&(this._frame=t.default.frame(function(){e._frame=null,e._render(),e.timer.update();}));},o.prototype._onWindowOnline=function(){this._update();},o.prototype._onWindowResize=function(){this._trackResize&&this.resize()._update();},r.showTileBoundaries.get=function(){return!!this._showTileBoundaries},r.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update());},r.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},r.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update());},r.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},r.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update());},r.repaint.get=function(){return!!this._repaint},r.repaint.set=function(t){this._repaint=t,this._update();},r.sphereRender.get=function(){return!!this.mapControl.sphereRender},r.sphereRender.set=function(t){this.mapControl.sphereRender=t,this.setCenter([this.getCenter().lng+1e-7,this.getCenter().lat]),this._update(!0);},r.fxaaRender.set=function(t){this._fxaaRender=t;},r.fxaaRender.get=function(){return this._fxaaRender},r.bloomRender.set=function(t){this._bloomRender=t;},r.bloomRender.get=function(){return this._bloomRender},o.prototype.setBloomOptions=function(t){t&&(this._bloomOptions=t);},r.projection.get=function(){return this.mapControl._projection},r.projection.set=function(e){e!==t.ProjectionType.MERCATOR&&e!==t.ProjectionType.LATLON||(this.mapControl._projection=e);},r.vertices.get=function(){return!!this._vertices},r.vertices.set=function(t){this._vertices=t,this._update();},o.prototype._onData=function(e){this._update("style"===e.dataType),this.fire(new t.Event(e.dataType+"data",e));},o.prototype._onDataLoading=function(e){this.fire(new t.Event(e.dataType+"dataloading",e));},r.panoramaMode.get=function(){return this._panoramaMode},r.panoramaMode.set=function(t){this._panoramaMode=t,this.transform.panoramaMode=t,this.triggerRepaint();},r.fPMode.get=function(){return this.transform.fPMode},r.fPMode.set=function(t){this.transform.fPMode=t;},r.cameraHeightOffset.set=function(t){this.transform.cameraHeightOffset=t;},r.cameraHeightOffset.get=function(){return this.transform.cameraHeightOffset},o.prototype.setDemMaxTiles=function(t){t&&(this.transform.maxTiles=t);},o.prototype.addCameraView=function(t,e){return this.td_cameraManager.addCameraView(t,e)},o.prototype.deleteCameraView=function(t){return this.td_cameraManager.deleteCameraView(t)},o.prototype.openCameraView=function(t){return this.td_cameraManager.openCameraView(t)},o.prototype.closeCameraView=function(t){return this.td_cameraManager.closeCameraView(t)},o.prototype.getCameraView=function(t){return this.td_cameraManager.getCameraView(t)},o.prototype.getAllActiveCameraViews=function(){return this.td_cameraManager.getAllActiveCameraViews()},o.prototype.modifyCameraViewGroup=function(t){this.td_cameraManager.modifyCameraViewGroup(t);},o.prototype.modifyCameraViewById=function(t,e){this.td_cameraManager.modifyCameraViewById(t,e);},o.prototype.getTranslatedLngLatPoint=function(e,i){return t.getTranslatedLngLatPoint(e,i)},o.prototype.getCameraViewOptionFromStartEnd=function(e,i){var o=t.calcLocalCoords(i,e),r=o[0],n=o[1],a=o[2],s=Math.atan2(a,r)*(180/Math.PI),h=t.length(o),l=Math.atan(n/Math.sqrt(r*r+a*a));return{distance:h,bearing:s,pitch:l=180*l/Math.PI}},o.prototype.getTDSpaceCoord=function(e){if(e.disableLayer){var i=this.unproject(e.point,0);return{lngLat:i,geographic:i?t.transformECEFToGeographic([],i.toArray(),t.default$27.TRANSFORM.REAL_R):null,altitude:0}}var o=this.queryRenderedFeatures(e.point,{disableLayer:!1,modelHighlight:e.modelHighlight});if(0===o.length){var r=this.unproject(e.point,0);return{lngLat:r,geographic:r?t.transformECEFToGeographic([],r.toArray(),t.default$27.TRANSFORM.REAL_R):null,altitude:0}}var n=o[0].intersectionPoint,a=t.transformGeographicToECEF([],n);return{geographic:n,lngLat:new t.default$29(a[0],a[1]),altitude:(a[2]-t.default$27.TRANSFORM.R)*t.default$27.TRANSFORM.R_ZOOM}},Object.defineProperties(o.prototype,r),o}(bt);function Nt(t){t.parentNode&&t.parentNode.removeChild(t);}var Ut={showCompass:!0,showZoom:!0},Zt=function(e){var i=this;this.options=t.extend({},Ut,e),this._container=t.default$28.create("div","minemap-ctrl minemap-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(this._zoomInButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-in","Zoom In",function(){return i._map.zoomIn()}),this._zoomOutButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-out","Zoom Out",function(){return i._map.zoomOut()})),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("minemap-ctrl-icon minemap-ctrl-compass","Reset North",function(){return i._map.resetNorth()}),this._compassArrow=t.default$28.create("span","minemap-ctrl-compass-arrow",this._compass));};Zt.prototype._rotateCompassArrow=function(t){var e=this._map.panoramaMode?"rotate("+t.angle+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=e;},Zt.prototype.onAdd=function(e){return this._map=e,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._map.on("panorama-change-bearing",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ut(e,{button:"left",element:this._compass}),t.default$28.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.enable()),this._container},Zt.prototype.onRemove=function(){t.default$28.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._map.off("panorama-change-bearing",this._rotateCompassArrow),t.default$28.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.disable(),delete this._handler),delete this._map;},Zt.prototype._createButton=function(e,i,o){var r=t.default$28.create("button",e,this._container);return r.type="button",r.setAttribute("aria-label",i),r.addEventListener("click",o),r};var qt,Gt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0};var Wt=function(e){function i(i){e.call(this),this.options=t.extend({},Gt,i),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this);}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(e){var i;return this._map=e,this._container=t.default$28.create("div","minemap-ctrl minemap-ctrl-group"),i=this._setupUI,void 0!==qt?i(qt):void 0!==t.default$11.navigator.permissions?t.default$11.navigator.permissions.query({name:"geolocation"}).then(function(t){qt="denied"!==t.state,i(qt);}):(qt=!!t.default$11.navigator.geolocation,i(qt)),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.default$11.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),t.default$28.remove(this._container),this._map=void 0;},i.prototype._onSuccess=function(e){if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("minemap-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish();},i.prototype._updateCamera=function(e){var i=new t.default$29(e.coords.longitude,e.coords.latitude),o=e.coords.accuracy;this._map.fitBounds(i.toBounds(o),this.options.fitBoundsOptions,{geolocateSource:!0});},i.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove();},i.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("minemap-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish();},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0;},i.prototype._setupUI=function(e){var i=this;!1!==e?(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=t.default$28.create("button","minemap-ctrl-icon minemap-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=t.default$28.create("div","minemap-user-location-dot"),this._userLocationDotMarker=new At(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(e){e.geolocateSource||"ACTIVE_LOCK"!==i._watchState||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("minemap-ctrl-geolocate-background"),i._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),i.fire(new t.Event("trackuserlocationend")));})):t.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.");},i.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"));}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error");}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.default$11.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions));}else t.default$11.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){t.default$11.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null);},i}(t.Evented),Vt={maxWidth:100,unit:"metric"},Kt=function(e){this.options=t.extend({},Vt,e),t.bindAll(["_onMove","setUnit"],this);};function Ht(t,e,i,o){var r,n,a,s,h,l,c=o&&o.maxWidth||100,u=t._container.clientHeight/2,p=t._container.clientWidth/2,d=(r=t.unproject([p,u]),n=t.unproject([p+1,u]),a=Math.PI/180,s=r.lat*a,h=n.lat*a,l=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((n.lng-r.lng)*a),6371e3*Math.acos(Math.min(l,1))*c);if(o&&"imperial"===o.unit){var f=3.2808*d;if(f>5280)Xt(e,i,c,f/5280,"mi");else Xt(e,i,c,f,"ft");}else if(o&&"nautical"===o.unit){Xt(e,i,c,d/1852,"nm");}else Xt(e,i,c,d,"m");}function Xt(t,e,i,o,r){var n,a,s,h=(n=o,(a=Math.pow(10,(""+Math.floor(n)).length-1))*(s=(s=n/a)>=10?10:s>=5?5:s>=3?3:s>=2?2:1)),l=h/o;"m"===r&&h>=1e3&&(h/=1e3,r="km"),t.style.width=i*l+"px",e.innerHTML=h+r;}Kt.prototype.getDefaultPosition=function(){return"bottom-left"},Kt.prototype._onMove=function(){Ht(this._map,this._container,this._content,this.options);},Kt.prototype.onAdd=function(e){this._map=e,this._container=t.default$28.create("div","minemap-ctrl minemap-ctrl-scale",e.getContainer()),this._content=t.default$28.create("div","minemap-ctrl-scale-text",this._container),this._container.appendChild(this._content);var i=t.default$28.create("div","minemap-ctrl-scale-left-bar",this._container),o=t.default$28.create("div","minemap-ctrl-scale-right-bar",this._container),r=t.default$28.create("div","minemap-ctrl-scale-bottom-bar",this._container);return this._container.appendChild(i),this._container.appendChild(o),this._container.appendChild(r),this._map.on("move",this._onMove),this._onMove(),this._container},Kt.prototype.onRemove=function(){t.default$28.remove(this._container),this._map.off("move",this._onMove),this._map=void 0;},Kt.prototype.setUnit=function(t){this.options.unit=t,Ht(this._map,this._container,this._content,this.options);};var Yt=function(){this._fullscreen=!1,t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.default$11.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.default$11.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.default$11.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.default$11.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="minemap-ctrl";};Yt.prototype.onAdd=function(e){return this._map=e,this._mapContainer=this._map.getContainer(),this._container=t.default$28.create("div",this._className+" minemap-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._container},Yt.prototype.onRemove=function(){t.default$28.remove(this._container),this._map=null,t.default$11.document.removeEventListener(this._fullscreenchange,this._changeIcon);},Yt.prototype._checkFullscreenSupport=function(){return!!(t.default$11.document.fullscreenEnabled||t.default$11.document.mozFullScreenEnabled||t.default$11.document.msFullscreenEnabled||t.default$11.document.webkitFullscreenEnabled)},Yt.prototype._setupUI=function(){var e=this._fullscreenButton=t.default$28.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);e.setAttribute("aria-label","Toggle fullscreen"),e.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.default$11.document.addEventListener(this._fullscreenchange,this._changeIcon);},Yt.prototype._isFullscreen=function(){return this._fullscreen},Yt.prototype._changeIcon=function(){(t.default$11.document.fullscreenElement||t.default$11.document.mozFullScreenElement||t.default$11.document.webkitFullscreenElement||t.default$11.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"));},Yt.prototype._onClickFullscreen=function(){this._isFullscreen()?t.default$11.document.exitFullscreen?t.default$11.document.exitFullscreen():t.default$11.document.mozCancelFullScreen?t.default$11.document.mozCancelFullScreen():t.default$11.document.msExitFullscreen?t.default$11.document.msExitFullscreen():t.default$11.document.webkitCancelFullScreen&&t.default$11.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen();};var Jt={closeButton:!0,closeOnClick:!0,className:""},Qt=function(e){function i(i){e.call(this),this.options=t.extend(Object.create(Jt),i),this._alt=0,t.bindAll(["_update","_onClickClose"],this);}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(e){return this._map=e,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this.fire(new t.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&t.default$28.remove(this._content),this._container&&(t.default$28.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire(new t.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.default$29.convert(e),this._pos=null,this._update(),this},i.prototype.getAltitude=function(){return this._alt},i.prototype.setAltitude=function(t){return this._alt=t,this._pos=null,this._update(),this},i.prototype.setText=function(e){return this.setDOMContent(t.default$11.document.createTextNode(e))},i.prototype.setHTML=function(e){var i,o=t.default$11.document.createDocumentFragment(),r=t.default$11.document.createElement("body");for(r.innerHTML=e;i=r.firstChild;)o.appendChild(i);return this.setDOMContent(o)},i.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},i.prototype._createContent=function(){this._content&&t.default$28.remove(this._content),this._content=t.default$28.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=t.default$28.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose));},i.prototype._update=function(){var e=this;if(this._map&&this._lngLat&&this._content){this._container||(this._container=t.default$28.create("div","minemap-popup",this._map.getContainer()),this._tip=t.default$28.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(t){return e._container.classList.add(t)})),this._map.transform.renderWorldCopies&&(this._lngLat=Rt(this._lngLat,this._pos,this._map.transform));var i=this._pos=this._map.project(this._lngLat,this._alt),o=this.options.anchor,r=function e(i){if(i){if("number"==typeof i){var o=Math.round(Math.sqrt(.5*Math.pow(i,2)));return{center:new t.default$14(0,0),top:new t.default$14(0,i),"top-left":new t.default$14(o,o),"top-right":new t.default$14(-o,o),bottom:new t.default$14(0,-i),"bottom-left":new t.default$14(o,-o),"bottom-right":new t.default$14(-o,-o),left:new t.default$14(i,0),right:new t.default$14(-i,0)}}if(i instanceof t.default$14||Array.isArray(i)){var r=t.default$14.convert(i);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:t.default$14.convert(i.center||[0,0]),top:t.default$14.convert(i.top||[0,0]),"top-left":t.default$14.convert(i["top-left"]||[0,0]),"top-right":t.default$14.convert(i["top-right"]||[0,0]),bottom:t.default$14.convert(i.bottom||[0,0]),"bottom-left":t.default$14.convert(i["bottom-left"]||[0,0]),"bottom-right":t.default$14.convert(i["bottom-right"]||[0,0]),left:t.default$14.convert(i.left||[0,0]),right:t.default$14.convert(i.right||[0,0])}}return e(new t.default$14(0,0))}(this.options.offset);if(!o){var n,a=this._container.offsetWidth,s=this._container.offsetHeight;n=i.y+r.bottom.y<s?["top"]:i.y>this._map.transform.height-s?["bottom"]:[],i.x<a/2?n.push("left"):i.x>this._map.transform.width-a/2&&n.push("right"),o=0===n.length?"bottom":n.join("-");}var h=i.add(r[o]).round();if(t.default$28.setTransform(this._container,$t[o]+" translate("+h.x+"px,"+h.y+"px)"),Pt(this._container,o,"popup"),this._map.sphereRender){var l=this._map.transform.locationPointOfScreen(this._lngLat,this._alt);this._map.panoramaMode?l.w>0?this._container.style.visibility="hidden":this._container.style.visibility="visible":!this._map.transform.checkPositionForeground(this._lngLat)||l.w<0?this._container.style.visibility="hidden":this._container.style.visibility="visible";}}},i.prototype._onClickClose=function(){this.remove();},i}(t.Evented);var te={getJSON:t.getJSON,getArrayBuffer:t.getArrayBuffer},ee={version:t.version,supported:e,workerCount:Math.max(Math.floor(t.default.hardwareConcurrency/2),1),setRTLTextPlugin:t.setRTLTextPlugin,Map:jt,Navigation:Zt,Geolocate:Wt,Attribution:wt,Scale:Kt,Fullscreen:Yt,Popup:Qt,Marker:At,Style:ot,LngLat:t.default$29,LngLatBounds:t.default$30,Point:t.default$14,Evented:t.Evented,config:t.default$32,ProjectionType:t.ProjectionType,util:te,R:t.default$27.TRANSFORM.R,get accessToken(){return t.default$32.ACCESS_TOKEN},set accessToken(e){t.default$32.ACCESS_TOKEN=e;},get appKey(){return t.default$32.APP_KEY},set appKey(e){t.default$32.APP_KEY=e;},get solution(){return t.default$32.SOLU},set solution(e){t.default$32.SOLU=e;},get dataVersion(){return t.default$32.DATA_VERSION},set dataVersion(e){t.default$32.DATA_VERSION=e;},get TRW(){return t.default$32.TRW},set TRW(e){t.default$32.TRW=e;},get spriteUrl(){return t.default$32.spriteUrl},set spriteUrl(e){t.default$32.spriteUrl=e;},get fontsUrl(){return t.default$32.fontsUrl},set fontsUrl(e){t.default$32.fontsUrl=e;},get serviceUrl(){return t.default$32.SERVICE_URL},set serviceUrl(e){t.default$32.SERVICE_URL=e;},get domainUrl(){return t.default$32.DOMAIN},set domainUrl(e){t.default$32.DOMAIN=e,t.default$32.SRC_URL=t.default$32.DOMAIN+t.default$32.SRC_BASE,t.default$32.SERVICE_URL=t.default$32.DOMAIN+t.default$32.SERVICE_BASE;},get dataDomainUrl(){return t.default$32.DATA_DOMAIN},set dataDomainUrl(e){t.default$32.DATA_DOMAIN=e,t.default$32.API_URL=t.default$32.DATA_DOMAIN+t.default$32.API_BASE,t.default$32.DYN_URL=t.default$32.DATA_DOMAIN+t.default$32.DYN_BASE,t.default$32.MERGE_URL=t.default$32.DATA_DOMAIN+t.default$32.MERGE_BASE,t.default$32.OTHER_URL=t.default$32.DATA_DOMAIN+t.default$32.OTHER_BASE;},workerUrl:""};return ee});

return minemap;

})));
//# sourceMappingURL=minemap.js.map
